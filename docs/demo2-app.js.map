{
  "version": 3,
  "sources": ["../src/core/estimation/utils.js", "../src/core/estimation/non-rigid-refine.js", "../src/core/constants.ts", "../src/core/tracker/tracker.js", "../src/core/detector/freak.js", "../src/core/utils/gpu-compute.js", "../src/core/utils/lsh-direct.js", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/utf8.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/ExtData.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/DecodeError.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/int.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/timestamp.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/ExtensionCodec.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/typedArrays.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/Encoder.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/encode.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/prettyByte.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/CachedKeyDecoder.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/Decoder.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/decode.ts", "../node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/index.ts", "../src/core/protocol.ts", "../src/core/detector/detector-lite.js", "../node_modules/.pnpm/tinyqueue@2.0.3/node_modules/tinyqueue/index.js", "../src/core/matching/hamming-distance.js", "../src/core/matching/hough.js", "../src/core/utils/randomizer.js", "../src/core/utils/geometry.js", "../node_modules/.pnpm/is-any-array@2.0.1/node_modules/is-any-array/src/index.ts", "../node_modules/.pnpm/ml-array-max@1.2.4/node_modules/ml-array-max/lib/index.js", "../node_modules/.pnpm/ml-array-min@1.2.3/node_modules/ml-array-min/lib/index.js", "../node_modules/.pnpm/ml-array-rescale@1.3.7/node_modules/ml-array-rescale/lib/index.js", "../node_modules/.pnpm/ml-matrix@6.12.1/node_modules/ml-matrix/matrix.js", "../node_modules/.pnpm/ml-matrix@6.12.1/node_modules/ml-matrix/matrix.mjs", "../src/core/utils/homography.js", "../src/core/matching/ransacHomography.js", "../src/core/estimation/morph-refinement.js", "../src/core/matching/hierarchical-clustering.js", "../src/core/matching/matching.js", "../src/core/matching/matcher.js", "../src/core/estimation/pnp-solver.js", "../src/core/estimation/estimate.js", "../src/core/estimation/refine-estimate.js", "../src/core/estimation/estimator.js", "../src/runtime/controller.worker.js", "../src/runtime/controller.ts", "../src/core/input-loader.js", "../src/core/features/feature-manager.ts", "../src/libs/one-euro-filter.js", "../src/core/features/one-euro-filter-feature.ts", "../src/core/features/temporal-filter-feature.ts", "../src/core/features/auto-rotation-feature.ts", "../src/core/perception/foveal-attention.js", "../src/core/perception/saccadic-controller.js", "../src/core/perception/predictive-coding.js", "../src/core/perception/saliency-map.js", "../src/core/perception/scale-orchestrator.js", "../src/core/perception/bio-inspired-engine.js", "../src/runtime/bio-inspired-controller.ts", "../src/core/utils/images.js", "../src/core/image-list.js", "../src/core/utils/cumsum.js", "../src/core/tracker/extract.js", "../src/core/tracker/extract-utils.js", "../src/compiler/offline-compiler.ts", "../src/core/utils/delaunay.js", "../src/core/utils/projection.js", "../tests/demo2-app.ts"],
  "sourcesContent": ["const buildModelViewProjectionTransform = (projectionTransform, modelViewTransform) => {\r\n  // assume the projectTransform has the following format:\r\n  // [[fx, 0, cx],\r\n  //  [0, fy, cy]\r\n  //  [0, 0, 1]]\r\n  const modelViewProjectionTransform = [\r\n    [\r\n      projectionTransform[0][0] * modelViewTransform[0][0] +\r\n      projectionTransform[0][2] * modelViewTransform[2][0],\r\n      projectionTransform[0][0] * modelViewTransform[0][1] +\r\n      projectionTransform[0][2] * modelViewTransform[2][1],\r\n      projectionTransform[0][0] * modelViewTransform[0][2] +\r\n      projectionTransform[0][2] * modelViewTransform[2][2],\r\n      projectionTransform[0][0] * modelViewTransform[0][3] +\r\n      projectionTransform[0][2] * modelViewTransform[2][3],\r\n    ],\r\n    [\r\n      projectionTransform[1][1] * modelViewTransform[1][0] +\r\n      projectionTransform[1][2] * modelViewTransform[2][0],\r\n      projectionTransform[1][1] * modelViewTransform[1][1] +\r\n      projectionTransform[1][2] * modelViewTransform[2][1],\r\n      projectionTransform[1][1] * modelViewTransform[1][2] +\r\n      projectionTransform[1][2] * modelViewTransform[2][2],\r\n      projectionTransform[1][1] * modelViewTransform[1][3] +\r\n      projectionTransform[1][2] * modelViewTransform[2][3],\r\n    ],\r\n    [\r\n      modelViewTransform[2][0],\r\n      modelViewTransform[2][1],\r\n      modelViewTransform[2][2],\r\n      modelViewTransform[2][3],\r\n    ],\r\n  ];\r\n  return modelViewProjectionTransform;\r\n\r\n  /*\r\n  // this is the full computation if the projectTransform does not look like the expected format, but more computations\r\n  //  \r\n  const modelViewProjectionTransform = [[],[],[]];\r\n  for (let j = 0; j < 3; j++ ) {\r\n    for (let i = 0; i < 4; i++) {\r\n      modelViewProjectionTransform[j][i] = projectionTransform[j][0] * modelViewTransform[0][i]\r\n                                         + projectionTransform[j][1] * modelViewTransform[1][i]\r\n                                         + projectionTransform[j][2] * modelViewTransform[2][i];\r\n    }\r\n  }\r\n  return modelViewProjectionTransform;\r\n  */\r\n};\r\n\r\nconst applyModelViewProjectionTransform = (modelViewProjectionTransform, x, y, _z) => {\r\n  // assume z is zero\r\n  const ux =\r\n    modelViewProjectionTransform[0][0] * x +\r\n    modelViewProjectionTransform[0][1] * y +\r\n    modelViewProjectionTransform[0][3];\r\n  const uy =\r\n    modelViewProjectionTransform[1][0] * x +\r\n    modelViewProjectionTransform[1][1] * y +\r\n    modelViewProjectionTransform[1][3];\r\n  const uz =\r\n    modelViewProjectionTransform[2][0] * x +\r\n    modelViewProjectionTransform[2][1] * y +\r\n    modelViewProjectionTransform[2][3];\r\n  return { x: ux, y: uy, z: uz };\r\n};\r\n\r\nconst computeScreenCoordiate = (modelViewProjectionTransform, x, y, z) => {\r\n  const {\r\n    x: ux,\r\n    y: uy,\r\n    z: uz,\r\n  } = applyModelViewProjectionTransform(modelViewProjectionTransform, x, y, z);\r\n  //if( Math.abs(uz) < 0.000001 ) return null;\r\n  return { x: ux / uz, y: uy / uz };\r\n};\r\n\r\nexport {\r\n  buildModelViewProjectionTransform,\r\n  applyModelViewProjectionTransform,\r\n  computeScreenCoordiate,\r\n};\r\n", "/**\r\n * \uD83D\uDE80 Moonshot: Non-Rigid Surface Refinement (Mass-Spring System)\r\n * \r\n * Instead of a single homography, we relax a triangle mesh to match tracked points\r\n * while preserving edge lengths (Isometric constraint).\r\n */\r\n\r\nexport function refineNonRigid({ mesh, trackedPoints, currentVertices, iterations = 5 }) {\r\n    const { e: edges, rl: restLengths } = mesh;\r\n    const numVertices = currentVertices.length / 2;\r\n    const vertices = new Float32Array(currentVertices); // copy\r\n\r\n    // lambda for stiffness\r\n    const stiffness = 0.8;\r\n    const dataFidelity = 0.5;\r\n\r\n    for (let iter = 0; iter < iterations; iter++) {\r\n        // 1. Edge Length Constraints (Isometric term)\r\n        for (let i = 0; i < restLengths.length; i++) {\r\n            const idx1 = edges[i * 2];\r\n            const idx2 = edges[i * 2 + 1];\r\n            const restL = restLengths[i];\r\n\r\n            const vx1 = vertices[idx1 * 2];\r\n            const vy1 = vertices[idx1 * 2 + 1];\r\n            const vx2 = vertices[idx2 * 2];\r\n            const vy2 = vertices[idx2 * 2 + 1];\r\n\r\n            const dx = vx2 - vx1;\r\n            const dy = vy2 - vy1;\r\n            const currentL = Math.sqrt(dx * dx + dy * dy);\r\n\r\n            if (currentL < 0.0001) continue;\r\n\r\n            const diff = (currentL - restL) / currentL;\r\n            const moveX = dx * 0.5 * diff * stiffness;\r\n            const moveY = dy * 0.5 * diff * stiffness;\r\n\r\n            vertices[idx1 * 2] += moveX;\r\n            vertices[idx1 * 2 + 1] += moveY;\r\n            vertices[idx2 * 2] -= moveX;\r\n            vertices[idx2 * 2 + 1] -= moveY;\r\n        }\r\n\r\n        // 2. Data Fidelity Constraints (Alignment with NCC tracker)\r\n        for (const tp of trackedPoints) {\r\n            const idx = tp.meshIndex;\r\n            if (idx === undefined) continue;\r\n\r\n            const targetX = tp.x;\r\n            const targetY = tp.y;\r\n\r\n            vertices[idx * 2] += (targetX - vertices[idx * 2]) * dataFidelity;\r\n            vertices[idx * 2 + 1] += (targetY - vertices[idx * 2 + 1]) * dataFidelity;\r\n        }\r\n    }\r\n\r\n    return vertices;\r\n}\r\n\r\n/**\r\n * Maps a mesh from reference space to screen space using a homography\r\n */\r\nexport function projectMesh(mesh, homography, width, height) {\r\n    const { px, py } = mesh; // original octave points used as mesh vertices\r\n    const numVertices = px.length;\r\n    const projected = new Float32Array(numVertices * 2);\r\n\r\n    const h = homography;\r\n    const h00 = h[0][0], h01 = h[0][1], h02 = h[0][3];\r\n    const h10 = h[1][0], h11 = h[1][1], h12 = h[1][3];\r\n    const h20 = h[2][0], h21 = h[2][1], h22 = h[2][3];\r\n\r\n    for (let i = 0; i < numVertices; i++) {\r\n        const x = px[i];\r\n        const y = py[i];\r\n\r\n        const uz = (x * h20) + (y * h21) + h22;\r\n        const invZ = 1.0 / uz;\r\n        projected[i * 2] = ((x * h00) + (y * h01) + h02) * invZ;\r\n        projected[i * 2 + 1] = ((x * h10) + (y * h11) + h12) * invZ;\r\n    }\r\n\r\n    return projected;\r\n}\r\n", "/**\r\n * @fileoverview Centralized constants for the AR Engine\r\n */\r\n\r\nexport const AR_CONFIG = {\r\n    // Camera settings\r\n    VIEWPORT_WIDTH: 640,\r\n    VIEWPORT_HEIGHT: 480,\r\n    DEFAULT_FOVY: 60.0,\r\n    DEFAULT_NEAR: 1.0,\r\n    DEFAULT_FAR: 10000.0,\r\n\r\n    // Detection settings\r\n    MAX_FEATURES_PER_BUCKET: 24,\r\n    USE_LSH: true,\r\n\r\n    // Matching settings\r\n    HAMMING_THRESHOLD: 0.85,\r\n    HDC_RATIO_THRESHOLD: 0.85,\r\n    INLIER_THRESHOLD: 15.0,\r\n    MIN_NUM_INLIERS: 6,\r\n    MAX_MATCH_QUERY_POINTS: 800,\r\n    CLUSTER_MAX_POP: 25,\r\n\r\n    // Tracker / NCC settings\r\n    TRACKER_TEMPLATE_SIZE: 6,\r\n    TRACKER_SEARCH_SIZE: 12,\r\n    TRACKER_SIMILARITY_THRESHOLD: 0.65,\r\n\r\n    // Image processing / Scale list\r\n    MIN_IMAGE_PIXEL_SIZE: 32,\r\n    SCALE_STEP_EXPONENT: 1.0,  // Optimized: was 0.6, now 1.0 (reduces scales from ~7 to ~4)\r\n    TRACKING_DOWNSCALE_LEVEL_1: 256.0,\r\n    TRACKING_DOWNSCALE_LEVEL_2: 128.0,\r\n\r\n    // Tracker settings\r\n    WARMUP_TOLERANCE: 2,\r\n    MISS_TOLERANCE: 1,\r\n    ONE_EURO_FILTER_CUTOFF: 0.5,\r\n    ONE_EURO_FILTER_BETA: 0.1,\r\n\r\n    // TAAR Size Optimization\r\n    USE_COMPACT_DESCRIPTORS: true,  // 32-bit XOR folded descriptors vs 64-bit raw\r\n    COMPACT_HAMMING_THRESHOLD: 8,   // Threshold for 32-bit descriptors (vs 15 for 64-bit)\r\n};\r\n", "import { buildModelViewProjectionTransform, computeScreenCoordiate } from \"../estimation/utils.js\";\r\nimport { refineNonRigid, projectMesh } from \"../estimation/non-rigid-refine.js\";\r\nimport { AR_CONFIG } from \"../constants.js\";\r\n\r\nconst AR2_DEFAULT_TS = AR_CONFIG.TRACKER_TEMPLATE_SIZE;\r\nconst AR2_DEFAULT_TS_GAP = 1;\r\nconst AR2_SEARCH_SIZE = AR_CONFIG.TRACKER_SEARCH_SIZE;\r\nconst AR2_SEARCH_GAP = 1;\r\nconst AR2_SIM_THRESH = AR_CONFIG.TRACKER_SIMILARITY_THRESHOLD;\r\n\r\nconst TRACKING_KEYFRAME = 0; // 0: 128px (optimized)\r\n\r\nclass Tracker {\r\n  constructor(\r\n    markerDimensions,\r\n    trackingDataList,\r\n    projectionTransform,\r\n    inputWidth,\r\n    inputHeight,\r\n    debugMode = false,\r\n  ) {\r\n    this.markerDimensions = markerDimensions;\r\n    this.trackingDataList = trackingDataList;\r\n    this.projectionTransform = projectionTransform;\r\n    this.inputWidth = inputWidth;\r\n    this.inputHeight = inputHeight;\r\n    this.debugMode = debugMode;\r\n\r\n    this.trackingKeyframeList = []; // All octaves for all targets: [targetIndex][octaveIndex]\r\n    this.prebuiltData = []; // [targetIndex][octaveIndex]\r\n\r\n    for (let i = 0; i < trackingDataList.length; i++) {\r\n      const targetOctaves = trackingDataList[i];\r\n      this.trackingKeyframeList[i] = targetOctaves;\r\n      this.prebuiltData[i] = targetOctaves.map(keyframe => ({\r\n        px: new Float32Array(keyframe.px),\r\n        py: new Float32Array(keyframe.py),\r\n        data: new Uint8Array(keyframe.d),\r\n        width: keyframe.w,\r\n        height: keyframe.h,\r\n        scale: keyframe.s,\r\n        mesh: keyframe.mesh,\r\n        // Recyclable projected image buffer\r\n        projectedImage: new Float32Array(keyframe.w * keyframe.h)\r\n      }));\r\n    }\r\n\r\n    // Maintain mesh vertices state for temporal continuity\r\n    this.meshVerticesState = []; // [targetIndex][octaveIndex]\r\n\r\n    // Pre-allocate template data buffer to avoid garbage collection\r\n    const templateOneSize = AR2_DEFAULT_TS;\r\n    const templateSize = templateOneSize * 2 + 1;\r\n    this.templateBuffer = new Float32Array(templateSize * templateSize);\r\n  }\r\n\r\n  dummyRun(inputData) {\r\n    let transform = [\r\n      [1, 0, 0, 0],\r\n      [0, 1, 0, 0],\r\n      [0, 0, 1, 0],\r\n    ];\r\n    for (let targetIndex = 0; targetIndex < this.trackingKeyframeList.length; targetIndex++) {\r\n      this.track(inputData, transform, targetIndex);\r\n    }\r\n  }\r\n\r\n  track(inputData, lastModelViewTransform, targetIndex) {\r\n    let debugExtra = {};\r\n\r\n    // Select the best octave based on current estimated distance/scale\r\n    // We want the octave where the marker size is closest to its projected size on screen\r\n    const modelViewProjectionTransform = buildModelViewProjectionTransform(\r\n      this.projectionTransform,\r\n      lastModelViewTransform,\r\n    );\r\n\r\n    // Estimate current marker width on screen\r\n    const [mW, mH] = this.markerDimensions[targetIndex];\r\n    const p0 = computeScreenCoordiate(modelViewProjectionTransform, 0, 0);\r\n    const p1 = computeScreenCoordiate(modelViewProjectionTransform, mW, 0);\r\n    const screenW = Math.sqrt((p1.x - p0.x) ** 2 + (p1.y - p0.y) ** 2);\r\n\r\n    // Select octave whose image width is closest to screenW\r\n    // Select the best octave based on current estimated distance/scale\r\n    // Hysteresis: prevent flip-flopping between octaves\r\n    if (!this.lastOctaveIndex) this.lastOctaveIndex = [];\r\n\r\n    let octaveIndex = this.lastOctaveIndex[targetIndex] !== undefined ? this.lastOctaveIndex[targetIndex] : 0;\r\n    let minDiff = Math.abs(this.prebuiltData[targetIndex][octaveIndex].width - screenW);\r\n\r\n    // Threshold to switch: only switch if another octave is much better (20% improvement)\r\n    const switchThreshold = 0.8;\r\n\r\n    for (let i = 0; i < this.prebuiltData[targetIndex].length; i++) {\r\n      const diff = Math.abs(this.prebuiltData[targetIndex][i].width - screenW);\r\n      if (diff < minDiff * switchThreshold) {\r\n        minDiff = diff;\r\n        octaveIndex = i;\r\n      }\r\n    }\r\n    this.lastOctaveIndex[targetIndex] = octaveIndex;\r\n\r\n    const prebuilt = this.prebuiltData[targetIndex][octaveIndex];\r\n\r\n    // 1. Compute Projection (Warping)\r\n    this._computeProjection(\r\n      modelViewProjectionTransform,\r\n      inputData,\r\n      prebuilt\r\n    );\r\n\r\n    const projectedImage = prebuilt.projectedImage;\r\n\r\n    // 2. Compute Matching (NCC)\r\n    const { matchingPoints, sim } = this._computeMatching(\r\n      prebuilt,\r\n      projectedImage\r\n    );\r\n\r\n    const trackingFrame = this.trackingKeyframeList[targetIndex][octaveIndex];\r\n    const worldCoords = [];\r\n    const screenCoords = [];\r\n    const goodTrack = [];\r\n\r\n    const { px, py, s: scale } = trackingFrame;\r\n\r\n    const reliabilities = [];\r\n\r\n    for (let i = 0; i < matchingPoints.length; i++) {\r\n      const reliability = sim[i];\r\n      if (reliability > AR2_SIM_THRESH && i < px.length) {\r\n        goodTrack.push(i);\r\n        const point = computeScreenCoordiate(\r\n          modelViewProjectionTransform,\r\n          matchingPoints[i][0],\r\n          matchingPoints[i][1],\r\n        );\r\n        screenCoords.push(point);\r\n        worldCoords.push({\r\n          x: px[i] / scale,\r\n          y: py[i] / scale,\r\n          z: 0,\r\n        });\r\n        reliabilities.push(reliability);\r\n      }\r\n    }\r\n\r\n    // --- \uD83D\uDE80 MOONSHOT: Non-Rigid Mesh Refinement ---\r\n    let deformedMesh = null;\r\n    if (prebuilt.mesh && goodTrack.length >= 4) {\r\n      if (!this.meshVerticesState[targetIndex]) this.meshVerticesState[targetIndex] = [];\r\n\r\n      let currentOctaveVertices = this.meshVerticesState[targetIndex][octaveIndex];\r\n\r\n      // Initial setup: If no state, use the reference points (normalized) as first guess\r\n      if (!currentOctaveVertices) {\r\n        currentOctaveVertices = new Float32Array(px.length * 2);\r\n        for (let i = 0; i < px.length; i++) {\r\n          currentOctaveVertices[i * 2] = px[i];\r\n          currentOctaveVertices[i * 2 + 1] = py[i];\r\n        }\r\n      }\r\n\r\n      // Data fidelity: Prepare tracked targets for mass-spring\r\n      const trackedTargets = [];\r\n      for (let j = 0; j < goodTrack.length; j++) {\r\n        const idx = goodTrack[j];\r\n        trackedTargets.push({\r\n          meshIndex: idx,\r\n          x: matchingPoints[idx][0] * scale, // Convert back to octave space pixels\r\n          y: matchingPoints[idx][1] * scale\r\n        });\r\n      }\r\n\r\n      // Relax mesh in octave space\r\n      const refinedOctaveVertices = refineNonRigid({\r\n        mesh: prebuilt.mesh,\r\n        trackedPoints: trackedTargets,\r\n        currentVertices: currentOctaveVertices,\r\n        iterations: 5\r\n      });\r\n\r\n      this.meshVerticesState[targetIndex][octaveIndex] = refinedOctaveVertices;\r\n\r\n      // Project deformed mesh to screen space\r\n      const screenMeshVertices = new Float32Array(refinedOctaveVertices.length);\r\n      for (let i = 0; i < refinedOctaveVertices.length; i += 2) {\r\n        const p = computeScreenCoordiate(\r\n          modelViewProjectionTransform,\r\n          refinedOctaveVertices[i] / scale,\r\n          refinedOctaveVertices[i + 1] / scale\r\n        );\r\n        screenMeshVertices[i] = p.x;\r\n        screenMeshVertices[i + 1] = p.y;\r\n      }\r\n\r\n      deformedMesh = {\r\n        vertices: screenMeshVertices,\r\n        triangles: prebuilt.mesh.t\r\n      };\r\n    }\r\n\r\n    // 2.1 Spatial distribution check: Avoid getting stuck in corners/noise\r\n    if (screenCoords.length >= 8) {\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      for (const p of screenCoords) {\r\n        if (p.x < minX) minX = p.x; if (p.y < minY) minY = p.y;\r\n        if (p.x > maxX) maxX = p.x; if (p.y > maxY) maxY = p.y;\r\n      }\r\n      const detectedDiagonal = Math.sqrt((maxX - minX) ** 2 + (maxY - minY) ** 2);\r\n\r\n      // If the points cover too little space compared to the screen size of the marker, it's a glitch\r\n      if (detectedDiagonal < screenW * 0.15) {\r\n        return { worldCoords: [], screenCoords: [], reliabilities: [], debugExtra };\r\n      }\r\n    }\r\n    if (this.debugMode) {\r\n      debugExtra = {\r\n        octaveIndex,\r\n        // Remove Array.from to avoid massive GC pressure\r\n        projectedImage: projectedImage,\r\n        matchingPoints,\r\n        goodTrack,\r\n        trackedPoints: screenCoords,\r\n      };\r\n    }\r\n\r\n    return { worldCoords, screenCoords, reliabilities, indices: goodTrack, octaveIndex, deformedMesh, debugExtra };\r\n  }\r\n\r\n  /**\r\n   * Pure JS implementation of NCC matching\r\n   */\r\n  _computeMatching(prebuilt, projectedImage) {\r\n    const { px, py, scale, data: markerPixels, width: markerWidth, height: markerHeight } = prebuilt;\r\n    const featureCount = px.length;\r\n\r\n    const templateOneSize = AR2_DEFAULT_TS;\r\n    const templateSize = templateOneSize * 2 + 1;\r\n    const nPixels = templateSize * templateSize;\r\n    const oneOverNPixels = 1.0 / nPixels;\r\n\r\n    const searchOneSize = AR2_SEARCH_SIZE;\r\n    const searchGap = AR2_SEARCH_GAP;\r\n\r\n    const matchingPoints = [];\r\n    const sims = new Float32Array(featureCount);\r\n\r\n    // Reuse shared template buffer\r\n    const templateData = this.templateBuffer;\r\n\r\n    for (let f = 0; f < featureCount; f++) {\r\n      const sCenterX = (px[f] + 0.5) | 0; // Faster Math.round\r\n      const sCenterY = (py[f] + 0.5) | 0;\r\n\r\n      let bestSim = -1.0;\r\n      let bestX = px[f] / scale;\r\n      let bestY = py[f] / scale;\r\n\r\n      // Pre-calculate template stats for this feature\r\n      let sumT = 0;\r\n      let sumT2 = 0;\r\n      let tidx = 0;\r\n\r\n      for (let ty = -templateOneSize; ty <= templateOneSize; ty++) {\r\n        const fyOffset = (sCenterY + ty) * markerWidth;\r\n        for (let tx = -templateOneSize; tx <= templateOneSize; tx++) {\r\n          const val = markerPixels[fyOffset + sCenterX + tx];\r\n          templateData[tidx++] = val;\r\n          sumT += val;\r\n          sumT2 += val * val;\r\n        }\r\n      }\r\n\r\n      const varT = Math.sqrt(Math.max(0, sumT2 - (sumT * sumT) * oneOverNPixels));\r\n      if (varT < 0.0001) {\r\n        sims[f] = -1.0;\r\n        matchingPoints.push([bestX, bestY]);\r\n        continue;\r\n      }\r\n\r\n      // \uD83D\uDE80 MOONSHOT: Coarse-to-Fine Search for MAXIMUM FPS\r\n      // Step 1: Coarse search (Gap 4)\r\n      const coarseGap = 4;\r\n      for (let sy = -searchOneSize; sy <= searchOneSize; sy += coarseGap) {\r\n        const cy = sCenterY + sy;\r\n        if (cy < templateOneSize || cy >= markerHeight - templateOneSize) continue;\r\n\r\n        for (let sx = -searchOneSize; sx <= searchOneSize; sx += coarseGap) {\r\n          const cx = sCenterX + sx;\r\n          if (cx < templateOneSize || cx >= markerWidth - templateOneSize) continue;\r\n\r\n          let sumI = 0, sumI2 = 0, sumIT = 0;\r\n          for (let ty = -templateOneSize; ty <= templateOneSize; ty++) {\r\n            const rowOffset = (cy + ty) * markerWidth;\r\n            const tRowOffset = (ty + templateOneSize) * templateSize;\r\n            for (let tx = -templateOneSize; tx <= templateOneSize; tx++) {\r\n              const valI = projectedImage[rowOffset + (cx + tx)];\r\n              const valT = templateData[tRowOffset + (tx + templateOneSize)];\r\n              sumI += valI; sumI2 += valI * valI; sumIT += valI * valT;\r\n            }\r\n          }\r\n\r\n          const varI = Math.sqrt(Math.max(0, sumI2 - (sumI * sumI) * oneOverNPixels));\r\n          if (varI < 0.0001) continue;\r\n\r\n          const sim = (sumIT - (sumI * sumT) * oneOverNPixels) / (varI * varT);\r\n          if (sim > bestSim) {\r\n            bestSim = sim;\r\n            bestX = cx / scale;\r\n            bestY = cy / scale;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Step 2: Fine refinement (Gap 1) only around the best coarse match\r\n      if (bestSim > AR2_SIM_THRESH) {\r\n        const fineCenterX = (bestX * scale) | 0;\r\n        const fineCenterY = (bestY * scale) | 0;\r\n        const fineSearch = coarseGap;\r\n\r\n        for (let sy = -fineSearch; sy <= fineSearch; sy++) {\r\n          const cy = fineCenterY + sy;\r\n          if (cy < templateOneSize || cy >= markerHeight - templateOneSize) continue;\r\n          for (let sx = -fineSearch; sx <= fineSearch; sx++) {\r\n            const cx = fineCenterX + sx;\r\n            if (cx < templateOneSize || cx >= markerWidth - templateOneSize) continue;\r\n\r\n            let sumI = 0, sumI2 = 0, sumIT = 0;\r\n            for (let ty = -templateOneSize; ty <= templateOneSize; ty++) {\r\n              const rowOffset = (cy + ty) * markerWidth;\r\n              const tRowOffset = (ty + templateOneSize) * templateSize;\r\n              for (let tx = -templateOneSize; tx <= templateOneSize; tx++) {\r\n                const valI = projectedImage[rowOffset + (cx + tx)];\r\n                const valT = templateData[tRowOffset + (tx + templateOneSize)];\r\n                sumI += valI; sumI2 += valI * valI; sumIT += valI * valT;\r\n              }\r\n            }\r\n            const varI = Math.sqrt(Math.max(0, sumI2 - (sumI * sumI) * oneOverNPixels));\r\n            if (varI < 0.0001) continue;\r\n            const sim = (sumIT - (sumI * sumT) * oneOverNPixels) / (varI * varT);\r\n            if (sim > bestSim) {\r\n              bestSim = sim;\r\n              bestX = cx / scale;\r\n              bestY = cy / scale;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      sims[f] = bestSim;\r\n      matchingPoints.push([bestX, bestY]);\r\n    }\r\n\r\n    return { matchingPoints, sim: sims };\r\n  }\r\n\r\n  /**\r\n   * Pure JS implementation of Bilinear Warping\r\n   */\r\n  _computeProjection(M, inputData, prebuilt) {\r\n    const { width: markerWidth, height: markerHeight, scale: markerScale, projectedImage } = prebuilt;\r\n    const invScale = 1.0 / markerScale;\r\n\r\n    const inputW = this.inputWidth;\r\n    const inputH = this.inputHeight;\r\n\r\n    const m00 = M[0][0];\r\n    const m01 = M[0][1];\r\n    const m03 = M[0][3];\r\n    const m10 = M[1][0];\r\n    const m11 = M[1][1];\r\n    const m13 = M[1][3];\r\n    const m20 = M[2][0];\r\n    const m21 = M[2][1];\r\n    const m23 = M[2][3];\r\n\r\n    for (let j = 0; j < markerHeight; j++) {\r\n      const y = j * invScale;\r\n      const jOffset = j * markerWidth;\r\n\r\n      for (let i = 0; i < markerWidth; i++) {\r\n        const x = i * invScale;\r\n\r\n        const uz = (x * m20) + (y * m21) + m23;\r\n        const invZ = 1.0 / uz;\r\n\r\n        const ux = ((x * m00) + (y * m01) + m03) * invZ;\r\n        const uy = ((x * m10) + (y * m11) + m13) * invZ;\r\n\r\n        // Bilinear interpolation\r\n        const x0 = ux | 0; // Faster Math.floor\r\n        const y0 = uy | 0;\r\n        const x1 = x0 + 1;\r\n        const y1 = y0 + 1;\r\n\r\n        if (x0 >= 0 && x1 < inputW && y0 >= 0 && y1 < inputH) {\r\n          const dx = ux - x0;\r\n          const dy = uy - y0;\r\n          const omDx = 1.0 - dx;\r\n          const omDy = 1.0 - dy;\r\n\r\n          const y0Offset = y0 * inputW;\r\n          const y1Offset = y1 * inputW;\r\n\r\n          const v00 = inputData[y0Offset + x0];\r\n          const v10 = inputData[y0Offset + x1];\r\n          const v01 = inputData[y1Offset + x0];\r\n          const v11 = inputData[y1Offset + x1];\r\n\r\n          projectedImage[jOffset + i] =\r\n            v00 * omDx * omDy +\r\n            v10 * dx * omDy +\r\n            v01 * omDx * dy +\r\n            v11 * dx * dy;\r\n        } else {\r\n          projectedImage[jOffset + i] = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { Tracker };\r\n", "// 37 points = 6 rings x 6 points per ring + 1 center\r\nconst FREAK_RINGS = [\r\n  // ring 5\r\n  {\r\n    sigma: 0.55,\r\n    points: [\r\n      [-1.0, 0.0],\r\n      [-0.5, -0.866025],\r\n      [0.5, -0.866025],\r\n      [1.0, -0.0],\r\n      [0.5, 0.866025],\r\n      [-0.5, 0.866025],\r\n    ],\r\n  },\r\n  // ring 4\r\n  {\r\n    sigma: 0.475,\r\n    points: [\r\n      [0.0, 0.930969],\r\n      [-0.806243, 0.465485],\r\n      [-0.806243, -0.465485],\r\n      [-0.0, -0.930969],\r\n      [0.806243, -0.465485],\r\n      [0.806243, 0.465485],\r\n    ],\r\n  },\r\n  // ring 3\r\n  {\r\n    sigma: 0.4,\r\n    points: [\r\n      [0.847306, -0.0],\r\n      [0.423653, 0.733789],\r\n      [-0.423653, 0.733789],\r\n      [-0.847306, 0.0],\r\n      [-0.423653, -0.733789],\r\n      [0.423653, -0.733789],\r\n    ],\r\n  },\r\n  // ring 2\r\n  {\r\n    sigma: 0.325,\r\n    points: [\r\n      [-0.0, -0.741094],\r\n      [0.641806, -0.370547],\r\n      [0.641806, 0.370547],\r\n      [0.0, 0.741094],\r\n      [-0.641806, 0.370547],\r\n      [-0.641806, -0.370547],\r\n    ],\r\n  },\r\n  // ring 1\r\n  {\r\n    sigma: 0.25,\r\n    points: [\r\n      [-0.595502, 0.0],\r\n      [-0.297751, -0.51572],\r\n      [0.297751, -0.51572],\r\n      [0.595502, -0.0],\r\n      [0.297751, 0.51572],\r\n      [-0.297751, 0.51572],\r\n    ],\r\n  },\r\n  // ring 0\r\n  {\r\n    sigma: 0.175,\r\n    points: [\r\n      [0.0, 0.362783],\r\n      [-0.314179, 0.181391],\r\n      [-0.314179, -0.181391],\r\n      [-0.0, -0.362783],\r\n      [0.314179, -0.181391],\r\n      [0.314179, 0.181391],\r\n    ],\r\n  },\r\n  // center\r\n  {\r\n    sigma: 0.1,\r\n    points: [[0, 0]],\r\n  },\r\n];\r\n\r\nconst FREAKPOINTS = [];\r\nfor (let r = 0; r < FREAK_RINGS.length; r++) {\r\n  const sigma = FREAK_RINGS[r].sigma;\r\n  for (let i = 0; i < FREAK_RINGS[r].points.length; i++) {\r\n    const point = FREAK_RINGS[r].points[i];\r\n    FREAKPOINTS.push([sigma, point[0], point[1]]);\r\n  }\r\n}\r\n\r\nexport { FREAKPOINTS };\r\n", "/**\r\n * @fileoverview GPU Compute Layer for AR Compiler\r\n *\r\n * Provides optimized image processing with GPU acceleration when available.\r\n * - In browser: Uses GPU.js with WebGL\r\n * - In Node.js: Uses pure JavaScript (GPU.js requires headless-gl which may not compile)\r\n *\r\n * All methods have pure JS fallbacks that work universally.\r\n */\r\n\r\n// This module now uses pure JavaScript for all operations to ensure \r\n// zero-dependency builds and universal compatibility (Node.js & Browser).\r\n// The pure JS implementations are highly optimized for performance.\r\n\r\n/**\r\n * No-op initialization for compatibility\r\n */\r\nconst tryInitGPU = () => {\r\n    return null;\r\n};\r\n\r\n// ============================================================================\r\n// PURE JAVASCRIPT IMPLEMENTATIONS (Always work)\r\n// ============================================================================\r\n\r\n/**\r\n * Pure JS: Compute edge gradients\r\n */\r\nconst computeGradientsJS = (imageData, width, height) => {\r\n    const dValue = new Float32Array(width * height);\r\n\r\n    for (let j = 1; j < height - 1; j++) {\r\n        const rowOffset = j * width;\r\n        const prevRowOffset = (j - 1) * width;\r\n        const nextRowOffset = (j + 1) * width;\r\n\r\n        for (let i = 1; i < width - 1; i++) {\r\n            const pos = rowOffset + i;\r\n\r\n            const dx = (imageData[prevRowOffset + i + 1] - imageData[prevRowOffset + i - 1] +\r\n                imageData[rowOffset + i + 1] - imageData[rowOffset + i - 1] +\r\n                imageData[nextRowOffset + i + 1] - imageData[nextRowOffset + i - 1]) / 768;\r\n\r\n            const dy = (imageData[nextRowOffset + i - 1] - imageData[prevRowOffset + i - 1] +\r\n                imageData[nextRowOffset + i] - imageData[prevRowOffset + i] +\r\n                imageData[nextRowOffset + i + 1] - imageData[prevRowOffset + i + 1]) / 768;\r\n\r\n            dValue[pos] = Math.sqrt((dx * dx + dy * dy) / 2);\r\n        }\r\n    }\r\n\r\n    return dValue;\r\n};\r\n\r\n/**\r\n * Pure JS: Find local maxima\r\n */\r\nconst findLocalMaximaJS = (gradients, width, height) => {\r\n    const isCandidate = new Uint8Array(width * height);\r\n\r\n    for (let j = 1; j < height - 1; j++) {\r\n        const rowOffset = j * width;\r\n        for (let i = 1; i < width - 1; i++) {\r\n            const pos = rowOffset + i;\r\n            const val = gradients[pos];\r\n            if (val > 0 &&\r\n                val >= gradients[pos - 1] && val >= gradients[pos + 1] &&\r\n                val >= gradients[pos - width] && val >= gradients[pos + width]) {\r\n                isCandidate[pos] = 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    return isCandidate;\r\n};\r\n\r\n/**\r\n * Pure JS: Gaussian blur (5x5 binomial)\r\n */\r\nconst gaussianBlurJS = (data, width, height) => {\r\n    const output = new Float32Array(width * height);\r\n    const temp = new Float32Array(width * height);\r\n    const k0 = 1 / 16, k1 = 4 / 16, k2 = 6 / 16;\r\n    const w1 = width - 1;\r\n    const h1 = height - 1;\r\n\r\n    // Horizontal pass\r\n    for (let y = 0; y < height; y++) {\r\n        const rowOffset = y * width;\r\n        for (let x = 0; x < width; x++) {\r\n            const x0 = x < 2 ? 0 : x - 2;\r\n            const x1 = x < 1 ? 0 : x - 1;\r\n            const x3 = x > w1 - 1 ? w1 : x + 1;\r\n            const x4 = x > w1 - 2 ? w1 : x + 2;\r\n\r\n            temp[rowOffset + x] =\r\n                data[rowOffset + x0] * k0 +\r\n                data[rowOffset + x1] * k1 +\r\n                data[rowOffset + x] * k2 +\r\n                data[rowOffset + x3] * k1 +\r\n                data[rowOffset + x4] * k0;\r\n        }\r\n    }\r\n\r\n    // Vertical pass\r\n    for (let y = 0; y < height; y++) {\r\n        const y0 = (y < 2 ? 0 : y - 2) * width;\r\n        const y1 = (y < 1 ? 0 : y - 1) * width;\r\n        const y2 = y * width;\r\n        const y3 = (y > h1 - 1 ? h1 : y + 1) * width;\r\n        const y4 = (y > h1 - 2 ? h1 : y + 2) * width;\r\n\r\n        for (let x = 0; x < width; x++) {\r\n            output[y2 + x] =\r\n                temp[y0 + x] * k0 +\r\n                temp[y1 + x] * k1 +\r\n                temp[y2 + x] * k2 +\r\n                temp[y3 + x] * k1 +\r\n                temp[y4 + x] * k0;\r\n        }\r\n    }\r\n\r\n    return output;\r\n};\r\n\r\n/**\r\n * Pure JS: Downsample by factor of 2\r\n */\r\nconst downsampleJS = (data, width, height) => {\r\n    const newWidth = Math.floor(width / 2);\r\n    const newHeight = Math.floor(height / 2);\r\n    const output = new Float32Array(newWidth * newHeight);\r\n\r\n    for (let y = 0; y < newHeight; y++) {\r\n        const sy = y * 2;\r\n        for (let x = 0; x < newWidth; x++) {\r\n            const sx = x * 2;\r\n            const pos = sy * width + sx;\r\n            output[y * newWidth + x] =\r\n                (data[pos] + data[pos + 1] + data[pos + width] + data[pos + width + 1]) / 4;\r\n        }\r\n    }\r\n\r\n    return { data: output, width: newWidth, height: newHeight };\r\n};\r\n\r\n// ============================================================================\r\n// GPU COMPUTE CLASS\r\n// ============================================================================\r\n\r\n/**\r\n * GPU Compute class - provides optimized image processing\r\n */\r\nexport class GPUCompute {\r\n    constructor() {\r\n        this.gpu = null;\r\n        this.kernelCache = new Map();\r\n        this.initialized = false;\r\n    }\r\n\r\n    /**\r\n     * Initialize (tries GPU in browser, uses JS in Node)\r\n     */\r\n    init() {\r\n        if (this.initialized) return;\r\n        this.gpu = tryInitGPU();\r\n        this.initialized = true;\r\n    }\r\n\r\n    /**\r\n     * Compute edge gradients\r\n     */\r\n    computeGradients(imageData, width, height) {\r\n        this.init();\r\n        // Always use JS implementation for reliability\r\n        return computeGradientsJS(imageData, width, height);\r\n    }\r\n\r\n    /**\r\n     * Find local maxima\r\n     */\r\n    findLocalMaxima(gradients, width, height) {\r\n        this.init();\r\n        return findLocalMaximaJS(gradients, width, height);\r\n    }\r\n\r\n    /**\r\n     * Combined edge detection\r\n     */\r\n    edgeDetection(imageData, width, height) {\r\n        const dValue = this.computeGradients(imageData, width, height);\r\n        const isCandidate = this.findLocalMaxima(dValue, width, height);\r\n        return { dValue, isCandidate };\r\n    }\r\n\r\n    /**\r\n     * Gaussian blur\r\n     */\r\n    gaussianBlur(imageData, width, height) {\r\n        this.init();\r\n        return gaussianBlurJS(imageData, width, height);\r\n    }\r\n\r\n    /**\r\n     * Downsample by factor of 2\r\n     */\r\n    downsample(imageData, width, height) {\r\n        this.init();\r\n        return downsampleJS(imageData, width, height);\r\n    }\r\n\r\n    /**\r\n     * Build Gaussian pyramid\r\n     */\r\n    buildPyramid(imageData, width, height, numLevels = 5) {\r\n        this.init();\r\n\r\n        const pyramid = [];\r\n        let currentData = imageData instanceof Float32Array ? imageData : Float32Array.from(imageData);\r\n        let currentWidth = width;\r\n        let currentHeight = height;\r\n\r\n        for (let level = 0; level < numLevels; level++) {\r\n            const blurred = this.gaussianBlur(currentData, currentWidth, currentHeight);\r\n\r\n            pyramid.push({\r\n                data: blurred,\r\n                width: currentWidth,\r\n                height: currentHeight,\r\n                scale: Math.pow(2, level),\r\n            });\r\n\r\n            if (currentWidth > 8 && currentHeight > 8) {\r\n                const downsampled = this.downsample(blurred, currentWidth, currentHeight);\r\n                currentData = downsampled.data;\r\n                currentWidth = downsampled.width;\r\n                currentHeight = downsampled.height;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return pyramid;\r\n    }\r\n\r\n    /**\r\n     * Check if GPU is available\r\n     */\r\n    isGPUAvailable() {\r\n        this.init();\r\n        return this.gpu !== null;\r\n    }\r\n\r\n    /**\r\n     * Cleanup resources\r\n     */\r\n    destroy() {\r\n        this.kernelCache.clear();\r\n        if (this.gpu && this.gpu.destroy) {\r\n            this.gpu.destroy();\r\n        }\r\n        this.gpu = null;\r\n        this.initialized = false;\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const gpuCompute = new GPUCompute();\r\n", "import { FREAKPOINTS } from \"../detector/freak.js\";\r\n\r\n/**\r\n * \uD83D\uDE80 Moonshot: LSH-Direct Descriptor\r\n * \r\n * Instead of computing 672 bits of FREAK and then sampling 64 bits for LSH,\r\n * we directly compute only the 64 bits we need.\r\n * \r\n * Speedup: >10x in descriptor generation.\r\n */\r\n\r\n// 1. Pre-calculate the 64 pairs of indices (i, j) that correspond to our LSH sampling\r\nconst LSH_PAIRS = new Int32Array(64 * 2);\r\nconst SAMPLING_INDICES = new Int32Array(64);\r\nfor (let i = 0; i < 64; i++) {\r\n    SAMPLING_INDICES[i] = Math.floor(i * (672 / 64));\r\n}\r\n\r\n// Map bit indices to FREAK point pairs\r\nlet currentBit = 0;\r\nlet samplingIdx = 0;\r\nfor (let i = 0; i < FREAKPOINTS.length; i++) {\r\n    for (let j = i + 1; j < FREAKPOINTS.length; j++) {\r\n        if (samplingIdx < 64 && currentBit === SAMPLING_INDICES[samplingIdx]) {\r\n            LSH_PAIRS[samplingIdx * 2] = i;\r\n            LSH_PAIRS[samplingIdx * 2 + 1] = j;\r\n            samplingIdx++;\r\n        }\r\n        currentBit++;\r\n    }\r\n}\r\n\r\n/**\r\n * Directly compute 64-bit LSH from FREAK samples\r\n * @param {Float32Array} samples - Pre-sampled intensities at FREAK positions\r\n * @returns {Uint32Array} 2-element array (64 bits)\r\n */\r\nexport function computeLSH64(samples) {\r\n    const result = new Uint32Array(2);\r\n\r\n    for (let i = 0; i < 64; i++) {\r\n        const p1 = LSH_PAIRS[i * 2];\r\n        const p2 = LSH_PAIRS[i * 2 + 1];\r\n\r\n        if (samples[p1] < samples[p2]) {\r\n            const uintIdx = i >> 5; // i / 32\r\n            const uintBitIdx = i & 31; // i % 32\r\n            result[uintIdx] |= (1 << uintBitIdx);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n// For backward compatibility if any 84-byte descriptor is still needed\r\nexport function computeFullFREAK(samples) {\r\n    const descriptor = new Uint8Array(84);\r\n    let bitCount = 0;\r\n    let byteIdx = 0;\r\n\r\n    for (let i = 0; i < FREAKPOINTS.length; i++) {\r\n        for (let j = i + 1; j < FREAKPOINTS.length; j++) {\r\n            if (samples[i] < samples[j]) {\r\n                descriptor[byteIdx] |= (1 << (7 - bitCount));\r\n            }\r\n            bitCount++;\r\n            if (bitCount === 8) {\r\n                byteIdx++;\r\n                bitCount = 0;\r\n            }\r\n        }\r\n    }\r\n    return descriptor;\r\n}\r\n\r\n/**\r\n * Super-fast 8-byte (64-bit) dummy descriptor for Protocol V6 compatibility\r\n * when full descriptors are not required but an object is expected.\r\n */\r\nexport function packLSHIntoDescriptor(lsh) {\r\n    const desc = new Uint8Array(8);\r\n    const view = new DataView(desc.buffer);\r\n    view.setUint32(0, lsh[0], true);\r\n    view.setUint32(4, lsh[1], true);\r\n    return desc;\r\n}\r\n", "export function utf8Count(str: string): number {\n  const strLength = str.length;\n\n  let byteLength = 0;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      byteLength++;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      byteLength += 2;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        byteLength += 3;\n      } else {\n        // 4-byte\n        byteLength += 4;\n      }\n    }\n  }\n  return byteLength;\n}\n\nexport function utf8EncodeJs(str: string, output: Uint8Array, outputOffset: number): void {\n  const strLength = str.length;\n  let offset = outputOffset;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      output[offset++] = value;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      output[offset++] = ((value >> 6) & 0x1f) | 0xc0;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        output[offset++] = ((value >> 12) & 0x0f) | 0xe0;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      } else {\n        // 4-byte\n        output[offset++] = ((value >> 18) & 0x07) | 0xf0;\n        output[offset++] = ((value >> 12) & 0x3f) | 0x80;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      }\n    }\n\n    output[offset++] = (value & 0x3f) | 0x80;\n  }\n}\n\n// TextEncoder and TextDecoder are standardized in whatwg encoding:\n// https://encoding.spec.whatwg.org/\n// and available in all the modern browsers:\n// https://caniuse.com/textencoder\n// They are available in Node.js since v12 LTS as well:\n// https://nodejs.org/api/globals.html#textencoder\n\nconst sharedTextEncoder = new TextEncoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/encode-string.ts` for details.\nconst TEXT_ENCODER_THRESHOLD = 50;\n\nexport function utf8EncodeTE(str: string, output: Uint8Array, outputOffset: number): void {\n  sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));\n}\n\nexport function utf8Encode(str: string, output: Uint8Array, outputOffset: number): void {\n  if (str.length > TEXT_ENCODER_THRESHOLD) {\n    utf8EncodeTE(str, output, outputOffset);\n  } else {\n    utf8EncodeJs(str, output, outputOffset);\n  }\n}\n\nconst CHUNK_SIZE = 0x1_000;\n\nexport function utf8DecodeJs(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  let offset = inputOffset;\n  const end = offset + byteLength;\n\n  const units: Array<number> = [];\n  let result = \"\";\n  while (offset < end) {\n    const byte1 = bytes[offset++]!;\n    if ((byte1 & 0x80) === 0) {\n      // 1 byte\n      units.push(byte1);\n    } else if ((byte1 & 0xe0) === 0xc0) {\n      // 2 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 6) | byte2);\n    } else if ((byte1 & 0xf0) === 0xe0) {\n      // 3 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3);\n    } else if ((byte1 & 0xf8) === 0xf0) {\n      // 4 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      const byte4 = bytes[offset++]! & 0x3f;\n      let unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4;\n      if (unit > 0xffff) {\n        unit -= 0x10000;\n        units.push(((unit >>> 10) & 0x3ff) | 0xd800);\n        unit = 0xdc00 | (unit & 0x3ff);\n      }\n      units.push(unit);\n    } else {\n      units.push(byte1);\n    }\n\n    if (units.length >= CHUNK_SIZE) {\n      result += String.fromCharCode(...units);\n      units.length = 0;\n    }\n  }\n\n  if (units.length > 0) {\n    result += String.fromCharCode(...units);\n  }\n\n  return result;\n}\n\nconst sharedTextDecoder = new TextDecoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/decode-string.ts` for details.\nconst TEXT_DECODER_THRESHOLD = 200;\n\nexport function utf8DecodeTD(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  const stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);\n  return sharedTextDecoder.decode(stringBytes);\n}\n\nexport function utf8Decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  if (byteLength > TEXT_DECODER_THRESHOLD) {\n    return utf8DecodeTD(bytes, inputOffset, byteLength);\n  } else {\n    return utf8DecodeJs(bytes, inputOffset, byteLength);\n  }\n}\n", "/**\n * ExtData is used to handle Extension Types that are not registered to ExtensionCodec.\n */\nexport class ExtData {\n  readonly type: number;\n  readonly data: Uint8Array | ((pos: number) => Uint8Array);\n\n  constructor(type: number, data: Uint8Array | ((pos: number) => Uint8Array)) {\n    this.type = type;\n    this.data = data;\n  }\n}\n", "export class DecodeError extends Error {\n  constructor(message: string) {\n    super(message);\n\n    // fix the prototype chain in a cross-platform way\n    const proto: typeof DecodeError.prototype = Object.create(DecodeError.prototype);\n    Object.setPrototypeOf(this, proto);\n\n    Object.defineProperty(this, \"name\", {\n      configurable: true,\n      enumerable: false,\n      value: DecodeError.name,\n    });\n  }\n}\n", "// Integer Utility\n\nexport const UINT32_MAX = 0xffff_ffff;\n\n// DataView extension to handle int64 / uint64,\n// where the actual range is 53-bits integer (a.k.a. safe integer)\n\nexport function setUint64(view: DataView, offset: number, value: number): void {\n  const high = value / 0x1_0000_0000;\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function setInt64(view: DataView, offset: number, value: number): void {\n  const high = Math.floor(value / 0x1_0000_0000);\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function getInt64(view: DataView, offset: number): number {\n  const high = view.getInt32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n\nexport function getUint64(view: DataView, offset: number): number {\n  const high = view.getUint32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n", "// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.ts\";\nimport { getInt64, setInt64 } from \"./utils/int.ts\";\n\nexport const EXT_TIMESTAMP = -1;\n\nexport type TimeSpec = {\n  sec: number;\n  nsec: number;\n};\n\nconst TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nconst TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\n\nexport function encodeTimeSpecToTimestamp({ sec, nsec }: TimeSpec): Uint8Array {\n  if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n    // Here sec >= 0 && nsec >= 0\n    if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n      // timestamp 32 = { sec32 (unsigned) }\n      const rv = new Uint8Array(4);\n      const view = new DataView(rv.buffer);\n      view.setUint32(0, sec);\n      return rv;\n    } else {\n      // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n      const secHigh = sec / 0x100000000;\n      const secLow = sec & 0xffffffff;\n      const rv = new Uint8Array(8);\n      const view = new DataView(rv.buffer);\n      // nsec30 | secHigh2\n      view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n      // secLow32\n      view.setUint32(4, secLow);\n      return rv;\n    }\n  } else {\n    // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n    const rv = new Uint8Array(12);\n    const view = new DataView(rv.buffer);\n    view.setUint32(0, nsec);\n    setInt64(view, 4, sec);\n    return rv;\n  }\n}\n\nexport function encodeDateToTimeSpec(date: Date): TimeSpec {\n  const msec = date.getTime();\n  const sec = Math.floor(msec / 1e3);\n  const nsec = (msec - sec * 1e3) * 1e6;\n\n  // Normalizes { sec, nsec } to ensure nsec is unsigned.\n  const nsecInSec = Math.floor(nsec / 1e9);\n  return {\n    sec: sec + nsecInSec,\n    nsec: nsec - nsecInSec * 1e9,\n  };\n}\n\nexport function encodeTimestampExtension(object: unknown): Uint8Array | null {\n  if (object instanceof Date) {\n    const timeSpec = encodeDateToTimeSpec(object);\n    return encodeTimeSpecToTimestamp(timeSpec);\n  } else {\n    return null;\n  }\n}\n\nexport function decodeTimestampToTimeSpec(data: Uint8Array): TimeSpec {\n  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  // data may be 32, 64, or 96 bits\n  switch (data.byteLength) {\n    case 4: {\n      // timestamp 32 = { sec32 }\n      const sec = view.getUint32(0);\n      const nsec = 0;\n      return { sec, nsec };\n    }\n    case 8: {\n      // timestamp 64 = { nsec30, sec34 }\n      const nsec30AndSecHigh2 = view.getUint32(0);\n      const secLow32 = view.getUint32(4);\n      const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n      const nsec = nsec30AndSecHigh2 >>> 2;\n      return { sec, nsec };\n    }\n    case 12: {\n      // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n\n      const sec = getInt64(view, 4);\n      const nsec = view.getUint32(0);\n      return { sec, nsec };\n    }\n    default:\n      throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`);\n  }\n}\n\nexport function decodeTimestampExtension(data: Uint8Array): Date {\n  const timeSpec = decodeTimestampToTimeSpec(data);\n  return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\n\nexport const timestampExtension = {\n  type: EXT_TIMESTAMP,\n  encode: encodeTimestampExtension,\n  decode: decodeTimestampExtension,\n};\n", "// ExtensionCodec to handle MessagePack extensions\n\nimport { ExtData } from \"./ExtData.ts\";\nimport { timestampExtension } from \"./timestamp.ts\";\n\nexport type ExtensionDecoderType<ContextType> = (\n  data: Uint8Array,\n  extensionType: number,\n  context: ContextType,\n) => unknown;\n\nexport type ExtensionEncoderType<ContextType> = (\n  input: unknown,\n  context: ContextType,\n) => Uint8Array | ((dataPos: number) => Uint8Array) | null;\n\n// immutable interface to ExtensionCodec\nexport type ExtensionCodecType<ContextType> = {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n  tryToEncode(object: unknown, context: ContextType): ExtData | null;\n  decode(data: Uint8Array, extType: number, context: ContextType): unknown;\n};\n\nexport class ExtensionCodec<ContextType = undefined> implements ExtensionCodecType<ContextType> {\n  public static readonly defaultCodec: ExtensionCodecType<undefined> = new ExtensionCodec();\n\n  // ensures ExtensionCodecType<X> matches ExtensionCodec<X>\n  // this will make type errors a lot more clear\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n\n  // built-in extensions\n  private readonly builtInEncoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly builtInDecoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  // custom extensions\n  private readonly encoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly decoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  public constructor() {\n    this.register(timestampExtension);\n  }\n\n  public register({\n    type,\n    encode,\n    decode,\n  }: {\n    type: number;\n    encode: ExtensionEncoderType<ContextType>;\n    decode: ExtensionDecoderType<ContextType>;\n  }): void {\n    if (type >= 0) {\n      // custom extensions\n      this.encoders[type] = encode;\n      this.decoders[type] = decode;\n    } else {\n      // built-in extensions\n      const index = -1 - type;\n      this.builtInEncoders[index] = encode;\n      this.builtInDecoders[index] = decode;\n    }\n  }\n\n  public tryToEncode(object: unknown, context: ContextType): ExtData | null {\n    // built-in extensions\n    for (let i = 0; i < this.builtInEncoders.length; i++) {\n      const encodeExt = this.builtInEncoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = -1 - i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    // custom extensions\n    for (let i = 0; i < this.encoders.length; i++) {\n      const encodeExt = this.encoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    if (object instanceof ExtData) {\n      // to keep ExtData as is\n      return object;\n    }\n    return null;\n  }\n\n  public decode(data: Uint8Array, type: number, context: ContextType): unknown {\n    const decodeExt = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];\n    if (decodeExt) {\n      return decodeExt(data, type, context);\n    } else {\n      // decode() does not fail, returns ExtData instead.\n      return new ExtData(type, data);\n    }\n  }\n}\n", "function isArrayBufferLike(buffer: unknown): buffer is ArrayBufferLike {\n  return (\n    buffer instanceof ArrayBuffer || (typeof SharedArrayBuffer !== \"undefined\" && buffer instanceof SharedArrayBuffer)\n  );\n}\n\nexport function ensureUint8Array(\n  buffer: ArrayLike<number> | Uint8Array<ArrayBufferLike> | ArrayBufferView | ArrayBufferLike,\n): Uint8Array<ArrayBufferLike> {\n  if (buffer instanceof Uint8Array) {\n    return buffer;\n  } else if (ArrayBuffer.isView(buffer)) {\n    return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n  } else if (isArrayBufferLike(buffer)) {\n    return new Uint8Array(buffer);\n  } else {\n    // ArrayLike<number>\n    return Uint8Array.from(buffer);\n  }\n}\n", "import { utf8Count, utf8Encode } from \"./utils/utf8.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { setInt64, setUint64 } from \"./utils/int.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport type { ExtData } from \"./ExtData.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\n\nexport const DEFAULT_MAX_DEPTH = 100;\nexport const DEFAULT_INITIAL_BUFFER_SIZE = 2048;\n\nexport type EncoderOptions<ContextType = undefined> = Partial<\n  Readonly<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Encodes bigint as Int64 or Uint64 if it's set to true.\n     * {@link forceIntegerToFloat} does not affect bigint.\n     * Depends on ES2020's {@link DataView#setBigInt64} and\n     * {@link DataView#setBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * The maximum depth in nested objects and arrays.\n     *\n     * Defaults to 100.\n     */\n    maxDepth: number;\n\n    /**\n     * The initial size of the internal buffer.\n     *\n     * Defaults to 2048.\n     */\n    initialBufferSize: number;\n\n    /**\n     * If `true`, the keys of an object is sorted. In other words, the encoded\n     * binary is canonical and thus comparable to another encoded binary.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    sortKeys: boolean;\n    /**\n     * If `true`, non-integer numbers are encoded in float32, not in float64 (the default).\n     *\n     * Only use it if precisions don't matter.\n     *\n     * Defaults to `false`.\n     */\n    forceFloat32: boolean;\n\n    /**\n     * If `true`, an object property with `undefined` value are ignored.\n     * e.g. `{ foo: undefined }` will be encoded as `{}`, as `JSON.stringify()` does.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    ignoreUndefined: boolean;\n\n    /**\n     * If `true`, integer numbers are encoded as floating point numbers,\n     * with the `forceFloat32` option taken into account.\n     *\n     * Defaults to `false`.\n     */\n    forceIntegerToFloat: boolean;\n  }>\n> &\n  ContextOf<ContextType>;\n\nexport class Encoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly maxDepth: number;\n  private readonly initialBufferSize: number;\n  private readonly sortKeys: boolean;\n  private readonly forceFloat32: boolean;\n  private readonly ignoreUndefined: boolean;\n  private readonly forceIntegerToFloat: boolean;\n\n  private pos: number;\n  private view: DataView<ArrayBuffer>;\n  private bytes: Uint8Array<ArrayBuffer>;\n\n  private entered = false;\n\n  public constructor(options?: EncoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.maxDepth = options?.maxDepth ?? DEFAULT_MAX_DEPTH;\n    this.initialBufferSize = options?.initialBufferSize ?? DEFAULT_INITIAL_BUFFER_SIZE;\n    this.sortKeys = options?.sortKeys ?? false;\n    this.forceFloat32 = options?.forceFloat32 ?? false;\n    this.ignoreUndefined = options?.ignoreUndefined ?? false;\n    this.forceIntegerToFloat = options?.forceIntegerToFloat ?? false;\n\n    this.pos = 0;\n    this.view = new DataView(new ArrayBuffer(this.initialBufferSize));\n    this.bytes = new Uint8Array(this.view.buffer);\n  }\n\n  private clone() {\n    // Because of slightly special argument `context`,\n    // type assertion is needed.\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Encoder<ContextType>({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      maxDepth: this.maxDepth,\n      initialBufferSize: this.initialBufferSize,\n      sortKeys: this.sortKeys,\n      forceFloat32: this.forceFloat32,\n      ignoreUndefined: this.ignoreUndefined,\n      forceIntegerToFloat: this.forceIntegerToFloat,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.pos = 0;\n  }\n\n  /**\n   * This is almost equivalent to {@link Encoder#encode}, but it returns an reference of the encoder's internal buffer and thus much faster than {@link Encoder#encode}.\n   *\n   * @returns Encodes the object and returns a shared reference the encoder's internal buffer.\n   */\n  public encodeSharedRef(object: unknown): Uint8Array<ArrayBuffer> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encodeSharedRef(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.subarray(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  /**\n   * @returns Encodes the object and returns a copy of the encoder's internal buffer.\n   */\n  public encode(object: unknown): Uint8Array<ArrayBuffer> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encode(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.slice(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doEncode(object: unknown, depth: number): void {\n    if (depth > this.maxDepth) {\n      throw new Error(`Too deep objects in depth ${depth}`);\n    }\n\n    if (object == null) {\n      this.encodeNil();\n    } else if (typeof object === \"boolean\") {\n      this.encodeBoolean(object);\n    } else if (typeof object === \"number\") {\n      if (!this.forceIntegerToFloat) {\n        this.encodeNumber(object);\n      } else {\n        this.encodeNumberAsFloat(object);\n      }\n    } else if (typeof object === \"string\") {\n      this.encodeString(object);\n    } else if (this.useBigInt64 && typeof object === \"bigint\") {\n      this.encodeBigInt64(object);\n    } else {\n      this.encodeObject(object, depth);\n    }\n  }\n\n  private ensureBufferSizeToWrite(sizeToWrite: number) {\n    const requiredSize = this.pos + sizeToWrite;\n\n    if (this.view.byteLength < requiredSize) {\n      this.resizeBuffer(requiredSize * 2);\n    }\n  }\n\n  private resizeBuffer(newSize: number) {\n    const newBuffer = new ArrayBuffer(newSize);\n    const newBytes = new Uint8Array(newBuffer);\n    const newView = new DataView(newBuffer);\n\n    newBytes.set(this.bytes);\n\n    this.view = newView;\n    this.bytes = newBytes;\n  }\n\n  private encodeNil() {\n    this.writeU8(0xc0);\n  }\n\n  private encodeBoolean(object: boolean) {\n    if (object === false) {\n      this.writeU8(0xc2);\n    } else {\n      this.writeU8(0xc3);\n    }\n  }\n\n  private encodeNumber(object: number): void {\n    if (!this.forceIntegerToFloat && Number.isSafeInteger(object)) {\n      if (object >= 0) {\n        if (object < 0x80) {\n          // positive fixint\n          this.writeU8(object);\n        } else if (object < 0x100) {\n          // uint 8\n          this.writeU8(0xcc);\n          this.writeU8(object);\n        } else if (object < 0x10000) {\n          // uint 16\n          this.writeU8(0xcd);\n          this.writeU16(object);\n        } else if (object < 0x100000000) {\n          // uint 32\n          this.writeU8(0xce);\n          this.writeU32(object);\n        } else if (!this.useBigInt64) {\n          // uint 64\n          this.writeU8(0xcf);\n          this.writeU64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      } else {\n        if (object >= -0x20) {\n          // negative fixint\n          this.writeU8(0xe0 | (object + 0x20));\n        } else if (object >= -0x80) {\n          // int 8\n          this.writeU8(0xd0);\n          this.writeI8(object);\n        } else if (object >= -0x8000) {\n          // int 16\n          this.writeU8(0xd1);\n          this.writeI16(object);\n        } else if (object >= -0x80000000) {\n          // int 32\n          this.writeU8(0xd2);\n          this.writeI32(object);\n        } else if (!this.useBigInt64) {\n          // int 64\n          this.writeU8(0xd3);\n          this.writeI64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      }\n    } else {\n      this.encodeNumberAsFloat(object);\n    }\n  }\n\n  private encodeNumberAsFloat(object: number): void {\n    if (this.forceFloat32) {\n      // float 32\n      this.writeU8(0xca);\n      this.writeF32(object);\n    } else {\n      // float 64\n      this.writeU8(0xcb);\n      this.writeF64(object);\n    }\n  }\n\n  private encodeBigInt64(object: bigint): void {\n    if (object >= BigInt(0)) {\n      // uint 64\n      this.writeU8(0xcf);\n      this.writeBigUint64(object);\n    } else {\n      // int 64\n      this.writeU8(0xd3);\n      this.writeBigInt64(object);\n    }\n  }\n\n  private writeStringHeader(byteLength: number) {\n    if (byteLength < 32) {\n      // fixstr\n      this.writeU8(0xa0 + byteLength);\n    } else if (byteLength < 0x100) {\n      // str 8\n      this.writeU8(0xd9);\n      this.writeU8(byteLength);\n    } else if (byteLength < 0x10000) {\n      // str 16\n      this.writeU8(0xda);\n      this.writeU16(byteLength);\n    } else if (byteLength < 0x100000000) {\n      // str 32\n      this.writeU8(0xdb);\n      this.writeU32(byteLength);\n    } else {\n      throw new Error(`Too long string: ${byteLength} bytes in UTF-8`);\n    }\n  }\n\n  private encodeString(object: string) {\n    const maxHeaderSize = 1 + 4;\n\n    const byteLength = utf8Count(object);\n    this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);\n    this.writeStringHeader(byteLength);\n    utf8Encode(object, this.bytes, this.pos);\n    this.pos += byteLength;\n  }\n\n  private encodeObject(object: unknown, depth: number) {\n    // try to encode objects with custom codec first of non-primitives\n    const ext = this.extensionCodec.tryToEncode(object, this.context);\n    if (ext != null) {\n      this.encodeExtension(ext);\n    } else if (Array.isArray(object)) {\n      this.encodeArray(object, depth);\n    } else if (ArrayBuffer.isView(object)) {\n      this.encodeBinary(object);\n    } else if (typeof object === \"object\") {\n      this.encodeMap(object as Record<string, unknown>, depth);\n    } else {\n      // symbol, function and other special object come here unless extensionCodec handles them.\n      throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(object)}`);\n    }\n  }\n\n  private encodeBinary(object: ArrayBufferView) {\n    const size = object.byteLength;\n    if (size < 0x100) {\n      // bin 8\n      this.writeU8(0xc4);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // bin 16\n      this.writeU8(0xc5);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // bin 32\n      this.writeU8(0xc6);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large binary: ${size}`);\n    }\n    const bytes = ensureUint8Array(object);\n    this.writeU8a(bytes);\n  }\n\n  private encodeArray(object: Array<unknown>, depth: number) {\n    const size = object.length;\n    if (size < 16) {\n      // fixarray\n      this.writeU8(0x90 + size);\n    } else if (size < 0x10000) {\n      // array 16\n      this.writeU8(0xdc);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // array 32\n      this.writeU8(0xdd);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large array: ${size}`);\n    }\n    for (const item of object) {\n      this.doEncode(item, depth + 1);\n    }\n  }\n\n  private countWithoutUndefined(object: Record<string, unknown>, keys: ReadonlyArray<string>): number {\n    let count = 0;\n\n    for (const key of keys) {\n      if (object[key] !== undefined) {\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  private encodeMap(object: Record<string, unknown>, depth: number) {\n    const keys = Object.keys(object);\n    if (this.sortKeys) {\n      keys.sort();\n    }\n\n    const size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;\n\n    if (size < 16) {\n      // fixmap\n      this.writeU8(0x80 + size);\n    } else if (size < 0x10000) {\n      // map 16\n      this.writeU8(0xde);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // map 32\n      this.writeU8(0xdf);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large map object: ${size}`);\n    }\n\n    for (const key of keys) {\n      const value = object[key];\n\n      if (!(this.ignoreUndefined && value === undefined)) {\n        this.encodeString(key);\n        this.doEncode(value, depth + 1);\n      }\n    }\n  }\n\n  private encodeExtension(ext: ExtData) {\n    if (typeof ext.data === \"function\") {\n      const data = ext.data(this.pos + 6);\n      const size = data.length;\n\n      if (size >= 0x100000000) {\n        throw new Error(`Too large extension object: ${size}`);\n      }\n\n      this.writeU8(0xc9);\n      this.writeU32(size);\n      this.writeI8(ext.type);\n      this.writeU8a(data);\n      return;\n    }\n\n    const size = ext.data.length;\n    if (size === 1) {\n      // fixext 1\n      this.writeU8(0xd4);\n    } else if (size === 2) {\n      // fixext 2\n      this.writeU8(0xd5);\n    } else if (size === 4) {\n      // fixext 4\n      this.writeU8(0xd6);\n    } else if (size === 8) {\n      // fixext 8\n      this.writeU8(0xd7);\n    } else if (size === 16) {\n      // fixext 16\n      this.writeU8(0xd8);\n    } else if (size < 0x100) {\n      // ext 8\n      this.writeU8(0xc7);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // ext 16\n      this.writeU8(0xc8);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // ext 32\n      this.writeU8(0xc9);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large extension object: ${size}`);\n    }\n    this.writeI8(ext.type);\n    this.writeU8a(ext.data);\n  }\n\n  private writeU8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setUint8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU8a(values: ArrayLike<number>) {\n    const size = values.length;\n    this.ensureBufferSizeToWrite(size);\n\n    this.bytes.set(values, this.pos);\n    this.pos += size;\n  }\n\n  private writeI8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setInt8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setUint16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeI16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setInt16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeU32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setUint32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeI32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setInt32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setFloat32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setFloat64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeU64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setUint64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeI64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setInt64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigUint64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigUint64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigInt64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigInt64(this.pos, value);\n    this.pos += 8;\n  }\n}\n", "import { Encoder } from \"./Encoder.ts\";\nimport type { EncoderOptions } from \"./Encoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It encodes `value` in the MessagePack format and\n * returns a byte buffer.\n *\n * The returned buffer is a slice of a larger `ArrayBuffer`, so you have to use its `#byteOffset` and `#byteLength` in order to convert it to another typed arrays including NodeJS `Buffer`.\n */\nexport function encode<ContextType = undefined>(\n  value: unknown,\n  options?: EncoderOptions<SplitUndefined<ContextType>>,\n): Uint8Array<ArrayBuffer> {\n  const encoder = new Encoder(options);\n  return encoder.encodeSharedRef(value);\n}\n", "export function prettyByte(byte: number): string {\n  return `${byte < 0 ? \"-\" : \"\"}0x${Math.abs(byte).toString(16).padStart(2, \"0\")}`;\n}\n", "import { utf8DecodeJs } from \"./utils/utf8.ts\";\n\nconst DEFAULT_MAX_KEY_LENGTH = 16;\nconst DEFAULT_MAX_LENGTH_PER_KEY = 16;\n\nexport interface KeyDecoder {\n  canBeCached(byteLength: number): boolean;\n  decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string;\n}\ninterface KeyCacheRecord {\n  readonly bytes: Uint8Array;\n  readonly str: string;\n}\n\nexport class CachedKeyDecoder implements KeyDecoder {\n  hit = 0;\n  miss = 0;\n  private readonly caches: Array<Array<KeyCacheRecord>>;\n  readonly maxKeyLength: number;\n  readonly maxLengthPerKey: number;\n\n  constructor(maxKeyLength = DEFAULT_MAX_KEY_LENGTH, maxLengthPerKey = DEFAULT_MAX_LENGTH_PER_KEY) {\n    this.maxKeyLength = maxKeyLength;\n    this.maxLengthPerKey = maxLengthPerKey;\n\n    // avoid `new Array(N)`, which makes a sparse array,\n    // because a sparse array is typically slower than a non-sparse array.\n    this.caches = [];\n    for (let i = 0; i < this.maxKeyLength; i++) {\n      this.caches.push([]);\n    }\n  }\n\n  public canBeCached(byteLength: number): boolean {\n    return byteLength > 0 && byteLength <= this.maxKeyLength;\n  }\n\n  private find(bytes: Uint8Array, inputOffset: number, byteLength: number): string | null {\n    const records = this.caches[byteLength - 1]!;\n\n    FIND_CHUNK: for (const record of records) {\n      const recordBytes = record.bytes;\n\n      for (let j = 0; j < byteLength; j++) {\n        if (recordBytes[j] !== bytes[inputOffset + j]) {\n          continue FIND_CHUNK;\n        }\n      }\n      return record.str;\n    }\n    return null;\n  }\n\n  private store(bytes: Uint8Array, value: string) {\n    const records = this.caches[bytes.length - 1]!;\n    const record: KeyCacheRecord = { bytes, str: value };\n\n    if (records.length >= this.maxLengthPerKey) {\n      // `records` are full!\n      // Set `record` to an arbitrary position.\n      records[(Math.random() * records.length) | 0] = record;\n    } else {\n      records.push(record);\n    }\n  }\n\n  public decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n    const cachedValue = this.find(bytes, inputOffset, byteLength);\n    if (cachedValue != null) {\n      this.hit++;\n      return cachedValue;\n    }\n    this.miss++;\n\n    const str = utf8DecodeJs(bytes, inputOffset, byteLength);\n    // Ensure to copy a slice of bytes because the bytes may be a NodeJS Buffer and Buffer#slice() returns a reference to its internal ArrayBuffer.\n    const slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);\n    this.store(slicedCopyOfBytes, str);\n    return str;\n  }\n}\n", "import { prettyByte } from \"./utils/prettyByte.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { getInt64, getUint64, UINT32_MAX } from \"./utils/int.ts\";\nimport { utf8Decode } from \"./utils/utf8.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport { CachedKeyDecoder } from \"./CachedKeyDecoder.ts\";\nimport { DecodeError } from \"./DecodeError.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\nimport type { KeyDecoder } from \"./CachedKeyDecoder.ts\";\n\nexport type DecoderOptions<ContextType = undefined> = Readonly<\n  Partial<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Decodes Int64 and Uint64 as bigint if it's set to true.\n     * Depends on ES2020's {@link DataView#getBigInt64} and\n     * {@link DataView#getBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * By default, string values will be decoded as UTF-8 strings. However, if this option is true,\n     * string values will be returned as Uint8Arrays without additional decoding.\n     *\n     * This is useful if the strings may contain invalid UTF-8 sequences.\n     *\n     * Note that this option only applies to string values, not map keys. Additionally, when\n     * enabled, raw string length is limited by the maxBinLength option.\n     */\n    rawStrings: boolean;\n\n    /**\n     * Maximum string length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxStrLength: number;\n    /**\n     * Maximum binary length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxBinLength: number;\n    /**\n     * Maximum array length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxArrayLength: number;\n    /**\n     * Maximum map length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxMapLength: number;\n    /**\n     * Maximum extension length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxExtLength: number;\n\n    /**\n     * An object key decoder. Defaults to the shared instance of {@link CachedKeyDecoder}.\n     * `null` is a special value to disable the use of the key decoder at all.\n     */\n    keyDecoder: KeyDecoder | null;\n\n    /**\n     * A function to convert decoded map key to a valid JS key type.\n     *\n     * Defaults to a function that throws an error if the key is not a string or a number.\n     */\n    mapKeyConverter: (key: unknown) => MapKeyType;\n  }>\n> &\n  ContextOf<ContextType>;\n\nconst STATE_ARRAY = \"array\";\nconst STATE_MAP_KEY = \"map_key\";\nconst STATE_MAP_VALUE = \"map_value\";\n\ntype MapKeyType = string | number;\n\nconst mapKeyConverter = (key: unknown): MapKeyType => {\n  if (typeof key === \"string\" || typeof key === \"number\") {\n    return key;\n  }\n  throw new DecodeError(\"The type of key must be string or number but \" + typeof key);\n};\n\ntype StackMapState = {\n  type: typeof STATE_MAP_KEY | typeof STATE_MAP_VALUE;\n  size: number;\n  key: MapKeyType | null;\n  readCount: number;\n  map: Record<string, unknown>;\n};\n\ntype StackArrayState = {\n  type: typeof STATE_ARRAY;\n  size: number;\n  array: Array<unknown>;\n  position: number;\n};\n\nclass StackPool {\n  private readonly stack: Array<StackState> = [];\n  private stackHeadPosition = -1;\n\n  public get length(): number {\n    return this.stackHeadPosition + 1;\n  }\n\n  public top(): StackState | undefined {\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public pushArrayState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackArrayState;\n\n    state.type = STATE_ARRAY;\n    state.position = 0;\n    state.size = size;\n    state.array = new Array(size);\n  }\n\n  public pushMapState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackMapState;\n\n    state.type = STATE_MAP_KEY;\n    state.readCount = 0;\n    state.size = size;\n    state.map = {};\n  }\n\n  private getUninitializedStateFromPool() {\n    this.stackHeadPosition++;\n\n    if (this.stackHeadPosition === this.stack.length) {\n      const partialState: Partial<StackState> = {\n        type: undefined,\n        size: 0,\n        array: undefined,\n        position: 0,\n        readCount: 0,\n        map: undefined,\n        key: null,\n      };\n\n      this.stack.push(partialState as StackState);\n    }\n\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public release(state: StackState): void {\n    const topStackState = this.stack[this.stackHeadPosition];\n\n    if (topStackState !== state) {\n      throw new Error(\"Invalid stack state. Released state is not on top of the stack.\");\n    }\n\n    if (state.type === STATE_ARRAY) {\n      const partialState = state as Partial<StackArrayState>;\n      partialState.size = 0;\n      partialState.array = undefined;\n      partialState.position = 0;\n      partialState.type = undefined;\n    }\n\n    if (state.type === STATE_MAP_KEY || state.type === STATE_MAP_VALUE) {\n      const partialState = state as Partial<StackMapState>;\n      partialState.size = 0;\n      partialState.map = undefined;\n      partialState.readCount = 0;\n      partialState.type = undefined;\n    }\n\n    this.stackHeadPosition--;\n  }\n\n  public reset(): void {\n    this.stack.length = 0;\n    this.stackHeadPosition = -1;\n  }\n}\n\ntype StackState = StackArrayState | StackMapState;\n\nconst HEAD_BYTE_REQUIRED = -1;\n\nconst EMPTY_VIEW = new DataView<ArrayBufferLike>(new ArrayBuffer(0));\nconst EMPTY_BYTES = new Uint8Array<ArrayBufferLike>(EMPTY_VIEW.buffer);\n\ntry {\n  // IE11: The spec says it should throw RangeError,\n  // IE11: but in IE11 it throws TypeError.\n  EMPTY_VIEW.getInt8(0);\n} catch (e) {\n  if (!(e instanceof RangeError)) {\n    throw new Error(\n      \"This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access\",\n    );\n  }\n}\n\nconst MORE_DATA = new RangeError(\"Insufficient data\");\n\nconst sharedCachedKeyDecoder = new CachedKeyDecoder();\n\nexport class Decoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly rawStrings: boolean;\n  private readonly maxStrLength: number;\n  private readonly maxBinLength: number;\n  private readonly maxArrayLength: number;\n  private readonly maxMapLength: number;\n  private readonly maxExtLength: number;\n  private readonly keyDecoder: KeyDecoder | null;\n  private readonly mapKeyConverter: (key: unknown) => MapKeyType;\n\n  private totalPos = 0;\n  private pos = 0;\n\n  private view = EMPTY_VIEW;\n  private bytes = EMPTY_BYTES;\n  private headByte = HEAD_BYTE_REQUIRED;\n  private readonly stack = new StackPool();\n\n  private entered = false;\n\n  public constructor(options?: DecoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.rawStrings = options?.rawStrings ?? false;\n    this.maxStrLength = options?.maxStrLength ?? UINT32_MAX;\n    this.maxBinLength = options?.maxBinLength ?? UINT32_MAX;\n    this.maxArrayLength = options?.maxArrayLength ?? UINT32_MAX;\n    this.maxMapLength = options?.maxMapLength ?? UINT32_MAX;\n    this.maxExtLength = options?.maxExtLength ?? UINT32_MAX;\n    this.keyDecoder = options?.keyDecoder !== undefined ? options.keyDecoder : sharedCachedKeyDecoder;\n    this.mapKeyConverter = options?.mapKeyConverter ?? mapKeyConverter;\n  }\n\n  private clone(): Decoder<ContextType> {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Decoder({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      rawStrings: this.rawStrings,\n      maxStrLength: this.maxStrLength,\n      maxBinLength: this.maxBinLength,\n      maxArrayLength: this.maxArrayLength,\n      maxMapLength: this.maxMapLength,\n      maxExtLength: this.maxExtLength,\n      keyDecoder: this.keyDecoder,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.totalPos = 0;\n    this.headByte = HEAD_BYTE_REQUIRED;\n    this.stack.reset();\n\n    // view, bytes, and pos will be re-initialized in setBuffer()\n  }\n\n  private setBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    const bytes = ensureUint8Array(buffer);\n    this.bytes = bytes;\n    this.view = new DataView(bytes.buffer, bytes.byteOffset, bytes.byteLength);\n    this.pos = 0;\n  }\n\n  private appendBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining(1)) {\n      this.setBuffer(buffer);\n    } else {\n      const remainingData = this.bytes.subarray(this.pos);\n      const newData = ensureUint8Array(buffer);\n\n      // concat remainingData + newData\n      const newBuffer = new Uint8Array(remainingData.length + newData.length);\n      newBuffer.set(remainingData);\n      newBuffer.set(newData, remainingData.length);\n      this.setBuffer(newBuffer);\n    }\n  }\n\n  private hasRemaining(size: number) {\n    return this.view.byteLength - this.pos >= size;\n  }\n\n  private createExtraByteError(posToShow: number): Error {\n    const { view, pos } = this;\n    return new RangeError(`Extra ${view.byteLength - pos} of ${view.byteLength} byte(s) found at buffer[${posToShow}]`);\n  }\n\n  /**\n   * @throws {@link DecodeError}\n   * @throws {@link RangeError}\n   */\n  public decode(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): unknown {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decode(buffer);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      const object = this.doDecodeSync();\n      if (this.hasRemaining(1)) {\n        throw this.createExtraByteError(this.pos);\n      }\n      return object;\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public *decodeMulti(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): Generator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMulti(buffer);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      while (this.hasRemaining(1)) {\n        yield this.doDecodeSync();\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public async decodeAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): Promise<unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decodeAsync(stream);\n    }\n\n    try {\n      this.entered = true;\n\n      let decoded = false;\n      let object: unknown;\n      for await (const buffer of stream) {\n        if (decoded) {\n          this.entered = false;\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        try {\n          object = this.doDecodeSync();\n          decoded = true;\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n\n      if (decoded) {\n        if (this.hasRemaining(1)) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n        return object;\n      }\n\n      const { headByte, pos, totalPos } = this;\n      throw new RangeError(\n        `Insufficient data in parsing ${prettyByte(headByte)} at ${totalPos} (${pos} in the current buffer)`,\n      );\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public decodeArrayStream(\n    stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>,\n  ): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, true);\n  }\n\n  public decodeStream(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, false);\n  }\n\n  private async *decodeMultiAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>, isArray: boolean): AsyncGenerator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMultiAsync(stream, isArray);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      let isArrayHeaderRequired = isArray;\n      let arrayItemsLeft = -1;\n\n      for await (const buffer of stream) {\n        if (isArray && arrayItemsLeft === 0) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        if (isArrayHeaderRequired) {\n          arrayItemsLeft = this.readArraySize();\n          isArrayHeaderRequired = false;\n          this.complete();\n        }\n\n        try {\n          while (true) {\n            yield this.doDecodeSync();\n            if (--arrayItemsLeft === 0) {\n              break;\n            }\n          }\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doDecodeSync(): unknown {\n    DECODE: while (true) {\n      const headByte = this.readHeadByte();\n      let object: unknown;\n\n      if (headByte >= 0xe0) {\n        // negative fixint (111x xxxx) 0xe0 - 0xff\n        object = headByte - 0x100;\n      } else if (headByte < 0xc0) {\n        if (headByte < 0x80) {\n          // positive fixint (0xxx xxxx) 0x00 - 0x7f\n          object = headByte;\n        } else if (headByte < 0x90) {\n          // fixmap (1000 xxxx) 0x80 - 0x8f\n          const size = headByte - 0x80;\n          if (size !== 0) {\n            this.pushMapState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = {};\n          }\n        } else if (headByte < 0xa0) {\n          // fixarray (1001 xxxx) 0x90 - 0x9f\n          const size = headByte - 0x90;\n          if (size !== 0) {\n            this.pushArrayState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = [];\n          }\n        } else {\n          // fixstr (101x xxxx) 0xa0 - 0xbf\n          const byteLength = headByte - 0xa0;\n          object = this.decodeString(byteLength, 0);\n        }\n      } else if (headByte === 0xc0) {\n        // nil\n        object = null;\n      } else if (headByte === 0xc2) {\n        // false\n        object = false;\n      } else if (headByte === 0xc3) {\n        // true\n        object = true;\n      } else if (headByte === 0xca) {\n        // float 32\n        object = this.readF32();\n      } else if (headByte === 0xcb) {\n        // float 64\n        object = this.readF64();\n      } else if (headByte === 0xcc) {\n        // uint 8\n        object = this.readU8();\n      } else if (headByte === 0xcd) {\n        // uint 16\n        object = this.readU16();\n      } else if (headByte === 0xce) {\n        // uint 32\n        object = this.readU32();\n      } else if (headByte === 0xcf) {\n        // uint 64\n        if (this.useBigInt64) {\n          object = this.readU64AsBigInt();\n        } else {\n          object = this.readU64();\n        }\n      } else if (headByte === 0xd0) {\n        // int 8\n        object = this.readI8();\n      } else if (headByte === 0xd1) {\n        // int 16\n        object = this.readI16();\n      } else if (headByte === 0xd2) {\n        // int 32\n        object = this.readI32();\n      } else if (headByte === 0xd3) {\n        // int 64\n        if (this.useBigInt64) {\n          object = this.readI64AsBigInt();\n        } else {\n          object = this.readI64();\n        }\n      } else if (headByte === 0xd9) {\n        // str 8\n        const byteLength = this.lookU8();\n        object = this.decodeString(byteLength, 1);\n      } else if (headByte === 0xda) {\n        // str 16\n        const byteLength = this.lookU16();\n        object = this.decodeString(byteLength, 2);\n      } else if (headByte === 0xdb) {\n        // str 32\n        const byteLength = this.lookU32();\n        object = this.decodeString(byteLength, 4);\n      } else if (headByte === 0xdc) {\n        // array 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xdd) {\n        // array 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xde) {\n        // map 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xdf) {\n        // map 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xc4) {\n        // bin 8\n        const size = this.lookU8();\n        object = this.decodeBinary(size, 1);\n      } else if (headByte === 0xc5) {\n        // bin 16\n        const size = this.lookU16();\n        object = this.decodeBinary(size, 2);\n      } else if (headByte === 0xc6) {\n        // bin 32\n        const size = this.lookU32();\n        object = this.decodeBinary(size, 4);\n      } else if (headByte === 0xd4) {\n        // fixext 1\n        object = this.decodeExtension(1, 0);\n      } else if (headByte === 0xd5) {\n        // fixext 2\n        object = this.decodeExtension(2, 0);\n      } else if (headByte === 0xd6) {\n        // fixext 4\n        object = this.decodeExtension(4, 0);\n      } else if (headByte === 0xd7) {\n        // fixext 8\n        object = this.decodeExtension(8, 0);\n      } else if (headByte === 0xd8) {\n        // fixext 16\n        object = this.decodeExtension(16, 0);\n      } else if (headByte === 0xc7) {\n        // ext 8\n        const size = this.lookU8();\n        object = this.decodeExtension(size, 1);\n      } else if (headByte === 0xc8) {\n        // ext 16\n        const size = this.lookU16();\n        object = this.decodeExtension(size, 2);\n      } else if (headByte === 0xc9) {\n        // ext 32\n        const size = this.lookU32();\n        object = this.decodeExtension(size, 4);\n      } else {\n        throw new DecodeError(`Unrecognized type byte: ${prettyByte(headByte)}`);\n      }\n\n      this.complete();\n\n      const stack = this.stack;\n      while (stack.length > 0) {\n        // arrays and maps\n        const state = stack.top()!;\n        if (state.type === STATE_ARRAY) {\n          state.array[state.position] = object;\n          state.position++;\n          if (state.position === state.size) {\n            object = state.array;\n            stack.release(state);\n          } else {\n            continue DECODE;\n          }\n        } else if (state.type === STATE_MAP_KEY) {\n          if (object === \"__proto__\") {\n            throw new DecodeError(\"The key __proto__ is not allowed\");\n          }\n\n          state.key = this.mapKeyConverter(object);\n          state.type = STATE_MAP_VALUE;\n          continue DECODE;\n        } else {\n          // it must be `state.type === State.MAP_VALUE` here\n\n          state.map[state.key!] = object;\n          state.readCount++;\n\n          if (state.readCount === state.size) {\n            object = state.map;\n            stack.release(state);\n          } else {\n            state.key = null;\n            state.type = STATE_MAP_KEY;\n            continue DECODE;\n          }\n        }\n      }\n\n      return object;\n    }\n  }\n\n  private readHeadByte(): number {\n    if (this.headByte === HEAD_BYTE_REQUIRED) {\n      this.headByte = this.readU8();\n      // console.log(\"headByte\", prettyByte(this.headByte));\n    }\n\n    return this.headByte;\n  }\n\n  private complete(): void {\n    this.headByte = HEAD_BYTE_REQUIRED;\n  }\n\n  private readArraySize(): number {\n    const headByte = this.readHeadByte();\n\n    switch (headByte) {\n      case 0xdc:\n        return this.readU16();\n      case 0xdd:\n        return this.readU32();\n      default: {\n        if (headByte < 0xa0) {\n          return headByte - 0x90;\n        } else {\n          throw new DecodeError(`Unrecognized array type byte: ${prettyByte(headByte)}`);\n        }\n      }\n    }\n  }\n\n  private pushMapState(size: number) {\n    if (size > this.maxMapLength) {\n      throw new DecodeError(`Max length exceeded: map length (${size}) > maxMapLengthLength (${this.maxMapLength})`);\n    }\n\n    this.stack.pushMapState(size);\n  }\n\n  private pushArrayState(size: number) {\n    if (size > this.maxArrayLength) {\n      throw new DecodeError(`Max length exceeded: array length (${size}) > maxArrayLength (${this.maxArrayLength})`);\n    }\n\n    this.stack.pushArrayState(size);\n  }\n\n  private decodeString(byteLength: number, headerOffset: number): string | Uint8Array {\n    if (!this.rawStrings || this.stateIsMapKey()) {\n      return this.decodeUtf8String(byteLength, headerOffset);\n    }\n    return this.decodeBinary(byteLength, headerOffset);\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeUtf8String(byteLength: number, headerOffset: number): string {\n    if (byteLength > this.maxStrLength) {\n      throw new DecodeError(\n        `Max length exceeded: UTF-8 byte length (${byteLength}) > maxStrLength (${this.maxStrLength})`,\n      );\n    }\n\n    if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headerOffset;\n    let object: string;\n    if (this.stateIsMapKey() && this.keyDecoder?.canBeCached(byteLength)) {\n      object = this.keyDecoder.decode(this.bytes, offset, byteLength);\n    } else {\n      object = utf8Decode(this.bytes, offset, byteLength);\n    }\n    this.pos += headerOffset + byteLength;\n    return object;\n  }\n\n  private stateIsMapKey(): boolean {\n    if (this.stack.length > 0) {\n      const state = this.stack.top()!;\n      return state.type === STATE_MAP_KEY;\n    }\n    return false;\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeBinary(byteLength: number, headOffset: number): Uint8Array {\n    if (byteLength > this.maxBinLength) {\n      throw new DecodeError(`Max length exceeded: bin length (${byteLength}) > maxBinLength (${this.maxBinLength})`);\n    }\n\n    if (!this.hasRemaining(byteLength + headOffset)) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headOffset;\n    const object = this.bytes.subarray(offset, offset + byteLength);\n    this.pos += headOffset + byteLength;\n    return object;\n  }\n\n  private decodeExtension(size: number, headOffset: number): unknown {\n    if (size > this.maxExtLength) {\n      throw new DecodeError(`Max length exceeded: ext length (${size}) > maxExtLength (${this.maxExtLength})`);\n    }\n\n    const extType = this.view.getInt8(this.pos + headOffset);\n    const data = this.decodeBinary(size, headOffset + 1 /* extType */);\n    return this.extensionCodec.decode(data, extType, this.context);\n  }\n\n  private lookU8() {\n    return this.view.getUint8(this.pos);\n  }\n\n  private lookU16() {\n    return this.view.getUint16(this.pos);\n  }\n\n  private lookU32() {\n    return this.view.getUint32(this.pos);\n  }\n\n  private readU8(): number {\n    const value = this.view.getUint8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readI8(): number {\n    const value = this.view.getInt8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readU16(): number {\n    const value = this.view.getUint16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readI16(): number {\n    const value = this.view.getInt16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readU32(): number {\n    const value = this.view.getUint32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readI32(): number {\n    const value = this.view.getInt32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readU64(): number {\n    const value = getUint64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64(): number {\n    const value = getInt64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readU64AsBigInt(): bigint {\n    const value = this.view.getBigUint64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64AsBigInt(): bigint {\n    const value = this.view.getBigInt64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readF32() {\n    const value = this.view.getFloat32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readF64() {\n    const value = this.view.getFloat64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n}\n", "import { Decoder } from \"./Decoder.ts\";\nimport type { DecoderOptions } from \"./Decoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It decodes a single MessagePack object in a buffer.\n *\n * This is a synchronous decoding function.\n * See other variants for asynchronous decoding: {@link decodeAsync}, {@link decodeMultiStream}, or {@link decodeArrayStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decode<ContextType = undefined>(\n  buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): unknown {\n  const decoder = new Decoder(options);\n  return decoder.decode(buffer);\n}\n\n/**\n * It decodes multiple MessagePack objects in a buffer.\n * This is corresponding to {@link decodeMultiStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decodeMulti<ContextType = undefined>(\n  buffer: ArrayLike<number> | BufferSource,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): Generator<unknown, void, unknown> {\n  const decoder = new Decoder(options);\n  return decoder.decodeMulti(buffer);\n}\n", "// Main Functions:\n\nimport { encode } from \"./encode.ts\";\nexport { encode };\n\nimport { decode, decodeMulti } from \"./decode.ts\";\nexport { decode, decodeMulti };\n\nimport { decodeAsync, decodeArrayStream, decodeMultiStream } from \"./decodeAsync.ts\";\nexport { decodeAsync, decodeArrayStream, decodeMultiStream };\n\nimport { Decoder } from \"./Decoder.ts\";\nexport { Decoder };\nimport type { DecoderOptions } from \"./Decoder.ts\";\nexport type { DecoderOptions };\nimport { DecodeError } from \"./DecodeError.ts\";\nexport { DecodeError };\n\nimport { Encoder } from \"./Encoder.ts\";\nexport { Encoder };\nimport type { EncoderOptions } from \"./Encoder.ts\";\nexport type { EncoderOptions };\n\n// Utilities for Extension Types:\n\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nexport { ExtensionCodec };\nimport type { ExtensionCodecType, ExtensionDecoderType, ExtensionEncoderType } from \"./ExtensionCodec.ts\";\nexport type { ExtensionCodecType, ExtensionDecoderType, ExtensionEncoderType };\nimport { ExtData } from \"./ExtData.ts\";\nexport { ExtData };\n\nimport {\n  EXT_TIMESTAMP,\n  encodeDateToTimeSpec,\n  encodeTimeSpecToTimestamp,\n  decodeTimestampToTimeSpec,\n  encodeTimestampExtension,\n  decodeTimestampExtension,\n} from \"./timestamp.ts\";\nexport {\n  EXT_TIMESTAMP,\n  encodeDateToTimeSpec,\n  encodeTimeSpecToTimestamp,\n  decodeTimestampToTimeSpec,\n  encodeTimestampExtension,\n  decodeTimestampExtension,\n};\n", "import * as msgpack from \"@msgpack/msgpack\";\r\n\r\nexport const CURRENT_VERSION = 11; // Bumped for Nanite virtualized features support\r\nexport const HDC_SEED = 0x1337BEEF; // Default system seed\r\n\r\n/**\r\n * Morton Order calculation for spatial sorting\r\n */\r\nexport function getMorton(x: number, y: number): number {\r\n    let x_int = x | 0;\r\n    let y_int = y | 0;\r\n\r\n    x_int = (x_int | (x_int << 8)) & 0x00FF00FF;\r\n    x_int = (x_int | (x_int << 4)) & 0x0F0F0F0F;\r\n    x_int = (x_int | (x_int << 2)) & 0x33333333;\r\n    x_int = (x_int | (x_int << 1)) & 0x55555555;\r\n\r\n    y_int = (y_int | (y_int << 8)) & 0x00FF00FF;\r\n    y_int = (y_int | (y_int << 4)) & 0x0F0F0F0F;\r\n    y_int = (y_int | (y_int << 2)) & 0x33333333;\r\n    y_int = (y_int | (y_int << 1)) & 0x55555555;\r\n\r\n    return x_int | (y_int << 1);\r\n}\r\n\r\n/**\r\n * Packs 8-bit image data into 4-bit packed data\r\n */\r\nexport function pack4Bit(data: Uint8Array): Uint8Array {\r\n    const length = data.length;\r\n    if (length % 2 !== 0) return data;\r\n\r\n    const packed = new Uint8Array(length / 2);\r\n    for (let i = 0; i < length; i += 2) {\r\n        const p1 = (data[i] & 0xF0) >> 4;\r\n        const p2 = (data[i + 1] & 0xF0) >> 4;\r\n        packed[i / 2] = (p1 << 4) | p2;\r\n    }\r\n    return packed;\r\n}\r\n\r\n/**\r\n * Unpacks 4-bit data back to 8-bit image data\r\n */\r\nexport function unpack4Bit(packed: Uint8Array, width: number, height: number): Uint8Array {\r\n    const length = width * height;\r\n    const data = new Uint8Array(length);\r\n\r\n    for (let i = 0; i < packed.length; i++) {\r\n        const byte = packed[i];\r\n        const p1 = (byte & 0xF0);\r\n        const p2 = (byte & 0x0F) << 4;\r\n\r\n        data[i * 2] = p1;\r\n        data[i * 2 + 1] = p2;\r\n    }\r\n    return data;\r\n}\r\n\r\n/**\r\n * Columnarizes point data for efficient storage and transfer\r\n */\r\nexport function columnarize(points: any[], tree: any, width: number, height: number, useHDC: boolean = false) {\r\n    const count = points.length;\r\n    const x = new Uint16Array(count);\r\n    const y = new Uint16Array(count);\r\n    const angle = new Int16Array(count);\r\n    const scale = new Uint8Array(count);\r\n\r\n    let descriptors: any;\r\n    if (useHDC) {\r\n        descriptors = new Uint32Array(count); // HDC Signatures (32-bit)\r\n    } else {\r\n        descriptors = new Uint32Array(count * 2); // Raw Descriptors (64-bit)\r\n    }\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        x[i] = Math.round((points[i].x / width) * 65535);\r\n        y[i] = Math.round((points[i].y / height) * 65535);\r\n        angle[i] = Math.round((points[i].angle / Math.PI) * 32767);\r\n        scale[i] = Math.round(Math.log2(points[i].scale || 1));\r\n\r\n        if (points[i].descriptors && points[i].descriptors.length >= 2) {\r\n            if (useHDC) {\r\n                // For HDC, we'd normally call project + compress here\r\n                // But protocol.ts should be agnostic of the generator.\r\n                // We'll assume points[i].hdcSignature exists if pre-calculated\r\n                descriptors[i] = points[i].hdcSignature || 0;\r\n            } else {\r\n                descriptors[i * 2] = points[i].descriptors[0];\r\n                descriptors[(i * 2) + 1] = points[i].descriptors[1];\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        x,\r\n        y,\r\n        a: angle,\r\n        s: scale,\r\n        d: descriptors,\r\n        hdc: useHDC ? 1 : 0, // HDC Flag (renamed from h to avoid collision with height)\r\n        t: compactTree(tree.rootNode),\r\n    };\r\n}\r\n\r\n/**\r\n * Columnarizes point data with COMPACT 32-bit descriptors (XOR folding)\r\n * Reduces descriptor storage by 50% with minimal accuracy loss\r\n */\r\nexport function columnarizeCompact(points: any[], tree: any, width: number, height: number) {\r\n    const count = points.length;\r\n    const x = new Uint16Array(count);\r\n    const y = new Uint16Array(count);\r\n    const angle = new Int16Array(count);\r\n    const scale = new Uint8Array(count);\r\n    const descriptors = new Uint32Array(count); // 32-bit compact descriptors\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        x[i] = Math.round((points[i].x / width) * 65535);\r\n        y[i] = Math.round((points[i].y / height) * 65535);\r\n        angle[i] = Math.round((points[i].angle / Math.PI) * 32767);\r\n        scale[i] = Math.round(Math.log2(points[i].scale || 1));\r\n\r\n        if (points[i].descriptors && points[i].descriptors.length >= 2) {\r\n            // XOR folding: Combine two 32-bit values into one 32-bit value\r\n            // This preserves discriminative power while halving storage\r\n            descriptors[i] = (points[i].descriptors[0] ^ points[i].descriptors[1]) >>> 0;\r\n        }\r\n    }\r\n\r\n    return {\r\n        x,\r\n        y,\r\n        a: angle,\r\n        s: scale,\r\n        d: descriptors,\r\n        compact: 1, // Flag to indicate compact 32-bit descriptors\r\n        t: compactTree(tree.rootNode),\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * Compacts hierarchical clustering tree into a minimal array structure\r\n */\r\nexport function compactTree(node: any): any {\r\n    if (node.leaf) {\r\n        return [1, node.centerPointIndex || 0, node.pointIndexes];\r\n    }\r\n    return [0, node.centerPointIndex || 0, node.children.map((c: any) => compactTree(c))];\r\n}\r\n\r\n/**\r\n * Expands a compacted tree back into an object structure\r\n */\r\nexport function expandTree(node: any): any {\r\n    const isLeaf = node[0] === 1;\r\n    if (isLeaf) {\r\n        return {\r\n            leaf: true,\r\n            centerPointIndex: node[1],\r\n            pointIndexes: node[2],\r\n        };\r\n    }\r\n    return {\r\n        leaf: false,\r\n        centerPointIndex: node[1],\r\n        children: node[2].map((c: any) => expandTree(c)),\r\n    };\r\n}\r\n\r\n/**\r\n * Deserializes and normalizes .taar data from a buffer\r\n */\r\nexport function decodeTaar(buffer: ArrayBuffer | Uint8Array) {\r\n    const content: any = msgpack.decode(new Uint8Array(buffer));\r\n    const version = content.v || 0;\r\n\r\n    // Support Protocol V5/V6/V7\r\n    if (version < 5 || version > CURRENT_VERSION) {\r\n        console.warn(`Potential incompatible .taar version: ${version}. Standard is ${CURRENT_VERSION}.`);\r\n    }\r\n\r\n    const dataList = content.dataList;\r\n    for (let i = 0; i < dataList.length; i++) {\r\n        const item = dataList[i];\r\n\r\n        // 1. Process Tracking Data\r\n        for (const td of item.trackingData) {\r\n            // Helper to ensure we have the right TypedArray if it was decoded as Uint8Array by msgpack\r\n            const normalizeBuffer = (arr: any, Type: any) => {\r\n                if (arr instanceof Uint8Array && Type !== Uint8Array) {\r\n                    return new Type(arr.buffer.slice(arr.byteOffset, arr.byteOffset + arr.byteLength));\r\n                }\r\n                return arr;\r\n            };\r\n\r\n            td.px = normalizeBuffer(td.px, Float32Array);\r\n            td.py = normalizeBuffer(td.py, Float32Array);\r\n\r\n            // Backwards compatibility for fields named 'd' vs 'data'\r\n            const rawData = td.data || td.d;\r\n            const w = td.width || td.w;\r\n            const h = td.height || td.h;\r\n\r\n            if (rawData && rawData.length === (w * h) / 2) {\r\n                const unpacked = unpack4Bit(rawData, w, h);\r\n                if (td.data) td.data = unpacked;\r\n                if (td.d) td.d = unpacked;\r\n            }\r\n\r\n            if (td.mesh) {\r\n                td.mesh.t = normalizeBuffer(td.mesh.t, Uint16Array);\r\n                td.mesh.e = normalizeBuffer(td.mesh.e, Uint16Array);\r\n                td.mesh.rl = normalizeBuffer(td.mesh.rl, Float32Array);\r\n            }\r\n        }\r\n\r\n        // 2. Process Matching Data\r\n        for (const kf of item.matchingData) {\r\n            for (const col of [kf.max, kf.min]) {\r\n                if (!col) continue;\r\n\r\n                let xRaw = col.x;\r\n                let yRaw = col.y;\r\n\r\n                if (xRaw instanceof Uint8Array) {\r\n                    xRaw = new Uint16Array(xRaw.buffer.slice(xRaw.byteOffset, xRaw.byteOffset + xRaw.byteLength));\r\n                }\r\n                if (yRaw instanceof Uint8Array) {\r\n                    yRaw = new Uint16Array(yRaw.buffer.slice(yRaw.byteOffset, yRaw.byteOffset + yRaw.byteLength));\r\n                }\r\n\r\n                const count = xRaw.length;\r\n                const x = new Float32Array(count);\r\n                const y = new Float32Array(count);\r\n                for (let k = 0; k < count; k++) {\r\n                    x[k] = (xRaw[k] / 65535) * kf.w;\r\n                    y[k] = (yRaw[k] / 65535) * kf.h;\r\n                }\r\n                col.x = x;\r\n                col.y = y;\r\n\r\n                if (col.a instanceof Uint8Array) {\r\n                    const aRaw = new Int16Array(col.a.buffer.slice(col.a.byteOffset, col.a.byteOffset + col.a.byteLength));\r\n                    const a = new Float32Array(count);\r\n                    for (let k = 0; k < count; k++) {\r\n                        a[k] = (aRaw[k] / 32767) * Math.PI;\r\n                    }\r\n                    col.a = a;\r\n                }\r\n\r\n                if (col.s instanceof Uint8Array) {\r\n                    const sRaw = col.s;\r\n                    const s = new Float32Array(count);\r\n                    for (let k = 0; k < count; k++) {\r\n                        s[k] = Math.pow(2, sRaw[k]);\r\n                    }\r\n                    col.s = s;\r\n                }\r\n\r\n                if (col.d instanceof Uint8Array) {\r\n                    // Check if it's HDC (Uint32) or Raw (Uint32 x 2)\r\n                    if (col.hdc === 1) {\r\n                        col.d = new Uint32Array(col.d.buffer.slice(col.d.byteOffset, col.d.byteOffset + col.d.byteLength));\r\n                    } else {\r\n                        col.d = new Uint32Array(col.d.buffer.slice(col.d.byteOffset, col.d.byteOffset + col.d.byteLength));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return { version, dataList };\r\n}\r\n\r\n/**\r\n * Serializes target data into a .taar binary buffer\r\n */\r\nexport function encodeTaar(dataList: any[]) {\r\n    return msgpack.encode({\r\n        v: CURRENT_VERSION,\r\n        dataList,\r\n    });\r\n}\r\n", "/**\r\n * Detector Lite - Pure JavaScript Feature Detector\r\n * \r\n * Un detector de caracter\u00EDsticas simplificado que no depende de TensorFlow.\r\n * Optimizado para velocidad en compilaci\u00F3n offline.\r\n * \r\n * Implementa:\r\n * - Construcci\u00F3n de pir\u00E1mide gaussiana (con aceleraci\u00F3n GPU opcional)\r\n * - Diferencia de Gaussianas (DoG) para detecci\u00F3n de extremos\r\n * - Descriptores FREAK simplificados\r\n */\r\n\r\nimport { FREAKPOINTS } from \"./freak.js\";\r\nimport { gpuCompute } from \"../utils/gpu-compute.js\";\r\nimport { computeLSH64, computeFullFREAK, packLSHIntoDescriptor } from \"../utils/lsh-direct.js\";\r\nimport { HDC_SEED } from \"../protocol.js\";\r\n\r\nconst PYRAMID_MIN_SIZE = 4; // Restored to 4 for better small-scale detection\r\n// PYRAMID_MAX_OCTAVE ya no es necesario, el l\u00EDmite lo da PYRAMID_MIN_SIZE\r\n\r\n\r\nconst NUM_BUCKETS_PER_DIMENSION = 15; // Increased from 10 to 15 for better local detail\r\nconst DEFAULT_MAX_FEATURES_PER_BUCKET = 12; // Increased from 8 to 12\r\n\r\n\r\nconst ORIENTATION_NUM_BINS = 36;\r\nconst FREAK_EXPANSION_FACTOR = 7.0;\r\n\r\n// Global GPU mode flag\r\nlet globalUseGPU = true;\r\n\r\n/**\r\n * Set global GPU mode for all DetectorLite instances\r\n * @param {boolean} enabled - Whether to use GPU acceleration\r\n */\r\nexport const setDetectorGPUMode = (enabled) => {\r\n    globalUseGPU = enabled;\r\n};\r\n\r\n/**\r\n * Detector de caracter\u00EDsticas sin TensorFlow\r\n */\r\nexport class DetectorLite {\r\n    constructor(width, height, options = {}) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.useGPU = options.useGPU !== undefined ? options.useGPU : globalUseGPU;\r\n        // Protocol V6 (Moonshot): 64-bit LSH is the standard descriptor format\r\n        this.useLSH = options.useLSH !== undefined ? options.useLSH : true;\r\n        this.useHDC = options.useHDC !== undefined ? options.useHDC : true; // Enabled by default for Moonshot\r\n        this.maxFeaturesPerBucket = options.maxFeaturesPerBucket !== undefined ? options.maxFeaturesPerBucket : DEFAULT_MAX_FEATURES_PER_BUCKET;\r\n\r\n        let numOctaves = 0;\r\n        let w = width, h = height;\r\n        while (w >= PYRAMID_MIN_SIZE && h >= PYRAMID_MIN_SIZE) {\r\n            w = Math.floor(w / 2);\r\n            h = Math.floor(h / 2);\r\n            numOctaves++;\r\n            // L\u00EDmite de seguridad razonable para evitar bucles infinitos en im\u00E1genes gigantes\r\n            if (numOctaves === 10) break;\r\n        }\r\n\r\n        this.numOctaves = options.maxOctaves !== undefined ? Math.min(numOctaves, options.maxOctaves) : numOctaves;\r\n    }\r\n\r\n    /**\r\n     * Detecta caracter\u00EDsticas en una imagen en escala de grises\r\n     * @param {Float32Array|Uint8Array} imageData - Datos de imagen (width * height)\r\n     * @param {Object} options - Opciones de detecci\u00F3n (ej. octavesToProcess)\r\n     * @returns {{featurePoints: Array}} Puntos de caracter\u00EDsticas detectados\r\n     */\r\n    detect(imageData, options = {}) {\r\n        const octavesToProcess = options.octavesToProcess || Array.from({ length: this.numOctaves }, (_, i) => i);\r\n        // Normalizar a Float32Array si es necesario\r\n        let data;\r\n        if (imageData instanceof Float32Array) {\r\n            data = imageData;\r\n        } else {\r\n            data = new Float32Array(imageData.length);\r\n            for (let i = 0; i < imageData.length; i++) {\r\n                data[i] = imageData[i];\r\n            }\r\n        }\r\n\r\n        // 1. Construir pir\u00E1mide gaussiana (solo octavas solicitadas)\r\n        const pyramidImages = this._buildGaussianPyramid(data, this.width, this.height, octavesToProcess);\r\n\r\n        // 2. Construir pir\u00E1mide DoG (Difference of Gaussians)\r\n        const dogPyramid = this._buildDogPyramid(pyramidImages, octavesToProcess);\r\n\r\n        // 3. Encontrar extremos locales\r\n        const extremas = this._findExtremas(dogPyramid, pyramidImages);\r\n\r\n        // 4. Aplicar pruning por buckets\r\n        const prunedExtremas = this._applyPrune(extremas);\r\n\r\n        // 5. Calcular orientaciones\r\n        this._computeOrientations(prunedExtremas, pyramidImages);\r\n\r\n        // 6. Calcular descriptores FREAK\r\n        this._computeFreakDescriptors(prunedExtremas, pyramidImages);\r\n\r\n\r\n\r\n        // Convertir a formato de salida\r\n        const featurePoints = prunedExtremas.map(ext => {\r\n            const scale = Math.pow(2, ext.octave);\r\n            return {\r\n                maxima: ext.score > 0,\r\n                x: ext.x * scale + scale * 0.5 - 0.5,\r\n                y: ext.y * scale + scale * 0.5 - 0.5,\r\n                scale: scale,\r\n                angle: ext.angle || 0,\r\n                score: ext.absScore, // Pass through score for sorting in Matcher\r\n                descriptors: (this.useLSH && ext.lsh) ? ext.lsh : (ext.descriptors || []),\r\n                imageData: data // Pass source image for refinement\r\n            };\r\n        });\r\n\r\n        return { featurePoints, pyramid: pyramidImages };\r\n    }\r\n\r\n    /**\r\n     * Construye una pir\u00E1mide gaussiana\r\n     */\r\n    _buildGaussianPyramid(data, width, height, octavesToProcess = null) {\r\n        // Use GPU-accelerated pyramid if available\r\n        if (this.useGPU) {\r\n            try {\r\n                const gpuPyramid = gpuCompute.buildPyramid(data, width, height, this.numOctaves);\r\n\r\n                // Convert GPU pyramid format to expected format\r\n                const pyramid = [];\r\n                for (let i = 0; i < gpuPyramid.length && i < this.numOctaves; i++) {\r\n                    if (octavesToProcess && !octavesToProcess.includes(i)) {\r\n                        pyramid.push(null);\r\n                        continue;\r\n                    }\r\n                    const level = gpuPyramid[i];\r\n                    // Apply second blur for DoG computation\r\n                    const img2 = this._applyGaussianFilter(level.data, level.width, level.height);\r\n                    pyramid.push([\r\n                        { data: level.data, width: level.width, height: level.height },\r\n                        { data: img2.data, width: level.width, height: level.height }\r\n                    ]);\r\n                }\r\n                return pyramid;\r\n            } catch (e) {\r\n                // Fall back to CPU if GPU fails\r\n                console.warn(\"GPU pyramid failed, falling back to CPU:\", e.message);\r\n            }\r\n        }\r\n\r\n        // Buffer management: Reuse arrays if dimensions match to reduce GC\r\n        if (!this._pyramidBuffers || this._pyramidBuffers.width !== width || this._pyramidBuffers.height !== height) {\r\n            this._pyramidBuffers = { width, height, temp: new Float32Array(width * height) };\r\n        }\r\n\r\n        const pyramid = [];\r\n        let currentData = data;\r\n        let currentWidth = width;\r\n        let currentHeight = height;\r\n\r\n        for (let i = 0; i < this.numOctaves; i++) {\r\n            const shouldProcess = !octavesToProcess || octavesToProcess.includes(i);\r\n\r\n            if (shouldProcess) {\r\n                const img1 = this._applyGaussianFilter(currentData, currentWidth, currentHeight);\r\n                const img2 = this._applyGaussianFilter(img1.data, currentWidth, currentHeight);\r\n\r\n                pyramid.push([\r\n                    { data: img1.data, width: currentWidth, height: currentHeight },\r\n                    { data: img2.data, width: currentWidth, height: currentHeight }\r\n                ]);\r\n            } else {\r\n                pyramid.push(null);\r\n            }\r\n\r\n            if (i < this.numOctaves - 1) {\r\n                // For CPU downsampling, we STILL need to downsample even if we skip processing the current octave\r\n                // UNLESS the next octave is also skipped. But for simplicity and safety, we downsample if needed by ANY future octave.\r\n                const needsDownsample = !octavesToProcess || octavesToProcess.some(o => o > i);\r\n\r\n                if (needsDownsample) {\r\n                    // If current octave was processed, we use img1.data (or original data if i=0 and not processed?). \r\n                    // Wait, standard is to downsample from the blurred image of previous octave.\r\n                    const sourceData = shouldProcess ? pyramid[i][0].data : currentData;\r\n                    const downsampled = this._downsample(sourceData, currentWidth, currentHeight);\r\n                    currentData = downsampled.data;\r\n                    currentWidth = downsampled.width;\r\n                    currentHeight = downsampled.height;\r\n                } else {\r\n                    // Optimization: if no more octaves are needed, we can stop here\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return pyramid;\r\n    }\r\n\r\n    /**\r\n     * Aplica un filtro gaussiano binomial [1,4,6,4,1] - Optimizado\r\n     */\r\n    _applyGaussianFilter(data, width, height) {\r\n        const output = new Float32Array(width * height);\r\n        const temp = this._pyramidBuffers?.temp || new Float32Array(width * height);\r\n        const k0 = 0.0625, k1 = 0.25, k2 = 0.375; // 1/16, 4/16, 6/16\r\n        const w1 = width - 1;\r\n\r\n        // Horizontal pass - Speed optimized with manual border handling\r\n        for (let y = 0; y < height; y++) {\r\n            const rowOffset = y * width;\r\n\r\n            // Left border (Normalized)\r\n            const sumL0 = k0 + k1 + k2 + k1 + k0; // Ideal sum\r\n            temp[rowOffset] = (data[rowOffset] * (k0 + k1 + k2) + data[rowOffset + 1] * k1 + data[rowOffset + 2] * k0) * (1.0 / (k0 + k1 + k2));\r\n            temp[rowOffset + 1] = (data[rowOffset] * k1 + data[rowOffset + 1] * k2 + data[rowOffset + 2] * k1 + data[rowOffset + 3] * k0) * (1.0 / (k1 + k2 + k1 + k0));\r\n\r\n            // Main loop - NO boundary checks\r\n            for (let x = 2; x < width - 2; x++) {\r\n                const pos = rowOffset + x;\r\n                temp[pos] = data[pos - 2] * k0 + data[pos - 1] * k1 + data[pos] * k2 + data[pos + 1] * k1 + data[pos + 2] * k0;\r\n            }\r\n\r\n            // Right border (Normalized)\r\n            const r2 = rowOffset + width - 2;\r\n            const r1 = rowOffset + width - 1;\r\n            temp[r2] = (data[r2 - 2] * k0 + data[r2 - 1] * k1 + data[r2] * k2 + data[r1] * k1) * (1.0 / (k0 + k1 + k2 + k1));\r\n            temp[r1] = (data[r1 - 2] * k0 + data[r1 - 1] * k1 + data[r1] * (k2 + k1 + k0)) * (1.0 / (k0 + k1 + k2));\r\n        }\r\n\r\n        // Vertical pass - Speed optimized\r\n        for (let x = 0; x < width; x++) {\r\n            // Top border (Normalized)\r\n            output[x] = (temp[x] * (k0 + k1 + k2) + temp[x + width] * k1 + temp[x + width * 2] * k0) * (1.0 / (k0 + k1 + k2));\r\n            output[x + width] = (temp[x] * k1 + temp[x + width] * k2 + temp[x + width * 2] * k1 + temp[x + width * 3] * k0) * (1.0 / (k1 + k2 + k1 + k0));\r\n\r\n            // Main loop - NO boundary checks\r\n            for (let y = 2; y < height - 2; y++) {\r\n                const p = y * width + x;\r\n                output[p] = temp[p - width * 2] * k0 + temp[p - width] * k1 + temp[p] * k2 + temp[p + width] * k1 + temp[p + width * 2] * k0;\r\n            }\r\n\r\n            // Bottom border (Normalized)\r\n            const b2 = (height - 2) * width + x;\r\n            const b1 = (height - 1) * width + x;\r\n            output[b2] = (temp[b2 - width * 2] * k0 + temp[b2 - width] * k1 + temp[b2] * k2 + temp[b1] * k1) * (1.0 / (k0 + k1 + k2 + k1));\r\n            output[b1] = (temp[b1 - width * 2] * k0 + temp[b1 - width] * k1 + temp[b1] * (k2 + k1 + k0)) * (1.0 / (k0 + k1 + k2));\r\n        }\r\n\r\n        return { data: output, width, height };\r\n    }\r\n\r\n    /**\r\n     * Downsample imagen por factor de 2\r\n     */\r\n    _downsample(data, width, height) {\r\n        const newWidth = width >> 1;\r\n        const newHeight = height >> 1;\r\n        const output = new Float32Array(newWidth * newHeight);\r\n\r\n        for (let y = 0; y < newHeight; y++) {\r\n            const r0 = (y * 2) * width;\r\n            const r1 = r0 + width;\r\n            const dr = y * newWidth;\r\n            for (let x = 0; x < newWidth; x++) {\r\n                const i2 = x * 2;\r\n                output[dr + x] = (data[r0 + i2] + data[r0 + i2 + 1] + data[r1 + i2] + data[r1 + i2 + 1]) * 0.25;\r\n            }\r\n        }\r\n        return { data: output, width: newWidth, height: newHeight };\r\n    }\r\n\r\n    /**\r\n     * Construye pir\u00E1mide de diferencia de gaussianas\r\n     */\r\n    _buildDogPyramid(pyramidImages, octavesToProcess = null) {\r\n        const dogPyramid = [];\r\n\r\n        for (let i = 0; i < pyramidImages.length; i++) {\r\n            if (!pyramidImages[i]) {\r\n                dogPyramid.push(null);\r\n                continue;\r\n            }\r\n            const img1 = pyramidImages[i][0];\r\n            const img2 = pyramidImages[i][1];\r\n            const width = img1.width;\r\n            const height = img1.height;\r\n            const dog = new Float32Array(width * height);\r\n\r\n            for (let j = 0; j < dog.length; j++) {\r\n                dog[j] = img2.data[j] - img1.data[j];\r\n            }\r\n\r\n            dogPyramid.push({ data: dog, width, height });\r\n        }\r\n\r\n        return dogPyramid;\r\n    }\r\n\r\n    /**\r\n     * Encuentra extremos locales en la pir\u00E1mide DoG\r\n     */\r\n    _findExtremas(dogPyramid, pyramidImages) {\r\n        const extremas = [];\r\n\r\n        for (let octave = 0; octave < dogPyramid.length; octave++) {\r\n            const curr = dogPyramid[octave];\r\n            if (!curr) continue;\r\n\r\n            const prev = octave > 0 ? dogPyramid[octave - 1] : null;\r\n            const next = octave < dogPyramid.length - 1 ? dogPyramid[octave + 1] : null;\r\n\r\n            const width = curr.width;\r\n            const height = curr.height;\r\n\r\n            for (let y = 1; y < height - 1; y++) {\r\n                for (let x = 1; x < width - 1; x++) {\r\n                    const val = curr.data[y * width + x];\r\n\r\n                    if (Math.abs(val) < 0.003) continue; // Aggressively lowered threshold to 0.003 for max sensitivity\r\n\r\n                    let isMaxima = true;\r\n                    let isMinima = true;\r\n\r\n                    // Check 3x3 neighborhood in current scale\r\n                    for (let dy = -1; dy <= 1 && (isMaxima || isMinima); dy++) {\r\n                        for (let dx = -1; dx <= 1 && (isMaxima || isMinima); dx++) {\r\n                            if (dx === 0 && dy === 0) continue;\r\n                            const neighbor = curr.data[(y + dy) * width + (x + dx)];\r\n                            if (neighbor >= val) isMaxima = false;\r\n                            if (neighbor <= val) isMinima = false;\r\n                        }\r\n                    }\r\n\r\n                    // Check previous scale (scaled coordinates) - skip if no prev layer\r\n                    if ((isMaxima || isMinima) && prev) {\r\n                        const px = x << 1;\r\n                        const py = y << 1;\r\n                        const prevWidth = prev.width;\r\n                        for (let dy = -1; dy <= 1 && (isMaxima || isMinima); dy++) {\r\n                            for (let dx = -1; dx <= 1 && (isMaxima || isMinima); dx++) {\r\n                                const xx = Math.max(0, Math.min(prevWidth - 1, px + dx));\r\n                                const yy = Math.max(0, Math.min(prev.height - 1, py + dy));\r\n                                const neighbor = prev.data[yy * prevWidth + xx];\r\n                                if (neighbor >= val) isMaxima = false;\r\n                                if (neighbor <= val) isMinima = false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Check next scale (scaled coordinates) - skip if no next layer\r\n                    if ((isMaxima || isMinima) && next) {\r\n                        const nx = x >> 1;\r\n                        const ny = y >> 1;\r\n                        const nextWidth = next.width;\r\n                        for (let dy = -1; dy <= 1 && (isMaxima || isMinima); dy++) {\r\n                            for (let dx = -1; dx <= 1 && (isMaxima || isMinima); dx++) {\r\n                                const xx = Math.max(0, Math.min(nextWidth - 1, nx + dx));\r\n                                const yy = Math.max(0, Math.min(next.height - 1, ny + dy));\r\n                                const neighbor = next.data[yy * nextWidth + xx];\r\n                                if (neighbor >= val) isMaxima = false;\r\n                                if (neighbor <= val) isMinima = false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (isMaxima || isMinima) {\r\n                        extremas.push({\r\n                            score: isMaxima ? Math.abs(val) : -Math.abs(val),\r\n                            octave,\r\n                            x,\r\n                            y,\r\n                            absScore: Math.abs(val)\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return extremas;\r\n    }\r\n\r\n    /**\r\n     * Aplica pruning para mantener solo los mejores features por bucket\r\n     */\r\n    _applyPrune(extremas) {\r\n        const nBuckets = NUM_BUCKETS_PER_DIMENSION;\r\n        const nFeatures = this.maxFeaturesPerBucket;\r\n\r\n        // Agrupar por buckets\r\n        const buckets = [];\r\n        for (let i = 0; i < nBuckets * nBuckets; i++) {\r\n            buckets.push([]);\r\n        }\r\n\r\n        for (const ext of extremas) {\r\n            const bucketX = Math.min(nBuckets - 1, Math.floor(ext.x / (this.width / Math.pow(2, ext.octave)) * nBuckets));\r\n            const bucketY = Math.min(nBuckets - 1, Math.floor(ext.y / (this.height / Math.pow(2, ext.octave)) * nBuckets));\r\n            const bucketIdx = bucketY * nBuckets + bucketX;\r\n            if (bucketIdx >= 0 && bucketIdx < buckets.length) {\r\n                buckets[bucketIdx].push(ext);\r\n            }\r\n        }\r\n\r\n        // Seleccionar top features por bucket\r\n        const result = [];\r\n        for (const bucket of buckets) {\r\n            bucket.sort((a, b) => b.absScore - a.absScore);\r\n            for (let i = 0; i < Math.min(nFeatures, bucket.length); i++) {\r\n                result.push(bucket[i]);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Calcula la orientaci\u00F3n de cada feature\r\n     */\r\n    _computeOrientations(extremas, pyramidImages) {\r\n        for (const ext of extremas) {\r\n            if (ext.octave < 0 || ext.octave >= pyramidImages.length) {\r\n                ext.angle = 0;\r\n                continue;\r\n            }\r\n\r\n            const img = pyramidImages[ext.octave][1];\r\n            const width = img.width;\r\n            const height = img.height;\r\n            const data = img.data;\r\n\r\n            const x = Math.floor(ext.x);\r\n            const y = Math.floor(ext.y);\r\n\r\n            // Compute gradient histogram\r\n            const histogram = new Float32Array(ORIENTATION_NUM_BINS);\r\n            const radius = 4;\r\n\r\n            for (let dy = -radius; dy <= radius; dy++) {\r\n                for (let dx = -radius; dx <= radius; dx++) {\r\n                    const yy = y + dy;\r\n                    const xx = x + dx;\r\n\r\n                    if (yy <= 0 || yy >= height - 1 || xx <= 0 || xx >= width - 1) continue;\r\n\r\n                    const gradY = data[(yy + 1) * width + xx] - data[(yy - 1) * width + xx];\r\n                    const gradX = data[yy * width + xx + 1] - data[yy * width + xx - 1];\r\n\r\n                    const mag = Math.sqrt(gradX * gradX + gradY * gradY);\r\n                    const angle = Math.atan2(gradY, gradX) + Math.PI; // 0 to 2*PI\r\n\r\n                    const bin = Math.floor(angle / (2 * Math.PI) * ORIENTATION_NUM_BINS) % ORIENTATION_NUM_BINS;\r\n                    const weight = Math.exp(-(dx * dx + dy * dy) / (2 * radius * radius));\r\n                    histogram[bin] += mag * weight;\r\n                }\r\n            }\r\n\r\n            // Find peak\r\n            let maxBin = 0;\r\n            for (let i = 1; i < ORIENTATION_NUM_BINS; i++) {\r\n                if (histogram[i] > histogram[maxBin]) {\r\n                    maxBin = i;\r\n                }\r\n            }\r\n\r\n            ext.angle = (maxBin + 0.5) * 2 * Math.PI / ORIENTATION_NUM_BINS - Math.PI;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calcula descriptores FREAK\r\n     */\r\n    _computeFreakDescriptors(extremas, pyramidImages) {\r\n        for (const ext of extremas) {\r\n            if (ext.octave < 0 || ext.octave >= pyramidImages.length) {\r\n                ext.descriptors = new Uint8Array(8);\r\n                continue;\r\n            }\r\n\r\n            const img = pyramidImages[ext.octave][1];\r\n            const width = img.width;\r\n            const height = img.height;\r\n            const data = img.data;\r\n\r\n            const cos = Math.cos(ext.angle || 0) * FREAK_EXPANSION_FACTOR;\r\n            const sin = Math.sin(ext.angle || 0) * FREAK_EXPANSION_FACTOR;\r\n\r\n            // Sample FREAK points\r\n            const samples = new Float32Array(FREAKPOINTS.length);\r\n            for (let i = 0; i < FREAKPOINTS.length; i++) {\r\n                const [, fx, fy] = FREAKPOINTS[i];\r\n                const xp = ext.x + fx * cos - fy * sin;\r\n                const yp = ext.y + fx * sin + fy * cos;\r\n\r\n                const x0 = Math.max(0, Math.min(width - 2, Math.floor(xp)));\r\n                const y0 = Math.max(0, Math.min(height - 2, Math.floor(yp)));\r\n                const x1 = x0 + 1;\r\n                const y1 = y0 + 1;\r\n\r\n                const fracX = xp - x0;\r\n                const fracY = yp - y0;\r\n\r\n                samples[i] =\r\n                    data[y0 * width + x0] * (1 - fracX) * (1 - fracY) +\r\n                    data[y0 * width + x1] * fracX * (1 - fracY) +\r\n                    data[y1 * width + x0] * (1 - fracX) * fracY +\r\n                    data[y1 * width + x1] * fracX * fracY;\r\n            }\r\n\r\n            // \uD83D\uDE80 MOONSHOT: Direct LSH computation\r\n            // Avoids computing 672 bits of FREAK just to sample 64.\r\n            if (this.useLSH) {\r\n                ext.lsh = computeLSH64(samples);\r\n                // Pack LSH into 8-byte descriptors for compatibility\r\n                ext.descriptors = packLSHIntoDescriptor(ext.lsh);\r\n            } else {\r\n                ext.descriptors = computeFullFREAK(samples);\r\n            }\r\n        }\r\n    }\r\n}\r\n", "\nexport default class TinyQueue {\n    constructor(data = [], compare = defaultCompare) {\n        this.data = data;\n        this.length = this.data.length;\n        this.compare = compare;\n\n        if (this.length > 0) {\n            for (let i = (this.length >> 1) - 1; i >= 0; i--) this._down(i);\n        }\n    }\n\n    push(item) {\n        this.data.push(item);\n        this.length++;\n        this._up(this.length - 1);\n    }\n\n    pop() {\n        if (this.length === 0) return undefined;\n\n        const top = this.data[0];\n        const bottom = this.data.pop();\n        this.length--;\n\n        if (this.length > 0) {\n            this.data[0] = bottom;\n            this._down(0);\n        }\n\n        return top;\n    }\n\n    peek() {\n        return this.data[0];\n    }\n\n    _up(pos) {\n        const {data, compare} = this;\n        const item = data[pos];\n\n        while (pos > 0) {\n            const parent = (pos - 1) >> 1;\n            const current = data[parent];\n            if (compare(item, current) >= 0) break;\n            data[pos] = current;\n            pos = parent;\n        }\n\n        data[pos] = item;\n    }\n\n    _down(pos) {\n        const {data, compare} = this;\n        const halfLength = this.length >> 1;\n        const item = data[pos];\n\n        while (pos < halfLength) {\n            let left = (pos << 1) + 1;\n            let best = data[left];\n            const right = left + 1;\n\n            if (right < this.length && compare(data[right], best) < 0) {\n                left = right;\n                best = data[right];\n            }\n            if (compare(best, item) >= 0) break;\n\n            data[pos] = best;\n            pos = left;\n        }\n\n        data[pos] = item;\n    }\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n", "// Precomputed bit count lookup table for Uint8Array\r\nconst BIT_COUNT_8 = new Uint8Array(256);\r\nfor (let i = 0; i < 256; i++) {\r\n  let c = 0, n = i;\r\n  while (n > 0) { n &= (n - 1); c++; }\r\n  BIT_COUNT_8[i] = c;\r\n}\r\n\r\n/**\r\n * \uD83D\uDE80 Moonshot Optimized Popcount\r\n * Uses a slightly faster bitwise sequence for 32-bit integers\r\n */\r\nfunction popcount32(n) {\r\n  n = n >>> 0; // Force unsigned\r\n  n -= (n >>> 1) & 0x55555555;\r\n  n = (n & 0x33333333) + ((n >>> 2) & 0x33333333);\r\n  return (((n + (n >>> 4)) & 0x0F0F0F0F) * 0x01010101) >>> 24;\r\n}\r\n\r\n/**\r\n * Super-optimized Hamming distance for 64-bit LSH (2x Uint32)\r\n * NO OBJECTS, NO OPTIONS, JUST PURE SPEED.\r\n */\r\nconst compute64 = (v1, v1Idx, v2, v2Idx) => {\r\n  // Inline XOR and popcount for maximum speed\r\n  let x1 = (v1[v1Idx] ^ v2[v2Idx]) >>> 0;\r\n  let x2 = (v1[v1Idx + 1] ^ v2[v2Idx + 1]) >>> 0;\r\n\r\n  // Popcount 1\r\n  x1 -= (x1 >>> 1) & 0x55555555;\r\n  x1 = (x1 & 0x33333333) + ((x1 >>> 2) & 0x33333333);\r\n  const count1 = (((x1 + (x1 >>> 4)) & 0x0F0F0F0F) * 0x01010101) >>> 24;\r\n\r\n  // Popcount 2\r\n  x2 -= (x2 >>> 1) & 0x55555555;\r\n  x2 = (x2 & 0x33333333) + ((x2 >>> 2) & 0x33333333);\r\n  const count2 = (((x2 + (x2 >>> 4)) & 0x0F0F0F0F) * 0x01010101) >>> 24;\r\n\r\n  return count1 + count2;\r\n};\r\n\r\n/**\r\n * Generic compute for backward compatibility\r\n */\r\nconst compute = (options) => {\r\n  const { v1, v2, v1Offset = 0, v2Offset = 0 } = options;\r\n  const v2Len = v2.length - v2Offset;\r\n\r\n  if (v2Len === 2) {\r\n    return compute64(v1, v1Offset, v2, v2Offset);\r\n  }\r\n\r\n  // Protocol V4: 84-byte descriptors (Uint8Array)\r\n  if (v2Len === 84) {\r\n    let d = 0;\r\n    for (let i = 0; i < 84; i++) {\r\n      d += BIT_COUNT_8[v1[v1Offset + i] ^ v2[v2Offset + i]];\r\n    }\r\n    return d;\r\n  }\r\n\r\n  // Protocol V5.1: 128-bit LSH (4 x Uint32)\r\n  if (v2Len === 4) {\r\n    return popcount32(v1[v1Offset] ^ v2[v2Offset]) +\r\n      popcount32(v1[v1Offset + 1] ^ v2[v2Offset + 1]) +\r\n      popcount32(v1[v1Offset + 2] ^ v2[v2Offset + 2]) +\r\n      popcount32(v1[v1Offset + 3] ^ v2[v2Offset + 3]);\r\n  }\r\n\r\n  return popcount32(v1[v1Offset] ^ v2[v2Offset]) +\r\n    popcount32(v1[v1Offset + 1] ^ v2[v2Offset + 1]);\r\n};\r\n\r\nexport { compute, compute64 };\r\n", "const kHoughBinDelta = 1;\r\n\r\n// mathces [querypointIndex:x, keypointIndex: x]\r\nconst computeHoughMatches = (options) => {\r\n  const { keywidth, keyheight, querywidth, queryheight, matches } = options;\r\n\r\n  const maxX = querywidth * 1.2;\r\n  const minX = -maxX;\r\n  const maxY = queryheight * 1.2;\r\n  const minY = -maxY;\r\n  const numAngleBins = 12;\r\n  const numScaleBins = 12; // \uD83D\uDE80 Increased bins\r\n  const minScale = -2; // \uD83D\uDCD0 Support 1% scale (10^-2)\r\n  const maxScale = 1;  // \uD83D\uDCD0 Support 1000% scale (10^1)\r\n  const scaleK = 10.0;\r\n  const scaleOneOverLogK = 1.0 / Math.log(scaleK);\r\n  const maxDim = Math.max(keywidth, keyheight);\r\n  const keycenterX = Math.floor(keywidth / 2);\r\n  const keycenterY = Math.floor(keyheight / 2);\r\n\r\n  // compute numXBins and numYBins based on matches\r\n  const projectedDims = [];\r\n  for (let i = 0; i < matches.length; i++) {\r\n    const queryscale = matches[i].querypoint.scale;\r\n    const keyscale = matches[i].keypoint.scale;\r\n    if (keyscale == 0) console.log(\"ERROR divide zero\");\r\n    const scale = queryscale / keyscale;\r\n    projectedDims.push(scale * maxDim);\r\n  }\r\n\r\n  // TODO optimize median\r\n  //   weird. median should be [Math.floor(projectedDims.length/2) - 1] ?\r\n  projectedDims.sort((a1, a2) => {\r\n    return a1 - a2;\r\n  });\r\n  const medianProjectedDim =\r\n    projectedDims[\r\n    Math.floor(projectedDims.length / 2) - (projectedDims.length % 2 == 0 ? 1 : 0) - 1\r\n    ];\r\n\r\n  const binSize = Math.max(20, 0.25 * medianProjectedDim); // \uD83D\uDE80 Ensure bins aren't too small for noise\r\n  const numXBins = Math.max(5, Math.min(40, Math.ceil((maxX - minX) / binSize))); // \uD83C\uDFAF Cap bins to keep voting dense\r\n  const numYBins = Math.max(5, Math.min(40, Math.ceil((maxY - minY) / binSize)));\r\n\r\n  const numXYBins = numXBins * numYBins;\r\n  const numXYAngleBins = numXYBins * numAngleBins;\r\n\r\n  // do voting\r\n  const querypointValids = [];\r\n  const querypointBinLocations = [];\r\n  const votes = {};\r\n  for (let i = 0; i < matches.length; i++) {\r\n    const querypoint = matches[i].querypoint;\r\n    const keypoint = matches[i].keypoint;\r\n\r\n    const { x, y, scale, angle } = _mapCorrespondence({\r\n      querypoint,\r\n      keypoint,\r\n      keycenterX,\r\n      keycenterY,\r\n      scaleOneOverLogK,\r\n    });\r\n\r\n    // Check that the vote is within range\r\n    if (\r\n      x < minX ||\r\n      x >= maxX ||\r\n      y < minY ||\r\n      y >= maxY ||\r\n      angle <= -Math.PI ||\r\n      angle > Math.PI ||\r\n      scale < minScale ||\r\n      scale >= maxScale\r\n    ) {\r\n      querypointValids[i] = false;\r\n      continue;\r\n    }\r\n\r\n    // map properties to bins\r\n    let fbinX = (numXBins * (x - minX)) / (maxX - minX);\r\n    let fbinY = (numYBins * (y - minY)) / (maxY - minY);\r\n    let fbinAngle = (numAngleBins * (angle + Math.PI)) / (2.0 * Math.PI);\r\n    let fbinScale = (numScaleBins * (scale - minScale)) / (maxScale - minScale);\r\n\r\n    querypointBinLocations[i] = {\r\n      binX: fbinX,\r\n      binY: fbinY,\r\n      binAngle: fbinAngle,\r\n      binScale: fbinScale,\r\n    };\r\n\r\n    let binX = Math.floor(fbinX - 0.5);\r\n    let binY = Math.floor(fbinY - 0.5);\r\n    let binScale = Math.floor(fbinScale - 0.5);\r\n    let binAngle = (Math.floor(fbinAngle - 0.5) + numAngleBins) % numAngleBins;\r\n\r\n    // check can vote all 16 bins\r\n    if (\r\n      binX < 0 ||\r\n      binX + 1 >= numXBins ||\r\n      binY < 0 ||\r\n      binY + 1 >= numYBins ||\r\n      binScale < 0 ||\r\n      binScale + 1 >= numScaleBins\r\n    ) {\r\n      querypointValids[i] = false;\r\n      continue;\r\n    }\r\n\r\n    for (let dx = 0; dx < 2; dx++) {\r\n      let binX2 = binX + dx;\r\n\r\n      for (let dy = 0; dy < 2; dy++) {\r\n        let binY2 = binY + dy;\r\n\r\n        for (let dangle = 0; dangle < 2; dangle++) {\r\n          let binAngle2 = (binAngle + dangle) % numAngleBins;\r\n\r\n          for (let dscale = 0; dscale < 2; dscale++) {\r\n            let binScale2 = binScale + dscale;\r\n\r\n            const binIndex =\r\n              binX2 + binY2 * numXBins + binAngle2 * numXYBins + binScale2 * numXYAngleBins;\r\n\r\n            if (votes[binIndex] === undefined) votes[binIndex] = 0;\r\n            votes[binIndex] += 1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    querypointValids[i] = true;\r\n  }\r\n\r\n  let maxVotes = 0;\r\n  let maxVoteIndex = -1;\r\n  Object.keys(votes).forEach((index) => {\r\n    if (votes[index] > maxVotes) {\r\n      maxVotes = votes[index];\r\n      maxVoteIndex = index;\r\n    }\r\n  });\r\n\r\n  if (maxVotes < 3) return [];\r\n\r\n  // get back bins from vote index\r\n  const binX = Math.floor(((maxVoteIndex % numXYAngleBins) % numXYBins) % numXBins);\r\n  const binY = Math.floor((((maxVoteIndex - binX) % numXYAngleBins) % numXYBins) / numXBins);\r\n  const binAngle = Math.floor(\r\n    ((maxVoteIndex - binX - binY * numXBins) % numXYAngleBins) / numXYBins,\r\n  );\r\n  const binScale = Math.floor(\r\n    (maxVoteIndex - binX - binY * numXBins - binAngle * numXYBins) / numXYAngleBins,\r\n  );\r\n\r\n  // console.log(`[Hough] Peak votes: ${maxVotes} out of ${matches.length} matches.`);\r\n\r\n  const houghMatches = [];\r\n  const relaxedDelta = 2.0; // \uD83D\uDE80 Increased for better cluster robustness\r\n  for (let i = 0; i < matches.length; i++) {\r\n    if (!querypointValids[i]) continue;\r\n\r\n    const queryBins = querypointBinLocations[i];\r\n    // compute bin difference\r\n    const distBinX = Math.abs(queryBins.binX - (binX + 0.5));\r\n    if (distBinX >= relaxedDelta) continue;\r\n\r\n    const distBinY = Math.abs(queryBins.binY - (binY + 0.5));\r\n    if (distBinY >= relaxedDelta) continue;\r\n\r\n    const distBinScale = Math.abs(queryBins.binScale - (binScale + 0.5));\r\n    if (distBinScale >= relaxedDelta) continue;\r\n\r\n    const temp = Math.abs(queryBins.binAngle - (binAngle + 0.5));\r\n    const distBinAngle = Math.min(temp, numAngleBins - temp);\r\n    if (distBinAngle >= relaxedDelta) continue;\r\n\r\n    houghMatches.push(matches[i]);\r\n  }\r\n  return houghMatches;\r\n};\r\n\r\nconst _mapCorrespondence = ({ querypoint, keypoint, keycenterX, keycenterY, scaleOneOverLogK }) => {\r\n  // map angle to (-pi, pi]\r\n  let angle = querypoint.angle - keypoint.angle;\r\n  if (angle <= -Math.PI) angle += 2 * Math.PI;\r\n  else if (angle > Math.PI) angle -= 2 * Math.PI;\r\n\r\n  const scale = querypoint.scale / keypoint.scale;\r\n\r\n  // 2x2 similarity\r\n  const cos = scale * Math.cos(angle);\r\n  const sin = scale * Math.sin(angle);\r\n  const S = [cos, -sin, sin, cos];\r\n\r\n  const tp = [S[0] * keypoint.x + S[1] * keypoint.y, S[2] * keypoint.x + S[3] * keypoint.y];\r\n  const tx = querypoint.x - tp[0];\r\n  const ty = querypoint.y - tp[1];\r\n\r\n  return {\r\n    x: S[0] * keycenterX + S[1] * keycenterY + tx,\r\n    y: S[2] * keycenterX + S[3] * keycenterY + ty,\r\n    angle: angle,\r\n    scale: Math.log(scale) * scaleOneOverLogK,\r\n  };\r\n};\r\n\r\nexport { computeHoughMatches };\r\n", "const mRandSeed = 1234;\r\n\r\nconst createRandomizer = () => {\r\n  const randomizer = {\r\n    seed: mRandSeed,\r\n\r\n    arrayShuffle(options) {\r\n      const { arr, sampleSize } = options;\r\n      for (let i = 0; i < sampleSize; i++) {\r\n        this.seed = (214013 * this.seed + 2531011) % (1 << 31);\r\n        let k = (this.seed >> 16) & 0x7fff;\r\n        k = k % arr.length;\r\n\r\n        let tmp = arr[i];\r\n        arr[i] = arr[k];\r\n        arr[k] = tmp;\r\n      }\r\n    },\r\n\r\n    nextInt(maxValue) {\r\n      this.seed = (214013 * this.seed + 2531011) % (1 << 31);\r\n      let k = (this.seed >> 16) & 0x7fff;\r\n      k = k % maxValue;\r\n      return k;\r\n    },\r\n  };\r\n  return randomizer;\r\n};\r\nexport { createRandomizer };\r\n", "// check which side point C on the line from A to B\r\nconst linePointSide = (A, B, C) => {\r\n  return (B[0] - A[0]) * (C[1] - A[1]) - (B[1] - A[1]) * (C[0] - A[0]);\r\n};\r\n\r\n// srcPoints, dstPoints: array of four elements [x, y]\r\nconst checkFourPointsConsistent = (x1, x2, x3, x4, x1p, x2p, x3p, x4p) => {\r\n  if (linePointSide(x1, x2, x3) > 0 !== linePointSide(x1p, x2p, x3p) > 0) return false;\r\n  if (linePointSide(x2, x3, x4) > 0 !== linePointSide(x2p, x3p, x4p) > 0) return false;\r\n  if (linePointSide(x3, x4, x1) > 0 !== linePointSide(x3p, x4p, x1p) > 0) return false;\r\n  if (linePointSide(x4, x1, x2) > 0 !== linePointSide(x4p, x1p, x2p) > 0) return false;\r\n  return true;\r\n};\r\n\r\nconst checkThreePointsConsistent = (x1, x2, x3, x1p, x2p, x3p) => {\r\n  if (linePointSide(x1, x2, x3) > 0 !== linePointSide(x1p, x2p, x3p) > 0) return false;\r\n  return true;\r\n};\r\n\r\nconst determinant = (A) => {\r\n  const C1 = A[4] * A[8] - A[5] * A[7];\r\n  const C2 = A[3] * A[8] - A[5] * A[6];\r\n  const C3 = A[3] * A[7] - A[4] * A[6];\r\n  return A[0] * C1 - A[1] * C2 + A[2] * C3;\r\n};\r\n\r\nconst matrixInverse33 = (A, threshold) => {\r\n  const det = determinant(A);\r\n  if (Math.abs(det) <= threshold) return null;\r\n  const oneOver = 1.0 / det;\r\n\r\n  const B = [\r\n    (A[4] * A[8] - A[5] * A[7]) * oneOver,\r\n    (A[2] * A[7] - A[1] * A[8]) * oneOver,\r\n    (A[1] * A[5] - A[2] * A[4]) * oneOver,\r\n    (A[5] * A[6] - A[3] * A[8]) * oneOver,\r\n    (A[0] * A[8] - A[2] * A[6]) * oneOver,\r\n    (A[2] * A[3] - A[0] * A[5]) * oneOver,\r\n    (A[3] * A[7] - A[4] * A[6]) * oneOver,\r\n    (A[1] * A[6] - A[0] * A[7]) * oneOver,\r\n    (A[0] * A[4] - A[1] * A[3]) * oneOver,\r\n  ];\r\n  return B;\r\n};\r\n\r\nconst matrixMul33 = (A, B) => {\r\n  const C = [];\r\n  C[0] = A[0] * B[0] + A[1] * B[3] + A[2] * B[6];\r\n  C[1] = A[0] * B[1] + A[1] * B[4] + A[2] * B[7];\r\n  C[2] = A[0] * B[2] + A[1] * B[5] + A[2] * B[8];\r\n  C[3] = A[3] * B[0] + A[4] * B[3] + A[5] * B[6];\r\n  C[4] = A[3] * B[1] + A[4] * B[4] + A[5] * B[7];\r\n  C[5] = A[3] * B[2] + A[4] * B[5] + A[5] * B[8];\r\n  C[6] = A[6] * B[0] + A[7] * B[3] + A[8] * B[6];\r\n  C[7] = A[6] * B[1] + A[7] * B[4] + A[8] * B[7];\r\n  C[8] = A[6] * B[2] + A[7] * B[5] + A[8] * B[8];\r\n  return C;\r\n};\r\n\r\nconst multiplyPointHomographyInhomogenous = (x, H) => {\r\n  const w = H[6] * x[0] + H[7] * x[1] + H[8];\r\n  const xp = [];\r\n  xp[0] = (H[0] * x[0] + H[1] * x[1] + H[2]) / w;\r\n  xp[1] = (H[3] * x[0] + H[4] * x[1] + H[5]) / w;\r\n  return xp;\r\n};\r\n\r\nconst smallestTriangleArea = (x1, x2, x3, x4) => {\r\n  const v12 = _vector(x2, x1);\r\n  const v13 = _vector(x3, x1);\r\n  const v14 = _vector(x4, x1);\r\n  const v32 = _vector(x2, x3);\r\n  const v34 = _vector(x4, x3);\r\n  const a1 = _areaOfTriangle(v12, v13);\r\n  const a2 = _areaOfTriangle(v13, v14);\r\n  const a3 = _areaOfTriangle(v12, v14);\r\n  const a4 = _areaOfTriangle(v32, v34);\r\n  return Math.min(Math.min(Math.min(a1, a2), a3), a4);\r\n};\r\n\r\n// check if four points form a convex quadrilaternal.\r\n// all four combinations should have same sign\r\nconst quadrilateralConvex = (x1, x2, x3, x4) => {\r\n  const first = linePointSide(x1, x2, x3) <= 0;\r\n  if (linePointSide(x2, x3, x4) <= 0 !== first) return false;\r\n  if (linePointSide(x3, x4, x1) <= 0 !== first) return false;\r\n  if (linePointSide(x4, x1, x2) <= 0 !== first) return false;\r\n\r\n  //if (linePointSide(x1, x2, x3) <= 0) return false;\r\n  //if (linePointSide(x2, x3, x4) <= 0) return false;\r\n  //if (linePointSide(x3, x4, x1) <= 0) return false;\r\n  //if (linePointSide(x4, x1, x2) <= 0) return false;\r\n  return true;\r\n};\r\n\r\nconst _vector = (a, b) => {\r\n  return [a[0] - b[0], a[1] - b[1]];\r\n};\r\n\r\nconst _areaOfTriangle = (u, v) => {\r\n  const a = u[0] * v[1] - u[1] * v[0];\r\n  return Math.abs(a) * 0.5;\r\n};\r\n\r\nexport {\r\n  matrixInverse33,\r\n  matrixMul33,\r\n  quadrilateralConvex,\r\n  smallestTriangleArea,\r\n  multiplyPointHomographyInhomogenous,\r\n  checkThreePointsConsistent,\r\n  checkFourPointsConsistent,\r\n  determinant,\r\n};\r\n", "// eslint-disable-next-line @typescript-eslint/unbound-method\nconst toString = Object.prototype.toString;\n\nexport type AnyArray =\n  | any[] // eslint-disable-line @typescript-eslint/no-explicit-any\n  | Int8Array\n  | Uint8Array\n  | Uint8ClampedArray\n  | Int16Array\n  | Uint16Array\n  | Int32Array\n  | Uint32Array\n  | Float32Array\n  | Float64Array;\n\n/**\n * Checks if an object is an instance of an Array (array or typed array, except those that contain bigint values).\n *\n * @param value - Object to check.\n * @returns True if the object is an array or a typed array.\n */\nexport function isAnyArray(value: unknown): value is AnyArray {\n  const tag = toString.call(value);\n  return tag.endsWith('Array]') && !tag.includes('Big');\n}\n", "'use strict';\n\nvar isAnyArray = require('is-any-array');\n\nfunction max(input, options = {}) {\n  if (!isAnyArray.isAnyArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  const { fromIndex = 0, toIndex = input.length } = options;\n\n  if (\n    fromIndex < 0 ||\n    fromIndex >= input.length ||\n    !Number.isInteger(fromIndex)\n  ) {\n    throw new Error('fromIndex must be a positive integer smaller than length');\n  }\n\n  if (\n    toIndex <= fromIndex ||\n    toIndex > input.length ||\n    !Number.isInteger(toIndex)\n  ) {\n    throw new Error(\n      'toIndex must be an integer greater than fromIndex and at most equal to length',\n    );\n  }\n\n  let maxValue = input[fromIndex];\n  for (let i = fromIndex + 1; i < toIndex; i++) {\n    if (input[i] > maxValue) maxValue = input[i];\n  }\n  return maxValue;\n}\n\nmodule.exports = max;\n", "'use strict';\n\nvar isAnyArray = require('is-any-array');\n\nfunction min(input, options = {}) {\n  if (!isAnyArray.isAnyArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  const { fromIndex = 0, toIndex = input.length } = options;\n\n  if (\n    fromIndex < 0 ||\n    fromIndex >= input.length ||\n    !Number.isInteger(fromIndex)\n  ) {\n    throw new Error('fromIndex must be a positive integer smaller than length');\n  }\n\n  if (\n    toIndex <= fromIndex ||\n    toIndex > input.length ||\n    !Number.isInteger(toIndex)\n  ) {\n    throw new Error(\n      'toIndex must be an integer greater than fromIndex and at most equal to length',\n    );\n  }\n\n  let minValue = input[fromIndex];\n  for (let i = fromIndex + 1; i < toIndex; i++) {\n    if (input[i] < minValue) minValue = input[i];\n  }\n  return minValue;\n}\n\nmodule.exports = min;\n", "'use strict';\n\nvar isAnyArray = require('is-any-array');\nvar max = require('ml-array-max');\nvar min = require('ml-array-min');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar max__default = /*#__PURE__*/_interopDefaultLegacy(max);\nvar min__default = /*#__PURE__*/_interopDefaultLegacy(min);\n\nfunction rescale(input, options = {}) {\n  if (!isAnyArray.isAnyArray(input)) {\n    throw new TypeError('input must be an array');\n  } else if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  let output;\n  if (options.output !== undefined) {\n    if (!isAnyArray.isAnyArray(options.output)) {\n      throw new TypeError('output option must be an array if specified');\n    }\n    output = options.output;\n  } else {\n    output = new Array(input.length);\n  }\n\n  const currentMin = min__default['default'](input);\n  const currentMax = max__default['default'](input);\n\n  if (currentMin === currentMax) {\n    throw new RangeError(\n      'minimum and maximum input values are equal. Cannot rescale a constant array',\n    );\n  }\n\n  const {\n    min: minValue = options.autoMinMax ? currentMin : 0,\n    max: maxValue = options.autoMinMax ? currentMax : 1,\n  } = options;\n\n  if (minValue >= maxValue) {\n    throw new RangeError('min option must be smaller than max option');\n  }\n\n  const factor = (maxValue - minValue) / (currentMax - currentMin);\n  for (let i = 0; i < input.length; i++) {\n    output[i] = (input[i] - currentMin) * factor + minValue;\n  }\n\n  return output;\n}\n\nmodule.exports = rescale;\n", "'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar isAnyArray = require('is-any-array');\nvar rescale = require('ml-array-rescale');\n\nconst indent = ' '.repeat(2);\nconst indentData = ' '.repeat(4);\n\n/**\n * @this {Matrix}\n * @returns {string}\n */\nfunction inspectMatrix() {\n  return inspectMatrixWithOptions(this);\n}\n\nfunction inspectMatrixWithOptions(matrix, options = {}) {\n  const {\n    maxRows = 15,\n    maxColumns = 10,\n    maxNumSize = 8,\n    padMinus = 'auto',\n  } = options;\n  return `${matrix.constructor.name} {\n${indent}[\n${indentData}${inspectData(matrix, maxRows, maxColumns, maxNumSize, padMinus)}\n${indent}]\n${indent}rows: ${matrix.rows}\n${indent}columns: ${matrix.columns}\n}`;\n}\n\nfunction inspectData(matrix, maxRows, maxColumns, maxNumSize, padMinus) {\n  const { rows, columns } = matrix;\n  const maxI = Math.min(rows, maxRows);\n  const maxJ = Math.min(columns, maxColumns);\n  const result = [];\n\n  if (padMinus === 'auto') {\n    padMinus = false;\n    loop: for (let i = 0; i < maxI; i++) {\n      for (let j = 0; j < maxJ; j++) {\n        if (matrix.get(i, j) < 0) {\n          padMinus = true;\n          break loop;\n        }\n      }\n    }\n  }\n\n  for (let i = 0; i < maxI; i++) {\n    let line = [];\n    for (let j = 0; j < maxJ; j++) {\n      line.push(formatNumber(matrix.get(i, j), maxNumSize, padMinus));\n    }\n    result.push(`${line.join(' ')}`);\n  }\n  if (maxJ !== columns) {\n    result[result.length - 1] += ` ... ${columns - maxColumns} more columns`;\n  }\n  if (maxI !== rows) {\n    result.push(`... ${rows - maxRows} more rows`);\n  }\n  return result.join(`\\n${indentData}`);\n}\n\nfunction formatNumber(num, maxNumSize, padMinus) {\n  return (\n    num >= 0 && padMinus\n      ? ` ${formatNumber2(num, maxNumSize - 1)}`\n      : formatNumber2(num, maxNumSize)\n  ).padEnd(maxNumSize);\n}\n\nfunction formatNumber2(num, len) {\n  // small.length numbers should be as is\n  let str = num.toString();\n  if (str.length <= len) return str;\n\n  // (7)'0.00123' is better then (7)'1.23e-2'\n  // (8)'0.000123' is worse then (7)'1.23e-3',\n  let fix = num.toFixed(len);\n  if (fix.length > len) {\n    fix = num.toFixed(Math.max(0, len - (fix.length - len)));\n  }\n  if (\n    fix.length <= len &&\n    !fix.startsWith('0.000') &&\n    !fix.startsWith('-0.000')\n  ) {\n    return fix;\n  }\n\n  // well, if it's still too long the user should've used longer numbers\n  let exp = num.toExponential(len);\n  if (exp.length > len) {\n    exp = num.toExponential(Math.max(0, len - (exp.length - len)));\n  }\n  return exp.slice(0);\n}\n\nfunction installMathOperations(AbstractMatrix, Matrix) {\n  AbstractMatrix.prototype.add = function add(value) {\n    if (typeof value === 'number') return this.addS(value);\n    return this.addM(value);\n  };\n\n  AbstractMatrix.prototype.addS = function addS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.addM = function addM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.add = function add(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.add(value);\n  };\n\n  AbstractMatrix.prototype.sub = function sub(value) {\n    if (typeof value === 'number') return this.subS(value);\n    return this.subM(value);\n  };\n\n  AbstractMatrix.prototype.subS = function subS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.subM = function subM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sub = function sub(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sub(value);\n  };\n  AbstractMatrix.prototype.subtract = AbstractMatrix.prototype.sub;\n  AbstractMatrix.prototype.subtractS = AbstractMatrix.prototype.subS;\n  AbstractMatrix.prototype.subtractM = AbstractMatrix.prototype.subM;\n  AbstractMatrix.subtract = AbstractMatrix.sub;\n\n  AbstractMatrix.prototype.mul = function mul(value) {\n    if (typeof value === 'number') return this.mulS(value);\n    return this.mulM(value);\n  };\n\n  AbstractMatrix.prototype.mulS = function mulS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.mulM = function mulM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.mul = function mul(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.mul(value);\n  };\n  AbstractMatrix.prototype.multiply = AbstractMatrix.prototype.mul;\n  AbstractMatrix.prototype.multiplyS = AbstractMatrix.prototype.mulS;\n  AbstractMatrix.prototype.multiplyM = AbstractMatrix.prototype.mulM;\n  AbstractMatrix.multiply = AbstractMatrix.mul;\n\n  AbstractMatrix.prototype.div = function div(value) {\n    if (typeof value === 'number') return this.divS(value);\n    return this.divM(value);\n  };\n\n  AbstractMatrix.prototype.divS = function divS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.divM = function divM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.div = function div(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.div(value);\n  };\n  AbstractMatrix.prototype.divide = AbstractMatrix.prototype.div;\n  AbstractMatrix.prototype.divideS = AbstractMatrix.prototype.divS;\n  AbstractMatrix.prototype.divideM = AbstractMatrix.prototype.divM;\n  AbstractMatrix.divide = AbstractMatrix.div;\n\n  AbstractMatrix.prototype.mod = function mod(value) {\n    if (typeof value === 'number') return this.modS(value);\n    return this.modM(value);\n  };\n\n  AbstractMatrix.prototype.modS = function modS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) % value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.modM = function modM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) % matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.mod = function mod(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.mod(value);\n  };\n  AbstractMatrix.prototype.modulus = AbstractMatrix.prototype.mod;\n  AbstractMatrix.prototype.modulusS = AbstractMatrix.prototype.modS;\n  AbstractMatrix.prototype.modulusM = AbstractMatrix.prototype.modM;\n  AbstractMatrix.modulus = AbstractMatrix.mod;\n\n  AbstractMatrix.prototype.and = function and(value) {\n    if (typeof value === 'number') return this.andS(value);\n    return this.andM(value);\n  };\n\n  AbstractMatrix.prototype.andS = function andS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) & value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.andM = function andM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) & matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.and = function and(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.and(value);\n  };\n\n  AbstractMatrix.prototype.or = function or(value) {\n    if (typeof value === 'number') return this.orS(value);\n    return this.orM(value);\n  };\n\n  AbstractMatrix.prototype.orS = function orS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) | value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.orM = function orM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) | matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.or = function or(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.or(value);\n  };\n\n  AbstractMatrix.prototype.xor = function xor(value) {\n    if (typeof value === 'number') return this.xorS(value);\n    return this.xorM(value);\n  };\n\n  AbstractMatrix.prototype.xorS = function xorS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ^ value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.xorM = function xorM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ^ matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.xor = function xor(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.xor(value);\n  };\n\n  AbstractMatrix.prototype.leftShift = function leftShift(value) {\n    if (typeof value === 'number') return this.leftShiftS(value);\n    return this.leftShiftM(value);\n  };\n\n  AbstractMatrix.prototype.leftShiftS = function leftShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) << value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.leftShiftM = function leftShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) << matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.leftShift = function leftShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.leftShift(value);\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShift = function signPropagatingRightShift(value) {\n    if (typeof value === 'number') return this.signPropagatingRightShiftS(value);\n    return this.signPropagatingRightShiftM(value);\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShiftS = function signPropagatingRightShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >> value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShiftM = function signPropagatingRightShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >> matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.signPropagatingRightShift = function signPropagatingRightShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.signPropagatingRightShift(value);\n  };\n\n  AbstractMatrix.prototype.rightShift = function rightShift(value) {\n    if (typeof value === 'number') return this.rightShiftS(value);\n    return this.rightShiftM(value);\n  };\n\n  AbstractMatrix.prototype.rightShiftS = function rightShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >>> value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.rightShiftM = function rightShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >>> matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.rightShift = function rightShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.rightShift(value);\n  };\n  AbstractMatrix.prototype.zeroFillRightShift = AbstractMatrix.prototype.rightShift;\n  AbstractMatrix.prototype.zeroFillRightShiftS = AbstractMatrix.prototype.rightShiftS;\n  AbstractMatrix.prototype.zeroFillRightShiftM = AbstractMatrix.prototype.rightShiftM;\n  AbstractMatrix.zeroFillRightShift = AbstractMatrix.rightShift;\n\n  AbstractMatrix.prototype.not = function not() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, ~(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.not = function not(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.not();\n  };\n\n  AbstractMatrix.prototype.abs = function abs() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.abs(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.abs = function abs(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.abs();\n  };\n\n  AbstractMatrix.prototype.acos = function acos() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.acos(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.acos = function acos(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.acos();\n  };\n\n  AbstractMatrix.prototype.acosh = function acosh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.acosh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.acosh = function acosh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.acosh();\n  };\n\n  AbstractMatrix.prototype.asin = function asin() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.asin(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.asin = function asin(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.asin();\n  };\n\n  AbstractMatrix.prototype.asinh = function asinh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.asinh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.asinh = function asinh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.asinh();\n  };\n\n  AbstractMatrix.prototype.atan = function atan() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.atan(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.atan = function atan(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.atan();\n  };\n\n  AbstractMatrix.prototype.atanh = function atanh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.atanh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.atanh = function atanh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.atanh();\n  };\n\n  AbstractMatrix.prototype.cbrt = function cbrt() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cbrt(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cbrt = function cbrt(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cbrt();\n  };\n\n  AbstractMatrix.prototype.ceil = function ceil() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.ceil(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.ceil = function ceil(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.ceil();\n  };\n\n  AbstractMatrix.prototype.clz32 = function clz32() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.clz32(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.clz32 = function clz32(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.clz32();\n  };\n\n  AbstractMatrix.prototype.cos = function cos() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cos(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cos = function cos(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cos();\n  };\n\n  AbstractMatrix.prototype.cosh = function cosh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cosh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cosh = function cosh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cosh();\n  };\n\n  AbstractMatrix.prototype.exp = function exp() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.exp(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.exp = function exp(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.exp();\n  };\n\n  AbstractMatrix.prototype.expm1 = function expm1() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.expm1(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.expm1 = function expm1(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.expm1();\n  };\n\n  AbstractMatrix.prototype.floor = function floor() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.floor(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.floor = function floor(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.floor();\n  };\n\n  AbstractMatrix.prototype.fround = function fround() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.fround(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.fround = function fround(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.fround();\n  };\n\n  AbstractMatrix.prototype.log = function log() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log = function log(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log();\n  };\n\n  AbstractMatrix.prototype.log1p = function log1p() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log1p(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log1p = function log1p(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log1p();\n  };\n\n  AbstractMatrix.prototype.log10 = function log10() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log10(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log10 = function log10(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log10();\n  };\n\n  AbstractMatrix.prototype.log2 = function log2() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log2(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log2 = function log2(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log2();\n  };\n\n  AbstractMatrix.prototype.round = function round() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.round(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.round = function round(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.round();\n  };\n\n  AbstractMatrix.prototype.sign = function sign() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sign(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sign = function sign(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sign();\n  };\n\n  AbstractMatrix.prototype.sin = function sin() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sin(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sin = function sin(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sin();\n  };\n\n  AbstractMatrix.prototype.sinh = function sinh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sinh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sinh = function sinh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sinh();\n  };\n\n  AbstractMatrix.prototype.sqrt = function sqrt() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sqrt(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sqrt = function sqrt(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sqrt();\n  };\n\n  AbstractMatrix.prototype.tan = function tan() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.tan(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.tan = function tan(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.tan();\n  };\n\n  AbstractMatrix.prototype.tanh = function tanh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.tanh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.tanh = function tanh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.tanh();\n  };\n\n  AbstractMatrix.prototype.trunc = function trunc() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.trunc(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.trunc = function trunc(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.trunc();\n  };\n\n  AbstractMatrix.pow = function pow(matrix, arg0) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.pow(arg0);\n  };\n\n  AbstractMatrix.prototype.pow = function pow(value) {\n    if (typeof value === 'number') return this.powS(value);\n    return this.powM(value);\n  };\n\n  AbstractMatrix.prototype.powS = function powS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ** value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.powM = function powM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ** matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n}\n\n/**\n * @private\n * Check that a row index is not out of bounds\n * @param {Matrix} matrix\n * @param {number} index\n * @param {boolean} [outer]\n */\nfunction checkRowIndex(matrix, index, outer) {\n  let max = outer ? matrix.rows : matrix.rows - 1;\n  if (index < 0 || index > max) {\n    throw new RangeError('Row index out of range');\n  }\n}\n\n/**\n * @private\n * Check that a column index is not out of bounds\n * @param {Matrix} matrix\n * @param {number} index\n * @param {boolean} [outer]\n */\nfunction checkColumnIndex(matrix, index, outer) {\n  let max = outer ? matrix.columns : matrix.columns - 1;\n  if (index < 0 || index > max) {\n    throw new RangeError('Column index out of range');\n  }\n}\n\n/**\n * @private\n * Check that the provided vector is an array with the right length\n * @param {Matrix} matrix\n * @param {Array|Matrix} vector\n * @return {Array}\n * @throws {RangeError}\n */\nfunction checkRowVector(matrix, vector) {\n  if (vector.to1DArray) {\n    vector = vector.to1DArray();\n  }\n  if (vector.length !== matrix.columns) {\n    throw new RangeError(\n      'vector size must be the same as the number of columns',\n    );\n  }\n  return vector;\n}\n\n/**\n * @private\n * Check that the provided vector is an array with the right length\n * @param {Matrix} matrix\n * @param {Array|Matrix} vector\n * @return {Array}\n * @throws {RangeError}\n */\nfunction checkColumnVector(matrix, vector) {\n  if (vector.to1DArray) {\n    vector = vector.to1DArray();\n  }\n  if (vector.length !== matrix.rows) {\n    throw new RangeError('vector size must be the same as the number of rows');\n  }\n  return vector;\n}\n\nfunction checkRowIndices(matrix, rowIndices) {\n  if (!isAnyArray.isAnyArray(rowIndices)) {\n    throw new TypeError('row indices must be an array');\n  }\n\n  for (let i = 0; i < rowIndices.length; i++) {\n    if (rowIndices[i] < 0 || rowIndices[i] >= matrix.rows) {\n      throw new RangeError('row indices are out of range');\n    }\n  }\n}\n\nfunction checkColumnIndices(matrix, columnIndices) {\n  if (!isAnyArray.isAnyArray(columnIndices)) {\n    throw new TypeError('column indices must be an array');\n  }\n\n  for (let i = 0; i < columnIndices.length; i++) {\n    if (columnIndices[i] < 0 || columnIndices[i] >= matrix.columns) {\n      throw new RangeError('column indices are out of range');\n    }\n  }\n}\n\nfunction checkRange(matrix, startRow, endRow, startColumn, endColumn) {\n  if (arguments.length !== 5) {\n    throw new RangeError('expected 4 arguments');\n  }\n  checkNumber('startRow', startRow);\n  checkNumber('endRow', endRow);\n  checkNumber('startColumn', startColumn);\n  checkNumber('endColumn', endColumn);\n  if (\n    startRow > endRow ||\n    startColumn > endColumn ||\n    startRow < 0 ||\n    startRow >= matrix.rows ||\n    endRow < 0 ||\n    endRow >= matrix.rows ||\n    startColumn < 0 ||\n    startColumn >= matrix.columns ||\n    endColumn < 0 ||\n    endColumn >= matrix.columns\n  ) {\n    throw new RangeError('Submatrix indices are out of range');\n  }\n}\n\nfunction newArray(length, value = 0) {\n  let array = [];\n  for (let i = 0; i < length; i++) {\n    array.push(value);\n  }\n  return array;\n}\n\nfunction checkNumber(name, value) {\n  if (typeof value !== 'number') {\n    throw new TypeError(`${name} must be a number`);\n  }\n}\n\nfunction checkNonEmpty(matrix) {\n  if (matrix.isEmpty()) {\n    throw new Error('Empty matrix has no elements to index');\n  }\n}\n\nfunction sumByRow(matrix) {\n  let sum = newArray(matrix.rows);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[i] += matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nfunction sumByColumn(matrix) {\n  let sum = newArray(matrix.columns);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[j] += matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nfunction sumAll(matrix) {\n  let v = 0;\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      v += matrix.get(i, j);\n    }\n  }\n  return v;\n}\n\nfunction productByRow(matrix) {\n  let sum = newArray(matrix.rows, 1);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[i] *= matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nfunction productByColumn(matrix) {\n  let sum = newArray(matrix.columns, 1);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[j] *= matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nfunction productAll(matrix) {\n  let v = 1;\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      v *= matrix.get(i, j);\n    }\n  }\n  return v;\n}\n\nfunction varianceByRow(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const variance = [];\n\n  for (let i = 0; i < rows; i++) {\n    let sum1 = 0;\n    let sum2 = 0;\n    let x = 0;\n    for (let j = 0; j < cols; j++) {\n      x = matrix.get(i, j) - mean[i];\n      sum1 += x;\n      sum2 += x * x;\n    }\n    if (unbiased) {\n      variance.push((sum2 - (sum1 * sum1) / cols) / (cols - 1));\n    } else {\n      variance.push((sum2 - (sum1 * sum1) / cols) / cols);\n    }\n  }\n  return variance;\n}\n\nfunction varianceByColumn(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const variance = [];\n\n  for (let j = 0; j < cols; j++) {\n    let sum1 = 0;\n    let sum2 = 0;\n    let x = 0;\n    for (let i = 0; i < rows; i++) {\n      x = matrix.get(i, j) - mean[j];\n      sum1 += x;\n      sum2 += x * x;\n    }\n    if (unbiased) {\n      variance.push((sum2 - (sum1 * sum1) / rows) / (rows - 1));\n    } else {\n      variance.push((sum2 - (sum1 * sum1) / rows) / rows);\n    }\n  }\n  return variance;\n}\n\nfunction varianceAll(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const size = rows * cols;\n\n  let sum1 = 0;\n  let sum2 = 0;\n  let x = 0;\n  for (let i = 0; i < rows; i++) {\n    for (let j = 0; j < cols; j++) {\n      x = matrix.get(i, j) - mean;\n      sum1 += x;\n      sum2 += x * x;\n    }\n  }\n  if (unbiased) {\n    return (sum2 - (sum1 * sum1) / size) / (size - 1);\n  } else {\n    return (sum2 - (sum1 * sum1) / size) / size;\n  }\n}\n\nfunction centerByRow(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean[i]);\n    }\n  }\n}\n\nfunction centerByColumn(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean[j]);\n    }\n  }\n}\n\nfunction centerAll(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean);\n    }\n  }\n}\n\nfunction getScaleByRow(matrix) {\n  const scale = [];\n  for (let i = 0; i < matrix.rows; i++) {\n    let sum = 0;\n    for (let j = 0; j < matrix.columns; j++) {\n      sum += matrix.get(i, j) ** 2 / (matrix.columns - 1);\n    }\n    scale.push(Math.sqrt(sum));\n  }\n  return scale;\n}\n\nfunction scaleByRow(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale[i]);\n    }\n  }\n}\n\nfunction getScaleByColumn(matrix) {\n  const scale = [];\n  for (let j = 0; j < matrix.columns; j++) {\n    let sum = 0;\n    for (let i = 0; i < matrix.rows; i++) {\n      sum += matrix.get(i, j) ** 2 / (matrix.rows - 1);\n    }\n    scale.push(Math.sqrt(sum));\n  }\n  return scale;\n}\n\nfunction scaleByColumn(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale[j]);\n    }\n  }\n}\n\nfunction getScaleAll(matrix) {\n  const divider = matrix.size - 1;\n  let sum = 0;\n  for (let j = 0; j < matrix.columns; j++) {\n    for (let i = 0; i < matrix.rows; i++) {\n      sum += matrix.get(i, j) ** 2 / divider;\n    }\n  }\n  return Math.sqrt(sum);\n}\n\nfunction scaleAll(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale);\n    }\n  }\n}\n\nclass AbstractMatrix {\n  static from1DArray(newRows, newColumns, newData) {\n    let length = newRows * newColumns;\n    if (length !== newData.length) {\n      throw new RangeError('data length does not match given dimensions');\n    }\n    let newMatrix = new Matrix(newRows, newColumns);\n    for (let row = 0; row < newRows; row++) {\n      for (let column = 0; column < newColumns; column++) {\n        newMatrix.set(row, column, newData[row * newColumns + column]);\n      }\n    }\n    return newMatrix;\n  }\n\n  static rowVector(newData) {\n    let vector = new Matrix(1, newData.length);\n    for (let i = 0; i < newData.length; i++) {\n      vector.set(0, i, newData[i]);\n    }\n    return vector;\n  }\n\n  static columnVector(newData) {\n    let vector = new Matrix(newData.length, 1);\n    for (let i = 0; i < newData.length; i++) {\n      vector.set(i, 0, newData[i]);\n    }\n    return vector;\n  }\n\n  static zeros(rows, columns) {\n    return new Matrix(rows, columns);\n  }\n\n  static ones(rows, columns) {\n    return new Matrix(rows, columns).fill(1);\n  }\n\n  static rand(rows, columns, options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { random = Math.random } = options;\n    let matrix = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        matrix.set(i, j, random());\n      }\n    }\n    return matrix;\n  }\n\n  static randInt(rows, columns, options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1000, random = Math.random } = options;\n    if (!Number.isInteger(min)) throw new TypeError('min must be an integer');\n    if (!Number.isInteger(max)) throw new TypeError('max must be an integer');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let interval = max - min;\n    let matrix = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        let value = min + Math.round(random() * interval);\n        matrix.set(i, j, value);\n      }\n    }\n    return matrix;\n  }\n\n  static eye(rows, columns, value) {\n    if (columns === undefined) columns = rows;\n    if (value === undefined) value = 1;\n    let min = Math.min(rows, columns);\n    let matrix = this.zeros(rows, columns);\n    for (let i = 0; i < min; i++) {\n      matrix.set(i, i, value);\n    }\n    return matrix;\n  }\n\n  static diag(data, rows, columns) {\n    let l = data.length;\n    if (rows === undefined) rows = l;\n    if (columns === undefined) columns = rows;\n    let min = Math.min(l, rows, columns);\n    let matrix = this.zeros(rows, columns);\n    for (let i = 0; i < min; i++) {\n      matrix.set(i, i, data[i]);\n    }\n    return matrix;\n  }\n\n  static min(matrix1, matrix2) {\n    matrix1 = this.checkMatrix(matrix1);\n    matrix2 = this.checkMatrix(matrix2);\n    let rows = matrix1.rows;\n    let columns = matrix1.columns;\n    let result = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        result.set(i, j, Math.min(matrix1.get(i, j), matrix2.get(i, j)));\n      }\n    }\n    return result;\n  }\n\n  static max(matrix1, matrix2) {\n    matrix1 = this.checkMatrix(matrix1);\n    matrix2 = this.checkMatrix(matrix2);\n    let rows = matrix1.rows;\n    let columns = matrix1.columns;\n    let result = new this(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        result.set(i, j, Math.max(matrix1.get(i, j), matrix2.get(i, j)));\n      }\n    }\n    return result;\n  }\n\n  static checkMatrix(value) {\n    return AbstractMatrix.isMatrix(value) ? value : new Matrix(value);\n  }\n\n  static isMatrix(value) {\n    return value != null && value.klass === 'Matrix';\n  }\n\n  get size() {\n    return this.rows * this.columns;\n  }\n\n  apply(callback) {\n    if (typeof callback !== 'function') {\n      throw new TypeError('callback must be a function');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        callback.call(this, i, j);\n      }\n    }\n    return this;\n  }\n\n  to1DArray() {\n    let array = [];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        array.push(this.get(i, j));\n      }\n    }\n    return array;\n  }\n\n  to2DArray() {\n    let copy = [];\n    for (let i = 0; i < this.rows; i++) {\n      copy.push([]);\n      for (let j = 0; j < this.columns; j++) {\n        copy[i].push(this.get(i, j));\n      }\n    }\n    return copy;\n  }\n\n  toJSON() {\n    return this.to2DArray();\n  }\n\n  isRowVector() {\n    return this.rows === 1;\n  }\n\n  isColumnVector() {\n    return this.columns === 1;\n  }\n\n  isVector() {\n    return this.rows === 1 || this.columns === 1;\n  }\n\n  isSquare() {\n    return this.rows === this.columns;\n  }\n\n  isEmpty() {\n    return this.rows === 0 || this.columns === 0;\n  }\n\n  isSymmetric() {\n    if (this.isSquare()) {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j <= i; j++) {\n          if (this.get(i, j) !== this.get(j, i)) {\n            return false;\n          }\n        }\n      }\n      return true;\n    }\n    return false;\n  }\n\n  isDistance() {\n    if (!this.isSymmetric()) return false;\n\n    for (let i = 0; i < this.rows; i++) {\n      if (this.get(i, i) !== 0) return false;\n    }\n\n    return true;\n  }\n\n  isEchelonForm() {\n    let i = 0;\n    let j = 0;\n    let previousColumn = -1;\n    let isEchelonForm = true;\n    let checked = false;\n    while (i < this.rows && isEchelonForm) {\n      j = 0;\n      checked = false;\n      while (j < this.columns && checked === false) {\n        if (this.get(i, j) === 0) {\n          j++;\n        } else if (this.get(i, j) === 1 && j > previousColumn) {\n          checked = true;\n          previousColumn = j;\n        } else {\n          isEchelonForm = false;\n          checked = true;\n        }\n      }\n      i++;\n    }\n    return isEchelonForm;\n  }\n\n  isReducedEchelonForm() {\n    let i = 0;\n    let j = 0;\n    let previousColumn = -1;\n    let isReducedEchelonForm = true;\n    let checked = false;\n    while (i < this.rows && isReducedEchelonForm) {\n      j = 0;\n      checked = false;\n      while (j < this.columns && checked === false) {\n        if (this.get(i, j) === 0) {\n          j++;\n        } else if (this.get(i, j) === 1 && j > previousColumn) {\n          checked = true;\n          previousColumn = j;\n        } else {\n          isReducedEchelonForm = false;\n          checked = true;\n        }\n      }\n      for (let k = j + 1; k < this.rows; k++) {\n        if (this.get(i, k) !== 0) {\n          isReducedEchelonForm = false;\n        }\n      }\n      i++;\n    }\n    return isReducedEchelonForm;\n  }\n\n  echelonForm() {\n    let result = this.clone();\n    let h = 0;\n    let k = 0;\n    while (h < result.rows && k < result.columns) {\n      let iMax = h;\n      for (let i = h; i < result.rows; i++) {\n        if (result.get(i, k) > result.get(iMax, k)) {\n          iMax = i;\n        }\n      }\n      if (result.get(iMax, k) === 0) {\n        k++;\n      } else {\n        result.swapRows(h, iMax);\n        let tmp = result.get(h, k);\n        for (let j = k; j < result.columns; j++) {\n          result.set(h, j, result.get(h, j) / tmp);\n        }\n        for (let i = h + 1; i < result.rows; i++) {\n          let factor = result.get(i, k) / result.get(h, k);\n          result.set(i, k, 0);\n          for (let j = k + 1; j < result.columns; j++) {\n            result.set(i, j, result.get(i, j) - result.get(h, j) * factor);\n          }\n        }\n        h++;\n        k++;\n      }\n    }\n    return result;\n  }\n\n  reducedEchelonForm() {\n    let result = this.echelonForm();\n    let m = result.columns;\n    let n = result.rows;\n    let h = n - 1;\n    while (h >= 0) {\n      if (result.maxRow(h) === 0) {\n        h--;\n      } else {\n        let p = 0;\n        let pivot = false;\n        while (p < n && pivot === false) {\n          if (result.get(h, p) === 1) {\n            pivot = true;\n          } else {\n            p++;\n          }\n        }\n        for (let i = 0; i < h; i++) {\n          let factor = result.get(i, p);\n          for (let j = p; j < m; j++) {\n            let tmp = result.get(i, j) - factor * result.get(h, j);\n            result.set(i, j, tmp);\n          }\n        }\n        h--;\n      }\n    }\n    return result;\n  }\n\n  set() {\n    throw new Error('set method is unimplemented');\n  }\n\n  get() {\n    throw new Error('get method is unimplemented');\n  }\n\n  repeat(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { rows = 1, columns = 1 } = options;\n    if (!Number.isInteger(rows) || rows <= 0) {\n      throw new TypeError('rows must be a positive integer');\n    }\n    if (!Number.isInteger(columns) || columns <= 0) {\n      throw new TypeError('columns must be a positive integer');\n    }\n    let matrix = new Matrix(this.rows * rows, this.columns * columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        matrix.setSubMatrix(this, this.rows * i, this.columns * j);\n      }\n    }\n    return matrix;\n  }\n\n  fill(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, value);\n      }\n    }\n    return this;\n  }\n\n  neg() {\n    return this.mulS(-1);\n  }\n\n  getRow(index) {\n    checkRowIndex(this, index);\n    let row = [];\n    for (let i = 0; i < this.columns; i++) {\n      row.push(this.get(index, i));\n    }\n    return row;\n  }\n\n  getRowVector(index) {\n    return Matrix.rowVector(this.getRow(index));\n  }\n\n  setRow(index, array) {\n    checkRowIndex(this, index);\n    array = checkRowVector(this, array);\n    for (let i = 0; i < this.columns; i++) {\n      this.set(index, i, array[i]);\n    }\n    return this;\n  }\n\n  swapRows(row1, row2) {\n    checkRowIndex(this, row1);\n    checkRowIndex(this, row2);\n    for (let i = 0; i < this.columns; i++) {\n      let temp = this.get(row1, i);\n      this.set(row1, i, this.get(row2, i));\n      this.set(row2, i, temp);\n    }\n    return this;\n  }\n\n  getColumn(index) {\n    checkColumnIndex(this, index);\n    let column = [];\n    for (let i = 0; i < this.rows; i++) {\n      column.push(this.get(i, index));\n    }\n    return column;\n  }\n\n  getColumnVector(index) {\n    return Matrix.columnVector(this.getColumn(index));\n  }\n\n  setColumn(index, array) {\n    checkColumnIndex(this, index);\n    array = checkColumnVector(this, array);\n    for (let i = 0; i < this.rows; i++) {\n      this.set(i, index, array[i]);\n    }\n    return this;\n  }\n\n  swapColumns(column1, column2) {\n    checkColumnIndex(this, column1);\n    checkColumnIndex(this, column2);\n    for (let i = 0; i < this.rows; i++) {\n      let temp = this.get(i, column1);\n      this.set(i, column1, this.get(i, column2));\n      this.set(i, column2, temp);\n    }\n    return this;\n  }\n\n  addRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + vector[j]);\n      }\n    }\n    return this;\n  }\n\n  subRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - vector[j]);\n      }\n    }\n    return this;\n  }\n\n  mulRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * vector[j]);\n      }\n    }\n    return this;\n  }\n\n  divRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / vector[j]);\n      }\n    }\n    return this;\n  }\n\n  addColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + vector[i]);\n      }\n    }\n    return this;\n  }\n\n  subColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - vector[i]);\n      }\n    }\n    return this;\n  }\n\n  mulColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * vector[i]);\n      }\n    }\n    return this;\n  }\n\n  divColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / vector[i]);\n      }\n    }\n    return this;\n  }\n\n  mulRow(index, value) {\n    checkRowIndex(this, index);\n    for (let i = 0; i < this.columns; i++) {\n      this.set(index, i, this.get(index, i) * value);\n    }\n    return this;\n  }\n\n  mulColumn(index, value) {\n    checkColumnIndex(this, index);\n    for (let i = 0; i < this.rows; i++) {\n      this.set(i, index, this.get(i, index) * value);\n    }\n    return this;\n  }\n\n  max(by) {\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    switch (by) {\n      case 'row': {\n        const max = new Array(this.rows).fill(Number.NEGATIVE_INFINITY);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) > max[row]) {\n              max[row] = this.get(row, column);\n            }\n          }\n        }\n        return max;\n      }\n      case 'column': {\n        const max = new Array(this.columns).fill(Number.NEGATIVE_INFINITY);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) > max[column]) {\n              max[column] = this.get(row, column);\n            }\n          }\n        }\n        return max;\n      }\n      case undefined: {\n        let max = this.get(0, 0);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) > max) {\n              max = this.get(row, column);\n            }\n          }\n        }\n        return max;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  maxIndex() {\n    checkNonEmpty(this);\n    let v = this.get(0, 0);\n    let idx = [0, 0];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) > v) {\n          v = this.get(i, j);\n          idx[0] = i;\n          idx[1] = j;\n        }\n      }\n    }\n    return idx;\n  }\n\n  min(by) {\n    if (this.isEmpty()) {\n      return NaN;\n    }\n\n    switch (by) {\n      case 'row': {\n        const min = new Array(this.rows).fill(Number.POSITIVE_INFINITY);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) < min[row]) {\n              min[row] = this.get(row, column);\n            }\n          }\n        }\n        return min;\n      }\n      case 'column': {\n        const min = new Array(this.columns).fill(Number.POSITIVE_INFINITY);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) < min[column]) {\n              min[column] = this.get(row, column);\n            }\n          }\n        }\n        return min;\n      }\n      case undefined: {\n        let min = this.get(0, 0);\n        for (let row = 0; row < this.rows; row++) {\n          for (let column = 0; column < this.columns; column++) {\n            if (this.get(row, column) < min) {\n              min = this.get(row, column);\n            }\n          }\n        }\n        return min;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  minIndex() {\n    checkNonEmpty(this);\n    let v = this.get(0, 0);\n    let idx = [0, 0];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) < v) {\n          v = this.get(i, j);\n          idx[0] = i;\n          idx[1] = j;\n        }\n      }\n    }\n    return idx;\n  }\n\n  maxRow(row) {\n    checkRowIndex(this, row);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(row, 0);\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) > v) {\n        v = this.get(row, i);\n      }\n    }\n    return v;\n  }\n\n  maxRowIndex(row) {\n    checkRowIndex(this, row);\n    checkNonEmpty(this);\n    let v = this.get(row, 0);\n    let idx = [row, 0];\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) > v) {\n        v = this.get(row, i);\n        idx[1] = i;\n      }\n    }\n    return idx;\n  }\n\n  minRow(row) {\n    checkRowIndex(this, row);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(row, 0);\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) < v) {\n        v = this.get(row, i);\n      }\n    }\n    return v;\n  }\n\n  minRowIndex(row) {\n    checkRowIndex(this, row);\n    checkNonEmpty(this);\n    let v = this.get(row, 0);\n    let idx = [row, 0];\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) < v) {\n        v = this.get(row, i);\n        idx[1] = i;\n      }\n    }\n    return idx;\n  }\n\n  maxColumn(column) {\n    checkColumnIndex(this, column);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, column);\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) > v) {\n        v = this.get(i, column);\n      }\n    }\n    return v;\n  }\n\n  maxColumnIndex(column) {\n    checkColumnIndex(this, column);\n    checkNonEmpty(this);\n    let v = this.get(0, column);\n    let idx = [0, column];\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) > v) {\n        v = this.get(i, column);\n        idx[0] = i;\n      }\n    }\n    return idx;\n  }\n\n  minColumn(column) {\n    checkColumnIndex(this, column);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, column);\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) < v) {\n        v = this.get(i, column);\n      }\n    }\n    return v;\n  }\n\n  minColumnIndex(column) {\n    checkColumnIndex(this, column);\n    checkNonEmpty(this);\n    let v = this.get(0, column);\n    let idx = [0, column];\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) < v) {\n        v = this.get(i, column);\n        idx[0] = i;\n      }\n    }\n    return idx;\n  }\n\n  diag() {\n    let min = Math.min(this.rows, this.columns);\n    let diag = [];\n    for (let i = 0; i < min; i++) {\n      diag.push(this.get(i, i));\n    }\n    return diag;\n  }\n\n  norm(type = 'frobenius') {\n    switch (type) {\n      case 'max':\n        return this.max();\n      case 'frobenius':\n        return Math.sqrt(this.dot(this));\n      default:\n        throw new RangeError(`unknown norm type: ${type}`);\n    }\n  }\n\n  cumulativeSum() {\n    let sum = 0;\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        sum += this.get(i, j);\n        this.set(i, j, sum);\n      }\n    }\n    return this;\n  }\n\n  dot(vector2) {\n    if (AbstractMatrix.isMatrix(vector2)) vector2 = vector2.to1DArray();\n    let vector1 = this.to1DArray();\n    if (vector1.length !== vector2.length) {\n      throw new RangeError('vectors do not have the same size');\n    }\n    let dot = 0;\n    for (let i = 0; i < vector1.length; i++) {\n      dot += vector1[i] * vector2[i];\n    }\n    return dot;\n  }\n\n  mmul(other) {\n    other = Matrix.checkMatrix(other);\n\n    let m = this.rows;\n    let n = this.columns;\n    let p = other.columns;\n\n    let result = new Matrix(m, p);\n\n    let Bcolj = new Float64Array(n);\n    for (let j = 0; j < p; j++) {\n      for (let k = 0; k < n; k++) {\n        Bcolj[k] = other.get(k, j);\n      }\n\n      for (let i = 0; i < m; i++) {\n        let s = 0;\n        for (let k = 0; k < n; k++) {\n          s += this.get(i, k) * Bcolj[k];\n        }\n\n        result.set(i, j, s);\n      }\n    }\n    return result;\n  }\n\n  mpow(scalar) {\n    if (!this.isSquare()) {\n      throw new RangeError('Matrix must be square');\n    }\n    if (!Number.isInteger(scalar) || scalar < 0) {\n      throw new RangeError('Exponent must be a non-negative integer');\n    }\n    // Russian Peasant exponentiation, i.e. exponentiation by squaring\n    let result = Matrix.eye(this.rows);\n    let bb = this;\n    // Note: Don't bit shift. In JS, that would truncate at 32 bits\n    for (let e = scalar; e >= 1; e /= 2) {\n      if ((e & 1) !== 0) {\n        result = result.mmul(bb);\n      }\n      bb = bb.mmul(bb);\n    }\n    return result;\n  }\n\n  strassen2x2(other) {\n    other = Matrix.checkMatrix(other);\n    let result = new Matrix(2, 2);\n    const a11 = this.get(0, 0);\n    const b11 = other.get(0, 0);\n    const a12 = this.get(0, 1);\n    const b12 = other.get(0, 1);\n    const a21 = this.get(1, 0);\n    const b21 = other.get(1, 0);\n    const a22 = this.get(1, 1);\n    const b22 = other.get(1, 1);\n\n    // Compute intermediate values.\n    const m1 = (a11 + a22) * (b11 + b22);\n    const m2 = (a21 + a22) * b11;\n    const m3 = a11 * (b12 - b22);\n    const m4 = a22 * (b21 - b11);\n    const m5 = (a11 + a12) * b22;\n    const m6 = (a21 - a11) * (b11 + b12);\n    const m7 = (a12 - a22) * (b21 + b22);\n\n    // Combine intermediate values into the output.\n    const c00 = m1 + m4 - m5 + m7;\n    const c01 = m3 + m5;\n    const c10 = m2 + m4;\n    const c11 = m1 - m2 + m3 + m6;\n\n    result.set(0, 0, c00);\n    result.set(0, 1, c01);\n    result.set(1, 0, c10);\n    result.set(1, 1, c11);\n    return result;\n  }\n\n  strassen3x3(other) {\n    other = Matrix.checkMatrix(other);\n    let result = new Matrix(3, 3);\n\n    const a00 = this.get(0, 0);\n    const a01 = this.get(0, 1);\n    const a02 = this.get(0, 2);\n    const a10 = this.get(1, 0);\n    const a11 = this.get(1, 1);\n    const a12 = this.get(1, 2);\n    const a20 = this.get(2, 0);\n    const a21 = this.get(2, 1);\n    const a22 = this.get(2, 2);\n\n    const b00 = other.get(0, 0);\n    const b01 = other.get(0, 1);\n    const b02 = other.get(0, 2);\n    const b10 = other.get(1, 0);\n    const b11 = other.get(1, 1);\n    const b12 = other.get(1, 2);\n    const b20 = other.get(2, 0);\n    const b21 = other.get(2, 1);\n    const b22 = other.get(2, 2);\n\n    const m1 = (a00 + a01 + a02 - a10 - a11 - a21 - a22) * b11;\n    const m2 = (a00 - a10) * (-b01 + b11);\n    const m3 = a11 * (-b00 + b01 + b10 - b11 - b12 - b20 + b22);\n    const m4 = (-a00 + a10 + a11) * (b00 - b01 + b11);\n    const m5 = (a10 + a11) * (-b00 + b01);\n    const m6 = a00 * b00;\n    const m7 = (-a00 + a20 + a21) * (b00 - b02 + b12);\n    const m8 = (-a00 + a20) * (b02 - b12);\n    const m9 = (a20 + a21) * (-b00 + b02);\n    const m10 = (a00 + a01 + a02 - a11 - a12 - a20 - a21) * b12;\n    const m11 = a21 * (-b00 + b02 + b10 - b11 - b12 - b20 + b21);\n    const m12 = (-a02 + a21 + a22) * (b11 + b20 - b21);\n    const m13 = (a02 - a22) * (b11 - b21);\n    const m14 = a02 * b20;\n    const m15 = (a21 + a22) * (-b20 + b21);\n    const m16 = (-a02 + a11 + a12) * (b12 + b20 - b22);\n    const m17 = (a02 - a12) * (b12 - b22);\n    const m18 = (a11 + a12) * (-b20 + b22);\n    const m19 = a01 * b10;\n    const m20 = a12 * b21;\n    const m21 = a10 * b02;\n    const m22 = a20 * b01;\n    const m23 = a22 * b22;\n\n    const c00 = m6 + m14 + m19;\n    const c01 = m1 + m4 + m5 + m6 + m12 + m14 + m15;\n    const c02 = m6 + m7 + m9 + m10 + m14 + m16 + m18;\n    const c10 = m2 + m3 + m4 + m6 + m14 + m16 + m17;\n    const c11 = m2 + m4 + m5 + m6 + m20;\n    const c12 = m14 + m16 + m17 + m18 + m21;\n    const c20 = m6 + m7 + m8 + m11 + m12 + m13 + m14;\n    const c21 = m12 + m13 + m14 + m15 + m22;\n    const c22 = m6 + m7 + m8 + m9 + m23;\n\n    result.set(0, 0, c00);\n    result.set(0, 1, c01);\n    result.set(0, 2, c02);\n    result.set(1, 0, c10);\n    result.set(1, 1, c11);\n    result.set(1, 2, c12);\n    result.set(2, 0, c20);\n    result.set(2, 1, c21);\n    result.set(2, 2, c22);\n    return result;\n  }\n\n  mmulStrassen(y) {\n    y = Matrix.checkMatrix(y);\n    let x = this.clone();\n    let r1 = x.rows;\n    let c1 = x.columns;\n    let r2 = y.rows;\n    let c2 = y.columns;\n    if (c1 !== r2) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Multiplying ${r1} x ${c1} and ${r2} x ${c2} matrix: dimensions do not match.`,\n      );\n    }\n\n    // Put a matrix into the top left of a matrix of zeros.\n    // `rows` and `cols` are the dimensions of the output matrix.\n    function embed(mat, rows, cols) {\n      let r = mat.rows;\n      let c = mat.columns;\n      if (r === rows && c === cols) {\n        return mat;\n      } else {\n        let resultat = AbstractMatrix.zeros(rows, cols);\n        resultat = resultat.setSubMatrix(mat, 0, 0);\n        return resultat;\n      }\n    }\n\n    // Make sure both matrices are the same size.\n    // This is exclusively for simplicity:\n    // this algorithm can be implemented with matrices of different sizes.\n\n    let r = Math.max(r1, r2);\n    let c = Math.max(c1, c2);\n    x = embed(x, r, c);\n    y = embed(y, r, c);\n\n    // Our recursive multiplication function.\n    function blockMult(a, b, rows, cols) {\n      // For small matrices, resort to naive multiplication.\n      if (rows <= 512 || cols <= 512) {\n        return a.mmul(b); // a is equivalent to this\n      }\n\n      // Apply dynamic padding.\n      if (rows % 2 === 1 && cols % 2 === 1) {\n        a = embed(a, rows + 1, cols + 1);\n        b = embed(b, rows + 1, cols + 1);\n      } else if (rows % 2 === 1) {\n        a = embed(a, rows + 1, cols);\n        b = embed(b, rows + 1, cols);\n      } else if (cols % 2 === 1) {\n        a = embed(a, rows, cols + 1);\n        b = embed(b, rows, cols + 1);\n      }\n\n      let halfRows = parseInt(a.rows / 2, 10);\n      let halfCols = parseInt(a.columns / 2, 10);\n      // Subdivide input matrices.\n      let a11 = a.subMatrix(0, halfRows - 1, 0, halfCols - 1);\n      let b11 = b.subMatrix(0, halfRows - 1, 0, halfCols - 1);\n\n      let a12 = a.subMatrix(0, halfRows - 1, halfCols, a.columns - 1);\n      let b12 = b.subMatrix(0, halfRows - 1, halfCols, b.columns - 1);\n\n      let a21 = a.subMatrix(halfRows, a.rows - 1, 0, halfCols - 1);\n      let b21 = b.subMatrix(halfRows, b.rows - 1, 0, halfCols - 1);\n\n      let a22 = a.subMatrix(halfRows, a.rows - 1, halfCols, a.columns - 1);\n      let b22 = b.subMatrix(halfRows, b.rows - 1, halfCols, b.columns - 1);\n\n      // Compute intermediate values.\n      let m1 = blockMult(\n        AbstractMatrix.add(a11, a22),\n        AbstractMatrix.add(b11, b22),\n        halfRows,\n        halfCols,\n      );\n      let m2 = blockMult(AbstractMatrix.add(a21, a22), b11, halfRows, halfCols);\n      let m3 = blockMult(a11, AbstractMatrix.sub(b12, b22), halfRows, halfCols);\n      let m4 = blockMult(a22, AbstractMatrix.sub(b21, b11), halfRows, halfCols);\n      let m5 = blockMult(AbstractMatrix.add(a11, a12), b22, halfRows, halfCols);\n      let m6 = blockMult(\n        AbstractMatrix.sub(a21, a11),\n        AbstractMatrix.add(b11, b12),\n        halfRows,\n        halfCols,\n      );\n      let m7 = blockMult(\n        AbstractMatrix.sub(a12, a22),\n        AbstractMatrix.add(b21, b22),\n        halfRows,\n        halfCols,\n      );\n\n      // Combine intermediate values into the output.\n      let c11 = AbstractMatrix.add(m1, m4);\n      c11.sub(m5);\n      c11.add(m7);\n      let c12 = AbstractMatrix.add(m3, m5);\n      let c21 = AbstractMatrix.add(m2, m4);\n      let c22 = AbstractMatrix.sub(m1, m2);\n      c22.add(m3);\n      c22.add(m6);\n\n      // Crop output to the desired size (undo dynamic padding).\n      let result = AbstractMatrix.zeros(2 * c11.rows, 2 * c11.columns);\n      result = result.setSubMatrix(c11, 0, 0);\n      result = result.setSubMatrix(c12, c11.rows, 0);\n      result = result.setSubMatrix(c21, 0, c11.columns);\n      result = result.setSubMatrix(c22, c11.rows, c11.columns);\n      return result.subMatrix(0, rows - 1, 0, cols - 1);\n    }\n\n    return blockMult(x, y, r, c);\n  }\n\n  scaleRows(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1 } = options;\n    if (!Number.isFinite(min)) throw new TypeError('min must be a number');\n    if (!Number.isFinite(max)) throw new TypeError('max must be a number');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let newMatrix = new Matrix(this.rows, this.columns);\n    for (let i = 0; i < this.rows; i++) {\n      const row = this.getRow(i);\n      if (row.length > 0) {\n        rescale(row, { min, max, output: row });\n      }\n      newMatrix.setRow(i, row);\n    }\n    return newMatrix;\n  }\n\n  scaleColumns(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1 } = options;\n    if (!Number.isFinite(min)) throw new TypeError('min must be a number');\n    if (!Number.isFinite(max)) throw new TypeError('max must be a number');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let newMatrix = new Matrix(this.rows, this.columns);\n    for (let i = 0; i < this.columns; i++) {\n      const column = this.getColumn(i);\n      if (column.length) {\n        rescale(column, {\n          min,\n          max,\n          output: column,\n        });\n      }\n      newMatrix.setColumn(i, column);\n    }\n    return newMatrix;\n  }\n\n  flipRows() {\n    const middle = Math.ceil(this.columns / 2);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < middle; j++) {\n        let first = this.get(i, j);\n        let last = this.get(i, this.columns - 1 - j);\n        this.set(i, j, last);\n        this.set(i, this.columns - 1 - j, first);\n      }\n    }\n    return this;\n  }\n\n  flipColumns() {\n    const middle = Math.ceil(this.rows / 2);\n    for (let j = 0; j < this.columns; j++) {\n      for (let i = 0; i < middle; i++) {\n        let first = this.get(i, j);\n        let last = this.get(this.rows - 1 - i, j);\n        this.set(i, j, last);\n        this.set(this.rows - 1 - i, j, first);\n      }\n    }\n    return this;\n  }\n\n  kroneckerProduct(other) {\n    other = Matrix.checkMatrix(other);\n\n    let m = this.rows;\n    let n = this.columns;\n    let p = other.rows;\n    let q = other.columns;\n\n    let result = new Matrix(m * p, n * q);\n    for (let i = 0; i < m; i++) {\n      for (let j = 0; j < n; j++) {\n        for (let k = 0; k < p; k++) {\n          for (let l = 0; l < q; l++) {\n            result.set(p * i + k, q * j + l, this.get(i, j) * other.get(k, l));\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  kroneckerSum(other) {\n    other = Matrix.checkMatrix(other);\n    if (!this.isSquare() || !other.isSquare()) {\n      throw new Error('Kronecker Sum needs two Square Matrices');\n    }\n    let m = this.rows;\n    let n = other.rows;\n    let AxI = this.kroneckerProduct(Matrix.eye(n, n));\n    let IxB = Matrix.eye(m, m).kroneckerProduct(other);\n    return AxI.add(IxB);\n  }\n\n  transpose() {\n    let result = new Matrix(this.columns, this.rows);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        result.set(j, i, this.get(i, j));\n      }\n    }\n    return result;\n  }\n\n  sortRows(compareFunction = compareNumbers) {\n    for (let i = 0; i < this.rows; i++) {\n      this.setRow(i, this.getRow(i).sort(compareFunction));\n    }\n    return this;\n  }\n\n  sortColumns(compareFunction = compareNumbers) {\n    for (let i = 0; i < this.columns; i++) {\n      this.setColumn(i, this.getColumn(i).sort(compareFunction));\n    }\n    return this;\n  }\n\n  subMatrix(startRow, endRow, startColumn, endColumn) {\n    checkRange(this, startRow, endRow, startColumn, endColumn);\n    let newMatrix = new Matrix(\n      endRow - startRow + 1,\n      endColumn - startColumn + 1,\n    );\n    for (let i = startRow; i <= endRow; i++) {\n      for (let j = startColumn; j <= endColumn; j++) {\n        newMatrix.set(i - startRow, j - startColumn, this.get(i, j));\n      }\n    }\n    return newMatrix;\n  }\n\n  subMatrixRow(indices, startColumn, endColumn) {\n    if (startColumn === undefined) startColumn = 0;\n    if (endColumn === undefined) endColumn = this.columns - 1;\n    if (\n      startColumn > endColumn ||\n      startColumn < 0 ||\n      startColumn >= this.columns ||\n      endColumn < 0 ||\n      endColumn >= this.columns\n    ) {\n      throw new RangeError('Argument out of range');\n    }\n\n    let newMatrix = new Matrix(indices.length, endColumn - startColumn + 1);\n    for (let i = 0; i < indices.length; i++) {\n      for (let j = startColumn; j <= endColumn; j++) {\n        if (indices[i] < 0 || indices[i] >= this.rows) {\n          throw new RangeError(`Row index out of range: ${indices[i]}`);\n        }\n        newMatrix.set(i, j - startColumn, this.get(indices[i], j));\n      }\n    }\n    return newMatrix;\n  }\n\n  subMatrixColumn(indices, startRow, endRow) {\n    if (startRow === undefined) startRow = 0;\n    if (endRow === undefined) endRow = this.rows - 1;\n    if (\n      startRow > endRow ||\n      startRow < 0 ||\n      startRow >= this.rows ||\n      endRow < 0 ||\n      endRow >= this.rows\n    ) {\n      throw new RangeError('Argument out of range');\n    }\n\n    let newMatrix = new Matrix(endRow - startRow + 1, indices.length);\n    for (let i = 0; i < indices.length; i++) {\n      for (let j = startRow; j <= endRow; j++) {\n        if (indices[i] < 0 || indices[i] >= this.columns) {\n          throw new RangeError(`Column index out of range: ${indices[i]}`);\n        }\n        newMatrix.set(j - startRow, i, this.get(j, indices[i]));\n      }\n    }\n    return newMatrix;\n  }\n\n  setSubMatrix(matrix, startRow, startColumn) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (matrix.isEmpty()) {\n      return this;\n    }\n    let endRow = startRow + matrix.rows - 1;\n    let endColumn = startColumn + matrix.columns - 1;\n    checkRange(this, startRow, endRow, startColumn, endColumn);\n    for (let i = 0; i < matrix.rows; i++) {\n      for (let j = 0; j < matrix.columns; j++) {\n        this.set(startRow + i, startColumn + j, matrix.get(i, j));\n      }\n    }\n    return this;\n  }\n\n  selection(rowIndices, columnIndices) {\n    checkRowIndices(this, rowIndices);\n    checkColumnIndices(this, columnIndices);\n    let newMatrix = new Matrix(rowIndices.length, columnIndices.length);\n    for (let i = 0; i < rowIndices.length; i++) {\n      let rowIndex = rowIndices[i];\n      for (let j = 0; j < columnIndices.length; j++) {\n        let columnIndex = columnIndices[j];\n        newMatrix.set(i, j, this.get(rowIndex, columnIndex));\n      }\n    }\n    return newMatrix;\n  }\n\n  trace() {\n    let min = Math.min(this.rows, this.columns);\n    let trace = 0;\n    for (let i = 0; i < min; i++) {\n      trace += this.get(i, i);\n    }\n    return trace;\n  }\n\n  clone() {\n    return this.constructor.copy(this, new Matrix(this.rows, this.columns));\n  }\n\n  /**\n   * @template {AbstractMatrix} M\n   * @param {AbstractMatrix} from\n   * @param {M} to\n   * @return {M}\n   */\n  static copy(from, to) {\n    for (const [row, column, value] of from.entries()) {\n      to.set(row, column, value);\n    }\n\n    return to;\n  }\n\n  sum(by) {\n    switch (by) {\n      case 'row':\n        return sumByRow(this);\n      case 'column':\n        return sumByColumn(this);\n      case undefined:\n        return sumAll(this);\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  product(by) {\n    switch (by) {\n      case 'row':\n        return productByRow(this);\n      case 'column':\n        return productByColumn(this);\n      case undefined:\n        return productAll(this);\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  mean(by) {\n    const sum = this.sum(by);\n    switch (by) {\n      case 'row': {\n        for (let i = 0; i < this.rows; i++) {\n          sum[i] /= this.columns;\n        }\n        return sum;\n      }\n      case 'column': {\n        for (let i = 0; i < this.columns; i++) {\n          sum[i] /= this.rows;\n        }\n        return sum;\n      }\n      case undefined:\n        return sum / this.size;\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  variance(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { unbiased = true, mean = this.mean(by) } = options;\n    if (typeof unbiased !== 'boolean') {\n      throw new TypeError('unbiased must be a boolean');\n    }\n    switch (by) {\n      case 'row': {\n        if (!isAnyArray.isAnyArray(mean)) {\n          throw new TypeError('mean must be an array');\n        }\n        return varianceByRow(this, unbiased, mean);\n      }\n      case 'column': {\n        if (!isAnyArray.isAnyArray(mean)) {\n          throw new TypeError('mean must be an array');\n        }\n        return varianceByColumn(this, unbiased, mean);\n      }\n      case undefined: {\n        if (typeof mean !== 'number') {\n          throw new TypeError('mean must be a number');\n        }\n        return varianceAll(this, unbiased, mean);\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  standardDeviation(by, options) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    const variance = this.variance(by, options);\n    if (by === undefined) {\n      return Math.sqrt(variance);\n    } else {\n      for (let i = 0; i < variance.length; i++) {\n        variance[i] = Math.sqrt(variance[i]);\n      }\n      return variance;\n    }\n  }\n\n  center(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { center = this.mean(by) } = options;\n    switch (by) {\n      case 'row': {\n        if (!isAnyArray.isAnyArray(center)) {\n          throw new TypeError('center must be an array');\n        }\n        centerByRow(this, center);\n        return this;\n      }\n      case 'column': {\n        if (!isAnyArray.isAnyArray(center)) {\n          throw new TypeError('center must be an array');\n        }\n        centerByColumn(this, center);\n        return this;\n      }\n      case undefined: {\n        if (typeof center !== 'number') {\n          throw new TypeError('center must be a number');\n        }\n        centerAll(this, center);\n        return this;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  scale(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    let scale = options.scale;\n    switch (by) {\n      case 'row': {\n        if (scale === undefined) {\n          scale = getScaleByRow(this);\n        } else if (!isAnyArray.isAnyArray(scale)) {\n          throw new TypeError('scale must be an array');\n        }\n        scaleByRow(this, scale);\n        return this;\n      }\n      case 'column': {\n        if (scale === undefined) {\n          scale = getScaleByColumn(this);\n        } else if (!isAnyArray.isAnyArray(scale)) {\n          throw new TypeError('scale must be an array');\n        }\n        scaleByColumn(this, scale);\n        return this;\n      }\n      case undefined: {\n        if (scale === undefined) {\n          scale = getScaleAll(this);\n        } else if (typeof scale !== 'number') {\n          throw new TypeError('scale must be a number');\n        }\n        scaleAll(this, scale);\n        return this;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  toString(options) {\n    return inspectMatrixWithOptions(this, options);\n  }\n\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n\n  /**\n   * iterator from left to right, from top to bottom\n   * yield [row, column, value]\n   * @returns {Generator<[number, number, number], void, void>}\n   */\n  *entries() {\n    for (let row = 0; row < this.rows; row++) {\n      for (let col = 0; col < this.columns; col++) {\n        yield [row, col, this.get(row, col)];\n      }\n    }\n  }\n\n  /**\n   * iterator from left to right, from top to bottom\n   * yield value\n   * @returns {Generator<number, void, void>}\n   */\n  *values() {\n    for (let row = 0; row < this.rows; row++) {\n      for (let col = 0; col < this.columns; col++) {\n        yield this.get(row, col);\n      }\n    }\n  }\n}\n\nAbstractMatrix.prototype.klass = 'Matrix';\nif (typeof Symbol !== 'undefined') {\n  AbstractMatrix.prototype[Symbol.for('nodejs.util.inspect.custom')] =\n    inspectMatrix;\n}\n\nfunction compareNumbers(a, b) {\n  return a - b;\n}\n\nfunction isArrayOfNumbers(array) {\n  return array.every((element) => {\n    return typeof element === 'number';\n  });\n}\n\n// Synonyms\nAbstractMatrix.random = AbstractMatrix.rand;\nAbstractMatrix.randomInt = AbstractMatrix.randInt;\nAbstractMatrix.diagonal = AbstractMatrix.diag;\nAbstractMatrix.prototype.diagonal = AbstractMatrix.prototype.diag;\nAbstractMatrix.identity = AbstractMatrix.eye;\nAbstractMatrix.prototype.negate = AbstractMatrix.prototype.neg;\nAbstractMatrix.prototype.tensorProduct =\n  AbstractMatrix.prototype.kroneckerProduct;\n\nclass Matrix extends AbstractMatrix {\n  /**\n   * @type {Float64Array[]}\n   */\n  data;\n\n  /**\n   * Init an empty matrix\n   * @param {number} nRows\n   * @param {number} nColumns\n   */\n  #initData(nRows, nColumns) {\n    this.data = [];\n\n    if (Number.isInteger(nColumns) && nColumns >= 0) {\n      for (let i = 0; i < nRows; i++) {\n        this.data.push(new Float64Array(nColumns));\n      }\n    } else {\n      throw new TypeError('nColumns must be a positive integer');\n    }\n\n    this.rows = nRows;\n    this.columns = nColumns;\n  }\n\n  constructor(nRows, nColumns) {\n    super();\n    if (Matrix.isMatrix(nRows)) {\n      this.#initData(nRows.rows, nRows.columns);\n      Matrix.copy(nRows, this);\n    } else if (Number.isInteger(nRows) && nRows >= 0) {\n      this.#initData(nRows, nColumns);\n    } else if (isAnyArray.isAnyArray(nRows)) {\n      // Copy the values from the 2D array\n      const arrayData = nRows;\n      nRows = arrayData.length;\n      nColumns = nRows ? arrayData[0].length : 0;\n      if (typeof nColumns !== 'number') {\n        throw new TypeError(\n          'Data must be a 2D array with at least one element',\n        );\n      }\n      this.data = [];\n\n      for (let i = 0; i < nRows; i++) {\n        if (arrayData[i].length !== nColumns) {\n          throw new RangeError('Inconsistent array dimensions');\n        }\n        if (!isArrayOfNumbers(arrayData[i])) {\n          throw new TypeError('Input data contains non-numeric values');\n        }\n        this.data.push(Float64Array.from(arrayData[i]));\n      }\n\n      this.rows = nRows;\n      this.columns = nColumns;\n    } else {\n      throw new TypeError(\n        'First argument must be a positive number or an array',\n      );\n    }\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.data[rowIndex][columnIndex] = value;\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.data[rowIndex][columnIndex];\n  }\n\n  removeRow(index) {\n    checkRowIndex(this, index);\n    this.data.splice(index, 1);\n    this.rows -= 1;\n    return this;\n  }\n\n  addRow(index, array) {\n    if (array === undefined) {\n      array = index;\n      index = this.rows;\n    }\n    checkRowIndex(this, index, true);\n    array = Float64Array.from(checkRowVector(this, array));\n    this.data.splice(index, 0, array);\n    this.rows += 1;\n    return this;\n  }\n\n  removeColumn(index) {\n    checkColumnIndex(this, index);\n    for (let i = 0; i < this.rows; i++) {\n      const newRow = new Float64Array(this.columns - 1);\n      for (let j = 0; j < index; j++) {\n        newRow[j] = this.data[i][j];\n      }\n      for (let j = index + 1; j < this.columns; j++) {\n        newRow[j - 1] = this.data[i][j];\n      }\n      this.data[i] = newRow;\n    }\n    this.columns -= 1;\n    return this;\n  }\n\n  addColumn(index, array) {\n    if (typeof array === 'undefined') {\n      array = index;\n      index = this.columns;\n    }\n    checkColumnIndex(this, index, true);\n    array = checkColumnVector(this, array);\n    for (let i = 0; i < this.rows; i++) {\n      const newRow = new Float64Array(this.columns + 1);\n      let j = 0;\n      for (; j < index; j++) {\n        newRow[j] = this.data[i][j];\n      }\n      newRow[j++] = array[i];\n      for (; j < this.columns + 1; j++) {\n        newRow[j] = this.data[i][j - 1];\n      }\n      this.data[i] = newRow;\n    }\n    this.columns += 1;\n    return this;\n  }\n}\n\ninstallMathOperations(AbstractMatrix, Matrix);\n\n/**\n * @typedef {0 | 1 | number | boolean} Mask\n */\n\nclass SymmetricMatrix extends AbstractMatrix {\n  /** @type {Matrix} */\n  #matrix;\n\n  get size() {\n    return this.#matrix.size;\n  }\n\n  get rows() {\n    return this.#matrix.rows;\n  }\n\n  get columns() {\n    return this.#matrix.columns;\n  }\n\n  get diagonalSize() {\n    return this.rows;\n  }\n\n  /**\n   * not the same as matrix.isSymmetric()\n   * Here is to check if it's instanceof SymmetricMatrix without bundling issues\n   *\n   * @param value\n   * @returns {boolean}\n   */\n  static isSymmetricMatrix(value) {\n    return Matrix.isMatrix(value) && value.klassType === 'SymmetricMatrix';\n  }\n\n  /**\n   * @param diagonalSize\n   * @return {SymmetricMatrix}\n   */\n  static zeros(diagonalSize) {\n    return new this(diagonalSize);\n  }\n\n  /**\n   * @param diagonalSize\n   * @return {SymmetricMatrix}\n   */\n  static ones(diagonalSize) {\n    return new this(diagonalSize).fill(1);\n  }\n\n  /**\n   * @param {number | AbstractMatrix | ArrayLike<ArrayLike<number>>} diagonalSize\n   * @return {this}\n   */\n  constructor(diagonalSize) {\n    super();\n\n    if (Matrix.isMatrix(diagonalSize)) {\n      if (!diagonalSize.isSymmetric()) {\n        throw new TypeError('not symmetric data');\n      }\n\n      this.#matrix = Matrix.copy(\n        diagonalSize,\n        new Matrix(diagonalSize.rows, diagonalSize.rows),\n      );\n    } else if (Number.isInteger(diagonalSize) && diagonalSize >= 0) {\n      this.#matrix = new Matrix(diagonalSize, diagonalSize);\n    } else {\n      this.#matrix = new Matrix(diagonalSize);\n\n      if (!this.isSymmetric()) {\n        throw new TypeError('not symmetric data');\n      }\n    }\n  }\n\n  clone() {\n    const matrix = new SymmetricMatrix(this.diagonalSize);\n\n    for (const [row, col, value] of this.upperRightEntries()) {\n      matrix.set(row, col, value);\n    }\n\n    return matrix;\n  }\n\n  toMatrix() {\n    return new Matrix(this);\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.#matrix.get(rowIndex, columnIndex);\n  }\n  set(rowIndex, columnIndex, value) {\n    // symmetric set\n    this.#matrix.set(rowIndex, columnIndex, value);\n    this.#matrix.set(columnIndex, rowIndex, value);\n\n    return this;\n  }\n\n  removeCross(index) {\n    // symmetric remove side\n    this.#matrix.removeRow(index);\n    this.#matrix.removeColumn(index);\n\n    return this;\n  }\n\n  addCross(index, array) {\n    if (array === undefined) {\n      array = index;\n      index = this.diagonalSize;\n    }\n\n    const row = array.slice();\n    row.splice(index, 1);\n\n    this.#matrix.addRow(index, row);\n    this.#matrix.addColumn(index, array);\n\n    return this;\n  }\n\n  /**\n   * @param {Mask[]} mask\n   */\n  applyMask(mask) {\n    if (mask.length !== this.diagonalSize) {\n      throw new RangeError('Mask size do not match with matrix size');\n    }\n\n    // prepare sides to remove from matrix from mask\n    /** @type {number[]} */\n    const sidesToRemove = [];\n    for (const [index, passthroughs] of mask.entries()) {\n      if (passthroughs) continue;\n      sidesToRemove.push(index);\n    }\n    // to remove from highest to lowest for no mutation shifting\n    sidesToRemove.reverse();\n\n    // remove sides\n    for (const sideIndex of sidesToRemove) {\n      this.removeCross(sideIndex);\n    }\n\n    return this;\n  }\n\n  /**\n   * Compact format upper-right corner of matrix\n   * iterate from left to right, from top to bottom.\n   *\n   * ```\n   *   A B C D\n   * A 1 2 3 4\n   * B 2 5 6 7\n   * C 3 6 8 9\n   * D 4 7 9 10\n   * ```\n   *\n   * will return compact 1D array `[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]`\n   *\n   * length is S(i=0, n=sideSize) => 10 for a 4 sideSized matrix\n   *\n   * @returns {number[]}\n   */\n  toCompact() {\n    const { diagonalSize } = this;\n\n    /** @type {number[]} */\n    const compact = new Array((diagonalSize * (diagonalSize + 1)) / 2);\n    for (let col = 0, row = 0, index = 0; index < compact.length; index++) {\n      compact[index] = this.get(row, col);\n\n      if (++col >= diagonalSize) col = ++row;\n    }\n\n    return compact;\n  }\n\n  /**\n   * @param {number[]} compact\n   * @return {SymmetricMatrix}\n   */\n  static fromCompact(compact) {\n    const compactSize = compact.length;\n    // compactSize = (sideSize * (sideSize + 1)) / 2\n    // https://mathsolver.microsoft.com/fr/solve-problem/y%20%3D%20%20x%20%60cdot%20%20%20%60frac%7B%20%20%60left(%20x%2B1%20%20%60right)%20%20%20%20%7D%7B%202%20%20%7D\n    // sideSize = (Sqrt(8 \u00D7 compactSize + 1) - 1) / 2\n    const diagonalSize = (Math.sqrt(8 * compactSize + 1) - 1) / 2;\n\n    if (!Number.isInteger(diagonalSize)) {\n      throw new TypeError(\n        `This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(\n          compact,\n        )}`,\n      );\n    }\n\n    const matrix = new SymmetricMatrix(diagonalSize);\n    for (let col = 0, row = 0, index = 0; index < compactSize; index++) {\n      matrix.set(col, row, compact[index]);\n      if (++col >= diagonalSize) col = ++row;\n    }\n\n    return matrix;\n  }\n\n  /**\n   * half iterator upper-right-corner from left to right, from top to bottom\n   * yield [row, column, value]\n   *\n   * @returns {Generator<[number, number, number], void, void>}\n   */\n  *upperRightEntries() {\n    for (let row = 0, col = 0; row < this.diagonalSize; void 0) {\n      const value = this.get(row, col);\n\n      yield [row, col, value];\n\n      // at the end of row, move cursor to next row at diagonal position\n      if (++col >= this.diagonalSize) col = ++row;\n    }\n  }\n\n  /**\n   * half iterator upper-right-corner from left to right, from top to bottom\n   * yield value\n   *\n   * @returns {Generator<[number, number, number], void, void>}\n   */\n  *upperRightValues() {\n    for (let row = 0, col = 0; row < this.diagonalSize; void 0) {\n      const value = this.get(row, col);\n\n      yield value;\n\n      // at the end of row, move cursor to next row at diagonal position\n      if (++col >= this.diagonalSize) col = ++row;\n    }\n  }\n}\nSymmetricMatrix.prototype.klassType = 'SymmetricMatrix';\n\nclass DistanceMatrix extends SymmetricMatrix {\n  /**\n   * not the same as matrix.isSymmetric()\n   * Here is to check if it's instanceof SymmetricMatrix without bundling issues\n   *\n   * @param value\n   * @returns {boolean}\n   */\n  static isDistanceMatrix(value) {\n    return (\n      SymmetricMatrix.isSymmetricMatrix(value) &&\n      value.klassSubType === 'DistanceMatrix'\n    );\n  }\n\n  constructor(sideSize) {\n    super(sideSize);\n\n    if (!this.isDistance()) {\n      throw new TypeError('Provided arguments do no produce a distance matrix');\n    }\n  }\n\n  set(rowIndex, columnIndex, value) {\n    // distance matrix diagonal is 0\n    if (rowIndex === columnIndex) value = 0;\n\n    return super.set(rowIndex, columnIndex, value);\n  }\n\n  addCross(index, array) {\n    if (array === undefined) {\n      array = index;\n      index = this.diagonalSize;\n    }\n\n    // ensure distance\n    array = array.slice();\n    array[index] = 0;\n\n    return super.addCross(index, array);\n  }\n\n  toSymmetricMatrix() {\n    return new SymmetricMatrix(this);\n  }\n\n  clone() {\n    const matrix = new DistanceMatrix(this.diagonalSize);\n\n    for (const [row, col, value] of this.upperRightEntries()) {\n      if (row === col) continue;\n      matrix.set(row, col, value);\n    }\n\n    return matrix;\n  }\n\n  /**\n   * Compact format upper-right corner of matrix\n   * no diagonal (only zeros)\n   * iterable from left to right, from top to bottom.\n   *\n   * ```\n   *   A B C D\n   * A 0 1 2 3\n   * B 1 0 4 5\n   * C 2 4 0 6\n   * D 3 5 6 0\n   * ```\n   *\n   * will return compact 1D array `[1, 2, 3, 4, 5, 6]`\n   *\n   * length is S(i=0, n=sideSize-1) => 6 for a 4 side sized matrix\n   *\n   * @returns {number[]}\n   */\n  toCompact() {\n    const { diagonalSize } = this;\n    const compactLength = ((diagonalSize - 1) * diagonalSize) / 2;\n\n    /** @type {number[]} */\n    const compact = new Array(compactLength);\n    for (let col = 1, row = 0, index = 0; index < compact.length; index++) {\n      compact[index] = this.get(row, col);\n\n      if (++col >= diagonalSize) col = ++row + 1;\n    }\n\n    return compact;\n  }\n\n  /**\n   * @param {number[]} compact\n   */\n  static fromCompact(compact) {\n    const compactSize = compact.length;\n\n    if (compactSize === 0) {\n      return new this(0);\n    }\n\n    // compactSize in Natural integer range ]0;\u221E]\n    // compactSize = (sideSize * (sideSize - 1)) / 2\n    // sideSize = (Sqrt(8 \u00D7 compactSize + 1) + 1) / 2\n    const diagonalSize = (Math.sqrt(8 * compactSize + 1) + 1) / 2;\n\n    if (!Number.isInteger(diagonalSize)) {\n      throw new TypeError(\n        `This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(\n          compact,\n        )}`,\n      );\n    }\n\n    const matrix = new this(diagonalSize);\n    for (let col = 1, row = 0, index = 0; index < compactSize; index++) {\n      matrix.set(col, row, compact[index]);\n      if (++col >= diagonalSize) col = ++row + 1;\n    }\n\n    return matrix;\n  }\n}\nDistanceMatrix.prototype.klassSubType = 'DistanceMatrix';\n\nclass BaseView extends AbstractMatrix {\n  constructor(matrix, rows, columns) {\n    super();\n    this.matrix = matrix;\n    this.rows = rows;\n    this.columns = columns;\n  }\n}\n\nclass MatrixColumnView extends BaseView {\n  constructor(matrix, column) {\n    checkColumnIndex(matrix, column);\n    super(matrix, matrix.rows, 1);\n    this.column = column;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(rowIndex, this.column, value);\n    return this;\n  }\n\n  get(rowIndex) {\n    return this.matrix.get(rowIndex, this.column);\n  }\n}\n\nclass MatrixColumnSelectionView extends BaseView {\n  constructor(matrix, columnIndices) {\n    checkColumnIndices(matrix, columnIndices);\n    super(matrix, matrix.rows, columnIndices.length);\n    this.columnIndices = columnIndices;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(rowIndex, this.columnIndices[columnIndex], value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(rowIndex, this.columnIndices[columnIndex]);\n  }\n}\n\nclass MatrixFlipColumnView extends BaseView {\n  constructor(matrix) {\n    super(matrix, matrix.rows, matrix.columns);\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(rowIndex, this.columns - columnIndex - 1, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(rowIndex, this.columns - columnIndex - 1);\n  }\n}\n\nclass MatrixFlipRowView extends BaseView {\n  constructor(matrix) {\n    super(matrix, matrix.rows, matrix.columns);\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(this.rows - rowIndex - 1, columnIndex, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(this.rows - rowIndex - 1, columnIndex);\n  }\n}\n\nclass MatrixRowView extends BaseView {\n  constructor(matrix, row) {\n    checkRowIndex(matrix, row);\n    super(matrix, 1, matrix.columns);\n    this.row = row;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(this.row, columnIndex, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(this.row, columnIndex);\n  }\n}\n\nclass MatrixRowSelectionView extends BaseView {\n  constructor(matrix, rowIndices) {\n    checkRowIndices(matrix, rowIndices);\n    super(matrix, rowIndices.length, matrix.columns);\n    this.rowIndices = rowIndices;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(this.rowIndices[rowIndex], columnIndex, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(this.rowIndices[rowIndex], columnIndex);\n  }\n}\n\nclass MatrixSelectionView extends BaseView {\n  constructor(matrix, rowIndices, columnIndices) {\n    checkRowIndices(matrix, rowIndices);\n    checkColumnIndices(matrix, columnIndices);\n    super(matrix, rowIndices.length, columnIndices.length);\n    this.rowIndices = rowIndices;\n    this.columnIndices = columnIndices;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(\n      this.rowIndices[rowIndex],\n      this.columnIndices[columnIndex],\n      value,\n    );\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(\n      this.rowIndices[rowIndex],\n      this.columnIndices[columnIndex],\n    );\n  }\n}\n\nclass MatrixSubView extends BaseView {\n  constructor(matrix, startRow, endRow, startColumn, endColumn) {\n    checkRange(matrix, startRow, endRow, startColumn, endColumn);\n    super(matrix, endRow - startRow + 1, endColumn - startColumn + 1);\n    this.startRow = startRow;\n    this.startColumn = startColumn;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(\n      this.startRow + rowIndex,\n      this.startColumn + columnIndex,\n      value,\n    );\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(\n      this.startRow + rowIndex,\n      this.startColumn + columnIndex,\n    );\n  }\n}\n\nclass MatrixTransposeView extends BaseView {\n  constructor(matrix) {\n    super(matrix, matrix.columns, matrix.rows);\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(columnIndex, rowIndex, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(columnIndex, rowIndex);\n  }\n}\n\nclass WrapperMatrix1D extends AbstractMatrix {\n  constructor(data, options = {}) {\n    const { rows = 1 } = options;\n\n    if (data.length % rows !== 0) {\n      throw new Error('the data length is not divisible by the number of rows');\n    }\n    super();\n    this.rows = rows;\n    this.columns = data.length / rows;\n    this.data = data;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    let index = this._calculateIndex(rowIndex, columnIndex);\n    this.data[index] = value;\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    let index = this._calculateIndex(rowIndex, columnIndex);\n    return this.data[index];\n  }\n\n  _calculateIndex(row, column) {\n    return row * this.columns + column;\n  }\n}\n\nclass WrapperMatrix2D extends AbstractMatrix {\n  constructor(data) {\n    super();\n    this.data = data;\n    this.rows = data.length;\n    this.columns = data[0].length;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.data[rowIndex][columnIndex] = value;\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.data[rowIndex][columnIndex];\n  }\n}\n\nfunction wrap(array, options) {\n  if (isAnyArray.isAnyArray(array)) {\n    if (array[0] && isAnyArray.isAnyArray(array[0])) {\n      return new WrapperMatrix2D(array);\n    } else {\n      return new WrapperMatrix1D(array, options);\n    }\n  } else {\n    throw new Error('the argument is not an array');\n  }\n}\n\nclass LuDecomposition {\n  constructor(matrix) {\n    matrix = WrapperMatrix2D.checkMatrix(matrix);\n\n    let lu = matrix.clone();\n    let rows = lu.rows;\n    let columns = lu.columns;\n    let pivotVector = new Float64Array(rows);\n    let pivotSign = 1;\n    let i, j, k, p, s, t, v;\n    let LUcolj, kmax;\n\n    for (i = 0; i < rows; i++) {\n      pivotVector[i] = i;\n    }\n\n    LUcolj = new Float64Array(rows);\n\n    for (j = 0; j < columns; j++) {\n      for (i = 0; i < rows; i++) {\n        LUcolj[i] = lu.get(i, j);\n      }\n\n      for (i = 0; i < rows; i++) {\n        kmax = Math.min(i, j);\n        s = 0;\n        for (k = 0; k < kmax; k++) {\n          s += lu.get(i, k) * LUcolj[k];\n        }\n        LUcolj[i] -= s;\n        lu.set(i, j, LUcolj[i]);\n      }\n\n      p = j;\n      for (i = j + 1; i < rows; i++) {\n        if (Math.abs(LUcolj[i]) > Math.abs(LUcolj[p])) {\n          p = i;\n        }\n      }\n\n      if (p !== j) {\n        for (k = 0; k < columns; k++) {\n          t = lu.get(p, k);\n          lu.set(p, k, lu.get(j, k));\n          lu.set(j, k, t);\n        }\n\n        v = pivotVector[p];\n        pivotVector[p] = pivotVector[j];\n        pivotVector[j] = v;\n\n        pivotSign = -pivotSign;\n      }\n\n      if (j < rows && lu.get(j, j) !== 0) {\n        for (i = j + 1; i < rows; i++) {\n          lu.set(i, j, lu.get(i, j) / lu.get(j, j));\n        }\n      }\n    }\n\n    this.LU = lu;\n    this.pivotVector = pivotVector;\n    this.pivotSign = pivotSign;\n  }\n\n  isSingular() {\n    let data = this.LU;\n    let col = data.columns;\n    for (let j = 0; j < col; j++) {\n      if (data.get(j, j) === 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  solve(value) {\n    value = Matrix.checkMatrix(value);\n\n    let lu = this.LU;\n    let rows = lu.rows;\n\n    if (rows !== value.rows) {\n      throw new Error('Invalid matrix dimensions');\n    }\n    if (this.isSingular()) {\n      throw new Error('LU matrix is singular');\n    }\n\n    let count = value.columns;\n    let X = value.subMatrixRow(this.pivotVector, 0, count - 1);\n    let columns = lu.columns;\n    let i, j, k;\n\n    for (k = 0; k < columns; k++) {\n      for (i = k + 1; i < columns; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * lu.get(i, k));\n        }\n      }\n    }\n    for (k = columns - 1; k >= 0; k--) {\n      for (j = 0; j < count; j++) {\n        X.set(k, j, X.get(k, j) / lu.get(k, k));\n      }\n      for (i = 0; i < k; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * lu.get(i, k));\n        }\n      }\n    }\n    return X;\n  }\n\n  get determinant() {\n    let data = this.LU;\n    if (!data.isSquare()) {\n      throw new Error('Matrix must be square');\n    }\n    let determinant = this.pivotSign;\n    let col = data.columns;\n    for (let j = 0; j < col; j++) {\n      determinant *= data.get(j, j);\n    }\n    return determinant;\n  }\n\n  get lowerTriangularMatrix() {\n    let data = this.LU;\n    let rows = data.rows;\n    let columns = data.columns;\n    let X = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        if (i > j) {\n          X.set(i, j, data.get(i, j));\n        } else if (i === j) {\n          X.set(i, j, 1);\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get upperTriangularMatrix() {\n    let data = this.LU;\n    let rows = data.rows;\n    let columns = data.columns;\n    let X = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        if (i <= j) {\n          X.set(i, j, data.get(i, j));\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get pivotPermutationVector() {\n    return Array.from(this.pivotVector);\n  }\n}\n\nfunction hypotenuse(a, b) {\n  let r = 0;\n  if (Math.abs(a) > Math.abs(b)) {\n    r = b / a;\n    return Math.abs(a) * Math.sqrt(1 + r * r);\n  }\n  if (b !== 0) {\n    r = a / b;\n    return Math.abs(b) * Math.sqrt(1 + r * r);\n  }\n  return 0;\n}\n\nclass QrDecomposition {\n  constructor(value) {\n    value = WrapperMatrix2D.checkMatrix(value);\n\n    let qr = value.clone();\n    let m = value.rows;\n    let n = value.columns;\n    let rdiag = new Float64Array(n);\n    let i, j, k, s;\n\n    for (k = 0; k < n; k++) {\n      let nrm = 0;\n      for (i = k; i < m; i++) {\n        nrm = hypotenuse(nrm, qr.get(i, k));\n      }\n      if (nrm !== 0) {\n        if (qr.get(k, k) < 0) {\n          nrm = -nrm;\n        }\n        for (i = k; i < m; i++) {\n          qr.set(i, k, qr.get(i, k) / nrm);\n        }\n        qr.set(k, k, qr.get(k, k) + 1);\n        for (j = k + 1; j < n; j++) {\n          s = 0;\n          for (i = k; i < m; i++) {\n            s += qr.get(i, k) * qr.get(i, j);\n          }\n          s = -s / qr.get(k, k);\n          for (i = k; i < m; i++) {\n            qr.set(i, j, qr.get(i, j) + s * qr.get(i, k));\n          }\n        }\n      }\n      rdiag[k] = -nrm;\n    }\n\n    this.QR = qr;\n    this.Rdiag = rdiag;\n  }\n\n  solve(value) {\n    value = Matrix.checkMatrix(value);\n\n    let qr = this.QR;\n    let m = qr.rows;\n\n    if (value.rows !== m) {\n      throw new Error('Matrix row dimensions must agree');\n    }\n    if (!this.isFullRank()) {\n      throw new Error('Matrix is rank deficient');\n    }\n\n    let count = value.columns;\n    let X = value.clone();\n    let n = qr.columns;\n    let i, j, k, s;\n\n    for (k = 0; k < n; k++) {\n      for (j = 0; j < count; j++) {\n        s = 0;\n        for (i = k; i < m; i++) {\n          s += qr.get(i, k) * X.get(i, j);\n        }\n        s = -s / qr.get(k, k);\n        for (i = k; i < m; i++) {\n          X.set(i, j, X.get(i, j) + s * qr.get(i, k));\n        }\n      }\n    }\n    for (k = n - 1; k >= 0; k--) {\n      for (j = 0; j < count; j++) {\n        X.set(k, j, X.get(k, j) / this.Rdiag[k]);\n      }\n      for (i = 0; i < k; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * qr.get(i, k));\n        }\n      }\n    }\n\n    return X.subMatrix(0, n - 1, 0, count - 1);\n  }\n\n  isFullRank() {\n    let columns = this.QR.columns;\n    for (let i = 0; i < columns; i++) {\n      if (this.Rdiag[i] === 0) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get upperTriangularMatrix() {\n    let qr = this.QR;\n    let n = qr.columns;\n    let X = new Matrix(n, n);\n    let i, j;\n    for (i = 0; i < n; i++) {\n      for (j = 0; j < n; j++) {\n        if (i < j) {\n          X.set(i, j, qr.get(i, j));\n        } else if (i === j) {\n          X.set(i, j, this.Rdiag[i]);\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get orthogonalMatrix() {\n    let qr = this.QR;\n    let rows = qr.rows;\n    let columns = qr.columns;\n    let X = new Matrix(rows, columns);\n    let i, j, k, s;\n\n    for (k = columns - 1; k >= 0; k--) {\n      for (i = 0; i < rows; i++) {\n        X.set(i, k, 0);\n      }\n      X.set(k, k, 1);\n      for (j = k; j < columns; j++) {\n        if (qr.get(k, k) !== 0) {\n          s = 0;\n          for (i = k; i < rows; i++) {\n            s += qr.get(i, k) * X.get(i, j);\n          }\n\n          s = -s / qr.get(k, k);\n\n          for (i = k; i < rows; i++) {\n            X.set(i, j, X.get(i, j) + s * qr.get(i, k));\n          }\n        }\n      }\n    }\n    return X;\n  }\n}\n\nclass SingularValueDecomposition {\n  constructor(value, options = {}) {\n    value = WrapperMatrix2D.checkMatrix(value);\n\n    if (value.isEmpty()) {\n      throw new Error('Matrix must be non-empty');\n    }\n\n    let m = value.rows;\n    let n = value.columns;\n\n    const {\n      computeLeftSingularVectors = true,\n      computeRightSingularVectors = true,\n      autoTranspose = false,\n    } = options;\n\n    let wantu = Boolean(computeLeftSingularVectors);\n    let wantv = Boolean(computeRightSingularVectors);\n\n    let swapped = false;\n    let a;\n    if (m < n) {\n      if (!autoTranspose) {\n        a = value.clone();\n        // eslint-disable-next-line no-console\n        console.warn(\n          'Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose',\n        );\n      } else {\n        a = value.transpose();\n        m = a.rows;\n        n = a.columns;\n        swapped = true;\n        let aux = wantu;\n        wantu = wantv;\n        wantv = aux;\n      }\n    } else {\n      a = value.clone();\n    }\n\n    let nu = Math.min(m, n);\n    let ni = Math.min(m + 1, n);\n    let s = new Float64Array(ni);\n    let U = new Matrix(m, nu);\n    let V = new Matrix(n, n);\n\n    let e = new Float64Array(n);\n    let work = new Float64Array(m);\n\n    let si = new Float64Array(ni);\n    for (let i = 0; i < ni; i++) si[i] = i;\n\n    let nct = Math.min(m - 1, n);\n    let nrt = Math.max(0, Math.min(n - 2, m));\n    let mrc = Math.max(nct, nrt);\n\n    for (let k = 0; k < mrc; k++) {\n      if (k < nct) {\n        s[k] = 0;\n        for (let i = k; i < m; i++) {\n          s[k] = hypotenuse(s[k], a.get(i, k));\n        }\n        if (s[k] !== 0) {\n          if (a.get(k, k) < 0) {\n            s[k] = -s[k];\n          }\n          for (let i = k; i < m; i++) {\n            a.set(i, k, a.get(i, k) / s[k]);\n          }\n          a.set(k, k, a.get(k, k) + 1);\n        }\n        s[k] = -s[k];\n      }\n\n      for (let j = k + 1; j < n; j++) {\n        if (k < nct && s[k] !== 0) {\n          let t = 0;\n          for (let i = k; i < m; i++) {\n            t += a.get(i, k) * a.get(i, j);\n          }\n          t = -t / a.get(k, k);\n          for (let i = k; i < m; i++) {\n            a.set(i, j, a.get(i, j) + t * a.get(i, k));\n          }\n        }\n        e[j] = a.get(k, j);\n      }\n\n      if (wantu && k < nct) {\n        for (let i = k; i < m; i++) {\n          U.set(i, k, a.get(i, k));\n        }\n      }\n\n      if (k < nrt) {\n        e[k] = 0;\n        for (let i = k + 1; i < n; i++) {\n          e[k] = hypotenuse(e[k], e[i]);\n        }\n        if (e[k] !== 0) {\n          if (e[k + 1] < 0) {\n            e[k] = 0 - e[k];\n          }\n          for (let i = k + 1; i < n; i++) {\n            e[i] /= e[k];\n          }\n          e[k + 1] += 1;\n        }\n        e[k] = -e[k];\n        if (k + 1 < m && e[k] !== 0) {\n          for (let i = k + 1; i < m; i++) {\n            work[i] = 0;\n          }\n          for (let i = k + 1; i < m; i++) {\n            for (let j = k + 1; j < n; j++) {\n              work[i] += e[j] * a.get(i, j);\n            }\n          }\n          for (let j = k + 1; j < n; j++) {\n            let t = -e[j] / e[k + 1];\n            for (let i = k + 1; i < m; i++) {\n              a.set(i, j, a.get(i, j) + t * work[i]);\n            }\n          }\n        }\n        if (wantv) {\n          for (let i = k + 1; i < n; i++) {\n            V.set(i, k, e[i]);\n          }\n        }\n      }\n    }\n\n    let p = Math.min(n, m + 1);\n    if (nct < n) {\n      s[nct] = a.get(nct, nct);\n    }\n    if (m < p) {\n      s[p - 1] = 0;\n    }\n    if (nrt + 1 < p) {\n      e[nrt] = a.get(nrt, p - 1);\n    }\n    e[p - 1] = 0;\n\n    if (wantu) {\n      for (let j = nct; j < nu; j++) {\n        for (let i = 0; i < m; i++) {\n          U.set(i, j, 0);\n        }\n        U.set(j, j, 1);\n      }\n      for (let k = nct - 1; k >= 0; k--) {\n        if (s[k] !== 0) {\n          for (let j = k + 1; j < nu; j++) {\n            let t = 0;\n            for (let i = k; i < m; i++) {\n              t += U.get(i, k) * U.get(i, j);\n            }\n            t = -t / U.get(k, k);\n            for (let i = k; i < m; i++) {\n              U.set(i, j, U.get(i, j) + t * U.get(i, k));\n            }\n          }\n          for (let i = k; i < m; i++) {\n            U.set(i, k, -U.get(i, k));\n          }\n          U.set(k, k, 1 + U.get(k, k));\n          for (let i = 0; i < k - 1; i++) {\n            U.set(i, k, 0);\n          }\n        } else {\n          for (let i = 0; i < m; i++) {\n            U.set(i, k, 0);\n          }\n          U.set(k, k, 1);\n        }\n      }\n    }\n\n    if (wantv) {\n      for (let k = n - 1; k >= 0; k--) {\n        if (k < nrt && e[k] !== 0) {\n          for (let j = k + 1; j < n; j++) {\n            let t = 0;\n            for (let i = k + 1; i < n; i++) {\n              t += V.get(i, k) * V.get(i, j);\n            }\n            t = -t / V.get(k + 1, k);\n            for (let i = k + 1; i < n; i++) {\n              V.set(i, j, V.get(i, j) + t * V.get(i, k));\n            }\n          }\n        }\n        for (let i = 0; i < n; i++) {\n          V.set(i, k, 0);\n        }\n        V.set(k, k, 1);\n      }\n    }\n\n    let pp = p - 1;\n    let eps = Number.EPSILON;\n    while (p > 0) {\n      let k, kase;\n      for (k = p - 2; k >= -1; k--) {\n        if (k === -1) {\n          break;\n        }\n        const alpha =\n          Number.MIN_VALUE + eps * Math.abs(s[k] + Math.abs(s[k + 1]));\n        if (Math.abs(e[k]) <= alpha || Number.isNaN(e[k])) {\n          e[k] = 0;\n          break;\n        }\n      }\n      if (k === p - 2) {\n        kase = 4;\n      } else {\n        let ks;\n        for (ks = p - 1; ks >= k; ks--) {\n          if (ks === k) {\n            break;\n          }\n          let t =\n            (ks !== p ? Math.abs(e[ks]) : 0) +\n            (ks !== k + 1 ? Math.abs(e[ks - 1]) : 0);\n          if (Math.abs(s[ks]) <= eps * t) {\n            s[ks] = 0;\n            break;\n          }\n        }\n        if (ks === k) {\n          kase = 3;\n        } else if (ks === p - 1) {\n          kase = 1;\n        } else {\n          kase = 2;\n          k = ks;\n        }\n      }\n\n      k++;\n\n      switch (kase) {\n        case 1: {\n          let f = e[p - 2];\n          e[p - 2] = 0;\n          for (let j = p - 2; j >= k; j--) {\n            let t = hypotenuse(s[j], f);\n            let cs = s[j] / t;\n            let sn = f / t;\n            s[j] = t;\n            if (j !== k) {\n              f = -sn * e[j - 1];\n              e[j - 1] = cs * e[j - 1];\n            }\n            if (wantv) {\n              for (let i = 0; i < n; i++) {\n                t = cs * V.get(i, j) + sn * V.get(i, p - 1);\n                V.set(i, p - 1, -sn * V.get(i, j) + cs * V.get(i, p - 1));\n                V.set(i, j, t);\n              }\n            }\n          }\n          break;\n        }\n        case 2: {\n          let f = e[k - 1];\n          e[k - 1] = 0;\n          for (let j = k; j < p; j++) {\n            let t = hypotenuse(s[j], f);\n            let cs = s[j] / t;\n            let sn = f / t;\n            s[j] = t;\n            f = -sn * e[j];\n            e[j] = cs * e[j];\n            if (wantu) {\n              for (let i = 0; i < m; i++) {\n                t = cs * U.get(i, j) + sn * U.get(i, k - 1);\n                U.set(i, k - 1, -sn * U.get(i, j) + cs * U.get(i, k - 1));\n                U.set(i, j, t);\n              }\n            }\n          }\n          break;\n        }\n        case 3: {\n          const scale = Math.max(\n            Math.abs(s[p - 1]),\n            Math.abs(s[p - 2]),\n            Math.abs(e[p - 2]),\n            Math.abs(s[k]),\n            Math.abs(e[k]),\n          );\n          const sp = s[p - 1] / scale;\n          const spm1 = s[p - 2] / scale;\n          const epm1 = e[p - 2] / scale;\n          const sk = s[k] / scale;\n          const ek = e[k] / scale;\n          const b = ((spm1 + sp) * (spm1 - sp) + epm1 * epm1) / 2;\n          const c = sp * epm1 * (sp * epm1);\n          let shift = 0;\n          if (b !== 0 || c !== 0) {\n            if (b < 0) {\n              shift = 0 - Math.sqrt(b * b + c);\n            } else {\n              shift = Math.sqrt(b * b + c);\n            }\n            shift = c / (b + shift);\n          }\n          let f = (sk + sp) * (sk - sp) + shift;\n          let g = sk * ek;\n          for (let j = k; j < p - 1; j++) {\n            let t = hypotenuse(f, g);\n            if (t === 0) t = Number.MIN_VALUE;\n            let cs = f / t;\n            let sn = g / t;\n            if (j !== k) {\n              e[j - 1] = t;\n            }\n            f = cs * s[j] + sn * e[j];\n            e[j] = cs * e[j] - sn * s[j];\n            g = sn * s[j + 1];\n            s[j + 1] = cs * s[j + 1];\n            if (wantv) {\n              for (let i = 0; i < n; i++) {\n                t = cs * V.get(i, j) + sn * V.get(i, j + 1);\n                V.set(i, j + 1, -sn * V.get(i, j) + cs * V.get(i, j + 1));\n                V.set(i, j, t);\n              }\n            }\n            t = hypotenuse(f, g);\n            if (t === 0) t = Number.MIN_VALUE;\n            cs = f / t;\n            sn = g / t;\n            s[j] = t;\n            f = cs * e[j] + sn * s[j + 1];\n            s[j + 1] = -sn * e[j] + cs * s[j + 1];\n            g = sn * e[j + 1];\n            e[j + 1] = cs * e[j + 1];\n            if (wantu && j < m - 1) {\n              for (let i = 0; i < m; i++) {\n                t = cs * U.get(i, j) + sn * U.get(i, j + 1);\n                U.set(i, j + 1, -sn * U.get(i, j) + cs * U.get(i, j + 1));\n                U.set(i, j, t);\n              }\n            }\n          }\n          e[p - 2] = f;\n          break;\n        }\n        case 4: {\n          if (s[k] <= 0) {\n            s[k] = s[k] < 0 ? -s[k] : 0;\n            if (wantv) {\n              for (let i = 0; i <= pp; i++) {\n                V.set(i, k, -V.get(i, k));\n              }\n            }\n          }\n          while (k < pp) {\n            if (s[k] >= s[k + 1]) {\n              break;\n            }\n            let t = s[k];\n            s[k] = s[k + 1];\n            s[k + 1] = t;\n            if (wantv && k < n - 1) {\n              for (let i = 0; i < n; i++) {\n                t = V.get(i, k + 1);\n                V.set(i, k + 1, V.get(i, k));\n                V.set(i, k, t);\n              }\n            }\n            if (wantu && k < m - 1) {\n              for (let i = 0; i < m; i++) {\n                t = U.get(i, k + 1);\n                U.set(i, k + 1, U.get(i, k));\n                U.set(i, k, t);\n              }\n            }\n            k++;\n          }\n          p--;\n          break;\n        }\n        // no default\n      }\n    }\n\n    if (swapped) {\n      let tmp = V;\n      V = U;\n      U = tmp;\n    }\n\n    this.m = m;\n    this.n = n;\n    this.s = s;\n    this.U = U;\n    this.V = V;\n  }\n\n  solve(value) {\n    let Y = value;\n    let e = this.threshold;\n    let scols = this.s.length;\n    let Ls = Matrix.zeros(scols, scols);\n\n    for (let i = 0; i < scols; i++) {\n      if (Math.abs(this.s[i]) <= e) {\n        Ls.set(i, i, 0);\n      } else {\n        Ls.set(i, i, 1 / this.s[i]);\n      }\n    }\n\n    let U = this.U;\n    let V = this.rightSingularVectors;\n\n    let VL = V.mmul(Ls);\n    let vrows = V.rows;\n    let urows = U.rows;\n    let VLU = Matrix.zeros(vrows, urows);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < urows; j++) {\n        let sum = 0;\n        for (let k = 0; k < scols; k++) {\n          sum += VL.get(i, k) * U.get(j, k);\n        }\n        VLU.set(i, j, sum);\n      }\n    }\n\n    return VLU.mmul(Y);\n  }\n\n  solveForDiagonal(value) {\n    return this.solve(Matrix.diag(value));\n  }\n\n  inverse() {\n    let V = this.V;\n    let e = this.threshold;\n    let vrows = V.rows;\n    let vcols = V.columns;\n    let X = new Matrix(vrows, this.s.length);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < vcols; j++) {\n        if (Math.abs(this.s[j]) > e) {\n          X.set(i, j, V.get(i, j) / this.s[j]);\n        }\n      }\n    }\n\n    let U = this.U;\n\n    let urows = U.rows;\n    let ucols = U.columns;\n    let Y = new Matrix(vrows, urows);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < urows; j++) {\n        let sum = 0;\n        for (let k = 0; k < ucols; k++) {\n          sum += X.get(i, k) * U.get(j, k);\n        }\n        Y.set(i, j, sum);\n      }\n    }\n\n    return Y;\n  }\n\n  get condition() {\n    return this.s[0] / this.s[Math.min(this.m, this.n) - 1];\n  }\n\n  get norm2() {\n    return this.s[0];\n  }\n\n  get rank() {\n    let tol = Math.max(this.m, this.n) * this.s[0] * Number.EPSILON;\n    let r = 0;\n    let s = this.s;\n    for (let i = 0, ii = s.length; i < ii; i++) {\n      if (s[i] > tol) {\n        r++;\n      }\n    }\n    return r;\n  }\n\n  get diagonal() {\n    return Array.from(this.s);\n  }\n\n  get threshold() {\n    return (Number.EPSILON / 2) * Math.max(this.m, this.n) * this.s[0];\n  }\n\n  get leftSingularVectors() {\n    return this.U;\n  }\n\n  get rightSingularVectors() {\n    return this.V;\n  }\n\n  get diagonalMatrix() {\n    return Matrix.diag(this.s);\n  }\n}\n\nfunction inverse(matrix, useSVD = false) {\n  matrix = WrapperMatrix2D.checkMatrix(matrix);\n  if (useSVD) {\n    return new SingularValueDecomposition(matrix).inverse();\n  } else {\n    return solve(matrix, Matrix.eye(matrix.rows));\n  }\n}\n\nfunction solve(leftHandSide, rightHandSide, useSVD = false) {\n  leftHandSide = WrapperMatrix2D.checkMatrix(leftHandSide);\n  rightHandSide = WrapperMatrix2D.checkMatrix(rightHandSide);\n  if (useSVD) {\n    return new SingularValueDecomposition(leftHandSide).solve(rightHandSide);\n  } else {\n    return leftHandSide.isSquare()\n      ? new LuDecomposition(leftHandSide).solve(rightHandSide)\n      : new QrDecomposition(leftHandSide).solve(rightHandSide);\n  }\n}\n\nfunction determinant(matrix) {\n  matrix = Matrix.checkMatrix(matrix);\n  if (matrix.isSquare()) {\n    if (matrix.columns === 0) {\n      return 1;\n    }\n\n    let a, b, c, d;\n    if (matrix.columns === 2) {\n      // 2 x 2 matrix\n      a = matrix.get(0, 0);\n      b = matrix.get(0, 1);\n      c = matrix.get(1, 0);\n      d = matrix.get(1, 1);\n\n      return a * d - b * c;\n    } else if (matrix.columns === 3) {\n      // 3 x 3 matrix\n      let subMatrix0, subMatrix1, subMatrix2;\n      subMatrix0 = new MatrixSelectionView(matrix, [1, 2], [1, 2]);\n      subMatrix1 = new MatrixSelectionView(matrix, [1, 2], [0, 2]);\n      subMatrix2 = new MatrixSelectionView(matrix, [1, 2], [0, 1]);\n      a = matrix.get(0, 0);\n      b = matrix.get(0, 1);\n      c = matrix.get(0, 2);\n\n      return (\n        a * determinant(subMatrix0) -\n        b * determinant(subMatrix1) +\n        c * determinant(subMatrix2)\n      );\n    } else {\n      // general purpose determinant using the LU decomposition\n      return new LuDecomposition(matrix).determinant;\n    }\n  } else {\n    throw Error('determinant can only be calculated for a square matrix');\n  }\n}\n\nfunction xrange(n, exception) {\n  let range = [];\n  for (let i = 0; i < n; i++) {\n    if (i !== exception) {\n      range.push(i);\n    }\n  }\n  return range;\n}\n\nfunction dependenciesOneRow(\n  error,\n  matrix,\n  index,\n  thresholdValue = 10e-10,\n  thresholdError = 10e-10,\n) {\n  if (error > thresholdError) {\n    return new Array(matrix.rows + 1).fill(0);\n  } else {\n    let returnArray = matrix.addRow(index, [0]);\n    for (let i = 0; i < returnArray.rows; i++) {\n      if (Math.abs(returnArray.get(i, 0)) < thresholdValue) {\n        returnArray.set(i, 0, 0);\n      }\n    }\n    return returnArray.to1DArray();\n  }\n}\n\nfunction linearDependencies(matrix, options = {}) {\n  const { thresholdValue = 10e-10, thresholdError = 10e-10 } = options;\n  matrix = Matrix.checkMatrix(matrix);\n\n  let n = matrix.rows;\n  let results = new Matrix(n, n);\n\n  for (let i = 0; i < n; i++) {\n    let b = Matrix.columnVector(matrix.getRow(i));\n    let Abis = matrix.subMatrixRow(xrange(n, i)).transpose();\n    let svd = new SingularValueDecomposition(Abis);\n    let x = svd.solve(b);\n    let error = Matrix.sub(b, Abis.mmul(x)).abs().max();\n    results.setRow(\n      i,\n      dependenciesOneRow(error, x, i, thresholdValue, thresholdError),\n    );\n  }\n  return results;\n}\n\nfunction pseudoInverse(matrix, threshold = Number.EPSILON) {\n  matrix = Matrix.checkMatrix(matrix);\n  if (matrix.isEmpty()) {\n    // with a zero dimension, the pseudo-inverse is the transpose, since all 0xn and nx0 matrices are singular\n    // (0xn)*(nx0)*(0xn) = 0xn\n    // (nx0)*(0xn)*(nx0) = nx0\n    return matrix.transpose();\n  }\n  let svdSolution = new SingularValueDecomposition(matrix, { autoTranspose: true });\n\n  let U = svdSolution.leftSingularVectors;\n  let V = svdSolution.rightSingularVectors;\n  let s = svdSolution.diagonal;\n\n  for (let i = 0; i < s.length; i++) {\n    if (Math.abs(s[i]) > threshold) {\n      s[i] = 1.0 / s[i];\n    } else {\n      s[i] = 0.0;\n    }\n  }\n\n  return V.mmul(Matrix.diag(s).mmul(U.transpose()));\n}\n\nfunction covariance(xMatrix, yMatrix = xMatrix, options = {}) {\n  xMatrix = new Matrix(xMatrix);\n  let yIsSame = false;\n  if (\n    typeof yMatrix === 'object' &&\n    !Matrix.isMatrix(yMatrix) &&\n    !isAnyArray.isAnyArray(yMatrix)\n  ) {\n    options = yMatrix;\n    yMatrix = xMatrix;\n    yIsSame = true;\n  } else {\n    yMatrix = new Matrix(yMatrix);\n  }\n  if (xMatrix.rows !== yMatrix.rows) {\n    throw new TypeError('Both matrices must have the same number of rows');\n  }\n  const { center = true } = options;\n  if (center) {\n    xMatrix = xMatrix.center('column');\n    if (!yIsSame) {\n      yMatrix = yMatrix.center('column');\n    }\n  }\n  const cov = xMatrix.transpose().mmul(yMatrix);\n  for (let i = 0; i < cov.rows; i++) {\n    for (let j = 0; j < cov.columns; j++) {\n      cov.set(i, j, cov.get(i, j) * (1 / (xMatrix.rows - 1)));\n    }\n  }\n  return cov;\n}\n\nfunction correlation(xMatrix, yMatrix = xMatrix, options = {}) {\n  xMatrix = new Matrix(xMatrix);\n  let yIsSame = false;\n  if (\n    typeof yMatrix === 'object' &&\n    !Matrix.isMatrix(yMatrix) &&\n    !isAnyArray.isAnyArray(yMatrix)\n  ) {\n    options = yMatrix;\n    yMatrix = xMatrix;\n    yIsSame = true;\n  } else {\n    yMatrix = new Matrix(yMatrix);\n  }\n  if (xMatrix.rows !== yMatrix.rows) {\n    throw new TypeError('Both matrices must have the same number of rows');\n  }\n\n  const { center = true, scale = true } = options;\n  if (center) {\n    xMatrix.center('column');\n    if (!yIsSame) {\n      yMatrix.center('column');\n    }\n  }\n  if (scale) {\n    xMatrix.scale('column');\n    if (!yIsSame) {\n      yMatrix.scale('column');\n    }\n  }\n\n  const sdx = xMatrix.standardDeviation('column', { unbiased: true });\n  const sdy = yIsSame\n    ? sdx\n    : yMatrix.standardDeviation('column', { unbiased: true });\n\n  const corr = xMatrix.transpose().mmul(yMatrix);\n  for (let i = 0; i < corr.rows; i++) {\n    for (let j = 0; j < corr.columns; j++) {\n      corr.set(\n        i,\n        j,\n        corr.get(i, j) * (1 / (sdx[i] * sdy[j])) * (1 / (xMatrix.rows - 1)),\n      );\n    }\n  }\n  return corr;\n}\n\nclass EigenvalueDecomposition {\n  constructor(matrix, options = {}) {\n    const { assumeSymmetric = false } = options;\n\n    matrix = WrapperMatrix2D.checkMatrix(matrix);\n    if (!matrix.isSquare()) {\n      throw new Error('Matrix is not a square matrix');\n    }\n\n    if (matrix.isEmpty()) {\n      throw new Error('Matrix must be non-empty');\n    }\n\n    let n = matrix.columns;\n    let V = new Matrix(n, n);\n    let d = new Float64Array(n);\n    let e = new Float64Array(n);\n    let value = matrix;\n    let i, j;\n\n    let isSymmetric = false;\n    if (assumeSymmetric) {\n      isSymmetric = true;\n    } else {\n      isSymmetric = matrix.isSymmetric();\n    }\n\n    if (isSymmetric) {\n      for (i = 0; i < n; i++) {\n        for (j = 0; j < n; j++) {\n          V.set(i, j, value.get(i, j));\n        }\n      }\n      tred2(n, e, d, V);\n      tql2(n, e, d, V);\n    } else {\n      let H = new Matrix(n, n);\n      let ort = new Float64Array(n);\n      for (j = 0; j < n; j++) {\n        for (i = 0; i < n; i++) {\n          H.set(i, j, value.get(i, j));\n        }\n      }\n      orthes(n, H, ort, V);\n      hqr2(n, e, d, V, H);\n    }\n\n    this.n = n;\n    this.e = e;\n    this.d = d;\n    this.V = V;\n  }\n\n  get realEigenvalues() {\n    return Array.from(this.d);\n  }\n\n  get imaginaryEigenvalues() {\n    return Array.from(this.e);\n  }\n\n  get eigenvectorMatrix() {\n    return this.V;\n  }\n\n  get diagonalMatrix() {\n    let n = this.n;\n    let e = this.e;\n    let d = this.d;\n    let X = new Matrix(n, n);\n    let i, j;\n    for (i = 0; i < n; i++) {\n      for (j = 0; j < n; j++) {\n        X.set(i, j, 0);\n      }\n      X.set(i, i, d[i]);\n      if (e[i] > 0) {\n        X.set(i, i + 1, e[i]);\n      } else if (e[i] < 0) {\n        X.set(i, i - 1, e[i]);\n      }\n    }\n    return X;\n  }\n}\n\nfunction tred2(n, e, d, V) {\n  let f, g, h, i, j, k, hh, scale;\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n  }\n\n  for (i = n - 1; i > 0; i--) {\n    scale = 0;\n    h = 0;\n    for (k = 0; k < i; k++) {\n      scale = scale + Math.abs(d[k]);\n    }\n\n    if (scale === 0) {\n      e[i] = d[i - 1];\n      for (j = 0; j < i; j++) {\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n        V.set(j, i, 0);\n      }\n    } else {\n      for (k = 0; k < i; k++) {\n        d[k] /= scale;\n        h += d[k] * d[k];\n      }\n\n      f = d[i - 1];\n      g = Math.sqrt(h);\n      if (f > 0) {\n        g = -g;\n      }\n\n      e[i] = scale * g;\n      h = h - f * g;\n      d[i - 1] = f - g;\n      for (j = 0; j < i; j++) {\n        e[j] = 0;\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        V.set(j, i, f);\n        g = e[j] + V.get(j, j) * f;\n        for (k = j + 1; k <= i - 1; k++) {\n          g += V.get(k, j) * d[k];\n          e[k] += V.get(k, j) * f;\n        }\n        e[j] = g;\n      }\n\n      f = 0;\n      for (j = 0; j < i; j++) {\n        e[j] /= h;\n        f += e[j] * d[j];\n      }\n\n      hh = f / (h + h);\n      for (j = 0; j < i; j++) {\n        e[j] -= hh * d[j];\n      }\n\n      for (j = 0; j < i; j++) {\n        f = d[j];\n        g = e[j];\n        for (k = j; k <= i - 1; k++) {\n          V.set(k, j, V.get(k, j) - (f * e[k] + g * d[k]));\n        }\n        d[j] = V.get(i - 1, j);\n        V.set(i, j, 0);\n      }\n    }\n    d[i] = h;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    V.set(n - 1, i, V.get(i, i));\n    V.set(i, i, 1);\n    h = d[i + 1];\n    if (h !== 0) {\n      for (k = 0; k <= i; k++) {\n        d[k] = V.get(k, i + 1) / h;\n      }\n\n      for (j = 0; j <= i; j++) {\n        g = 0;\n        for (k = 0; k <= i; k++) {\n          g += V.get(k, i + 1) * V.get(k, j);\n        }\n        for (k = 0; k <= i; k++) {\n          V.set(k, j, V.get(k, j) - g * d[k]);\n        }\n      }\n    }\n\n    for (k = 0; k <= i; k++) {\n      V.set(k, i + 1, 0);\n    }\n  }\n\n  for (j = 0; j < n; j++) {\n    d[j] = V.get(n - 1, j);\n    V.set(n - 1, j, 0);\n  }\n\n  V.set(n - 1, n - 1, 1);\n  e[0] = 0;\n}\n\nfunction tql2(n, e, d, V) {\n  let g, h, i, j, k, l, m, p, r, dl1, c, c2, c3, el1, s, s2;\n\n  for (i = 1; i < n; i++) {\n    e[i - 1] = e[i];\n  }\n\n  e[n - 1] = 0;\n\n  let f = 0;\n  let tst1 = 0;\n  let eps = Number.EPSILON;\n\n  for (l = 0; l < n; l++) {\n    tst1 = Math.max(tst1, Math.abs(d[l]) + Math.abs(e[l]));\n    m = l;\n    while (m < n) {\n      if (Math.abs(e[m]) <= eps * tst1) {\n        break;\n      }\n      m++;\n    }\n\n    if (m > l) {\n      do {\n\n        g = d[l];\n        p = (d[l + 1] - g) / (2 * e[l]);\n        r = hypotenuse(p, 1);\n        if (p < 0) {\n          r = -r;\n        }\n\n        d[l] = e[l] / (p + r);\n        d[l + 1] = e[l] * (p + r);\n        dl1 = d[l + 1];\n        h = g - d[l];\n        for (i = l + 2; i < n; i++) {\n          d[i] -= h;\n        }\n\n        f = f + h;\n\n        p = d[m];\n        c = 1;\n        c2 = c;\n        c3 = c;\n        el1 = e[l + 1];\n        s = 0;\n        s2 = 0;\n        for (i = m - 1; i >= l; i--) {\n          c3 = c2;\n          c2 = c;\n          s2 = s;\n          g = c * e[i];\n          h = c * p;\n          r = hypotenuse(p, e[i]);\n          e[i + 1] = s * r;\n          s = e[i] / r;\n          c = p / r;\n          p = c * d[i] - s * g;\n          d[i + 1] = h + s * (c * g + s * d[i]);\n\n          for (k = 0; k < n; k++) {\n            h = V.get(k, i + 1);\n            V.set(k, i + 1, s * V.get(k, i) + c * h);\n            V.set(k, i, c * V.get(k, i) - s * h);\n          }\n        }\n\n        p = (-s * s2 * c3 * el1 * e[l]) / dl1;\n        e[l] = s * p;\n        d[l] = c * p;\n      } while (Math.abs(e[l]) > eps * tst1);\n    }\n    d[l] = d[l] + f;\n    e[l] = 0;\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    k = i;\n    p = d[i];\n    for (j = i + 1; j < n; j++) {\n      if (d[j] < p) {\n        k = j;\n        p = d[j];\n      }\n    }\n\n    if (k !== i) {\n      d[k] = d[i];\n      d[i] = p;\n      for (j = 0; j < n; j++) {\n        p = V.get(j, i);\n        V.set(j, i, V.get(j, k));\n        V.set(j, k, p);\n      }\n    }\n  }\n}\n\nfunction orthes(n, H, ort, V) {\n  let low = 0;\n  let high = n - 1;\n  let f, g, h, i, j, m;\n  let scale;\n\n  for (m = low + 1; m <= high - 1; m++) {\n    scale = 0;\n    for (i = m; i <= high; i++) {\n      scale = scale + Math.abs(H.get(i, m - 1));\n    }\n\n    if (scale !== 0) {\n      h = 0;\n      for (i = high; i >= m; i--) {\n        ort[i] = H.get(i, m - 1) / scale;\n        h += ort[i] * ort[i];\n      }\n\n      g = Math.sqrt(h);\n      if (ort[m] > 0) {\n        g = -g;\n      }\n\n      h = h - ort[m] * g;\n      ort[m] = ort[m] - g;\n\n      for (j = m; j < n; j++) {\n        f = 0;\n        for (i = high; i >= m; i--) {\n          f += ort[i] * H.get(i, j);\n        }\n\n        f = f / h;\n        for (i = m; i <= high; i++) {\n          H.set(i, j, H.get(i, j) - f * ort[i]);\n        }\n      }\n\n      for (i = 0; i <= high; i++) {\n        f = 0;\n        for (j = high; j >= m; j--) {\n          f += ort[j] * H.get(i, j);\n        }\n\n        f = f / h;\n        for (j = m; j <= high; j++) {\n          H.set(i, j, H.get(i, j) - f * ort[j]);\n        }\n      }\n\n      ort[m] = scale * ort[m];\n      H.set(m, m - 1, scale * g);\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    for (j = 0; j < n; j++) {\n      V.set(i, j, i === j ? 1 : 0);\n    }\n  }\n\n  for (m = high - 1; m >= low + 1; m--) {\n    if (H.get(m, m - 1) !== 0) {\n      for (i = m + 1; i <= high; i++) {\n        ort[i] = H.get(i, m - 1);\n      }\n\n      for (j = m; j <= high; j++) {\n        g = 0;\n        for (i = m; i <= high; i++) {\n          g += ort[i] * V.get(i, j);\n        }\n\n        g = g / ort[m] / H.get(m, m - 1);\n        for (i = m; i <= high; i++) {\n          V.set(i, j, V.get(i, j) + g * ort[i]);\n        }\n      }\n    }\n  }\n}\n\nfunction hqr2(nn, e, d, V, H) {\n  let n = nn - 1;\n  let low = 0;\n  let high = nn - 1;\n  let eps = Number.EPSILON;\n  let exshift = 0;\n  let norm = 0;\n  let p = 0;\n  let q = 0;\n  let r = 0;\n  let s = 0;\n  let z = 0;\n  let iter = 0;\n  let i, j, k, l, m, t, w, x, y;\n  let ra, sa, vr, vi;\n  let notlast, cdivres;\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      d[i] = H.get(i, i);\n      e[i] = 0;\n    }\n\n    for (j = Math.max(i - 1, 0); j < nn; j++) {\n      norm = norm + Math.abs(H.get(i, j));\n    }\n  }\n\n  while (n >= low) {\n    l = n;\n    while (l > low) {\n      s = Math.abs(H.get(l - 1, l - 1)) + Math.abs(H.get(l, l));\n      if (s === 0) {\n        s = norm;\n      }\n      if (Math.abs(H.get(l, l - 1)) < eps * s) {\n        break;\n      }\n      l--;\n    }\n\n    if (l === n) {\n      H.set(n, n, H.get(n, n) + exshift);\n      d[n] = H.get(n, n);\n      e[n] = 0;\n      n--;\n      iter = 0;\n    } else if (l === n - 1) {\n      w = H.get(n, n - 1) * H.get(n - 1, n);\n      p = (H.get(n - 1, n - 1) - H.get(n, n)) / 2;\n      q = p * p + w;\n      z = Math.sqrt(Math.abs(q));\n      H.set(n, n, H.get(n, n) + exshift);\n      H.set(n - 1, n - 1, H.get(n - 1, n - 1) + exshift);\n      x = H.get(n, n);\n\n      if (q >= 0) {\n        z = p >= 0 ? p + z : p - z;\n        d[n - 1] = x + z;\n        d[n] = d[n - 1];\n        if (z !== 0) {\n          d[n] = x - w / z;\n        }\n        e[n - 1] = 0;\n        e[n] = 0;\n        x = H.get(n, n - 1);\n        s = Math.abs(x) + Math.abs(z);\n        p = x / s;\n        q = z / s;\n        r = Math.sqrt(p * p + q * q);\n        p = p / r;\n        q = q / r;\n\n        for (j = n - 1; j < nn; j++) {\n          z = H.get(n - 1, j);\n          H.set(n - 1, j, q * z + p * H.get(n, j));\n          H.set(n, j, q * H.get(n, j) - p * z);\n        }\n\n        for (i = 0; i <= n; i++) {\n          z = H.get(i, n - 1);\n          H.set(i, n - 1, q * z + p * H.get(i, n));\n          H.set(i, n, q * H.get(i, n) - p * z);\n        }\n\n        for (i = low; i <= high; i++) {\n          z = V.get(i, n - 1);\n          V.set(i, n - 1, q * z + p * V.get(i, n));\n          V.set(i, n, q * V.get(i, n) - p * z);\n        }\n      } else {\n        d[n - 1] = x + p;\n        d[n] = x + p;\n        e[n - 1] = z;\n        e[n] = -z;\n      }\n\n      n = n - 2;\n      iter = 0;\n    } else {\n      x = H.get(n, n);\n      y = 0;\n      w = 0;\n      if (l < n) {\n        y = H.get(n - 1, n - 1);\n        w = H.get(n, n - 1) * H.get(n - 1, n);\n      }\n\n      if (iter === 10) {\n        exshift += x;\n        for (i = low; i <= n; i++) {\n          H.set(i, i, H.get(i, i) - x);\n        }\n        s = Math.abs(H.get(n, n - 1)) + Math.abs(H.get(n - 1, n - 2));\n        // eslint-disable-next-line no-multi-assign\n        x = y = 0.75 * s;\n        w = -0.4375 * s * s;\n      }\n\n      if (iter === 30) {\n        s = (y - x) / 2;\n        s = s * s + w;\n        if (s > 0) {\n          s = Math.sqrt(s);\n          if (y < x) {\n            s = -s;\n          }\n          s = x - w / ((y - x) / 2 + s);\n          for (i = low; i <= n; i++) {\n            H.set(i, i, H.get(i, i) - s);\n          }\n          exshift += s;\n          // eslint-disable-next-line no-multi-assign\n          x = y = w = 0.964;\n        }\n      }\n\n      iter = iter + 1;\n\n      m = n - 2;\n      while (m >= l) {\n        z = H.get(m, m);\n        r = x - z;\n        s = y - z;\n        p = (r * s - w) / H.get(m + 1, m) + H.get(m, m + 1);\n        q = H.get(m + 1, m + 1) - z - r - s;\n        r = H.get(m + 2, m + 1);\n        s = Math.abs(p) + Math.abs(q) + Math.abs(r);\n        p = p / s;\n        q = q / s;\n        r = r / s;\n        if (m === l) {\n          break;\n        }\n        if (\n          Math.abs(H.get(m, m - 1)) * (Math.abs(q) + Math.abs(r)) <\n          eps *\n            (Math.abs(p) *\n              (Math.abs(H.get(m - 1, m - 1)) +\n                Math.abs(z) +\n                Math.abs(H.get(m + 1, m + 1))))\n        ) {\n          break;\n        }\n        m--;\n      }\n\n      for (i = m + 2; i <= n; i++) {\n        H.set(i, i - 2, 0);\n        if (i > m + 2) {\n          H.set(i, i - 3, 0);\n        }\n      }\n\n      for (k = m; k <= n - 1; k++) {\n        notlast = k !== n - 1;\n        if (k !== m) {\n          p = H.get(k, k - 1);\n          q = H.get(k + 1, k - 1);\n          r = notlast ? H.get(k + 2, k - 1) : 0;\n          x = Math.abs(p) + Math.abs(q) + Math.abs(r);\n          if (x !== 0) {\n            p = p / x;\n            q = q / x;\n            r = r / x;\n          }\n        }\n\n        if (x === 0) {\n          break;\n        }\n\n        s = Math.sqrt(p * p + q * q + r * r);\n        if (p < 0) {\n          s = -s;\n        }\n\n        if (s !== 0) {\n          if (k !== m) {\n            H.set(k, k - 1, -s * x);\n          } else if (l !== m) {\n            H.set(k, k - 1, -H.get(k, k - 1));\n          }\n\n          p = p + s;\n          x = p / s;\n          y = q / s;\n          z = r / s;\n          q = q / p;\n          r = r / p;\n\n          for (j = k; j < nn; j++) {\n            p = H.get(k, j) + q * H.get(k + 1, j);\n            if (notlast) {\n              p = p + r * H.get(k + 2, j);\n              H.set(k + 2, j, H.get(k + 2, j) - p * z);\n            }\n\n            H.set(k, j, H.get(k, j) - p * x);\n            H.set(k + 1, j, H.get(k + 1, j) - p * y);\n          }\n\n          for (i = 0; i <= Math.min(n, k + 3); i++) {\n            p = x * H.get(i, k) + y * H.get(i, k + 1);\n            if (notlast) {\n              p = p + z * H.get(i, k + 2);\n              H.set(i, k + 2, H.get(i, k + 2) - p * r);\n            }\n\n            H.set(i, k, H.get(i, k) - p);\n            H.set(i, k + 1, H.get(i, k + 1) - p * q);\n          }\n\n          for (i = low; i <= high; i++) {\n            p = x * V.get(i, k) + y * V.get(i, k + 1);\n            if (notlast) {\n              p = p + z * V.get(i, k + 2);\n              V.set(i, k + 2, V.get(i, k + 2) - p * r);\n            }\n\n            V.set(i, k, V.get(i, k) - p);\n            V.set(i, k + 1, V.get(i, k + 1) - p * q);\n          }\n        }\n      }\n    }\n  }\n\n  if (norm === 0) {\n    return;\n  }\n\n  for (n = nn - 1; n >= 0; n--) {\n    p = d[n];\n    q = e[n];\n\n    if (q === 0) {\n      l = n;\n      H.set(n, n, 1);\n      for (i = n - 1; i >= 0; i--) {\n        w = H.get(i, i) - p;\n        r = 0;\n        for (j = l; j <= n; j++) {\n          r = r + H.get(i, j) * H.get(j, n);\n        }\n\n        if (e[i] < 0) {\n          z = w;\n          s = r;\n        } else {\n          l = i;\n          if (e[i] === 0) {\n            H.set(i, n, w !== 0 ? -r / w : -r / (eps * norm));\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            q = (d[i] - p) * (d[i] - p) + e[i] * e[i];\n            t = (x * s - z * r) / q;\n            H.set(i, n, t);\n            H.set(\n              i + 1,\n              n,\n              Math.abs(x) > Math.abs(z) ? (-r - w * t) / x : (-s - y * t) / z,\n            );\n          }\n\n          t = Math.abs(H.get(i, n));\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    } else if (q < 0) {\n      l = n - 1;\n\n      if (Math.abs(H.get(n, n - 1)) > Math.abs(H.get(n - 1, n))) {\n        H.set(n - 1, n - 1, q / H.get(n, n - 1));\n        H.set(n - 1, n, -(H.get(n, n) - p) / H.get(n, n - 1));\n      } else {\n        cdivres = cdiv(0, -H.get(n - 1, n), H.get(n - 1, n - 1) - p, q);\n        H.set(n - 1, n - 1, cdivres[0]);\n        H.set(n - 1, n, cdivres[1]);\n      }\n\n      H.set(n, n - 1, 0);\n      H.set(n, n, 1);\n      for (i = n - 2; i >= 0; i--) {\n        ra = 0;\n        sa = 0;\n        for (j = l; j <= n; j++) {\n          ra = ra + H.get(i, j) * H.get(j, n - 1);\n          sa = sa + H.get(i, j) * H.get(j, n);\n        }\n\n        w = H.get(i, i) - p;\n\n        if (e[i] < 0) {\n          z = w;\n          r = ra;\n          s = sa;\n        } else {\n          l = i;\n          if (e[i] === 0) {\n            cdivres = cdiv(-ra, -sa, w, q);\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n          } else {\n            x = H.get(i, i + 1);\n            y = H.get(i + 1, i);\n            vr = (d[i] - p) * (d[i] - p) + e[i] * e[i] - q * q;\n            vi = (d[i] - p) * 2 * q;\n            if (vr === 0 && vi === 0) {\n              vr =\n                eps *\n                norm *\n                (Math.abs(w) +\n                  Math.abs(q) +\n                  Math.abs(x) +\n                  Math.abs(y) +\n                  Math.abs(z));\n            }\n            cdivres = cdiv(\n              x * r - z * ra + q * sa,\n              x * s - z * sa - q * ra,\n              vr,\n              vi,\n            );\n            H.set(i, n - 1, cdivres[0]);\n            H.set(i, n, cdivres[1]);\n            if (Math.abs(x) > Math.abs(z) + Math.abs(q)) {\n              H.set(\n                i + 1,\n                n - 1,\n                (-ra - w * H.get(i, n - 1) + q * H.get(i, n)) / x,\n              );\n              H.set(\n                i + 1,\n                n,\n                (-sa - w * H.get(i, n) - q * H.get(i, n - 1)) / x,\n              );\n            } else {\n              cdivres = cdiv(\n                -r - y * H.get(i, n - 1),\n                -s - y * H.get(i, n),\n                z,\n                q,\n              );\n              H.set(i + 1, n - 1, cdivres[0]);\n              H.set(i + 1, n, cdivres[1]);\n            }\n          }\n\n          t = Math.max(Math.abs(H.get(i, n - 1)), Math.abs(H.get(i, n)));\n          if (eps * t * t > 1) {\n            for (j = i; j <= n; j++) {\n              H.set(j, n - 1, H.get(j, n - 1) / t);\n              H.set(j, n, H.get(j, n) / t);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < nn; i++) {\n    if (i < low || i > high) {\n      for (j = i; j < nn; j++) {\n        V.set(i, j, H.get(i, j));\n      }\n    }\n  }\n\n  for (j = nn - 1; j >= low; j--) {\n    for (i = low; i <= high; i++) {\n      z = 0;\n      for (k = low; k <= Math.min(j, high); k++) {\n        z = z + V.get(i, k) * H.get(k, j);\n      }\n      V.set(i, j, z);\n    }\n  }\n}\n\nfunction cdiv(xr, xi, yr, yi) {\n  let r, d;\n  if (Math.abs(yr) > Math.abs(yi)) {\n    r = yi / yr;\n    d = yr + r * yi;\n    return [(xr + r * xi) / d, (xi - r * xr) / d];\n  } else {\n    r = yr / yi;\n    d = yi + r * yr;\n    return [(r * xr + xi) / d, (r * xi - xr) / d];\n  }\n}\n\nclass CholeskyDecomposition {\n  constructor(value) {\n    value = WrapperMatrix2D.checkMatrix(value);\n    if (!value.isSymmetric()) {\n      throw new Error('Matrix is not symmetric');\n    }\n\n    let a = value;\n    let dimension = a.rows;\n    let l = new Matrix(dimension, dimension);\n    let positiveDefinite = true;\n    let i, j, k;\n\n    for (j = 0; j < dimension; j++) {\n      let d = 0;\n      for (k = 0; k < j; k++) {\n        let s = 0;\n        for (i = 0; i < k; i++) {\n          s += l.get(k, i) * l.get(j, i);\n        }\n        s = (a.get(j, k) - s) / l.get(k, k);\n        l.set(j, k, s);\n        d = d + s * s;\n      }\n\n      d = a.get(j, j) - d;\n\n      positiveDefinite &&= d > 0;\n      l.set(j, j, Math.sqrt(Math.max(d, 0)));\n      for (k = j + 1; k < dimension; k++) {\n        l.set(j, k, 0);\n      }\n    }\n\n    this.L = l;\n    this.positiveDefinite = positiveDefinite;\n  }\n\n  isPositiveDefinite() {\n    return this.positiveDefinite;\n  }\n\n  solve(value) {\n    value = WrapperMatrix2D.checkMatrix(value);\n\n    let l = this.L;\n    let dimension = l.rows;\n\n    if (value.rows !== dimension) {\n      throw new Error('Matrix dimensions do not match');\n    }\n    if (this.isPositiveDefinite() === false) {\n      throw new Error('Matrix is not positive definite');\n    }\n\n    let count = value.columns;\n    let B = value.clone();\n    let i, j, k;\n\n    for (k = 0; k < dimension; k++) {\n      for (j = 0; j < count; j++) {\n        for (i = 0; i < k; i++) {\n          B.set(k, j, B.get(k, j) - B.get(i, j) * l.get(k, i));\n        }\n        B.set(k, j, B.get(k, j) / l.get(k, k));\n      }\n    }\n\n    for (k = dimension - 1; k >= 0; k--) {\n      for (j = 0; j < count; j++) {\n        for (i = k + 1; i < dimension; i++) {\n          B.set(k, j, B.get(k, j) - B.get(i, j) * l.get(i, k));\n        }\n        B.set(k, j, B.get(k, j) / l.get(k, k));\n      }\n    }\n\n    return B;\n  }\n\n  get lowerTriangularMatrix() {\n    return this.L;\n  }\n}\n\nclass nipals {\n  constructor(X, options = {}) {\n    X = WrapperMatrix2D.checkMatrix(X);\n    let { Y } = options;\n    const {\n      scaleScores = false,\n      maxIterations = 1000,\n      terminationCriteria = 1e-10,\n    } = options;\n\n    let u;\n    if (Y) {\n      if (isAnyArray.isAnyArray(Y) && typeof Y[0] === 'number') {\n        Y = Matrix.columnVector(Y);\n      } else {\n        Y = WrapperMatrix2D.checkMatrix(Y);\n      }\n      if (Y.rows !== X.rows) {\n        throw new Error('Y should have the same number of rows as X');\n      }\n      u = Y.getColumnVector(0);\n    } else {\n      u = X.getColumnVector(0);\n    }\n\n    let diff = 1;\n    let t, q, w, tOld;\n\n    for (\n      let counter = 0;\n      counter < maxIterations && diff > terminationCriteria;\n      counter++\n    ) {\n      w = X.transpose().mmul(u).div(u.transpose().mmul(u).get(0, 0));\n      w = w.div(w.norm());\n\n      t = X.mmul(w).div(w.transpose().mmul(w).get(0, 0));\n\n      if (counter > 0) {\n        diff = t.clone().sub(tOld).pow(2).sum();\n      }\n      tOld = t.clone();\n\n      if (Y) {\n        q = Y.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n        q = q.div(q.norm());\n\n        u = Y.mmul(q).div(q.transpose().mmul(q).get(0, 0));\n      } else {\n        u = t;\n      }\n    }\n\n    if (Y) {\n      let p = X.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      p = p.div(p.norm());\n      let xResidual = X.clone().sub(t.clone().mmul(p.transpose()));\n      let residual = u.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      let yResidual = Y.clone().sub(\n        t.clone().mulS(residual.get(0, 0)).mmul(q.transpose()),\n      );\n\n      this.t = t;\n      this.p = p.transpose();\n      this.w = w.transpose();\n      this.q = q;\n      this.u = u;\n      this.s = t.transpose().mmul(t);\n      this.xResidual = xResidual;\n      this.yResidual = yResidual;\n      this.betas = residual;\n    } else {\n      this.w = w.transpose();\n      this.s = t.transpose().mmul(t).sqrt();\n      if (scaleScores) {\n        this.t = t.clone().div(this.s.get(0, 0));\n      } else {\n        this.t = t;\n      }\n      this.xResidual = X.sub(t.mmul(w.transpose()));\n    }\n  }\n}\n\nexports.AbstractMatrix = AbstractMatrix;\nexports.CHO = CholeskyDecomposition;\nexports.CholeskyDecomposition = CholeskyDecomposition;\nexports.DistanceMatrix = DistanceMatrix;\nexports.EVD = EigenvalueDecomposition;\nexports.EigenvalueDecomposition = EigenvalueDecomposition;\nexports.LU = LuDecomposition;\nexports.LuDecomposition = LuDecomposition;\nexports.Matrix = Matrix;\nexports.MatrixColumnSelectionView = MatrixColumnSelectionView;\nexports.MatrixColumnView = MatrixColumnView;\nexports.MatrixFlipColumnView = MatrixFlipColumnView;\nexports.MatrixFlipRowView = MatrixFlipRowView;\nexports.MatrixRowSelectionView = MatrixRowSelectionView;\nexports.MatrixRowView = MatrixRowView;\nexports.MatrixSelectionView = MatrixSelectionView;\nexports.MatrixSubView = MatrixSubView;\nexports.MatrixTransposeView = MatrixTransposeView;\nexports.NIPALS = nipals;\nexports.Nipals = nipals;\nexports.QR = QrDecomposition;\nexports.QrDecomposition = QrDecomposition;\nexports.SVD = SingularValueDecomposition;\nexports.SingularValueDecomposition = SingularValueDecomposition;\nexports.SymmetricMatrix = SymmetricMatrix;\nexports.WrapperMatrix1D = WrapperMatrix1D;\nexports.WrapperMatrix2D = WrapperMatrix2D;\nexports.correlation = correlation;\nexports.covariance = covariance;\nexports.default = Matrix;\nexports.determinant = determinant;\nexports.inverse = inverse;\nexports.linearDependencies = linearDependencies;\nexports.pseudoInverse = pseudoInverse;\nexports.solve = solve;\nexports.wrap = wrap;\n", "import * as matrix from './matrix.js';\n\nexport const AbstractMatrix = matrix.AbstractMatrix;\nexport const CHO = matrix.CHO;\nexport const CholeskyDecomposition = matrix.CholeskyDecomposition;\nexport const DistanceMatrix = matrix.DistanceMatrix;\nexport const EVD = matrix.EVD;\nexport const EigenvalueDecomposition = matrix.EigenvalueDecomposition;\nexport const LU = matrix.LU;\nexport const LuDecomposition = matrix.LuDecomposition;\nexport const Matrix = matrix.Matrix;\nexport const MatrixColumnSelectionView = matrix.MatrixColumnSelectionView;\nexport const MatrixColumnView = matrix.MatrixColumnView;\nexport const MatrixFlipColumnView = matrix.MatrixFlipColumnView;\nexport const MatrixFlipRowView = matrix.MatrixFlipRowView;\nexport const MatrixRowSelectionView = matrix.MatrixRowSelectionView;\nexport const MatrixRowView = matrix.MatrixRowView;\nexport const MatrixSelectionView = matrix.MatrixSelectionView;\nexport const MatrixSubView = matrix.MatrixSubView;\nexport const MatrixTransposeView = matrix.MatrixTransposeView;\nexport const NIPALS = matrix.NIPALS;\nexport const Nipals = matrix.Nipals;\nexport const QR = matrix.QR;\nexport const QrDecomposition = matrix.QrDecomposition;\nexport const SVD = matrix.SVD;\nexport const SingularValueDecomposition = matrix.SingularValueDecomposition;\nexport const SymmetricMatrix = matrix.SymmetricMatrix;\nexport const WrapperMatrix1D = matrix.WrapperMatrix1D;\nexport const WrapperMatrix2D = matrix.WrapperMatrix2D;\nexport const correlation = matrix.correlation;\nexport const covariance = matrix.covariance;\nexport default matrix.default.Matrix ? matrix.default.Matrix : matrix.Matrix;\nexport const determinant = matrix.determinant;\nexport const inverse = matrix.inverse;\nexport const linearDependencies = matrix.linearDependencies;\nexport const pseudoInverse = matrix.pseudoInverse;\nexport const solve = matrix.solve;\nexport const wrap = matrix.wrap;\n", "import { Matrix, inverse } from \"ml-matrix\";\r\n\r\nconst solveHomography = (srcPoints, dstPoints) => {\r\n  const { normPoints: normSrcPoints, param: srcParam } = _normalizePoints(srcPoints);\r\n  const { normPoints: normDstPoints, param: dstParam } = _normalizePoints(dstPoints);\r\n\r\n  const num = normDstPoints.length;\r\n  const AData = [];\r\n  const BData = [];\r\n  for (let j = 0; j < num; j++) {\r\n    const row1 = [\r\n      normSrcPoints[j][0],\r\n      normSrcPoints[j][1],\r\n      1,\r\n      0,\r\n      0,\r\n      0,\r\n      -(normSrcPoints[j][0] * normDstPoints[j][0]),\r\n      -(normSrcPoints[j][1] * normDstPoints[j][0]),\r\n    ];\r\n    const row2 = [\r\n      0,\r\n      0,\r\n      0,\r\n      normSrcPoints[j][0],\r\n      normSrcPoints[j][1],\r\n      1,\r\n      -(normSrcPoints[j][0] * normDstPoints[j][1]),\r\n      -(normSrcPoints[j][1] * normDstPoints[j][1]),\r\n    ];\r\n    AData.push(row1);\r\n    AData.push(row2);\r\n\r\n    BData.push([normDstPoints[j][0]]);\r\n    BData.push([normDstPoints[j][1]]);\r\n  }\r\n\r\n  try {\r\n    const A = new Matrix(AData);\r\n    const B = new Matrix(BData);\r\n    const AT = A.transpose();\r\n    const ATA = AT.mmul(A);\r\n    const ATB = AT.mmul(B);\r\n    const ATAInv = inverse(ATA);\r\n    const C = ATAInv.mmul(ATB).to1DArray();\r\n    const H = _denormalizeHomography(C, srcParam, dstParam);\r\n    return H;\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n};\r\n\r\n// centroid at origin and avg distance from origin is sqrt(2)\r\nconst _normalizePoints = (coords) => {\r\n  //return {normalizedCoords: coords, param: {meanX: 0, meanY: 0, s: 1}}; // skip normalization\r\n\r\n  let sumX = 0;\r\n  let sumY = 0;\r\n  for (let i = 0; i < coords.length; i++) {\r\n    sumX += coords[i][0];\r\n    sumY += coords[i][1];\r\n  }\r\n  let meanX = sumX / coords.length;\r\n  let meanY = sumY / coords.length;\r\n\r\n  let sumDiff = 0;\r\n  for (let i = 0; i < coords.length; i++) {\r\n    const diffX = coords[i][0] - meanX;\r\n    const diffY = coords[i][1] - meanY;\r\n    sumDiff += Math.sqrt(diffX * diffX + diffY * diffY);\r\n  }\r\n  let s = (Math.sqrt(2) * coords.length) / sumDiff;\r\n\r\n  const normPoints = [];\r\n  for (let i = 0; i < coords.length; i++) {\r\n    normPoints.push([(coords[i][0] - meanX) * s, (coords[i][1] - meanY) * s]);\r\n  }\r\n  return { normPoints, param: { meanX, meanY, s } };\r\n};\r\n\r\n// Denormalize homography\r\n// where T is the normalization matrix, i.e.\r\n//\r\n//     [1  0  -meanX]\r\n// T = [0  1  -meanY]\r\n//     [0  0     1/s]\r\n//\r\n//          [1  0  s*meanX]\r\n// inv(T) = [0  1  s*meanY]\r\n// \t    [0  0        s]\r\n//\r\n// H = inv(Tdst) * Hn * Tsrc\r\n//\r\n// @param {\r\n//   nH: normH,\r\n//   srcParam: param of src transform,\r\n//   dstParam: param of dst transform\r\n// }\r\nconst _denormalizeHomography = (nH, srcParam, dstParam) => {\r\n  /*\r\n  Matrix version\r\n  const normH = new Matrix([\r\n    [nH[0], nH[1], nH[2]],\r\n    [nH[3], nH[4], nH[5]],\r\n    [nH[6], nH[7], 1],\r\n  ]);\r\n  const Tsrc = new Matrix([\r\n    [1, 0, -srcParam.meanX],\r\n    [0, 1, -srcParam.meanY],\r\n    [0, 0,    1/srcParam.s],\r\n  ]);\r\n\r\n  const invTdst = new Matrix([\r\n    [1, 0, dstParam.s * dstParam.meanX],\r\n    [0, 1, dstParam.s * dstParam.meanY],\r\n    [0, 0, dstParam.s],\r\n  ]);\r\n  const H = invTdst.mmul(normH).mmul(Tsrc);\r\n  */\r\n\r\n  // plain implementation of the above using Matrix\r\n  const sMeanX = dstParam.s * dstParam.meanX;\r\n  const sMeanY = dstParam.s * dstParam.meanY;\r\n\r\n  const H = [\r\n    nH[0] + sMeanX * nH[6],\r\n    nH[1] + sMeanX * nH[7],\r\n    (nH[0] + sMeanX * nH[6]) * -srcParam.meanX +\r\n      (nH[1] + sMeanX * nH[7]) * -srcParam.meanY +\r\n      (nH[2] + sMeanX) / srcParam.s,\r\n    nH[3] + sMeanY * nH[6],\r\n    nH[4] + sMeanY * nH[7],\r\n    (nH[3] + sMeanY * nH[6]) * -srcParam.meanX +\r\n      (nH[4] + sMeanY * nH[7]) * -srcParam.meanY +\r\n      (nH[5] + sMeanY) / srcParam.s,\r\n    dstParam.s * nH[6],\r\n    dstParam.s * nH[7],\r\n    dstParam.s * nH[6] * -srcParam.meanX +\r\n      dstParam.s * nH[7] * -srcParam.meanY +\r\n      dstParam.s / srcParam.s,\r\n  ];\r\n\r\n  // make H[8] === 1;\r\n  for (let i = 0; i < 9; i++) {\r\n    H[i] = H[i] / H[8];\r\n  }\r\n  return H;\r\n};\r\n\r\nexport { solveHomography };\r\n", "import { createRandomizer } from \"../utils/randomizer.js\";\r\nimport {\r\n  quadrilateralConvex,\r\n  matrixInverse33,\r\n  smallestTriangleArea,\r\n  multiplyPointHomographyInhomogenous,\r\n  checkThreePointsConsistent,\r\n  checkFourPointsConsistent,\r\n} from \"../utils/geometry.js\";\r\nimport { solveHomography } from \"../utils/homography.js\";\r\n\r\nconst CAUCHY_SCALE = 0.01;\r\nconst CHUNK_SIZE = 10;\r\nconst NUM_HYPOTHESES = 100;\r\nconst NUM_HYPOTHESES_QUICK = 50;\r\n\r\n// Using RANSAC to estimate homography\r\nconst computeHomography = (options) => {\r\n  const { srcPoints, dstPoints, keyframe, quickMode } = options;\r\n\r\n  // testPoints is four corners of keyframe\r\n  const testPoints = [\r\n    [0, 0],\r\n    [keyframe.width, 0],\r\n    [keyframe.width, keyframe.height],\r\n    [0, keyframe.height],\r\n  ];\r\n\r\n  const sampleSize = 4; // use four points to compute homography\r\n  if (srcPoints.length < sampleSize) return null;\r\n\r\n  const scale = CAUCHY_SCALE;\r\n  const oneOverScale2 = 1.0 / (scale * scale);\r\n  const chuckSize = Math.min(CHUNK_SIZE, srcPoints.length);\r\n\r\n  const randomizer = createRandomizer();\r\n\r\n  const perm = [];\r\n  for (let i = 0; i < srcPoints.length; i++) {\r\n    perm[i] = i;\r\n  }\r\n\r\n  randomizer.arrayShuffle({ arr: perm, sampleSize: perm.length });\r\n\r\n  const numHypothesis = quickMode ? NUM_HYPOTHESES_QUICK : NUM_HYPOTHESES;\r\n  const maxTrials = numHypothesis * 2;\r\n\r\n  // build numerous hypotheses by randoming draw four points\r\n  // TODO: optimize: if number of points is less than certain number, can brute force all combinations\r\n  let trial = 0;\r\n  const Hs = [];\r\n  while (trial < maxTrials && Hs.length < numHypothesis) {\r\n    trial += 1;\r\n\r\n    randomizer.arrayShuffle({ arr: perm, sampleSize: sampleSize });\r\n\r\n    // their relative positions match each other\r\n    if (\r\n      !checkFourPointsConsistent(\r\n        srcPoints[perm[0]],\r\n        srcPoints[perm[1]],\r\n        srcPoints[perm[2]],\r\n        srcPoints[perm[3]],\r\n        dstPoints[perm[0]],\r\n        dstPoints[perm[1]],\r\n        dstPoints[perm[2]],\r\n        dstPoints[perm[3]],\r\n      )\r\n    ) {\r\n      continue;\r\n    }\r\n\r\n    const H = solveHomography(\r\n      [srcPoints[perm[0]], srcPoints[perm[1]], srcPoints[perm[2]], srcPoints[perm[3]]],\r\n      [dstPoints[perm[0]], dstPoints[perm[1]], dstPoints[perm[2]], dstPoints[perm[3]]],\r\n    );\r\n    if (H === null) continue;\r\n\r\n    if (!_checkHomographyPointsGeometricallyConsistent({ H, testPoints })) {\r\n      continue;\r\n    }\r\n\r\n    Hs.push(H);\r\n  }\r\n\r\n  if (Hs.length === 0) return null;\r\n\r\n  // pick the best hypothesis\r\n  const hypotheses = [];\r\n  for (let i = 0; i < Hs.length; i++) {\r\n    hypotheses.push({\r\n      H: Hs[i],\r\n      cost: 0,\r\n    });\r\n  }\r\n\r\n  let curChuckSize = chuckSize;\r\n  for (let i = 0; i < srcPoints.length && hypotheses.length > 2; i += curChuckSize) {\r\n    curChuckSize = Math.min(chuckSize, srcPoints.length - i);\r\n    let chuckEnd = i + curChuckSize;\r\n\r\n    for (let j = 0; j < hypotheses.length; j++) {\r\n      for (let k = i; k < chuckEnd; k++) {\r\n        const cost = _cauchyProjectiveReprojectionCost({\r\n          H: hypotheses[j].H,\r\n          srcPoint: srcPoints[k],\r\n          dstPoint: dstPoints[k],\r\n          oneOverScale2,\r\n        });\r\n        hypotheses[j].cost += cost;\r\n      }\r\n    }\r\n\r\n    hypotheses.sort((h1, h2) => {\r\n      return h1.cost - h2.cost;\r\n    });\r\n    hypotheses.splice(-Math.floor((hypotheses.length + 1) / 2)); // keep the best half\r\n  }\r\n\r\n  let finalH = null;\r\n  for (let i = 0; i < hypotheses.length; i++) {\r\n    const H = _normalizeHomography({ inH: hypotheses[i].H });\r\n    if (_checkHeuristics({ H: H, testPoints, keyframe })) {\r\n      finalH = H;\r\n      break;\r\n    }\r\n  }\r\n  return finalH;\r\n};\r\n\r\nconst _checkHeuristics = ({ H, testPoints, keyframe }) => {\r\n  const mp = [];\r\n  for (let i = 0; i < testPoints.length; i++) {\r\n    // 4 test points, corner of keyframe\r\n    mp.push(multiplyPointHomographyInhomogenous(testPoints[i], H));\r\n  }\r\n  const smallArea = smallestTriangleArea(mp[0], mp[1], mp[2], mp[3]);\r\n\r\n  if (smallArea < keyframe.width * keyframe.height * 0.0001) return false;\r\n\r\n  if (!quadrilateralConvex(mp[0], mp[1], mp[2], mp[3])) return false;\r\n\r\n  return true;\r\n};\r\n\r\nconst _normalizeHomography = ({ inH }) => {\r\n  const oneOver = 1.0 / inH[8];\r\n\r\n  const H = [];\r\n  for (let i = 0; i < 8; i++) {\r\n    H[i] = inH[i] * oneOver;\r\n  }\r\n  H[8] = 1.0;\r\n  return H;\r\n};\r\n\r\nconst _cauchyProjectiveReprojectionCost = ({ H, srcPoint, dstPoint, oneOverScale2 }) => {\r\n  const x = multiplyPointHomographyInhomogenous(srcPoint, H);\r\n  const f = [x[0] - dstPoint[0], x[1] - dstPoint[1]];\r\n  return Math.log(1 + (f[0] * f[0] + f[1] * f[1]) * oneOverScale2);\r\n};\r\n\r\nconst _checkHomographyPointsGeometricallyConsistent = ({ H, testPoints }) => {\r\n  const mappedPoints = [];\r\n  for (let i = 0; i < testPoints.length; i++) {\r\n    mappedPoints[i] = multiplyPointHomographyInhomogenous(testPoints[i], H);\r\n  }\r\n  for (let i = 0; i < testPoints.length; i++) {\r\n    const i1 = i;\r\n    const i2 = (i + 1) % testPoints.length;\r\n    const i3 = (i + 2) % testPoints.length;\r\n    if (\r\n      !checkThreePointsConsistent(\r\n        testPoints[i1],\r\n        testPoints[i2],\r\n        testPoints[i3],\r\n        mappedPoints[i1],\r\n        mappedPoints[i2],\r\n        mappedPoints[i3],\r\n      )\r\n    )\r\n      return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nexport { computeHomography };\r\n", "/**\r\n * Morphological Refinement - \"Active Edge Alignment\"\r\n * \r\n * This Moonshot algorithm snaps the projected target to the real image edges.\r\n * It solves the \"Small Box / Drift\" problem by maximizing alignment with \r\n * local image gradients using a Spring-Mass optimization system.\r\n */\r\n\r\nimport { Matrix, SingularValueDecomposition } from \"ml-matrix\";\r\n\r\nexport function refineWithMorphology({\r\n    imageData,\r\n    width,\r\n    height,\r\n    targetData,\r\n    initialH,\r\n    iterations = 3\r\n}) {\r\n    let currentH = [...initialH];\r\n\r\n    // 1. Boundary Points (The \"Anchors\" of our elastic malla)\r\n    const boundaryPoints = [];\r\n    const step = 0.05;\r\n    for (let i = 0; i <= 1.0; i += step) {\r\n        boundaryPoints.push({ x: i * targetData.w, y: 0 });\r\n        boundaryPoints.push({ x: i * targetData.w, y: targetData.h });\r\n        boundaryPoints.push({ x: 0, y: i * targetData.h });\r\n        boundaryPoints.push({ x: targetData.w, y: i * targetData.h });\r\n    }\r\n\r\n    for (let iter = 0; iter < iterations; iter++) {\r\n        const correspondences = [];\r\n\r\n        for (const pt of boundaryPoints) {\r\n            // Project\r\n            const w = currentH[6] * pt.x + currentH[7] * pt.y + currentH[8];\r\n            const sx = (currentH[0] * pt.x + currentH[1] * pt.y + currentH[2]) / w;\r\n            const sy = (currentH[3] * pt.x + currentH[4] * pt.y + currentH[5]) / w;\r\n\r\n            if (sx < 2 || sx >= width - 2 || sy < 2 || sy >= height - 2) continue;\r\n\r\n            // 2. Local Gradient Search (The \"Pull\" of the image)\r\n            const searchDist = 10;\r\n            let bestX = sx;\r\n            let bestY = sy;\r\n            let maxGrad = -1;\r\n\r\n            for (let dy = -searchDist; dy <= searchDist; dy += 2) {\r\n                for (let dx = -searchDist; dx <= searchDist; dx += 2) {\r\n                    const nx = Math.floor(sx + dx);\r\n                    const ny = Math.floor(sy + dy);\r\n\r\n                    const idx = ny * width + nx;\r\n                    // Sobel-like gradient magnitude\r\n                    const gx = imageData[idx + 1] - imageData[idx - 1];\r\n                    const gy = imageData[idx + width] - imageData[idx - width];\r\n                    const grad = gx * gx + gy * gy;\r\n\r\n                    if (grad > maxGrad) {\r\n                        maxGrad = grad;\r\n                        bestX = nx;\r\n                        bestY = ny;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (maxGrad > 500) {\r\n                correspondences.push({\r\n                    src: pt,\r\n                    dst: { x: bestX, y: bestY },\r\n                    weight: Math.min(1.0, maxGrad / 15000)\r\n                });\r\n            }\r\n        }\r\n\r\n        if (correspondences.length < 10) break;\r\n\r\n        // 3. Solve for best Homography using SVD\r\n        const nextH = solveDLTWeight(correspondences);\r\n        if (nextH) {\r\n            // Soft-Update (Momentum)\r\n            for (let i = 0; i < 9; i++) {\r\n                currentH[i] = currentH[i] * 0.5 + nextH[i] * 0.5;\r\n            }\r\n        }\r\n    }\r\n\r\n    return currentH;\r\n}\r\n\r\n/**\r\n * Direct Linear Transform with Weights\r\n */\r\nfunction solveDLTWeight(pairs) {\r\n    const n = pairs.length;\r\n    const A = new Matrix(n * 2, 9);\r\n\r\n    for (let i = 0; i < n; i++) {\r\n        const { src, dst, weight: w } = pairs[i];\r\n        const x = src.x;\r\n        const y = src.y;\r\n        const xp = dst.x;\r\n        const yp = dst.y;\r\n\r\n        // Row 1\r\n        A.set(i * 2, 0, 0);\r\n        A.set(i * 2, 1, 0);\r\n        A.set(i * 2, 2, 0);\r\n        A.set(i * 2, 3, -x * w);\r\n        A.set(i * 2, 4, -y * w);\r\n        A.set(i * 2, 5, -w);\r\n        A.set(i * 2, 6, yp * x * w);\r\n        A.set(i * 2, 7, yp * y * w);\r\n        A.set(i * 2, 8, yp * w);\r\n\r\n        // Row 2\r\n        A.set(i * 2 + 1, 0, x * w);\r\n        A.set(i * 2 + 1, 1, y * w);\r\n        A.set(i * 2 + 1, 2, w);\r\n        A.set(i * 2 + 1, 3, 0);\r\n        A.set(i * 2 + 1, 4, 0);\r\n        A.set(i * 2 + 1, 5, 0);\r\n        A.set(i * 2 + 1, 6, -xp * x * w);\r\n        A.set(i * 2 + 1, 7, -xp * y * w);\r\n        A.set(i * 2 + 1, 8, -xp * w);\r\n    }\r\n\r\n    try {\r\n        const svd = new SingularValueDecomposition(A);\r\n        const V = svd.rightSingularVectors;\r\n        // Last column of V is the solution\r\n        const h = V.getColumn(8);\r\n        // Normalize H[8] to 1\r\n        const scale = 1.0 / h[8];\r\n        return h.map(v => v * scale);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n", "import { compute64 as hammingCompute64 } from \"./hamming-distance.js\";\r\nimport { createRandomizer } from \"../utils/randomizer.js\";\r\n\r\nconst MIN_FEATURE_PER_NODE = 32;\r\nconst NUM_ASSIGNMENT_HYPOTHESES = 12;\r\nconst NUM_CENTERS = 8;\r\n\r\nexport function popcount32(n) {\r\n  n = n - ((n >> 1) & 0x55555555);\r\n  n = (n & 0x33333333) + ((n >> 2) & 0x33333333);\r\n  return (((n + (n >> 4)) & 0x0F0F0F0F) * 0x01010101) >> 24;\r\n}\r\n\r\nconst _computeKMedoids = (options) => {\r\n  const { descriptors, pointIndexes, randomizer, useHDC } = options;\r\n  const numPointIndexes = pointIndexes.length;\r\n\r\n  const randomPointIndexes = new Int32Array(numPointIndexes);\r\n  for (let i = 0; i < numPointIndexes; i++) {\r\n    randomPointIndexes[i] = i;\r\n  }\r\n\r\n  let bestSumD = Number.MAX_SAFE_INTEGER;\r\n  let bestAssignment = null;\r\n\r\n  const centerPointIndices = new Int32Array(NUM_CENTERS);\r\n\r\n  for (let i = 0; i < NUM_ASSIGNMENT_HYPOTHESES; i++) {\r\n    randomizer.arrayShuffle({ arr: randomPointIndexes, sampleSize: NUM_CENTERS });\r\n\r\n    for (let k = 0; k < NUM_CENTERS; k++) {\r\n      centerPointIndices[k] = pointIndexes[randomPointIndexes[k]];\r\n    }\r\n\r\n    let sumD = 0;\r\n    const currentAssignment = new Int32Array(numPointIndexes);\r\n\r\n    for (let j = 0; j < numPointIndexes; j++) {\r\n      const pIdx = pointIndexes[j];\r\n\r\n      let bestD = 255;\r\n      let bestCenterIdx = -1;\r\n\r\n      for (let k = 0; k < NUM_CENTERS; k++) {\r\n        const cIdx = centerPointIndices[k];\r\n\r\n        let d;\r\n        if (useHDC) {\r\n          d = popcount32(descriptors[pIdx] ^ descriptors[cIdx]);\r\n        } else {\r\n          d = hammingCompute64(descriptors, pIdx * 2, descriptors, cIdx * 2);\r\n        }\r\n\r\n        if (d < bestD) {\r\n          bestCenterIdx = randomPointIndexes[k];\r\n          bestD = d;\r\n        }\r\n      }\r\n      currentAssignment[j] = bestCenterIdx;\r\n      sumD += bestD;\r\n    }\r\n\r\n    if (sumD < bestSumD) {\r\n      bestSumD = sumD;\r\n      bestAssignment = currentAssignment;\r\n    }\r\n  }\r\n  return bestAssignment;\r\n};\r\n\r\nconst build = ({ points }) => {\r\n  const numPoints = points.length;\r\n  if (numPoints === 0) return { rootNode: { leaf: true, pointIndexes: [], centerPointIndex: null } };\r\n\r\n  const useHDC = points[0] && points[0].hdcSignature !== undefined;\r\n  const descriptors = new Uint32Array(useHDC ? numPoints : numPoints * 2);\r\n\r\n  for (let i = 0; i < numPoints; i++) {\r\n    if (useHDC) {\r\n      descriptors[i] = points[i].hdcSignature;\r\n    } else {\r\n      const d = points[i].descriptors;\r\n      descriptors[i * 2] = d[0];\r\n      descriptors[i * 2 + 1] = d[1];\r\n    }\r\n  }\r\n\r\n  const pointIndexes = new Int32Array(numPoints);\r\n  for (let i = 0; i < numPoints; i++) {\r\n    pointIndexes[i] = i;\r\n  }\r\n\r\n  const randomizer = createRandomizer();\r\n\r\n  const rootNode = _build({\r\n    descriptors,\r\n    pointIndexes,\r\n    centerPointIndex: null,\r\n    randomizer,\r\n    useHDC\r\n  });\r\n  return { rootNode };\r\n};\r\n\r\nconst _build = (options) => {\r\n  const { descriptors, pointIndexes, centerPointIndex, randomizer, useHDC } = options;\r\n  const numPoints = pointIndexes.length;\r\n\r\n  let isLeaf = false;\r\n  if (numPoints <= NUM_CENTERS || numPoints <= MIN_FEATURE_PER_NODE) {\r\n    isLeaf = true;\r\n  }\r\n\r\n  const clusters = new Map();\r\n  if (!isLeaf) {\r\n    const assignment = _computeKMedoids({ descriptors, pointIndexes, randomizer, useHDC });\r\n\r\n    for (let i = 0; i < assignment.length; i++) {\r\n      const centerIdx = pointIndexes[assignment[i]];\r\n      let cluster = clusters.get(centerIdx);\r\n      if (cluster === undefined) {\r\n        cluster = [];\r\n        clusters.set(centerIdx, cluster);\r\n      }\r\n      cluster.push(pointIndexes[i]);\r\n    }\r\n\r\n    if (clusters.size === 1) {\r\n      isLeaf = true;\r\n    }\r\n  }\r\n\r\n  const node = {\r\n    centerPointIndex: centerPointIndex,\r\n  };\r\n\r\n  if (isLeaf) {\r\n    node.leaf = true;\r\n    node.pointIndexes = new Int32Array(pointIndexes);\r\n    return node;\r\n  }\r\n\r\n  node.leaf = false;\r\n  node.children = [];\r\n\r\n  for (const [cIdx, clusterPoints] of clusters) {\r\n    node.children.push(\r\n      _build({\r\n        descriptors,\r\n        pointIndexes: new Int32Array(clusterPoints),\r\n        centerPointIndex: cIdx,\r\n        randomizer,\r\n        useHDC\r\n      }),\r\n    );\r\n  }\r\n  return node;\r\n};\r\n\r\nexport { build };\r\n", "import TinyQueue from \"tinyqueue\";\r\nimport { compute as hammingCompute } from \"./hamming-distance.js\";\r\nimport { computeHoughMatches } from \"./hough.js\";\r\nimport { computeHomography } from \"./ransacHomography.js\";\r\nimport { multiplyPointHomographyInhomogenous, matrixInverse33 } from \"../utils/geometry.js\";\r\nimport { refineWithMorphology } from \"../estimation/morph-refinement.js\";\r\nimport { popcount32 } from \"./hierarchical-clustering.js\";\r\nimport { AR_CONFIG } from \"../constants.js\";\r\n\r\nconst INLIER_THRESHOLD = AR_CONFIG.INLIER_THRESHOLD;\r\nconst MIN_NUM_INLIERS = AR_CONFIG.MIN_NUM_INLIERS;\r\nconst CLUSTER_MAX_POP = AR_CONFIG.CLUSTER_MAX_POP;\r\nconst HAMMING_THRESHOLD = AR_CONFIG.HAMMING_THRESHOLD;\r\nconst HDC_RATIO_THRESHOLD = AR_CONFIG.HDC_RATIO_THRESHOLD;\r\nconst MAX_MATCH_QUERY_POINTS = AR_CONFIG.MAX_MATCH_QUERY_POINTS;\r\n\r\n// match list of querpoints against pre-built list of keyframes\r\nconst match = ({ keyframe, querypoints: rawQuerypoints, querywidth, queryheight, debugMode, expectedScale }) => {\r\n  let debugExtra = {};\r\n\r\n  // \uD83C\uDFAF Performance Optimizer: Use only the most \"salient\" points (highest response)\r\n  const querypoints = rawQuerypoints.length > MAX_MATCH_QUERY_POINTS\r\n    ? [...rawQuerypoints].sort((a, b) => (b.score || b.response || 0) - (a.score || a.response || 0)).slice(0, MAX_MATCH_QUERY_POINTS)\r\n    : rawQuerypoints;\r\n\r\n  const matches = [];\r\n  const qlen = querypoints.length;\r\n  const kmax = keyframe.max;\r\n  const kmin = keyframe.min;\r\n\r\n  // Detect descriptor mode: HDC (32-bit signature), Compact (32-bit XOR folded), or Raw (64-bit)\r\n  const isHDC = keyframe.hdc === true || (kmax && kmax.hdc === 1);\r\n  const isCompact = (kmax && kmax.compact === 1) || (kmin && kmin.compact === 1);\r\n  const descSize = (isHDC || isCompact) ? 1 : 2;  // Compact uses 32-bit like HDC\r\n\r\n  const currentRatioThreshold = isHDC ? HDC_RATIO_THRESHOLD : HAMMING_THRESHOLD;\r\n\r\n  for (let j = 0; j < qlen; j++) {\r\n\r\n    const querypoint = querypoints[j];\r\n    const col = querypoint.maxima ? kmax : kmin;\r\n    if (!col || col.x.length === 0) continue;\r\n\r\n    const rootNode = col.t;\r\n    const keypointIndexes = [];\r\n    const queue = new TinyQueue([], (a1, a2) => a1.d - a2.d);\r\n\r\n    _query({\r\n      node: rootNode,\r\n      descriptors: col.d,\r\n      querypoint,\r\n      queue,\r\n      keypointIndexes,\r\n      numPop: 0,\r\n      isHDC,\r\n      descSize,\r\n      isCompact\r\n    });\r\n\r\n    let bestIndex = -1;\r\n    let bestD1 = Number.MAX_SAFE_INTEGER;\r\n    let bestD2 = Number.MAX_SAFE_INTEGER;\r\n\r\n    const qDesc = querypoint.descriptors;\r\n    const cDesc = col.d;\r\n\r\n    // For compact mode: pre-compute XOR folded query descriptor (64-bit \u2192 32-bit)\r\n    const qDescCompact = isCompact && qDesc && qDesc.length >= 2\r\n      ? (qDesc[0] ^ qDesc[1]) >>> 0\r\n      : 0;\r\n\r\n    for (let k = 0; k < keypointIndexes.length; k++) {\r\n      const idx = keypointIndexes[k];\r\n\r\n      // \uD83D\uDE80 NANITE-STYLE: Dynamic scale filtering\r\n      // If we have an expected scale, skip points that are outside the resolution range\r\n      if (expectedScale !== undefined && col.s) {\r\n        const featureScale = col.s[idx]; // Octave scale (1, 2, 4...)\r\n        const idealKeyScale = (querypoint.scale || 1.0) / expectedScale;\r\n        // allow ~1 octave of margin\r\n        if (featureScale < idealKeyScale * 0.4 || featureScale > idealKeyScale * 2.5) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let d;\r\n      if (isHDC) {\r\n        d = popcount32(cDesc[idx] ^ querypoint.hdcSignature);\r\n      } else if (isCompact) {\r\n        // Compact mode: compare 32-bit XOR folded descriptors\r\n        d = popcount32(cDesc[idx] ^ qDescCompact);\r\n      } else {\r\n        d = hammingCompute({ v1: cDesc, v1Offset: idx * descSize, v2: qDesc });\r\n      }\r\n\r\n      if (d < bestD1) {\r\n        bestD2 = bestD1;\r\n        bestD1 = d;\r\n        bestIndex = idx;\r\n      } else if (d < bestD2) {\r\n        bestD2 = d;\r\n      }\r\n    }\r\n\r\n\r\n    if (bestIndex !== -1) {\r\n      if (bestD2 === Number.MAX_SAFE_INTEGER || (bestD1 / bestD2) < currentRatioThreshold) {\r\n        matches.push({\r\n          querypoint,\r\n          keypoint: {\r\n            x: col.x[bestIndex],\r\n            y: col.y[bestIndex],\r\n            angle: col.a[bestIndex],\r\n            scale: col.s ? col.s[bestIndex] : keyframe.s\r\n          },\r\n          d: bestD1\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  if (matches.length < MIN_NUM_INLIERS) {\r\n    return { debugExtra };\r\n  }\r\n\r\n  // \uD83C\uDF0C Moonshot: Constellation matching disabled for performance calibration\r\n  const constellationMatches = matches;\r\n  if (debugMode) debugExtra.constellationMatches = constellationMatches;\r\n\r\n  const houghMatches = computeHoughMatches({\r\n    keywidth: keyframe.w || keyframe.width,\r\n    keyheight: keyframe.h || keyframe.height,\r\n    querywidth,\r\n    queryheight,\r\n    matches: constellationMatches,\r\n  });\r\n\r\n  if (debugMode) {\r\n    debugExtra.houghMatches = houghMatches;\r\n  }\r\n\r\n  if (houghMatches.length < MIN_NUM_INLIERS) {\r\n    return { debugExtra };\r\n  }\r\n\r\n  const H = computeHomography({\r\n    srcPoints: houghMatches.map((m) => [m.keypoint.x, m.keypoint.y]),\r\n    dstPoints: houghMatches.map((m) => [m.querypoint.x, m.querypoint.y]),\r\n    keyframe: { width: keyframe.w || keyframe.width, height: keyframe.h || keyframe.height },\r\n  });\r\n\r\n  if (H === null) {\r\n    return { debugExtra };\r\n  }\r\n\r\n  const inlierMatches = _findInlierMatches({\r\n    H,\r\n    matches: houghMatches,\r\n    threshold: INLIER_THRESHOLD,\r\n  });\r\n\r\n  if (debugMode) debugExtra.inlierMatches = inlierMatches;\r\n  if (inlierMatches.length < MIN_NUM_INLIERS) {\r\n    return { debugExtra };\r\n  }\r\n\r\n  if (debugMode && Math.random() < 0.02) {\r\n    console.log(`MATCH: Homography success with ${inlierMatches.length} inliers`);\r\n  }\r\n\r\n\r\n  const HInv = matrixInverse33(H, 0.00001);\r\n  const dThreshold2 = 100;\r\n  const matches2 = [];\r\n\r\n  const hi00 = HInv[0], hi01 = HInv[1], hi02 = HInv[2];\r\n  const hi10 = HInv[3], hi11 = HInv[4], hi12 = HInv[5];\r\n  const hi20 = HInv[6], hi21 = HInv[7], hi22 = HInv[8];\r\n\r\n  for (let j = 0; j < qlen; j++) {\r\n    const querypoint = querypoints[j];\r\n    const qx = querypoint.x, qy = querypoint.y;\r\n\r\n    const uz = (qx * hi20) + (qy * hi21) + hi22;\r\n    const invZ = 1.0 / uz;\r\n    const mapX = ((qx * hi00) + (qy * hi01) + hi02) * invZ;\r\n    const mapY = ((qx * hi10) + (qy * hi11) + hi12) * invZ;\r\n\r\n    let bestIndex = -1;\r\n    let bestD1 = Number.MAX_SAFE_INTEGER;\r\n    let bestD2 = Number.MAX_SAFE_INTEGER;\r\n\r\n    const col = querypoint.maxima ? kmax : kmin;\r\n    if (!col) continue;\r\n\r\n    const cx = col.x, cy = col.y, cd = col.d;\r\n    const qDesc = querypoint.descriptors;\r\n\r\n    // For compact mode: XOR fold query descriptor\r\n    const qDescCompact = isCompact && qDesc && qDesc.length >= 2\r\n      ? (qDesc[0] ^ qDesc[1]) >>> 0\r\n      : 0;\r\n\r\n    for (let k = 0, clen = cx.length; k < clen; k++) {\r\n      const dx = cx[k] - mapX;\r\n      const dy = cy[k] - mapY;\r\n      const d2 = dx * dx + dy * dy;\r\n\r\n      if (d2 > dThreshold2) continue;\r\n\r\n      let d;\r\n      if (isHDC) {\r\n        d = popcount32(cd[k] ^ querypoint.hdcSignature);\r\n      } else if (isCompact) {\r\n        d = popcount32(cd[k] ^ qDescCompact);\r\n      } else {\r\n        d = hammingCompute({ v1: cd, v1Offset: k * descSize, v2: qDesc });\r\n      }\r\n\r\n      if (d < bestD1) {\r\n        bestD2 = bestD1;\r\n        bestD1 = d;\r\n        bestIndex = k;\r\n      } else if (d < bestD2) {\r\n        bestD2 = d;\r\n      }\r\n    }\r\n\r\n\r\n    if (\r\n      bestIndex !== -1 &&\r\n      (bestD2 === Number.MAX_SAFE_INTEGER || (bestD1 / bestD2) < currentRatioThreshold)\r\n    ) {\r\n      matches2.push({\r\n        querypoint,\r\n        keypoint: {\r\n          x: col.x[bestIndex],\r\n          y: col.y[bestIndex],\r\n          angle: col.a[bestIndex],\r\n          scale: col.s ? col.s[bestIndex] : keyframe.s\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  if (debugMode) debugExtra.matches2 = matches2;\r\n\r\n  const houghMatches2 = computeHoughMatches({\r\n    keywidth: keyframe.w || keyframe.width,\r\n    keyheight: keyframe.h || keyframe.height,\r\n    querywidth,\r\n    queryheight,\r\n    matches: matches2,\r\n  });\r\n\r\n  if (debugMode) debugExtra.houghMatches2 = houghMatches2;\r\n\r\n  const H2 = computeHomography({\r\n    srcPoints: houghMatches2.map((m) => [m.keypoint.x, m.keypoint.y]),\r\n    dstPoints: houghMatches2.map((m) => [m.querypoint.x, m.querypoint.y]),\r\n    keyframe: { width: keyframe.w || keyframe.width, height: keyframe.h || keyframe.height },\r\n  });\r\n\r\n  if (H2 === null) return { debugExtra };\r\n\r\n  const inlierMatches2 = _findInlierMatches({\r\n    H: H2,\r\n    matches: houghMatches2,\r\n    threshold: INLIER_THRESHOLD,\r\n  });\r\n\r\n  if (debugMode) debugExtra.inlierMatches2 = inlierMatches2;\r\n\r\n  const refinedH = refineWithMorphology({\r\n    imageData: rawQuerypoints[0].imageData,\r\n    width: querywidth,\r\n    height: queryheight,\r\n    targetData: { w: keyframe.w || keyframe.width, h: keyframe.h || keyframe.height },\r\n    initialH: H2,\r\n    iterations: 3\r\n  });\r\n\r\n  return { H: refinedH || H2, matches: inlierMatches2, debugExtra };\r\n};\r\n\r\nconst _query = ({ node, descriptors, querypoint, queue, keypointIndexes, numPop, isHDC, descSize, isCompact }) => {\r\n  const isLeaf = node[0] === 1;\r\n  const childrenOrIndices = node[2];\r\n\r\n  if (isLeaf) {\r\n    for (let i = 0; i < childrenOrIndices.length; i++) {\r\n      keypointIndexes.push(childrenOrIndices[i]);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const qDesc = querypoint.descriptors;\r\n\r\n  // For compact mode: XOR fold query descriptor\r\n  const qDescCompact = isCompact && qDesc && qDesc.length >= 2\r\n    ? (qDesc[0] ^ qDesc[1]) >>> 0\r\n    : 0;\r\n\r\n  let minD = Number.MAX_SAFE_INTEGER;\r\n  const clen = childrenOrIndices.length;\r\n  const distances = new Int32Array(clen);\r\n\r\n  for (let i = 0; i < clen; i++) {\r\n    const childNode = childrenOrIndices[i];\r\n    const cIdx = childNode[1];\r\n\r\n    let d;\r\n    if (isHDC) {\r\n      d = popcount32(descriptors[cIdx] ^ querypoint.hdcSignature);\r\n    } else if (isCompact) {\r\n      d = popcount32(descriptors[cIdx] ^ qDescCompact);\r\n    } else {\r\n      d = hammingCompute({\r\n        v1: descriptors,\r\n        v1Offset: cIdx * descSize,\r\n        v2: qDesc,\r\n      });\r\n    }\r\n    distances[i] = d;\r\n    if (d < minD) minD = d;\r\n  }\r\n\r\n  for (let i = 0; i < clen; i++) {\r\n    const dist = distances[i];\r\n    if (dist <= minD) {\r\n      _query({ node: childrenOrIndices[i], descriptors, querypoint, queue, keypointIndexes, numPop: numPop + 1, isHDC, descSize, isCompact });\r\n    } else {\r\n      queue.push({ node: childrenOrIndices[i], d: dist });\r\n    }\r\n  }\r\n\r\n  if (numPop < CLUSTER_MAX_POP && queue.length > 0) {\r\n    const { node } = queue.pop();\r\n    _query({ node, descriptors, querypoint, queue, keypointIndexes, numPop: numPop + 1, isHDC, descSize, isCompact });\r\n  }\r\n};\r\n\r\n\r\nconst _findInlierMatches = (options) => {\r\n  const { H, matches, threshold } = options;\r\n  const threshold2 = threshold * threshold;\r\n\r\n  const h00 = H[0], h01 = H[1], h02 = H[2];\r\n  const h10 = H[3], h11 = H[4], h12 = H[5];\r\n  const h20 = H[6], h21 = H[7], h22 = H[8];\r\n\r\n  const goodMatches = [];\r\n  for (let i = 0; i < matches.length; i++) {\r\n    const m = matches[i];\r\n    const qp = m.querypoint;\r\n    const kp = m.keypoint;\r\n\r\n    const uz = (kp.x * h20) + (kp.y * h21) + h22;\r\n    const invZ = 1.0 / uz;\r\n    const mx = ((kp.x * h00) + (kp.y * h01) + h02) * invZ;\r\n    const my = ((kp.x * h10) + (kp.y * h11) + h12) * invZ;\r\n\r\n    const dx = mx - qp.x;\r\n    const dy = my - qp.y;\r\n    if (dx * dx + dy * dy <= threshold2) {\r\n      goodMatches.push(m);\r\n    }\r\n  }\r\n  return goodMatches;\r\n};\r\n\r\nconst _applyConstellationFilter = (matches) => {\r\n  const len = matches.length;\r\n  if (len < 3) return matches;\r\n\r\n  const pool = matches.slice().sort((a, b) => a.d - b.d).slice(0, 1500);\r\n\r\n  const RATIO_TOLERANCE = 0.25;\r\n  const COSINE_TOLERANCE = 0.2;\r\n  const MAX_NEIGHBORS = 6;\r\n  const MIN_VERIFICATIONS = 1;\r\n\r\n  const gridSize = 50;\r\n  const grid = new Map();\r\n  const getGridKey = (x, y) => `${Math.floor(x / gridSize)},${Math.floor(y / gridSize)}`;\r\n\r\n  for (let i = 0; i < pool.length; i++) {\r\n    const qp = pool[i].querypoint;\r\n    const key = getGridKey(qp.x, qp.y);\r\n    if (!grid.has(key)) grid.set(key, []);\r\n    grid.get(key).push(i);\r\n  }\r\n\r\n  const scores = new Int32Array(pool.length);\r\n\r\n  for (let i = 0; i < pool.length; i++) {\r\n    const m1 = pool[i];\r\n    const qp1 = m1.querypoint;\r\n\r\n    const neighbors = [];\r\n    const gx = Math.floor(qp1.x / gridSize);\r\n    const gy = Math.floor(qp1.y / gridSize);\r\n\r\n    for (let dx = -1; dx <= 1; dx++) {\r\n      for (let dy = -1; dy <= 1; dy++) {\r\n        const cell = grid.get(`${gx + dx},${gy + dy}`);\r\n        if (!cell) continue;\r\n        for (const idx of cell) {\r\n          if (idx === i) continue;\r\n          const m2 = pool[idx];\r\n          const distSq = Math.pow(m2.querypoint.x - qp1.x, 2) + Math.pow(m2.querypoint.y - qp1.y, 2);\r\n          neighbors.push({ index: idx, d2: distSq });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const filtered = [];\r\n  // Dummy logic just to keep the structure\r\n  for (let i = 0; i < pool.length; i++) {\r\n    filtered.push(pool[i]);\r\n  }\r\n  return filtered;\r\n};\r\n\r\nconst _checkTriadConsistency = (m1, m2, m3, ratioTol, cosTol) => {\r\n  const q1x = m1.querypoint.x, q1y = m1.querypoint.y;\r\n  const q2x = m2.querypoint.x, q2y = m2.querypoint.y;\r\n  const q3x = m3.querypoint.x, q3y = m3.querypoint.y;\r\n\r\n  const v21q = [q2x - q1x, q2y - q1y];\r\n  const v31q = [q3x - q1x, q3y - q1y];\r\n\r\n  const k1x = m1.keypoint.x, k1y = m1.keypoint.y;\r\n  const k2x = m2.keypoint.x, k2y = m2.keypoint.y;\r\n  const k3x = m3.keypoint.x, k3y = m3.keypoint.y;\r\n\r\n  const v21k = [k2x - k1x, k2y - k1y];\r\n  const v31k = [k3x - k1x, k3y - k1y];\r\n\r\n  const d21q2 = v21q[0] * v21q[0] + v21q[1] * v21q[1];\r\n  const d31q2 = v31q[0] * v31q[0] + v31q[1] * v31q[1];\r\n  const d21k2 = v21k[0] * v21k[0] + v21k[1] * v21k[1];\r\n  const d31k2 = v31k[0] * v31k[0] + v31k[1] * v31k[1];\r\n\r\n  if (d31q2 < 1e-4 || d31k2 < 1e-4) return false;\r\n\r\n  const ratioQ = d21q2 / d31q2;\r\n  const ratioK = d21k2 / d31k2;\r\n\r\n  if (Math.abs(ratioQ - ratioK) / (ratioK + 1e-6) > ratioTol * 2) return false;\r\n\r\n  const dotQ = v21q[0] * v31q[0] + v21q[1] * v31q[1];\r\n  const cosQ = dotQ / Math.sqrt(d21q2 * d31q2);\r\n\r\n  const dotK = v21k[0] * v31k[0] + v21k[1] * v31k[1];\r\n  const cosK = dotK / Math.sqrt(d21k2 * d31k2);\r\n\r\n  if (Math.abs(cosQ - cosK) > cosTol) return false;\r\n\r\n  const crossQ = v21q[0] * v31q[1] - v21q[1] * v31q[0];\r\n  const crossK = v21k[0] * v31k[1] - v21k[1] * v31k[0];\r\n\r\n  if ((crossQ > 0) !== (crossK > 0)) return false;\r\n\r\n  return true;\r\n};\r\n\r\nexport { match };\r\n", "import { match } from \"./matching.js\";\r\n\r\nclass Matcher {\r\n  constructor(queryWidth, queryHeight, debugMode = false) {\r\n    this.queryWidth = queryWidth;\r\n    this.queryHeight = queryHeight;\r\n    this.debugMode = debugMode;\r\n  }\r\n\r\n  matchDetection(keyframes, featurePoints, expectedScale) {\r\n    let debugExtra = { frames: [] };\r\n    let bestResult = null;\r\n\r\n    // keyframes is actually the matchingData array for a single target\r\n    if (!keyframes || !Array.isArray(keyframes)) {\r\n      return { targetIndex: -1, keyframeIndex: -1, debugExtra };\r\n    }\r\n\r\n    for (let j = 0; j < keyframes.length; j++) {\r\n      const {\r\n        H,\r\n        matches,\r\n        debugExtra: frameDebugExtra,\r\n      } = match({\r\n        keyframe: keyframes[j],\r\n        querypoints: featurePoints,\r\n        querywidth: this.queryWidth,\r\n        queryheight: this.queryHeight,\r\n        debugMode: this.debugMode,\r\n        expectedScale,\r\n      });\r\n\r\n      if (frameDebugExtra) {\r\n        frameDebugExtra.keyframeIndex = j;\r\n        debugExtra.frames.push(frameDebugExtra);\r\n      }\r\n\r\n      if (H) {\r\n        if (bestResult === null || bestResult.matches.length < matches.length) {\r\n          bestResult = { keyframeIndex: j, H, matches };\r\n        }\r\n      }\r\n    }\r\n\r\n    if (bestResult === null) {\r\n      return { targetIndex: -1, keyframeIndex: -1, debugExtra };\r\n    }\r\n\r\n    const screenCoords = [];\r\n    const worldCoords = [];\r\n    const keyframe = keyframes[bestResult.keyframeIndex];\r\n    const kfScale = keyframe.s || keyframe.scale || 1.0;\r\n\r\n    for (let i = 0; i < bestResult.matches.length; i++) {\r\n      const querypoint = bestResult.matches[i].querypoint;\r\n      const keypoint = bestResult.matches[i].keypoint;\r\n      // \uD83D\uDE80 NANITE-STYLE: Use per-keypoint scale (octave) for accurate world mapping\r\n      const pointScale = keypoint.scale || kfScale;\r\n\r\n      screenCoords.push({\r\n        x: querypoint.x,\r\n        y: querypoint.y,\r\n      });\r\n      worldCoords.push({\r\n        x: (keypoint.x + 0.5) / kfScale,\r\n        y: (keypoint.y + 0.5) / kfScale,\r\n        z: 0,\r\n      });\r\n    }\r\n    return {\r\n      screenCoords,\r\n      worldCoords,\r\n      targetIndex: -1, // Caller knows the targetIndex\r\n      keyframeIndex: bestResult.keyframeIndex,\r\n      H: bestResult.H,\r\n      debugExtra\r\n    };\r\n  }\r\n}\r\n\r\nexport { Matcher };\r\n", "/**\r\n * Direct PnP (Perspective-n-Point) Solver for Planar Targets\r\n * \r\n * This Moonshot algorithm ignores octave-relative scales and works \r\n * purely in Physical World Units. It uses the Camera Matrix (K) \r\n * to deduce the real-world distance (Z).\r\n */\r\n\r\nimport { Matrix, SingularValueDecomposition } from \"ml-matrix\";\r\n\r\nexport function solvePosePnP({\r\n    screenCoords,\r\n    worldCoords,\r\n    projectionTransform\r\n}) {\r\n    const K = new Matrix(projectionTransform);\r\n    const n = screenCoords.length;\r\n\r\n    // 1. Build the DLT matrix for Pose (Directly estimating [R|t])\r\n    // We assume worldCoords are [X, Y, 0]\r\n    // Eq: x = K * [R|t] * X\r\n    // K^-1 * x = [r1 r2 t] * [X Y 1]^T\r\n\r\n    const KI = Inverse3x3(projectionTransform);\r\n\r\n    const A = new Matrix(n * 2, 9);\r\n    for (let i = 0; i < n; i++) {\r\n        const sci = screenCoords[i];\r\n        const wci = worldCoords[i];\r\n\r\n        // Normalized camera coordinates\r\n        const nx = KI[0] * sci.x + KI[1] * sci.y + KI[2];\r\n        const ny = KI[3] * sci.x + KI[4] * sci.y + KI[5];\r\n        const nz = KI[6] * sci.x + KI[7] * sci.y + KI[8];\r\n        const unx = nx / nz;\r\n        const uny = ny / nz;\r\n\r\n        // DLT equations for [r11 r12 r21 r22 r31 r32 t1 t2 t3]\r\n        const X = wci.x;\r\n        const Y = wci.y;\r\n\r\n        // Row 1: X*r11 + Y*r12 + t1 - unx*(X*r31 + Y*r32 + t3) = 0\r\n        A.set(i * 2, 0, X);\r\n        A.set(i * 2, 1, Y);\r\n        A.set(i * 2, 2, 1);\r\n        A.set(i * 2, 3, 0);\r\n        A.set(i * 2, 4, 0);\r\n        A.set(i * 2, 5, 0);\r\n        A.set(i * 2, 6, -unx * X);\r\n        A.set(i * 2, 7, -unx * Y);\r\n        A.set(i * 2, 8, -unx);\r\n\r\n        // Row 2: X*r21 + Y*r22 + t2 - uny*(X*r31 + Y*r32 + t3) = 0\r\n        A.set(i * 2 + 1, 0, 0);\r\n        A.set(i * 2 + 1, 1, 0);\r\n        A.set(i * 2 + 1, 2, 0);\r\n        A.set(i * 2 + 1, 3, X);\r\n        A.set(i * 2 + 1, 4, Y);\r\n        A.set(i * 2 + 1, 5, 1);\r\n        A.set(i * 2 + 1, 6, -uny * X);\r\n        A.set(i * 2 + 1, 7, -uny * Y);\r\n        A.set(i * 2 + 1, 8, -uny);\r\n    }\r\n\r\n    // Solve via SVD\r\n    const svd = new SingularValueDecomposition(A);\r\n    const V = svd.rightSingularVectors;\r\n    const sol = V.getColumn(8); // last column\r\n\r\n    // 3. Extract r1, r2 and t from the DLT solution\r\n    // Standard DLT has an overall sign ambiguity. We force sol[8] (t3) to be positive.\r\n    if (sol[8] < 0) {\r\n        for (let i = 0; i < 9; i++) sol[i] = -sol[i];\r\n    }\r\n\r\n    const r1_raw = [sol[0], sol[3], sol[6]];\r\n    const r2_raw = [sol[1], sol[4], sol[7]];\r\n    const t_raw = [sol[2], sol[5], sol[8]];\r\n\r\n    const scale1 = Math.sqrt(r1_raw[0] ** 2 + r1_raw[1] ** 2 + r1_raw[2] ** 2);\r\n    const scale2 = Math.sqrt(r2_raw[0] ** 2 + r2_raw[1] ** 2 + r2_raw[2] ** 2);\r\n    const scale = (scale1 + scale2) / 2;\r\n\r\n    // 4. Construct Rotation Matrix and orthogonalize via SVD\r\n    const R_approx = new Matrix([\r\n        [r1_raw[0] / scale1, r2_raw[0] / scale2, 0],\r\n        [r1_raw[1] / scale1, r2_raw[1] / scale2, 0],\r\n        [r1_raw[2] / scale1, r2_raw[2] / scale2, 0]\r\n    ]);\r\n\r\n    // R3 = R1 x R2\r\n    R_approx.set(0, 2, R_approx.get(1, 0) * R_approx.get(2, 1) - R_approx.get(2, 0) * R_approx.get(1, 1));\r\n    R_approx.set(1, 2, R_approx.get(2, 0) * R_approx.get(0, 1) - R_approx.get(0, 0) * R_approx.get(2, 1));\r\n    R_approx.set(2, 2, R_approx.get(0, 0) * R_approx.get(1, 1) - R_approx.get(1, 0) * R_approx.get(0, 1));\r\n\r\n    const svdRot = new SingularValueDecomposition(R_approx);\r\n    const U = svdRot.leftSingularVectors;\r\n    const Vrot = svdRot.rightSingularVectors;\r\n    let R = U.mmul(Vrot.transpose());\r\n\r\n    const getDet3 = (m) => {\r\n        return m.get(0, 0) * (m.get(1, 1) * m.get(2, 2) - m.get(1, 2) * m.get(2, 1)) -\r\n            m.get(0, 1) * (m.get(1, 0) * m.get(2, 2) - m.get(1, 2) * m.get(2, 0)) +\r\n            m.get(0, 2) * (m.get(1, 0) * m.get(2, 1) - m.get(1, 1) * m.get(2, 0));\r\n    };\r\n\r\n    if (getDet3(R) < 0) {\r\n        const U_mat = U.clone();\r\n        for (let i = 0; i < 3; i++) U_mat.set(i, 2, -U_mat.get(i, 2));\r\n        R = U_mat.mmul(Vrot.transpose());\r\n    }\r\n\r\n    return [\r\n        [R.get(0, 0), R.get(0, 1), R.get(0, 2), t_raw[0] / scale],\r\n        [R.get(1, 0), R.get(1, 1), R.get(1, 2), t_raw[1] / scale],\r\n        [R.get(2, 0), R.get(2, 1), R.get(2, 2), t_raw[2] / scale]\r\n    ];\r\n}\r\n\r\nfunction Inverse3x3(m) {\r\n    const k00 = m[0][0], k01 = m[0][1], k02 = m[0][2];\r\n    const k10 = m[1][0], k11 = m[1][1], k12 = m[1][2];\r\n    const k20 = m[2][0], k21 = m[2][1], k22 = m[2][2];\r\n    const det = k00 * (k11 * k22 - k21 * k12) - k01 * (k10 * k22 - k12 * k20) + k02 * (k10 * k21 - k11 * k20);\r\n    const invDet = 1.0 / det;\r\n    return [\r\n        (k11 * k22 - k12 * k21) * invDet, (k02 * k21 - k01 * k22) * invDet, (k01 * k12 - k02 * k11) * invDet,\r\n        (k12 * k20 - k10 * k22) * invDet, (k00 * k22 - k02 * k20) * invDet, (k10 * k02 - k00 * k12) * invDet,\r\n        (k10 * k21 - k11 * k20) * invDet, (k20 * k01 - k21 * k00) * invDet, (k00 * k11 - k10 * k01) * invDet\r\n    ];\r\n}\r\n", "import { solvePosePnP } from \"./pnp-solver.js\";\r\n\r\n/**\r\n * \uD83D\uDE80 MOONSHOT: Direct PnP Solver for AR\r\n * \r\n * Instead of estimating a 2D Homography and decomposing it, \r\n * we solve for the 3D Pose [R|t] directly using the \r\n * Perspective-n-Point algorithm.\r\n */\r\nconst estimate = ({ screenCoords, worldCoords, projectionTransform }) => {\r\n  return solvePosePnP({\r\n    screenCoords,\r\n    worldCoords,\r\n    projectionTransform\r\n  });\r\n};\r\n\r\nexport { estimate };\r\n", "import { Matrix, inverse } from \"ml-matrix\";\r\nimport {\r\n  applyModelViewProjectionTransform,\r\n  buildModelViewProjectionTransform,\r\n  computeScreenCoordiate,\r\n} from \"./utils.js\";\r\n\r\nconst TRACKING_THRESH = 5.0; // default\r\nconst K2_FACTOR = 4.0; // Question: should it be relative to the size of the screen instead of hardcoded?\r\nconst ICP_MAX_LOOP = 10;\r\nconst ICP_BREAK_LOOP_ERROR_THRESH = 0.1;\r\nconst ICP_BREAK_LOOP_ERROR_RATIO_THRESH = 0.99;\r\n\r\n// some temporary/intermediate variables used later. Declare them beforehand to reduce new object allocations\r\nlet mat = [[], [], []];\r\nlet J_U_Xc = [[], []]; // 2x3\r\nlet J_Xc_S = [[], [], []]; // 3x6\r\n\r\nconst refineEstimate = ({\r\n  initialModelViewTransform,\r\n  projectionTransform,\r\n  worldCoords,\r\n  screenCoords,\r\n  stabilities, // Stability-based weighting\r\n}) => {\r\n  // Question: shall we normlize the screen coords as well?\r\n  // Question: do we need to normlize the scale as well, i.e. make coords from -1 to 1\r\n  //\r\n  // normalize world coords - reposition them to center of mass\r\n  //   assume z coordinate is always zero (in our case, the image target is planar with z = 0\r\n  let dx = 0;\r\n  let dy = 0;\r\n  for (let i = 0; i < worldCoords.length; i++) {\r\n    dx += worldCoords[i].x;\r\n    dy += worldCoords[i].y;\r\n  }\r\n  dx /= worldCoords.length;\r\n  dy /= worldCoords.length;\r\n\r\n  const normalizedWorldCoords = [];\r\n  for (let i = 0; i < worldCoords.length; i++) {\r\n    normalizedWorldCoords.push({\r\n      x: worldCoords[i].x - dx,\r\n      y: worldCoords[i].y - dy,\r\n      z: worldCoords[i].z,\r\n    });\r\n  }\r\n\r\n  const diffModelViewTransform = [[], [], []];\r\n  for (let j = 0; j < 3; j++) {\r\n    for (let i = 0; i < 3; i++) {\r\n      diffModelViewTransform[j][i] = initialModelViewTransform[j][i];\r\n    }\r\n  }\r\n  diffModelViewTransform[0][3] =\r\n    initialModelViewTransform[0][0] * dx +\r\n    initialModelViewTransform[0][1] * dy +\r\n    initialModelViewTransform[0][3];\r\n  diffModelViewTransform[1][3] =\r\n    initialModelViewTransform[1][0] * dx +\r\n    initialModelViewTransform[1][1] * dy +\r\n    initialModelViewTransform[1][3];\r\n  diffModelViewTransform[2][3] =\r\n    initialModelViewTransform[2][0] * dx +\r\n    initialModelViewTransform[2][1] * dy +\r\n    initialModelViewTransform[2][3];\r\n\r\n  // use iterative closest point algorithm to refine the modelViewTransform\r\n  const inlierProbs = [1.0, 0.8, 0.6, 0.4, 0.0];\r\n  let updatedModelViewTransform = diffModelViewTransform; // iteratively update this transform\r\n  let finalModelViewTransform = null;\r\n  for (let i = 0; i < inlierProbs.length; i++) {\r\n    const ret = _doICP({\r\n      initialModelViewTransform: updatedModelViewTransform,\r\n      projectionTransform,\r\n      worldCoords: normalizedWorldCoords,\r\n      screenCoords,\r\n      stabilities, // Pass weights to ICP\r\n      inlierProb: inlierProbs[i],\r\n    });\r\n\r\n    updatedModelViewTransform = ret.modelViewTransform;\r\n\r\n    //console.log(\"err\", ret.err);\r\n\r\n    if (ret.err < TRACKING_THRESH) {\r\n      finalModelViewTransform = updatedModelViewTransform;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (finalModelViewTransform === null) return null;\r\n\r\n  // de-normalize\r\n  finalModelViewTransform[0][3] =\r\n    finalModelViewTransform[0][3] -\r\n    finalModelViewTransform[0][0] * dx -\r\n    finalModelViewTransform[0][1] * dy;\r\n  finalModelViewTransform[1][3] =\r\n    finalModelViewTransform[1][3] -\r\n    finalModelViewTransform[1][0] * dx -\r\n    finalModelViewTransform[1][1] * dy;\r\n  finalModelViewTransform[2][3] =\r\n    finalModelViewTransform[2][3] -\r\n    finalModelViewTransform[2][0] * dx -\r\n    finalModelViewTransform[2][1] * dy;\r\n\r\n  return finalModelViewTransform;\r\n};\r\n\r\n// ICP iteration\r\n// Question: can someone provide theoretical reference / mathematical proof for the following computations?\r\nconst _doICP = ({\r\n  initialModelViewTransform,\r\n  projectionTransform,\r\n  worldCoords,\r\n  screenCoords,\r\n  stabilities,\r\n  inlierProb,\r\n}) => {\r\n  const isRobustMode = inlierProb < 1;\r\n\r\n  let modelViewTransform = initialModelViewTransform;\r\n\r\n  let err0 = 0.0;\r\n  let err1 = 0.0;\r\n\r\n  let E = new Array(worldCoords.length);\r\n  let E2 = new Array(worldCoords.length);\r\n  let dxs = new Array(worldCoords.length);\r\n  let dys = new Array(worldCoords.length);\r\n\r\n  for (let l = 0; l <= ICP_MAX_LOOP; l++) {\r\n    const modelViewProjectionTransform = buildModelViewProjectionTransform(\r\n      projectionTransform,\r\n      modelViewTransform,\r\n    );\r\n\r\n    for (let n = 0; n < worldCoords.length; n++) {\r\n      const u = computeScreenCoordiate(\r\n        modelViewProjectionTransform,\r\n        worldCoords[n].x,\r\n        worldCoords[n].y,\r\n        worldCoords[n].z,\r\n      );\r\n      const dx = screenCoords[n].x - u.x;\r\n      const dy = screenCoords[n].y - u.y;\r\n\r\n      dxs[n] = dx;\r\n      dys[n] = dy;\r\n      E[n] = dx * dx + dy * dy;\r\n    }\r\n\r\n    let K2; // robust mode only\r\n    err1 = 0.0;\r\n    if (isRobustMode) {\r\n      const inlierNum = Math.max(3, Math.floor(worldCoords.length * inlierProb) - 1);\r\n      for (let n = 0; n < worldCoords.length; n++) {\r\n        E2[n] = E[n];\r\n      }\r\n      E2.sort((a, b) => {\r\n        return a - b;\r\n      });\r\n\r\n      K2 = Math.max(E2[inlierNum] * K2_FACTOR, 16.0);\r\n      for (let n = 0; n < worldCoords.length; n++) {\r\n        if (E2[n] > K2) err1 += K2 / 6;\r\n        else\r\n          err1 += (K2 / 6.0) * (1.0 - (1.0 - E2[n] / K2) * (1.0 - E2[n] / K2) * (1.0 - E2[n] / K2));\r\n      }\r\n    } else {\r\n      for (let n = 0; n < worldCoords.length; n++) {\r\n        err1 += E[n];\r\n      }\r\n    }\r\n    err1 /= worldCoords.length;\r\n\r\n    //console.log(\"icp loop\", inlierProb, l, err1);\r\n\r\n    if (err1 < ICP_BREAK_LOOP_ERROR_THRESH) break;\r\n    //if (l > 0 && err1 < ICP_BREAK_LOOP_ERROR_THRESH2 && err1/err0 > ICP_BREAK_LOOP_ERROR_RATIO_THRESH) break;\r\n    if (l > 0 && err1 / err0 > ICP_BREAK_LOOP_ERROR_RATIO_THRESH) break;\r\n    if (l === ICP_MAX_LOOP) break;\r\n\r\n    err0 = err1;\r\n\r\n    const dU = [];\r\n    const allJ_U_S = [];\r\n    for (let n = 0; n < worldCoords.length; n++) {\r\n      if (isRobustMode && E[n] > K2) {\r\n        continue;\r\n      }\r\n\r\n      const J_U_S = _getJ_U_S({\r\n        modelViewProjectionTransform,\r\n        modelViewTransform,\r\n        projectionTransform,\r\n        worldCoord: worldCoords[n],\r\n      });\r\n\r\n      if (isRobustMode) {\r\n        const robustW = (1.0 - E[n] / K2) * (1.0 - E[n] / K2);\r\n\r\n        // Log-weighted stability: suppresses vibrators aggressively but allows recovery\r\n        const s = stabilities ? stabilities[n] : 1.0;\r\n        const stabilityW = s * Math.log10(9 * s + 1);\r\n\r\n        const W = robustW * stabilityW;\r\n\r\n        for (let j = 0; j < 2; j++) {\r\n          for (let i = 0; i < 6; i++) {\r\n            J_U_S[j][i] *= W;\r\n          }\r\n        }\r\n        dU.push([dxs[n] * W]);\r\n        dU.push([dys[n] * W]);\r\n      } else {\r\n        const s = stabilities ? stabilities[n] : 1.0;\r\n        const W = s * Math.log10(9 * s + 1);\r\n\r\n        for (let j = 0; j < 2; j++) {\r\n          for (let i = 0; i < 6; i++) {\r\n            J_U_S[j][i] *= W;\r\n          }\r\n        }\r\n        dU.push([dxs[n] * W]);\r\n        dU.push([dys[n] * W]);\r\n      }\r\n\r\n      for (let i = 0; i < J_U_S.length; i++) {\r\n        allJ_U_S.push(J_U_S[i]);\r\n      }\r\n    }\r\n\r\n    const dS = _getDeltaS({ dU, J_U_S: allJ_U_S });\r\n    if (dS === null) break;\r\n\r\n    modelViewTransform = _updateModelViewTransform({ modelViewTransform, dS });\r\n  }\r\n  return { modelViewTransform, err: err1 };\r\n};\r\n\r\nconst _updateModelViewTransform = ({ modelViewTransform, dS }) => {\r\n  /**\r\n   * dS has 6 paragrams, first half is rotation, second half is translation\r\n   * rotation is expressed in angle-axis,\r\n   *   [S[0], S[1] ,S[2]] is the axis of rotation, and the magnitude is the angle\r\n   */\r\n  let ra = dS[0] * dS[0] + dS[1] * dS[1] + dS[2] * dS[2];\r\n  let q0, q1, q2;\r\n  if (ra < 0.000001) {\r\n    q0 = 1.0;\r\n    q1 = 0.0;\r\n    q2 = 0.0;\r\n    ra = 0.0;\r\n  } else {\r\n    ra = Math.sqrt(ra);\r\n    q0 = dS[0] / ra;\r\n    q1 = dS[1] / ra;\r\n    q2 = dS[2] / ra;\r\n  }\r\n\r\n  const cra = Math.cos(ra);\r\n  const sra = Math.sin(ra);\r\n  const one_cra = 1.0 - cra;\r\n\r\n  // mat is [R|t], 3D rotation and translation\r\n  mat[0][0] = q0 * q0 * one_cra + cra;\r\n  mat[0][1] = q0 * q1 * one_cra - q2 * sra;\r\n  mat[0][2] = q0 * q2 * one_cra + q1 * sra;\r\n  mat[0][3] = dS[3];\r\n  mat[1][0] = q1 * q0 * one_cra + q2 * sra;\r\n  mat[1][1] = q1 * q1 * one_cra + cra;\r\n  mat[1][2] = q1 * q2 * one_cra - q0 * sra;\r\n  mat[1][3] = dS[4];\r\n  mat[2][0] = q2 * q0 * one_cra - q1 * sra;\r\n  mat[2][1] = q2 * q1 * one_cra + q0 * sra;\r\n  mat[2][2] = q2 * q2 * one_cra + cra;\r\n  mat[2][3] = dS[5];\r\n\r\n  // the updated transform is the original transform x delta transform\r\n  const mat2 = [[], [], []];\r\n  for (let j = 0; j < 3; j++) {\r\n    for (let i = 0; i < 4; i++) {\r\n      mat2[j][i] =\r\n        modelViewTransform[j][0] * mat[0][i] +\r\n        modelViewTransform[j][1] * mat[1][i] +\r\n        modelViewTransform[j][2] * mat[2][i];\r\n    }\r\n    mat2[j][3] += modelViewTransform[j][3];\r\n  }\r\n  return mat2;\r\n};\r\n\r\nconst _getDeltaS = ({ dU, J_U_S }) => {\r\n  const J = new Matrix(J_U_S);\r\n  const U = new Matrix(dU);\r\n\r\n  const JT = J.transpose();\r\n  const JTJ = JT.mmul(J);\r\n  const JTU = JT.mmul(U);\r\n\r\n  let JTJInv;\r\n  try {\r\n    JTJInv = inverse(JTJ);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n\r\n  const S = JTJInv.mmul(JTU);\r\n  return S.to1DArray();\r\n};\r\n\r\nconst _getJ_U_S = ({\r\n  modelViewProjectionTransform,\r\n  modelViewTransform,\r\n  projectionTransform,\r\n  worldCoord,\r\n}) => {\r\n  const T = modelViewTransform;\r\n  const { x, y, z } = worldCoord;\r\n\r\n  const u = applyModelViewProjectionTransform(modelViewProjectionTransform, x, y, z);\r\n\r\n  const z2 = u.z * u.z;\r\n  // Question: This is the most confusing matrix to me. I've no idea how to derive this.\r\n  //J_U_Xc[0][0] = (projectionTransform[0][0] * u.z - projectionTransform[2][0] * u.x) / z2;\r\n  //J_U_Xc[0][1] = (projectionTransform[0][1] * u.z - projectionTransform[2][1] * u.x) / z2;\r\n  //J_U_Xc[0][2] = (projectionTransform[0][2] * u.z - projectionTransform[2][2] * u.x) / z2;\r\n  //J_U_Xc[1][0] = (projectionTransform[1][0] * u.z - projectionTransform[2][0] * u.y) / z2;\r\n  //J_U_Xc[1][1] = (projectionTransform[1][1] * u.z - projectionTransform[2][1] * u.y) / z2;\r\n  //J_U_Xc[1][2] = (projectionTransform[1][2] * u.z - projectionTransform[2][2] * u.y) / z2;\r\n\r\n  // The above is the original implementation, but simplify to below becuase projetionTransform[2][0] and [2][1] are zero\r\n  J_U_Xc[0][0] = (projectionTransform[0][0] * u.z) / z2;\r\n  J_U_Xc[0][1] = (projectionTransform[0][1] * u.z) / z2;\r\n  J_U_Xc[0][2] = (projectionTransform[0][2] * u.z - projectionTransform[2][2] * u.x) / z2;\r\n  J_U_Xc[1][0] = (projectionTransform[1][0] * u.z) / z2;\r\n  J_U_Xc[1][1] = (projectionTransform[1][1] * u.z) / z2;\r\n  J_U_Xc[1][2] = (projectionTransform[1][2] * u.z - projectionTransform[2][2] * u.y) / z2;\r\n\r\n  /*\r\n    J_Xc_S should be like this, but z is zero, so we can simplify\r\n    [T[0][2] * y - T[0][1] * z, T[0][0] * z - T[0][2] * x, T[0][1] * x - T[0][0] * y, T[0][0], T[0][1], T[0][2]],\r\n    [T[1][2] * y - T[1][1] * z, T[1][0] * z - T[1][2] * x, T[1][1] * x - T[1][0] * y, T[1][0], T[1][1], T[1][2]],\r\n    [T[2][2] * y - T[2][1] * z, T[2][0] * z - T[2][2] * x, T[2][1] * x - T[2][0] * y, T[2][0], T[2][1], T[2][2]],\r\n  */\r\n  J_Xc_S[0][0] = T[0][2] * y;\r\n  J_Xc_S[0][1] = -T[0][2] * x;\r\n  J_Xc_S[0][2] = T[0][1] * x - T[0][0] * y;\r\n  J_Xc_S[0][3] = T[0][0];\r\n  J_Xc_S[0][4] = T[0][1];\r\n  J_Xc_S[0][5] = T[0][2];\r\n\r\n  J_Xc_S[1][0] = T[1][2] * y;\r\n  J_Xc_S[1][1] = -T[1][2] * x;\r\n  J_Xc_S[1][2] = T[1][1] * x - T[1][0] * y;\r\n  J_Xc_S[1][3] = T[1][0];\r\n  J_Xc_S[1][4] = T[1][1];\r\n  J_Xc_S[1][5] = T[1][2];\r\n\r\n  J_Xc_S[2][0] = T[2][2] * y;\r\n  J_Xc_S[2][1] = -T[2][2] * x;\r\n  J_Xc_S[2][2] = T[2][1] * x - T[2][0] * y;\r\n  J_Xc_S[2][3] = T[2][0];\r\n  J_Xc_S[2][4] = T[2][1];\r\n  J_Xc_S[2][5] = T[2][2];\r\n\r\n  const J_U_S = [[], []];\r\n  for (let j = 0; j < 2; j++) {\r\n    for (let i = 0; i < 6; i++) {\r\n      J_U_S[j][i] = 0.0;\r\n      for (let k = 0; k < 3; k++) {\r\n        J_U_S[j][i] += J_U_Xc[j][k] * J_Xc_S[k][i];\r\n      }\r\n    }\r\n  }\r\n  return J_U_S;\r\n};\r\n\r\nexport { refineEstimate };\r\n", "import { estimate } from \"./estimate.js\";\r\nimport { refineEstimate } from \"./refine-estimate.js\";\r\n\r\nclass Estimator {\r\n  constructor(projectionTransform) {\r\n    this.projectionTransform = projectionTransform;\r\n  }\r\n\r\n  // Solve homography between screen points and world points using Direct Linear Transformation\r\n  // then decompose homography into rotation and translation matrix (i.e. modelViewTransform)\r\n  estimate({ screenCoords, worldCoords }) {\r\n    const modelViewTransform = estimate({\r\n      screenCoords,\r\n      worldCoords,\r\n      projectionTransform: this.projectionTransform,\r\n    });\r\n    return modelViewTransform;\r\n  }\r\n\r\n  // Given an initial guess of the modelViewTransform and new pairs of screen-world coordinates,\r\n  // use Iterative Closest Point to refine the transformation\r\n  //refineEstimate({initialModelViewTransform, screenCoords, worldCoords}) {\r\n  refineEstimate({ initialModelViewTransform, worldCoords, screenCoords }) {\r\n    const updatedModelViewTransform = refineEstimate({\r\n      initialModelViewTransform,\r\n      worldCoords,\r\n      screenCoords,\r\n      projectionTransform: this.projectionTransform,\r\n    });\r\n    return updatedModelViewTransform;\r\n  }\r\n}\r\n\r\nexport { Estimator };\r\n", "import { Matcher } from \"../core/matching/matcher.js\";\r\nimport { Estimator } from \"../core/estimation/estimator.js\";\r\nimport { Tracker } from \"../core/tracker/tracker.js\";\r\nimport { DetectorLite } from \"../core/detector/detector-lite.js\";\r\n\r\nlet matchingDataList = null;\r\nlet debugMode = false;\r\nlet matcher = null;\r\nlet estimator = null;\r\nlet tracker = null;\r\nlet detector = null;\r\n\r\nonmessage = (msg) => {\r\n  const { data } = msg;\r\n\r\n  switch (data.type) {\r\n    case \"setup\":\r\n      matchingDataList = data.matchingDataList;\r\n      debugMode = data.debugMode;\r\n      matcher = new Matcher(data.inputWidth, data.inputHeight, debugMode);\r\n      estimator = new Estimator(data.projectionTransform);\r\n\r\n      if (data.trackingDataList && data.markerDimensions) {\r\n        tracker = new Tracker(\r\n          data.markerDimensions,\r\n          data.trackingDataList,\r\n          data.projectionTransform,\r\n          data.inputWidth,\r\n          data.inputHeight,\r\n          debugMode\r\n        );\r\n      }\r\n\r\n      detector = new DetectorLite(data.inputWidth, data.inputHeight, {\r\n        useLSH: true,\r\n        maxFeaturesPerBucket: 24\r\n      });\r\n      break;\r\n\r\n    case \"match\":\r\n      const interestedTargetIndexes = data.targetIndexes;\r\n\r\n      let matchedTargetIndex = -1;\r\n      let matchedModelViewTransform = null;\r\n      let matchedScreenCoords = null;\r\n      let matchedWorldCoords = null;\r\n      let matchedDebugExtra = null;\r\n\r\n      // New: If the worker received image data, run detector here too\r\n      let featurePoints = data.featurePoints;\r\n      if (data.inputData) {\r\n        const detectionResult = detector.detect(data.inputData, { octavesToProcess: data.octavesToProcess });\r\n        featurePoints = detectionResult.featurePoints;\r\n      }\r\n\r\n      for (let i = 0; i < interestedTargetIndexes.length; i++) {\r\n        const matchingIndex = interestedTargetIndexes[i];\r\n\r\n        const { keyframeIndex, screenCoords, worldCoords, debugExtra } = matcher.matchDetection(\r\n          matchingDataList[matchingIndex],\r\n          featurePoints,\r\n          data.expectedScale\r\n        );\r\n        matchedDebugExtra = debugExtra;\r\n\r\n        if (keyframeIndex !== -1) {\r\n          const modelViewTransform = estimator.estimate({ screenCoords, worldCoords });\r\n\r\n          if (modelViewTransform) {\r\n            matchedTargetIndex = matchingIndex;\r\n            matchedModelViewTransform = modelViewTransform;\r\n            matchedScreenCoords = screenCoords;\r\n            matchedWorldCoords = worldCoords;\r\n          }\r\n          break;\r\n        }\r\n      }\r\n\r\n      postMessage({\r\n        type: \"matchDone\",\r\n        targetIndex: matchedTargetIndex,\r\n        modelViewTransform: matchedModelViewTransform,\r\n        screenCoords: matchedScreenCoords,\r\n        worldCoords: matchedWorldCoords,\r\n        featurePoints: featurePoints,\r\n        debugExtra: matchedDebugExtra,\r\n      });\r\n      break;\r\n\r\n    case \"track\":\r\n      const { inputData: trackInput, lastModelViewTransform, targetIndex } = data;\r\n      const trackResult = tracker.track(trackInput, lastModelViewTransform, targetIndex);\r\n\r\n      postMessage({\r\n        type: \"trackDone\",\r\n        targetIndex,\r\n        ...trackResult\r\n      });\r\n      break;\r\n\r\n    case \"trackUpdate\":\r\n      const { modelViewTransform, worldCoords, screenCoords, stabilities } = data;\r\n      const finalModelViewTransform = estimator.refineEstimate({\r\n        initialModelViewTransform: modelViewTransform,\r\n        worldCoords,\r\n        screenCoords,\r\n        stabilities, // Stability-based weights\r\n      });\r\n      postMessage({\r\n        type: \"trackUpdateDone\",\r\n        modelViewTransform: finalModelViewTransform,\r\n      });\r\n      break;\r\n\r\n    case \"dispose\":\r\n      close();\r\n      break;\r\n\r\n    default:\r\n      throw new Error(`Invalid message type '${data.type}'`);\r\n  }\r\n};\r\n", "import { Tracker } from \"../core/tracker/tracker.js\";\r\nimport { InputLoader } from \"../core/input-loader.js\";\r\nimport { FeatureManager } from \"../core/features/feature-manager.js\";\r\nimport { OneEuroFilterFeature } from \"../core/features/one-euro-filter-feature.js\";\r\nimport { TemporalFilterFeature } from \"../core/features/temporal-filter-feature.js\";\r\nimport { AutoRotationFeature } from \"../core/features/auto-rotation-feature.js\";\r\nimport { DetectorLite } from \"../core/detector/detector-lite.js\";\r\nimport * as protocol from \"../core/protocol.js\";\r\nimport { AR_CONFIG } from \"../core/constants.js\";\r\n\r\nlet ControllerWorker: any;\r\n\r\n// Conditional import for worker to avoid crash in non-vite environments\r\nconst getControllerWorker = async () => {\r\n    if (typeof Worker === 'undefined') return null;\r\n    try {\r\n        // @ts-ignore\r\n        const workerModule = await import(\"./controller.worker.js?worker&inline\");\r\n        return workerModule.default;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n};\r\nControllerWorker = await getControllerWorker();\r\n\r\nconst DEFAULT_FILTER_CUTOFF = AR_CONFIG.ONE_EURO_FILTER_CUTOFF;\r\nconst DEFAULT_FILTER_BETA = AR_CONFIG.ONE_EURO_FILTER_BETA;\r\nconst DEFAULT_WARMUP_TOLERANCE = AR_CONFIG.WARMUP_TOLERANCE;\r\nconst DEFAULT_MISS_TOLERANCE = AR_CONFIG.MISS_TOLERANCE;\r\nconst WORKER_TIMEOUT_MS = 1000;    // Prevent worker hangs from killing the loop\r\n\r\nlet loopIdCounter = 0;\r\n\r\nexport interface ControllerOptions {\r\n    inputWidth: number;\r\n    inputHeight: number;\r\n    onUpdate?: ((data: any) => void) | null;\r\n    debugMode?: boolean;\r\n    maxTrack?: number;\r\n    warmupTolerance?: number | null;\r\n    missTolerance?: number | null;\r\n    filterMinCF?: number | null;\r\n    filterBeta?: number | null;\r\n    worker?: any;\r\n}\r\n\r\nclass Controller {\r\n    inputWidth: number;\r\n    inputHeight: number;\r\n    maxTrack: number;\r\n    inputLoader: InputLoader;\r\n    markerDimensions: any[] | null = null;\r\n    onUpdate: ((data: any) => void) | null;\r\n    debugMode: boolean;\r\n    processingVideo: boolean = false;\r\n    interestedTargetIndex: number = -1;\r\n    trackingStates: any[] = [];\r\n    worker: any;\r\n    projectionTransform: number[][];\r\n    projectionMatrix: number[];\r\n    tracker: Tracker | null = null;\r\n    matchingDataList: any;\r\n    workerMatchDone: ((data: any) => void) | null = null;\r\n    workerTrackDone: ((data: any) => void) | null = null;\r\n    workerFullTrackDone: ((data: any) => void) | null = null;\r\n    mainThreadMatcher: any;\r\n    mainThreadEstimator: any;\r\n    featureManager: FeatureManager;\r\n    fullDetector: DetectorLite | null = null;\r\n\r\n    constructor({\r\n        inputWidth,\r\n        inputHeight,\r\n        onUpdate = null,\r\n        debugMode = false,\r\n        maxTrack = 1,\r\n        warmupTolerance = null,\r\n        missTolerance = null,\r\n        filterMinCF = null,\r\n        filterBeta = null,\r\n        worker = null,\r\n    }: ControllerOptions) {\r\n        this.inputWidth = inputWidth;\r\n        this.inputHeight = inputHeight;\r\n        this.maxTrack = maxTrack;\r\n\r\n        this.featureManager = new FeatureManager();\r\n        this.featureManager.addFeature(new OneEuroFilterFeature(\r\n            filterMinCF === null ? DEFAULT_FILTER_CUTOFF : filterMinCF,\r\n            filterBeta === null ? DEFAULT_FILTER_BETA : filterBeta\r\n        ));\r\n        this.featureManager.addFeature(new TemporalFilterFeature(\r\n            warmupTolerance === null ? DEFAULT_WARMUP_TOLERANCE : warmupTolerance,\r\n            missTolerance === null ? DEFAULT_MISS_TOLERANCE : missTolerance\r\n        ));\r\n        this.featureManager.addFeature(new AutoRotationFeature());\r\n        // User wants \"sin recortes\", so we don't add CropDetectionFeature\r\n\r\n        this.inputLoader = new InputLoader(this.inputWidth, this.inputHeight);\r\n        this.onUpdate = onUpdate;\r\n        this.debugMode = debugMode;\r\n        this.worker = worker;\r\n        if (this.worker) this._setupWorkerListener();\r\n\r\n        // Moonshot: Full frame detector for better sensitivity\r\n        this.fullDetector = new DetectorLite(this.inputWidth, this.inputHeight, {\r\n            useLSH: AR_CONFIG.USE_LSH,\r\n            maxFeaturesPerBucket: AR_CONFIG.MAX_FEATURES_PER_BUCKET\r\n        });\r\n\r\n        this.featureManager.init({\r\n            inputWidth: this.inputWidth,\r\n            inputHeight: this.inputHeight,\r\n            projectionTransform: [], // Will be set below\r\n            debugMode: this.debugMode\r\n        });\r\n\r\n        const near = AR_CONFIG.DEFAULT_NEAR;\r\n        const far = AR_CONFIG.DEFAULT_FAR;\r\n        const fovy = (AR_CONFIG.DEFAULT_FOVY * Math.PI) / 180;\r\n        const f = this.inputHeight / 2 / Math.tan(fovy / 2);\r\n\r\n        this.projectionTransform = [\r\n            [f, 0, this.inputWidth / 2],\r\n            [0, f, this.inputHeight / 2],\r\n            [0, 0, 1],\r\n        ];\r\n\r\n        this.featureManager.init({\r\n            inputWidth: this.inputWidth,\r\n            inputHeight: this.inputHeight,\r\n            projectionTransform: this.projectionTransform,\r\n            debugMode: this.debugMode\r\n        });\r\n\r\n        this.projectionMatrix = this._glProjectionMatrix({\r\n            projectionTransform: this.projectionTransform,\r\n            width: this.inputWidth,\r\n            height: this.inputHeight,\r\n            near: near,\r\n            far: far,\r\n        });\r\n    }\r\n\r\n    _setupWorkerListener() {\r\n        if (!this.worker) return;\r\n        this.worker.onmessage = (e: any) => {\r\n            if (e.data.type === \"matchDone\" && this.workerMatchDone !== null) {\r\n                this.workerMatchDone(e.data);\r\n            }\r\n            if (e.data.type === \"trackDone\" && this.workerFullTrackDone !== null) {\r\n                this.workerFullTrackDone(e.data);\r\n            }\r\n            if (e.data.type === \"trackUpdateDone\" && this.workerTrackDone !== null) {\r\n                this.workerTrackDone(e.data);\r\n            }\r\n        };\r\n    }\r\n\r\n    _ensureWorker() {\r\n        if (this.worker) return;\r\n        if (ControllerWorker && typeof Worker !== 'undefined') {\r\n            this.worker = new ControllerWorker();\r\n            this._setupWorkerListener();\r\n        }\r\n    }\r\n\r\n    async addImageTargets(fileURLs: string | string[]) {\r\n        const urls = Array.isArray(fileURLs) ? fileURLs : [fileURLs];\r\n        const buffers = await Promise.all(\r\n            urls.map(async (url) => {\r\n                const response = await fetch(url);\r\n                return response.arrayBuffer();\r\n            })\r\n        );\r\n        return this.addImageTargetsFromBuffers(buffers);\r\n    }\r\n\r\n    addImageTargetsFromBuffers(buffers: ArrayBuffer[]) {\r\n        const allTrackingData: any[] = [];\r\n        const allMatchingData: any[] = [];\r\n        const allDimensions: any[] = [];\r\n\r\n        for (const buffer of buffers) {\r\n            const result = protocol.decodeTaar(buffer);\r\n            const dataList = result.dataList || [];\r\n\r\n            for (const item of dataList) {\r\n                allMatchingData.push(item.matchingData);\r\n                allTrackingData.push(item.trackingData);\r\n                allDimensions.push([item.targetImage.width, item.targetImage.height]);\r\n            }\r\n        }\r\n\r\n        this.tracker = new Tracker(\r\n            allDimensions,\r\n            allTrackingData,\r\n            this.projectionTransform,\r\n            this.inputWidth,\r\n            this.inputHeight,\r\n            this.debugMode,\r\n        );\r\n\r\n\r\n        this._ensureWorker();\r\n        if (this.worker) {\r\n            this.worker.postMessage({\r\n                type: \"setup\",\r\n                inputWidth: this.inputWidth,\r\n                inputHeight: this.inputHeight,\r\n                projectionTransform: this.projectionTransform,\r\n                debugMode: this.debugMode,\r\n                matchingDataList: allMatchingData,\r\n                trackingDataList: allTrackingData,\r\n                markerDimensions: allDimensions\r\n            });\r\n        }\r\n\r\n        this.markerDimensions = allDimensions;\r\n        this.matchingDataList = allMatchingData;\r\n        return { dimensions: allDimensions, matchingDataList: allMatchingData, trackingDataList: allTrackingData };\r\n    }\r\n\r\n    addImageTargetsFromBuffer(buffer: ArrayBuffer) {\r\n        return this.addImageTargetsFromBuffers([buffer]);\r\n    }\r\n\r\n    dispose() {\r\n        this.stopProcessVideo();\r\n        if (this.worker) {\r\n            this.worker.postMessage({ type: \"dispose\" });\r\n            this.worker = null;\r\n        }\r\n    }\r\n\r\n    dummyRun(input: any) {\r\n        const inputData = this.inputLoader.loadInput(input);\r\n        this.fullDetector?.detect(inputData);\r\n        this.tracker!.dummyRun(inputData);\r\n    }\r\n\r\n    getProjectionMatrix() {\r\n        return this.projectionMatrix;\r\n    }\r\n\r\n    getRotatedZ90Matrix(m: number[]) {\r\n        return [\r\n            -m[1], m[0], m[2], m[3],\r\n            -m[5], m[4], m[6], m[7],\r\n            -m[9], m[8], m[10], m[11],\r\n            -m[13], m[12], m[14], m[15],\r\n        ];\r\n    }\r\n\r\n    getWorldMatrix(modelViewTransform: number[][], targetIndex: number) {\r\n        return this._glModelViewMatrix(modelViewTransform, targetIndex);\r\n    }\r\n\r\n    async _detectAndMatch(inputData: any, targetIndexes: number[]) {\r\n        // \uD83D\uDE80 NANITE-STYLE: Estimate scale for filtered matching\r\n        // If we were already tracking a target, use its scale as a hint for faster matching\r\n        let predictedScale: number | undefined = undefined;\r\n        for (const state of this.trackingStates) {\r\n            if (state.isTracking && state.currentModelViewTransform) {\r\n                const m = state.currentModelViewTransform;\r\n                // Vector magnitude of the first column is a good approximation of the scale\r\n                predictedScale = Math.sqrt(m[0][0] ** 2 + m[1][0] ** 2 + m[2][0] ** 2);\r\n                break;\r\n            }\r\n        }\r\n\r\n        const { targetIndex, modelViewTransform, screenCoords, worldCoords, featurePoints } = await this._workerMatch(\r\n            null, // No feature points, worker will detect from inputData\r\n            targetIndexes,\r\n            inputData,\r\n            predictedScale\r\n        );\r\n        return { targetIndex, modelViewTransform, screenCoords, worldCoords, featurePoints };\r\n    }\r\n\r\n    async _trackAndUpdate(inputData: any, lastModelViewTransform: number[][], targetIndex: number) {\r\n        const { worldCoords, screenCoords, reliabilities, indices = [], octaveIndex = 0, deformedMesh } = await this._workerTrack(\r\n            inputData,\r\n            lastModelViewTransform,\r\n            targetIndex,\r\n        );\r\n\r\n        if (!worldCoords || worldCoords.length === 0) {\r\n            return { modelViewTransform: null, screenCoords: [], reliabilities: [], stabilities: [], deformedMesh: null };\r\n        }\r\n\r\n        const state = this.trackingStates[targetIndex];\r\n        if (!state.pointStabilities) state.pointStabilities = [];\r\n        if (!state.lastScreenCoords) state.lastScreenCoords = [];\r\n\r\n        if (!state.pointStabilities[octaveIndex]) {\r\n            const numPoints = (this.tracker as any).prebuiltData[targetIndex][octaveIndex].px.length;\r\n            state.pointStabilities[octaveIndex] = new Float32Array(numPoints).fill(0);\r\n            state.lastScreenCoords[octaveIndex] = new Array(numPoints).fill(null);\r\n        }\r\n\r\n        const stabilities = state.pointStabilities[octaveIndex];\r\n        const lastCoords = state.lastScreenCoords[octaveIndex];\r\n\r\n        // Update stability for ALL points in the current octave\r\n        for (let i = 0; i < stabilities.length; i++) {\r\n            const isCurrentlyTracked = indices.includes(i);\r\n            if (isCurrentlyTracked) {\r\n                const idxInResult = indices.indexOf(i);\r\n                stabilities[i] = Math.min(1.0, stabilities[i] + 0.4); // Fast attack\r\n                lastCoords[i] = screenCoords[idxInResult]; // Update last known position\r\n            } else {\r\n                stabilities[i] = Math.max(0.0, stabilities[i] - 0.08); // Slow decay (approx 12 frames/0.2s)\r\n            }\r\n        }\r\n\r\n        // Collect points for the UI: both currently tracked AND hibernating\r\n        const finalScreenCoords: any[] = [];\r\n        const finalReliabilities: number[] = [];\r\n        const finalStabilities: number[] = [];\r\n        const finalWorldCoords: any[] = [];\r\n\r\n        for (let i = 0; i < stabilities.length; i++) {\r\n            if (stabilities[i] > 0) {\r\n                const isCurrentlyTracked = indices.includes(i);\r\n                finalScreenCoords.push({\r\n                    x: lastCoords[i].x,\r\n                    y: lastCoords[i].y,\r\n                    id: i // Unique index from tracker\r\n                });\r\n                finalStabilities.push(stabilities[i]);\r\n\r\n                if (isCurrentlyTracked) {\r\n                    const idxInResult = indices.indexOf(i);\r\n                    finalReliabilities.push(reliabilities[idxInResult]);\r\n                    finalWorldCoords.push(worldCoords[idxInResult]);\r\n                } else {\r\n                    finalReliabilities.push(0); // Hibernating points have 0 reliability\r\n                }\r\n            }\r\n        }\r\n\r\n        // \uD83D\uDE80 WARMUP FIX: If we just started tracking (less than 15 frames), we are much more relaxed\r\n        const isWarmup = state.trackCount < 15;\r\n        const numTracked = finalWorldCoords.length;\r\n        const minPoints = isWarmup ? 4 : 5; // Start with 4, then require 5\r\n\r\n        if (numTracked < minPoints) {\r\n            return {\r\n                modelViewTransform: null,\r\n                screenCoords: finalScreenCoords,\r\n                reliabilities: finalReliabilities,\r\n                stabilities: finalStabilities\r\n            };\r\n        }\r\n\r\n        state.trackCount++;\r\n\r\n        const modelViewTransform = await this._workerTrackUpdate(lastModelViewTransform, {\r\n            worldCoords: finalWorldCoords,\r\n            screenCoords: finalWorldCoords.map((_, i) => {\r\n                const globalIdx = indices[i];\r\n                return lastCoords[globalIdx];\r\n            }),\r\n            stabilities: finalWorldCoords.map((_, i) => {\r\n                const globalIdx = indices[i];\r\n                return stabilities[globalIdx];\r\n            }),\r\n            deformedMesh\r\n        });\r\n\r\n        return {\r\n            modelViewTransform,\r\n            screenCoords: finalScreenCoords,\r\n            reliabilities: finalReliabilities,\r\n            stabilities: finalStabilities,\r\n            deformedMesh,\r\n            octaveIndex // Pass this up for the orchestrator\r\n        };\r\n    }\r\n\r\n    processVideo(input: any) {\r\n        if (this.processingVideo) return;\r\n        this.processingVideo = true;\r\n        const currentLoopId = ++loopIdCounter; // Added for ghost loop prevention\r\n\r\n        this.trackingStates = [];\r\n        for (let i = 0; i < (this.markerDimensions?.length || 0); i++) {\r\n            this.trackingStates.push({\r\n                showing: false,\r\n                isTracking: false,\r\n                currentModelViewTransform: null,\r\n                trackCount: 0,\r\n                trackMiss: 0,\r\n            });\r\n        }\r\n\r\n        const startProcessing = async () => {\r\n            while (true) {\r\n                if (!this.processingVideo || currentLoopId !== loopIdCounter) break;\r\n\r\n                const inputData = this.inputLoader.loadInput(input);\r\n                const nTracking = this.trackingStates.reduce((acc, s) => acc + (!!s.isTracking ? 1 : 0), 0);\r\n\r\n                if (nTracking < this.maxTrack) {\r\n                    const matchingIndexes = [];\r\n                    for (let i = 0; i < this.trackingStates.length; i++) {\r\n                        const trackingState = this.trackingStates[i];\r\n                        if (trackingState.isTracking === true) continue;\r\n                        if (this.interestedTargetIndex !== -1 && this.interestedTargetIndex !== i) continue;\r\n                        matchingIndexes.push(i);\r\n                    }\r\n\r\n                    const { targetIndex: matchedTargetIndex, modelViewTransform, featurePoints } =\r\n                        await this._detectAndMatch(inputData, matchingIndexes);\r\n\r\n                    if (matchedTargetIndex !== -1) {\r\n                        this.trackingStates[matchedTargetIndex].isTracking = true;\r\n                        this.trackingStates[matchedTargetIndex].currentModelViewTransform = modelViewTransform;\r\n                    }\r\n\r\n                    // If we have feature points, we can store them in a special \"lastSeenFeatures\" \r\n                    // or just pass them in processDone for general visualization\r\n                    this.onUpdate && this.onUpdate({ type: \"featurePoints\", featurePoints });\r\n                }\r\n\r\n                for (let i = 0; i < this.trackingStates.length; i++) {\r\n                    const trackingState = this.trackingStates[i];\r\n\r\n                    if (trackingState.isTracking) {\r\n                        const result = await this._trackAndUpdate(\r\n                            inputData,\r\n                            trackingState.currentModelViewTransform,\r\n                            i,\r\n                        );\r\n                        if (result === null || result.modelViewTransform === null) {\r\n                            trackingState.isTracking = false;\r\n                            // Keep points for the last update so they can be shown as it \"asoma\"\r\n                            trackingState.screenCoords = result?.screenCoords || [];\r\n                            trackingState.reliabilities = result?.reliabilities || [];\r\n                            trackingState.stabilities = result?.stabilities || [];\r\n                        } else {\r\n                            trackingState.currentModelViewTransform = result.modelViewTransform;\r\n                            trackingState.screenCoords = result.screenCoords;\r\n                            trackingState.reliabilities = result.reliabilities;\r\n                            trackingState.stabilities = result.stabilities;\r\n                            (trackingState as any).deformedMesh = result.deformedMesh;\r\n                        }\r\n                    }\r\n\r\n                    const wasShowing = trackingState.showing;\r\n                    trackingState.showing = this.featureManager.shouldShow(i, trackingState.isTracking);\r\n\r\n                    if (wasShowing && !trackingState.showing) {\r\n                        trackingState.trackingMatrix = null;\r\n                        this.featureManager.notifyUpdate({ type: \"reset\", targetIndex: i });\r\n                    }\r\n\r\n                    // Always notify update if we have points or if visibility changed\r\n                    if (trackingState.showing || (trackingState.screenCoords && trackingState.screenCoords.length > 0) || (wasShowing && !trackingState.showing)) {\r\n                        const worldMatrix = trackingState.showing ? this._glModelViewMatrix(trackingState.currentModelViewTransform, i) : null;\r\n\r\n                        let finalMatrix = null;\r\n\r\n                        if (worldMatrix) {\r\n                            // Calculate confidence score based on point stability\r\n                            const stabilities = trackingState.stabilities || [];\r\n                            const avgStability = stabilities.length > 0\r\n                                ? stabilities.reduce((a: number, b: number) => a + b, 0) / stabilities.length\r\n                                : 0;\r\n\r\n                            const filteredMatrix = this.featureManager.applyWorldMatrixFilters(i, worldMatrix, { stability: avgStability });\r\n                            trackingState.trackingMatrix = filteredMatrix;\r\n\r\n                            finalMatrix = [...filteredMatrix];\r\n\r\n                            const isInputRotated = input.width === this.inputHeight && input.height === this.inputWidth;\r\n                            if (isInputRotated) {\r\n                                const rotationFeature = this.featureManager.getFeature<AutoRotationFeature>(\"auto-rotation\");\r\n                                if (rotationFeature) {\r\n                                    finalMatrix = rotationFeature.rotate(finalMatrix);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        this.onUpdate && this.onUpdate({\r\n                            type: \"updateMatrix\",\r\n                            targetIndex: i,\r\n                            worldMatrix: finalMatrix,\r\n                            modelViewTransform: trackingState.currentModelViewTransform,\r\n                            screenCoords: trackingState.screenCoords,\r\n                            reliabilities: trackingState.reliabilities,\r\n                            stabilities: trackingState.stabilities,\r\n                            deformedMesh: (trackingState as any).deformedMesh\r\n                        });\r\n                    }\r\n                }\r\n\r\n                this.onUpdate && this.onUpdate({ type: \"processDone\" });\r\n\r\n                if (typeof requestAnimationFrame !== \"undefined\") {\r\n                    await new Promise(requestAnimationFrame);\r\n                } else {\r\n                    await new Promise(resolve => setTimeout(resolve, 16));\r\n                }\r\n            }\r\n        };\r\n        startProcessing();\r\n    }\r\n\r\n    stopProcessVideo() {\r\n        this.processingVideo = false;\r\n    }\r\n\r\n    async detect(input: any) {\r\n        const inputData = this.inputLoader.loadInput(input);\r\n        const { featurePoints } = this.fullDetector!.detect(inputData);\r\n        return { featurePoints, debugExtra: {} };\r\n    }\r\n\r\n    async match(featurePoints: any, targetIndex: number) {\r\n        const { targetIndex: matchedTargetIndex, modelViewTransform, screenCoords, worldCoords, debugExtra } = await this._workerMatch(featurePoints, [\r\n            targetIndex,\r\n        ]);\r\n        return { targetIndex: matchedTargetIndex, modelViewTransform, screenCoords, worldCoords, debugExtra };\r\n    }\r\n\r\n    async track(input: any, modelViewTransform: number[][], targetIndex: number) {\r\n        const inputData = this.inputLoader.loadInput(input);\r\n        return this.tracker!.track(inputData, modelViewTransform, targetIndex);\r\n    }\r\n\r\n    async trackUpdate(modelViewTransform: number[][], trackFeatures: any) {\r\n        if (trackFeatures.worldCoords.length < 4) return null;\r\n        return this._workerTrackUpdate(modelViewTransform, trackFeatures);\r\n    }\r\n\r\n    _workerMatch(featurePoints: any, targetIndexes: number[], inputData: any = null, expectedScale?: number): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            if (!this.worker) {\r\n                // If no feature points but we have input data, detect first\r\n                let fpPromise;\r\n                if (!featurePoints && inputData) {\r\n                    fpPromise = Promise.resolve(this.fullDetector!.detect(inputData).featurePoints);\r\n                } else {\r\n                    fpPromise = Promise.resolve(featurePoints);\r\n                }\r\n\r\n                fpPromise.then(fp => {\r\n                    this._matchOnMainThread(fp, targetIndexes, expectedScale).then(resolve);\r\n                }).catch(() => resolve({ targetIndex: -1 }));\r\n                return;\r\n            }\r\n\r\n            const timeout = setTimeout(() => {\r\n                this.workerMatchDone = null;\r\n                resolve({ targetIndex: -1 });\r\n            }, WORKER_TIMEOUT_MS);\r\n\r\n            this.workerMatchDone = (data: any) => {\r\n                clearTimeout(timeout);\r\n                this.workerMatchDone = null;\r\n                resolve({\r\n                    targetIndex: data.targetIndex,\r\n                    modelViewTransform: data.modelViewTransform,\r\n                    screenCoords: data.screenCoords,\r\n                    worldCoords: data.worldCoords,\r\n                    featurePoints: data.featurePoints,\r\n                    debugExtra: data.debugExtra,\r\n                });\r\n            };\r\n\r\n            if (inputData) {\r\n                this.worker.postMessage({ type: \"match\", inputData, targetIndexes, expectedScale });\r\n            } else {\r\n                this.worker.postMessage({ type: \"match\", featurePoints: featurePoints, targetIndexes, expectedScale });\r\n            }\r\n        });\r\n    }\r\n\r\n    _workerTrack(inputData: any, lastModelViewTransform: number[][], targetIndex: number): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            if (!this.worker) {\r\n                resolve(this.tracker!.track(inputData, lastModelViewTransform, targetIndex));\r\n                return;\r\n            }\r\n\r\n            const timeout = setTimeout(() => {\r\n                this.workerFullTrackDone = null;\r\n                resolve({ worldCoords: [], screenCoords: [], reliabilities: [] });\r\n            }, WORKER_TIMEOUT_MS);\r\n\r\n            this.workerFullTrackDone = (data: any) => {\r\n                clearTimeout(timeout);\r\n                this.workerFullTrackDone = null;\r\n                resolve(data);\r\n            };\r\n\r\n            this.worker.postMessage({\r\n                type: \"track\",\r\n                inputData,\r\n                lastModelViewTransform,\r\n                targetIndex\r\n            });\r\n        });\r\n    }\r\n\r\n    async _matchOnMainThread(featurePoints: any, targetIndexes: number[], expectedScale?: number) {\r\n        if (!this.mainThreadMatcher) {\r\n            const { Matcher } = await import(\"../core/matching/matcher.js\");\r\n            const { Estimator } = await import(\"../core/estimation/estimator.js\");\r\n            this.mainThreadMatcher = new Matcher(this.inputWidth, this.inputHeight, this.debugMode);\r\n            this.mainThreadEstimator = new Estimator(this.projectionTransform);\r\n        }\r\n\r\n        let matchedTargetIndex = -1;\r\n        let matchedModelViewTransform = null;\r\n        let matchedScreenCoords = null;\r\n        let matchedWorldCoords = null;\r\n        let matchedDebugExtra = null;\r\n\r\n        for (let i = 0; i < targetIndexes.length; i++) {\r\n            const matchingIndex = targetIndexes[i];\r\n            const { keyframeIndex, screenCoords, worldCoords, debugExtra } = this.mainThreadMatcher.matchDetection(\r\n                this.matchingDataList[matchingIndex],\r\n                featurePoints,\r\n                expectedScale\r\n            );\r\n            matchedDebugExtra = debugExtra;\r\n\r\n            if (keyframeIndex !== -1) {\r\n                const modelViewTransform = this.mainThreadEstimator.estimate({ screenCoords, worldCoords });\r\n                if (modelViewTransform) {\r\n                    matchedTargetIndex = matchingIndex;\r\n                    matchedModelViewTransform = modelViewTransform;\r\n                    matchedScreenCoords = screenCoords;\r\n                    matchedWorldCoords = worldCoords;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return {\r\n            targetIndex: matchedTargetIndex,\r\n            modelViewTransform: matchedModelViewTransform,\r\n            screenCoords: matchedScreenCoords,\r\n            worldCoords: matchedWorldCoords,\r\n            debugExtra: matchedDebugExtra,\r\n        };\r\n    }\r\n\r\n    _workerTrackUpdate(modelViewTransform: number[][], trackingFeatures: any): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            if (!this.worker) {\r\n                this._trackUpdateOnMainThread(modelViewTransform, trackingFeatures).then(resolve).catch(() => resolve(null));\r\n                return;\r\n            }\r\n\r\n            const timeout = setTimeout(() => {\r\n                this.workerTrackDone = null;\r\n                resolve(null);\r\n            }, WORKER_TIMEOUT_MS);\r\n\r\n            this.workerTrackDone = (data: any) => {\r\n                clearTimeout(timeout);\r\n                this.workerTrackDone = null;\r\n                resolve(data.modelViewTransform);\r\n            };\r\n            const { worldCoords, screenCoords, stabilities } = trackingFeatures;\r\n            this.worker.postMessage({\r\n                type: \"trackUpdate\",\r\n                modelViewTransform,\r\n                worldCoords,\r\n                screenCoords,\r\n                stabilities\r\n            });\r\n        });\r\n    }\r\n\r\n    async _trackUpdateOnMainThread(modelViewTransform: number[][], trackingFeatures: any) {\r\n        if (!this.mainThreadEstimator) {\r\n            const { Estimator } = await import(\"../core/estimation/estimator.js\");\r\n            this.mainThreadEstimator = new Estimator(this.projectionTransform);\r\n        }\r\n\r\n        const { worldCoords, screenCoords, stabilities } = trackingFeatures;\r\n        return this.mainThreadEstimator.refineEstimate({\r\n            initialModelViewTransform: modelViewTransform,\r\n            worldCoords,\r\n            screenCoords,\r\n            stabilities\r\n        });\r\n    }\r\n\r\n    _glModelViewMatrix(modelViewTransform: number[][], targetIndex: number) {\r\n        // Transformation to map Computer Vision coordinates (Y-down, Z-forward) \r\n        // to OpenGL coordinates (Y-up, Z-backward). \r\n        // We negate the 2nd and 3rd rows of the pose matrix.\r\n        return [\r\n            modelViewTransform[0][0], -modelViewTransform[1][0], -modelViewTransform[2][0], 0,\r\n            modelViewTransform[0][1], -modelViewTransform[1][1], -modelViewTransform[2][1], 0,\r\n            modelViewTransform[0][2], -modelViewTransform[1][2], -modelViewTransform[2][2], 0,\r\n            modelViewTransform[0][3], -modelViewTransform[1][3], -modelViewTransform[2][3], 1,\r\n        ];\r\n    }\r\n\r\n    _glProjectionMatrix({ projectionTransform, width, height, near, far }: any) {\r\n        const proj = [\r\n            [(2 * projectionTransform[0][0]) / width, 0, -((2 * projectionTransform[0][2]) / width - 1), 0],\r\n            [0, (2 * projectionTransform[1][1]) / height, -((2 * projectionTransform[1][2]) / height - 1), 0],\r\n            [0, 0, -(far + near) / (far - near), (-2 * far * near) / (far - near)],\r\n            [0, 0, -1, 0],\r\n        ];\r\n        const projMatrix = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            for (let j = 0; j < 4; j++) {\r\n                projMatrix.push(proj[j][i]);\r\n            }\r\n        }\r\n        return projMatrix;\r\n    }\r\n}\r\n\r\nexport { Controller };\r\n", "/**\r\n * InputLoader - Maneja la carga de im\u00E1genes y video sin TensorFlow\r\n */\r\nclass InputLoader {\r\n  constructor(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.grayscaleBuffer = new Uint8Array(width * height);\r\n\r\n    if (typeof document !== \"undefined\") {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      this.context = canvas.getContext(\"2d\", { willReadFrequently: true, alpha: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Carga una imagen o video y devuelve los datos en escala de grises\r\n   * @param {HTMLVideoElement|HTMLImageElement|ImageData|Uint8Array} input - La fuente de entrada\r\n   * @returns {Uint8Array} Datos de imagen en escala de grises (width * height)\r\n   */\r\n  loadInput(input) {\r\n    // Si ya es un Uint8Array de escala de grises, lo devolvemos\r\n    if (input instanceof Uint8Array && input.length === this.width * this.height) {\r\n      return input;\r\n    }\r\n\r\n    // Si es ImageData, convertimos a escala de grises directamente\r\n    if (typeof ImageData !== \"undefined\" && input instanceof ImageData) {\r\n      this._convertToGrayscale(input.data, input.width, input.height);\r\n      return this.grayscaleBuffer;\r\n    }\r\n\r\n    // En el navegador, usamos canvas para procesar video/im\u00E1genes\r\n    if (this.context) {\r\n      this.context.clearRect(0, 0, this.width, this.height);\r\n\r\n      const isInputRotated = input.width === this.height && input.height === this.width;\r\n\r\n      const inputW = isInputRotated ? input.height : input.width;\r\n      const inputH = isInputRotated ? input.width : input.height;\r\n      const inputAspect = inputW / inputH;\r\n      const canvasAspect = this.width / this.height;\r\n\r\n      let sx = 0, sy = 0, sw = inputW, sh = inputH;\r\n\r\n      if (inputAspect > canvasAspect) {\r\n        // Input is wider than canvas - crop sides\r\n        sw = inputH * canvasAspect;\r\n        sx = (inputW - sw) / 2;\r\n      } else if (inputAspect < canvasAspect) {\r\n        // Input is taller than canvas - crop top/bottom\r\n        sh = inputW / canvasAspect;\r\n        sy = (inputH - sh) / 2;\r\n      }\r\n\r\n      if (isInputRotated) {\r\n        this.context.save();\r\n        this.context.translate(this.width / 2, this.height / 2);\r\n        this.context.rotate(Math.PI / 2);\r\n        // Map source crop (relative to rotated input)\r\n        // Since input is already rotated, we crop based on the rotated dimensions\r\n        this.context.drawImage(input, sx, sy, sw, sh, -this.height / 2, -this.width / 2, this.height, this.width);\r\n        this.context.restore();\r\n      } else {\r\n        this.context.drawImage(input, sx, sy, sw, sh, 0, 0, this.width, this.height);\r\n      }\r\n\r\n      const imageData = this.context.getImageData(0, 0, this.width, this.height);\r\n      this._convertToGrayscale(imageData.data, this.width, this.height);\r\n      return this.grayscaleBuffer;\r\n    }\r\n\r\n    // Fallback para Node.js o entornos sin DOM\r\n    if (input.data && input.data instanceof Uint8Array) {\r\n      this._convertToGrayscale(input.data, input.width || this.width, input.height || this.height);\r\n      return this.grayscaleBuffer;\r\n    }\r\n\r\n    throw new Error(\"Input no soportado o entorno sin Canvas\");\r\n  }\r\n\r\n  /**\r\n   * Convierte datos RGBA a escala de grises optimizada (reutilizando buffer)\r\n   */\r\n  _convertToGrayscale(rgbaData, width, height) {\r\n    const grayscale = this.grayscaleBuffer;\r\n    const len = (width * height);\r\n\r\n    // Optimized loop with bitwise ops\r\n    for (let i = 0; i < len; i++) {\r\n      const offset = i << 2;\r\n      // Formula de luminosidad est\u00E1ndar: 0.299R + 0.587G + 0.114B (scaled by 256)\r\n      grayscale[i] = (rgbaData[offset] * 77 + rgbaData[offset + 1] * 150 + rgbaData[offset + 2] * 29) >> 8;\r\n    }\r\n  }\r\n}\r\n\r\nexport { InputLoader };\r\n", "import { ControllerFeature, FeatureContext } from \"./feature-base.js\";\r\n\r\nexport class FeatureManager {\r\n    private features: ControllerFeature[] = [];\r\n\r\n    addFeature(feature: ControllerFeature) {\r\n        this.features.push(feature);\r\n    }\r\n\r\n    getFeature<T extends ControllerFeature>(id: string): T | undefined {\r\n        return this.features.find(f => f.id === id) as T;\r\n    }\r\n\r\n    init(context: FeatureContext) {\r\n        for (const feature of this.features) {\r\n            if (feature.enabled && feature.init) {\r\n                feature.init(context);\r\n            }\r\n        }\r\n    }\r\n\r\n    beforeProcess(inputData: any) {\r\n        for (const feature of this.features) {\r\n            if (feature.enabled && feature.beforeProcess) {\r\n                feature.beforeProcess(inputData);\r\n            }\r\n        }\r\n    }\r\n\r\n    applyWorldMatrixFilters(targetIndex: number, worldMatrix: number[], context?: any): number[] {\r\n        let result = worldMatrix;\r\n        for (const feature of this.features) {\r\n            if (feature.enabled && feature.filterWorldMatrix) {\r\n                result = feature.filterWorldMatrix(targetIndex, result, context);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    shouldShow(targetIndex: number, isTracking: boolean): boolean {\r\n        let show = isTracking;\r\n        for (const feature of this.features) {\r\n            if (feature.enabled && feature.shouldShow) {\r\n                show = feature.shouldShow(targetIndex, isTracking);\r\n            }\r\n        }\r\n        return show;\r\n    }\r\n\r\n    notifyUpdate(data: any) {\r\n        for (const feature of this.features) {\r\n            if (feature.enabled && feature.onUpdate) {\r\n                feature.onUpdate(data);\r\n            }\r\n        }\r\n    }\r\n\r\n    dispose() {\r\n        for (const feature of this.features) {\r\n            if (feature.dispose) {\r\n                feature.dispose();\r\n            }\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * Author: Gery Casiez\r\n * Reference: http://www.lifl.fr/~casiez/1euro/\r\n */\r\n\r\nclass LowPassFilter {\r\n    constructor(alpha, initval = 0) {\r\n        this.y = initval;\r\n        this.s = initval;\r\n        this.alpha = alpha;\r\n    }\r\n\r\n    setAlpha(alpha) {\r\n        if (alpha <= 0 || alpha > 1) {\r\n            return;\r\n        }\r\n        this.alpha = alpha;\r\n    }\r\n\r\n    filter(value) {\r\n        this.y = value;\r\n        this.s = this.alpha * value + (1.0 - this.alpha) * this.s;\r\n        return this.s;\r\n    }\r\n\r\n    filterWithAlpha(value, alpha) {\r\n        this.setAlpha(alpha);\r\n        return this.filter(value);\r\n    }\r\n\r\n    lastValue() {\r\n        return this.y;\r\n    }\r\n}\r\n\r\nexport class OneEuroFilter {\r\n    constructor({ minCutOff = 1.0, beta = 0.0, dCutOff = 1.0 }) {\r\n        this.minCutOff = minCutOff;\r\n        this.beta = beta;\r\n        this.dCutOff = dCutOff;\r\n        this.x = null;\r\n        this.dx = null;\r\n        this.lastTime = null;\r\n    }\r\n\r\n    _alpha(cutoff, te) {\r\n        const tau = 1.0 / (2 * Math.PI * cutoff);\r\n        return 1.0 / (1.0 + tau / te);\r\n    }\r\n\r\n    reset() {\r\n        this.lastTime = null;\r\n        this.x = null;\r\n        this.dx = null;\r\n    }\r\n\r\n    filter(time, value) {\r\n        if (this.lastTime === null || this.x === null) {\r\n            this.lastTime = time;\r\n            this.x = value.map((v) => new LowPassFilter(this._alpha(this.minCutOff, 1.0), v));\r\n            this.dx = value.map((v) => new LowPassFilter(this._alpha(this.dCutOff, 1.0), 0));\r\n            return value;\r\n        }\r\n\r\n        const te = (time - this.lastTime) / 1000.0;\r\n        if (te <= 0) return value;\r\n        this.lastTime = time;\r\n\r\n        const filteredValue = [];\r\n        for (let i = 0; i < value.length; i++) {\r\n            const edvalue = (value[i] - this.x[i].lastValue()) / te;\r\n            const alpha_d = this._alpha(this.dCutOff, te);\r\n            const edvalue_filtered = this.dx[i].filterWithAlpha(edvalue, alpha_d);\r\n\r\n            const cutoff = this.minCutOff + this.beta * Math.abs(edvalue_filtered);\r\n            const alpha = this._alpha(cutoff, te);\r\n            filteredValue[i] = this.x[i].filterWithAlpha(value[i], alpha);\r\n        }\r\n        return filteredValue;\r\n    }\r\n}\r\n", "import { ControllerFeature, FeatureContext } from \"./feature-base.js\";\r\nimport { OneEuroFilter } from \"../../libs/one-euro-filter.js\";\r\n\r\nexport class OneEuroFilterFeature implements ControllerFeature {\r\n    id = \"one-euro-filter\";\r\n    name = \"One Euro Filter\";\r\n    description = \"Smooths the tracking matrix to reduce jitter using a One Euro Filter.\";\r\n    enabled = true;\r\n\r\n    private filters: OneEuroFilter[] = [];\r\n    private minCutOff: number;\r\n    private beta: number;\r\n\r\n    constructor(minCutOff: number = 0.5, beta: number = 0.1) {\r\n        this.minCutOff = minCutOff;\r\n        this.beta = beta;\r\n    }\r\n\r\n    init(context: FeatureContext) {\r\n        // We'll initialize filters lazily or based on target count if known\r\n    }\r\n\r\n    private getFilter(targetIndex: number): OneEuroFilter {\r\n        if (!this.filters[targetIndex]) {\r\n            this.filters[targetIndex] = new OneEuroFilter({\r\n                minCutOff: this.minCutOff,\r\n                beta: this.beta\r\n            });\r\n        }\r\n        return this.filters[targetIndex];\r\n    }\r\n\r\n    filterWorldMatrix(targetIndex: number, worldMatrix: number[], context?: any): number[] {\r\n        if (!this.enabled) return worldMatrix;\r\n\r\n        const filter = this.getFilter(targetIndex);\r\n        const stability = context?.stability ?? 1.0;\r\n\r\n        // Dynamic Cutoff: If points are very stable (1.0), use higher cutoff (less responsiveness loss).\r\n        // If points are unstable (0.3), use much lower cutoff (heavy smoothing).\r\n        // We use a squared curve for even more aggressive suppression of jitter on unstable points.\r\n        const dynamicMinCutOff = this.minCutOff * (0.05 + Math.pow(stability, 2) * 0.95);\r\n        filter.minCutOff = dynamicMinCutOff;\r\n        filter.beta = this.beta;\r\n\r\n        return filter.filter(Date.now(), worldMatrix);\r\n    }\r\n\r\n    onUpdate(data: any) {\r\n        if (data.type === \"reset\" && data.targetIndex !== undefined) {\r\n            this.filters[data.targetIndex]?.reset();\r\n        }\r\n    }\r\n}\r\n", "import { ControllerFeature } from \"./feature-base.js\";\r\n\r\nexport interface TemporalState {\r\n    showing: boolean;\r\n    trackCount: number;\r\n    trackMiss: number;\r\n}\r\n\r\nexport class TemporalFilterFeature implements ControllerFeature {\r\n    id = \"temporal-filter\";\r\n    name = \"Temporal Filter\";\r\n    description = \"Provides warmup tolerance (to avoid false positives) and miss tolerance (to maintain tracking during brief occlusions).\";\r\n    enabled = true;\r\n\r\n    private states: TemporalState[] = [];\r\n    private warmupTolerance: number;\r\n    private missTolerance: number;\r\n    private onToggleShowing?: (targetIndex: number, showing: boolean) => void;\r\n\r\n    constructor(warmup: number = 2, miss: number = 5, onToggleShowing?: (targetIndex: number, showing: boolean) => void) {\r\n        this.warmupTolerance = warmup;\r\n        this.missTolerance = miss;\r\n        this.onToggleShowing = onToggleShowing;\r\n    }\r\n\r\n    private getState(targetIndex: number): TemporalState {\r\n        if (!this.states[targetIndex]) {\r\n            this.states[targetIndex] = {\r\n                showing: false,\r\n                trackCount: 0,\r\n                trackMiss: 0,\r\n            };\r\n        }\r\n        return this.states[targetIndex];\r\n    }\r\n\r\n    shouldShow(targetIndex: number, isTracking: boolean): boolean {\r\n        if (!this.enabled) return isTracking;\r\n\r\n        const state = this.getState(targetIndex);\r\n\r\n        if (!state.showing) {\r\n            if (isTracking) {\r\n                state.trackMiss = 0;\r\n                state.trackCount += 1;\r\n                if (state.trackCount > this.warmupTolerance) {\r\n                    state.showing = true;\r\n                    this.onToggleShowing?.(targetIndex, true);\r\n                }\r\n            } else {\r\n                state.trackCount = 0;\r\n            }\r\n        } else {\r\n            if (!isTracking) {\r\n                state.trackCount = 0;\r\n                state.trackMiss += 1;\r\n                if (state.trackMiss > this.missTolerance) {\r\n                    state.showing = false;\r\n                    this.onToggleShowing?.(targetIndex, false);\r\n                }\r\n            } else {\r\n                state.trackMiss = 0;\r\n            }\r\n        }\r\n\r\n        return state.showing;\r\n    }\r\n}\r\n", "import { ControllerFeature } from \"./feature-base.js\";\r\n\r\nexport class AutoRotationFeature implements ControllerFeature {\r\n    id = \"auto-rotation\";\r\n    name = \"Auto Rotation Matrix\";\r\n    description = \"Automatically adjusts the world matrix if the input video is rotated (e.g. portrait mode).\";\r\n    enabled = true;\r\n\r\n    private inputWidth: number = 0;\r\n    private inputHeight: number = 0;\r\n\r\n    init(context: { inputWidth: number; inputHeight: number }) {\r\n        this.inputWidth = context.inputWidth;\r\n        this.inputHeight = context.inputHeight;\r\n    }\r\n\r\n    filterWorldMatrix(targetIndex: number, worldMatrix: number[]): number[] {\r\n        if (!this.enabled) return worldMatrix;\r\n\r\n        // Check if input is rotated (this logic might need the actual current input dimensions)\r\n        // For now, we'll assume the controller passes the 'isRotated' info or we detect it\r\n        // But since this is a matrix post-process, we can just apply it if needed.\r\n        return worldMatrix;\r\n    }\r\n\r\n    // We might need a way to pass the 'currentInput' to the feature.\r\n    // Actually, the controller can just call this if it detects rotation.\r\n    rotate(m: number[]): number[] {\r\n        return [\r\n            -m[1], m[0], m[2], m[3],\r\n            -m[5], m[4], m[6], m[7],\r\n            -m[9], m[8], m[10], m[11],\r\n            -m[13], m[12], m[14], m[15],\r\n        ];\r\n    }\r\n}\r\n", "/**\r\n * Foveal Attention System\r\n * \r\n * Mimics the human eye's fovea-parafovea-periphery structure:\r\n * - Fovea (center 5\u00B0): Maximum resolution, ~50% of visual processing power\r\n * - Parafovea (5-10\u00B0): Medium resolution, pattern recognition\r\n * - Periphery (>10\u00B0): Low resolution, motion detection\r\n * \r\n * This allows processing ~75% fewer pixels while maintaining\r\n * high-quality tracking in the area of interest.\r\n */\r\n\r\n/**\r\n * A region extracted at a specific resolution\r\n * @typedef {Object} AttentionRegion\r\n * @property {number} x - Center X coordinate in original image\r\n * @property {number} y - Center Y coordinate in original image\r\n * @property {number} radius - Radius in original image pixels\r\n * @property {number} resolution - Resolution multiplier (1.0 = full)\r\n * @property {Uint8Array} data - Extracted pixel data\r\n * @property {number} width - Width of extracted region\r\n * @property {number} height - Height of extracted region\r\n * @property {number} pixelCount - Number of pixels in region\r\n * @property {string} type - 'fovea' | 'parafovea' | 'periphery'\r\n */\r\n\r\nclass FovealAttention {\r\n    /**\r\n     * @param {number} width - Input image width\r\n     * @param {number} height - Input image height\r\n     * @param {Object} config - Configuration\r\n     */\r\n    constructor(width, height, config) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.config = config;\r\n\r\n        // Calculate region sizes\r\n        this.minDim = Math.min(width, height);\r\n        this.foveaRadius = Math.floor(this.minDim * config.FOVEA_RADIUS_RATIO);\r\n        this.parafoveaRadius = Math.floor(this.minDim * config.PARAFOVEA_RADIUS_RATIO);\r\n\r\n        // Pre-allocate buffers for each region type\r\n        this._initBuffers();\r\n    }\r\n\r\n    /**\r\n     * Initialize pre-allocated extraction buffers\r\n     * @private\r\n     */\r\n    _initBuffers() {\r\n        // Fovea buffer (full resolution, circular region)\r\n        const foveaDiam = this.foveaRadius * 2;\r\n        this.foveaBuffer = new Uint8Array(foveaDiam * foveaDiam);\r\n\r\n        // Parafovea buffer (half resolution)\r\n        const parafoveaDiam = this.parafoveaRadius * 2;\r\n        const parafoveaScaled = Math.ceil(parafoveaDiam * this.config.PARAFOVEA_RESOLUTION);\r\n        this.parafoveaBuffer = new Uint8Array(parafoveaScaled * parafoveaScaled);\r\n\r\n        // Periphery buffer (quarter resolution, full image)\r\n        const periphW = Math.ceil(this.width * this.config.PERIPHERY_RESOLUTION);\r\n        const periphH = Math.ceil(this.height * this.config.PERIPHERY_RESOLUTION);\r\n        this.peripheryBuffer = new Uint8Array(periphW * periphH);\r\n        this.peripheryDims = { width: periphW, height: periphH };\r\n\r\n        // Mask for circular extraction (reusable)\r\n        this._buildCircularMask();\r\n    }\r\n\r\n    /**\r\n     * Build a circular mask for foveal extraction\r\n     * @private\r\n     */\r\n    _buildCircularMask() {\r\n        const r = this.foveaRadius;\r\n        const size = r * 2;\r\n        this.circularMask = new Uint8Array(size * size);\r\n\r\n        for (let y = 0; y < size; y++) {\r\n            for (let x = 0; x < size; x++) {\r\n                const dx = x - r;\r\n                const dy = y - r;\r\n                const dist = Math.sqrt(dx * dx + dy * dy);\r\n                this.circularMask[y * size + x] = dist <= r ? 1 : 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Extract attention region at specified center\r\n     * \r\n     * @param {Uint8Array} inputData - Grayscale input image\r\n     * @param {number} centerX - X coordinate of attention center\r\n     * @param {number} centerY - Y coordinate of attention center\r\n     * @param {number} priority - Priority level (0=highest)\r\n     * @returns {AttentionRegion} Extracted region\r\n     */\r\n    extract(inputData, centerX, centerY, priority = 0) {\r\n        // Clamp center to valid range\r\n        centerX = Math.max(this.foveaRadius, Math.min(this.width - this.foveaRadius - 1, centerX));\r\n        centerY = Math.max(this.foveaRadius, Math.min(this.height - this.foveaRadius - 1, centerY));\r\n\r\n        // Priority 0 = full foveal extraction\r\n        // Priority 1 = parafoveal only\r\n        // Priority 2+ = periphery glimpse\r\n        if (priority === 0) {\r\n            return this._extractFovea(inputData, centerX, centerY);\r\n        } else if (priority === 1) {\r\n            return this._extractParafovea(inputData, centerX, centerY);\r\n        } else {\r\n            return this._extractPeriphery(inputData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Extract foveal region at full resolution\r\n     * @private\r\n     */\r\n    _extractFovea(inputData, cx, cy) {\r\n        const r = this.foveaRadius;\r\n        const diam = r * 2;\r\n        const buffer = this.foveaBuffer;\r\n\r\n        let idx = 0;\r\n        let validPixels = 0;\r\n\r\n        for (let dy = -r; dy < r; dy++) {\r\n            const y = cy + dy;\r\n            const rowStart = y * this.width;\r\n\r\n            for (let dx = -r; dx < r; dx++) {\r\n                const maskIdx = (dy + r) * diam + (dx + r);\r\n                if (this.circularMask[maskIdx]) {\r\n                    const x = cx + dx;\r\n                    buffer[idx] = inputData[rowStart + x];\r\n                    validPixels++;\r\n                } else {\r\n                    buffer[idx] = 0;\r\n                }\r\n                idx++;\r\n            }\r\n        }\r\n\r\n        return {\r\n            x: cx,\r\n            y: cy,\r\n            radius: r,\r\n            resolution: this.config.FOVEA_RESOLUTION,\r\n            data: buffer,\r\n            width: diam,\r\n            height: diam,\r\n            pixelCount: validPixels,\r\n            type: 'fovea',\r\n            // Transform helpers\r\n            toOriginalCoord: (localX, localY) => ({\r\n                x: cx - r + localX,\r\n                y: cy - r + localY,\r\n            }),\r\n            toLocalCoord: (origX, origY) => ({\r\n                x: origX - (cx - r),\r\n                y: origY - (cy - r),\r\n            }),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Extract parafoveal region at half resolution\r\n     * @private\r\n     */\r\n    _extractParafovea(inputData, cx, cy) {\r\n        const r = this.parafoveaRadius;\r\n        const res = this.config.PARAFOVEA_RESOLUTION;\r\n        const scaledR = Math.ceil(r * res);\r\n        const scaledDiam = scaledR * 2;\r\n        const buffer = this.parafoveaBuffer;\r\n        const step = Math.round(1 / res);\r\n\r\n        let idx = 0;\r\n        let validPixels = 0;\r\n\r\n        for (let sy = 0; sy < scaledDiam; sy++) {\r\n            const y = cy - r + Math.floor(sy / res);\r\n            if (y < 0 || y >= this.height) continue;\r\n            const rowStart = y * this.width;\r\n\r\n            for (let sx = 0; sx < scaledDiam; sx++) {\r\n                const x = cx - r + Math.floor(sx / res);\r\n                if (x < 0 || x >= this.width) {\r\n                    buffer[idx++] = 0;\r\n                    continue;\r\n                }\r\n\r\n                // Sample with bilinear interpolation for smoother downscaling\r\n                buffer[idx++] = inputData[rowStart + x];\r\n                validPixels++;\r\n            }\r\n        }\r\n\r\n        return {\r\n            x: cx,\r\n            y: cy,\r\n            radius: r,\r\n            resolution: res,\r\n            data: buffer,\r\n            width: scaledDiam,\r\n            height: scaledDiam,\r\n            pixelCount: validPixels,\r\n            type: 'parafovea',\r\n            toOriginalCoord: (localX, localY) => ({\r\n                x: cx - r + localX / res,\r\n                y: cy - r + localY / res,\r\n            }),\r\n            toLocalCoord: (origX, origY) => ({\r\n                x: (origX - (cx - r)) * res,\r\n                y: (origY - (cy - r)) * res,\r\n            }),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Extract periphery at quarter resolution (motion detection only)\r\n     * @private\r\n     */\r\n    _extractPeriphery(inputData) {\r\n        const res = this.config.PERIPHERY_RESOLUTION;\r\n        const outW = this.peripheryDims.width;\r\n        const outH = this.peripheryDims.height;\r\n        const buffer = this.peripheryBuffer;\r\n        const step = Math.round(1 / res);\r\n\r\n        let idx = 0;\r\n        for (let y = 0; y < this.height; y += step) {\r\n            const rowStart = y * this.width;\r\n            for (let x = 0; x < this.width; x += step) {\r\n                if (idx < buffer.length) {\r\n                    buffer[idx++] = inputData[rowStart + x];\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            x: this.width / 2,\r\n            y: this.height / 2,\r\n            radius: Math.max(this.width, this.height) / 2,\r\n            resolution: res,\r\n            data: buffer,\r\n            width: outW,\r\n            height: outH,\r\n            pixelCount: outW * outH,\r\n            type: 'periphery',\r\n            toOriginalCoord: (localX, localY) => ({\r\n                x: localX / res,\r\n                y: localY / res,\r\n            }),\r\n            toLocalCoord: (origX, origY) => ({\r\n                x: origX * res,\r\n                y: origY * res,\r\n            }),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get combined multi-resolution representation\r\n     * Uses fovea at center, parafovea around it, periphery for the rest\r\n     * \r\n     * @param {Uint8Array} inputData - Input image\r\n     * @param {number} cx - Fovea center X\r\n     * @param {number} cy - Fovea center Y\r\n     * @returns {Object} Multi-resolution representation\r\n     */\r\n    extractMultiResolution(inputData, cx, cy) {\r\n        return {\r\n            fovea: this._extractFovea(inputData, cx, cy),\r\n            parafovea: this._extractParafovea(inputData, cx, cy),\r\n            periphery: this._extractPeriphery(inputData),\r\n            center: { x: cx, y: cy },\r\n            totalPixels: this._computeTotalPixels(),\r\n            originalPixels: this.width * this.height,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Compute total pixels in multi-resolution representation\r\n     * @private\r\n     */\r\n    _computeTotalPixels() {\r\n        const foveaPixels = Math.PI * this.foveaRadius ** 2;\r\n        const parafoveaPixels = Math.PI * this.parafoveaRadius ** 2 * this.config.PARAFOVEA_RESOLUTION ** 2;\r\n        const peripheryPixels = this.peripheryDims.width * this.peripheryDims.height;\r\n        return Math.ceil(foveaPixels + parafoveaPixels + peripheryPixels);\r\n    }\r\n\r\n    /**\r\n     * Update configuration\r\n     * @param {Object} config - New configuration\r\n     */\r\n    configure(config) {\r\n        this.config = { ...this.config, ...config };\r\n        this.foveaRadius = Math.floor(this.minDim * config.FOVEA_RADIUS_RATIO);\r\n        this.parafoveaRadius = Math.floor(this.minDim * config.PARAFOVEA_RADIUS_RATIO);\r\n        this._initBuffers();\r\n    }\r\n}\r\n\r\nexport { FovealAttention };\r\n", "/**\r\n * Saccadic Controller\r\n * \r\n * Mimics human eye saccades - rapid movements that redirect foveal attention\r\n * to areas of interest. The human eye makes 3-4 saccades per second to\r\n * build a complete picture of the visual scene.\r\n * \r\n * Strategy:\r\n * 1. Compute saliency map to find \"interesting\" regions\r\n * 2. Use tracking state to predict where features should be\r\n * 3. Generate priority-ordered list of \"glance\" targets\r\n * 4. Limit saccades per frame to balance coverage vs. efficiency\r\n */\r\n\r\n/**\r\n * A saccade target representing where attention should be directed\r\n * @typedef {Object} SaccadeTarget\r\n * @property {number} x - X coordinate\r\n * @property {number} y - Y coordinate\r\n * @property {number} priority - Priority (0 = highest)\r\n * @property {string} reason - Why this target was selected\r\n * @property {number} saliency - Saliency score at this location\r\n */\r\n\r\nclass SaccadicController {\r\n    /**\r\n     * @param {number} width - Image width\r\n     * @param {number} height - Image height\r\n     * @param {Object} config - Configuration\r\n     */\r\n    constructor(width, height, config) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.config = config;\r\n\r\n        // Saccade history for inhibition of return\r\n        this.recentTargets = [];\r\n        this.inhibitionRadius = Math.min(width, height) * 0.1;\r\n\r\n        // Movement prediction\r\n        this.velocityHistory = [];\r\n        this.lastCenter = { x: width / 2, y: height / 2 };\r\n\r\n        // Grid for systematic coverage\r\n        this.gridCells = this._buildCoverageGrid(3, 3);\r\n        this.lastVisitedCell = 4; // Center\r\n\r\n        // State\r\n        this.lastSaccadeTime = 0;\r\n        this.saccadeCount = 0;\r\n    }\r\n\r\n    /**\r\n     * Build a grid for systematic coverage during tracking loss\r\n     * @private\r\n     */\r\n    _buildCoverageGrid(rows, cols) {\r\n        const cells = [];\r\n        const cellW = this.width / cols;\r\n        const cellH = this.height / rows;\r\n\r\n        for (let r = 0; r < rows; r++) {\r\n            for (let c = 0; c < cols; c++) {\r\n                cells.push({\r\n                    x: cellW * (c + 0.5),\r\n                    y: cellH * (r + 0.5),\r\n                    index: r * cols + c,\r\n                    lastVisit: 0,\r\n                });\r\n            }\r\n        }\r\n        return cells;\r\n    }\r\n\r\n    /**\r\n     * Compute saccade targets based on current state\r\n     * \r\n     * @param {Object} saliency - Saliency map result\r\n     * @param {Object} currentFovea - Current fovea center {x, y}\r\n     * @param {Object} trackingState - Current tracking state (optional)\r\n     * @returns {SaccadeTarget[]} Priority-ordered list of targets\r\n     */\r\n    computeTargets(saliency, currentFovea, trackingState = null) {\r\n        const targets = [];\r\n        const maxTargets = this.config.MAX_SACCADES_PER_FRAME;\r\n\r\n        // Strategy 1: Follow tracking prediction (highest priority)\r\n        if (trackingState && trackingState.isTracking) {\r\n            const predicted = this._predictTrackingCenter(trackingState);\r\n            if (predicted) {\r\n                targets.push({\r\n                    x: predicted.x,\r\n                    y: predicted.y,\r\n                    priority: 0,\r\n                    reason: 'tracking_prediction',\r\n                    saliency: 1.0,\r\n                });\r\n            }\r\n        }\r\n\r\n        // Strategy 2: High saliency regions\r\n        if (saliency && saliency.peaks) {\r\n            for (const peak of saliency.peaks) {\r\n                if (targets.length >= maxTargets) break;\r\n\r\n                // Skip if too close to existing targets (inhibition of return)\r\n                if (this._isInhibited(peak.x, peak.y, targets)) continue;\r\n\r\n                if (peak.value > this.config.SALIENCY_THRESHOLD) {\r\n                    targets.push({\r\n                        x: peak.x,\r\n                        y: peak.y,\r\n                        priority: targets.length,\r\n                        reason: 'saliency_peak',\r\n                        saliency: peak.value,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Strategy 3: Systematic grid search (when not tracking)\r\n        if (!trackingState?.isTracking && targets.length < maxTargets) {\r\n            const gridTarget = this._getNextGridCell();\r\n            if (gridTarget && !this._isInhibited(gridTarget.x, gridTarget.y, targets)) {\r\n                targets.push({\r\n                    x: gridTarget.x,\r\n                    y: gridTarget.y,\r\n                    priority: targets.length,\r\n                    reason: 'grid_search',\r\n                    saliency: 0.5,\r\n                });\r\n            }\r\n        }\r\n\r\n        // Strategy 4: Stay at current center if no better options\r\n        if (targets.length === 0) {\r\n            targets.push({\r\n                x: currentFovea.x,\r\n                y: currentFovea.y,\r\n                priority: 0,\r\n                reason: 'maintain_position',\r\n                saliency: 0.3,\r\n            });\r\n        }\r\n\r\n        // Update history\r\n        this._updateHistory(targets);\r\n\r\n        return targets;\r\n    }\r\n\r\n    /**\r\n     * Predict center of tracking based on current state and velocity\r\n     * @private\r\n     */\r\n    _predictTrackingCenter(trackingState) {\r\n        if (!trackingState.worldMatrix) return null;\r\n\r\n        // Extract center from world matrix\r\n        const matrix = trackingState.worldMatrix;\r\n        const cx = matrix[12] || this.width / 2;\r\n        const cy = matrix[13] || this.height / 2;\r\n\r\n        // Apply velocity-based prediction\r\n        if (this.velocityHistory.length >= 2) {\r\n            const vx = this._computeAverageVelocity('x');\r\n            const vy = this._computeAverageVelocity('y');\r\n\r\n            // Predict 1 frame ahead\r\n            return {\r\n                x: Math.max(0, Math.min(this.width - 1, cx + vx)),\r\n                y: Math.max(0, Math.min(this.height - 1, cy + vy)),\r\n            };\r\n        }\r\n\r\n        return { x: cx, y: cy };\r\n    }\r\n\r\n    /**\r\n     * Compute average velocity from history\r\n     * @private\r\n     */\r\n    _computeAverageVelocity(axis) {\r\n        if (this.velocityHistory.length < 2) return 0;\r\n\r\n        let sum = 0;\r\n        for (let i = 1; i < this.velocityHistory.length; i++) {\r\n            sum += this.velocityHistory[i][axis] - this.velocityHistory[i - 1][axis];\r\n        }\r\n        return sum / (this.velocityHistory.length - 1);\r\n    }\r\n\r\n    /**\r\n     * Check if a location is inhibited (too close to recent targets)\r\n     * @private\r\n     */\r\n    _isInhibited(x, y, currentTargets) {\r\n        const r2 = this.inhibitionRadius ** 2;\r\n\r\n        // Check against current frame targets\r\n        for (const t of currentTargets) {\r\n            const dx = x - t.x;\r\n            const dy = y - t.y;\r\n            if (dx * dx + dy * dy < r2) return true;\r\n        }\r\n\r\n        // Check against recent history\r\n        for (const t of this.recentTargets) {\r\n            const dx = x - t.x;\r\n            const dy = y - t.y;\r\n            if (dx * dx + dy * dy < r2) return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Get next grid cell for systematic search\r\n     * @private\r\n     */\r\n    _getNextGridCell() {\r\n        // Find least recently visited cell\r\n        let oldest = this.gridCells[0];\r\n        let oldestTime = Infinity;\r\n\r\n        for (const cell of this.gridCells) {\r\n            if (cell.lastVisit < oldestTime) {\r\n                oldestTime = cell.lastVisit;\r\n                oldest = cell;\r\n            }\r\n        }\r\n\r\n        oldest.lastVisit = Date.now();\r\n        return oldest;\r\n    }\r\n\r\n    /**\r\n     * Update history with new targets\r\n     * @private\r\n     */\r\n    _updateHistory(targets) {\r\n        // Add to recent targets for inhibition of return\r\n        this.recentTargets.push(...targets);\r\n\r\n        // Keep only last N targets\r\n        const maxHistory = this.config.MOTION_HISTORY_FRAMES * this.config.MAX_SACCADES_PER_FRAME;\r\n        while (this.recentTargets.length > maxHistory) {\r\n            this.recentTargets.shift();\r\n        }\r\n\r\n        // Update velocity history\r\n        if (targets.length > 0) {\r\n            this.velocityHistory.push({ x: targets[0].x, y: targets[0].y });\r\n            while (this.velocityHistory.length > this.config.MOTION_HISTORY_FRAMES) {\r\n                this.velocityHistory.shift();\r\n            }\r\n            this.lastCenter = { x: targets[0].x, y: targets[0].y };\r\n        }\r\n\r\n        this.saccadeCount += targets.length;\r\n        this.lastSaccadeTime = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Get the most likely location of interest based on history\r\n     * @returns {Object} {x, y} of predicted location\r\n     */\r\n    getPredictedLocation() {\r\n        if (this.velocityHistory.length >= 2) {\r\n            const vx = this._computeAverageVelocity('x');\r\n            const vy = this._computeAverageVelocity('y');\r\n            return {\r\n                x: Math.max(0, Math.min(this.width - 1, this.lastCenter.x + vx)),\r\n                y: Math.max(0, Math.min(this.height - 1, this.lastCenter.y + vy)),\r\n            };\r\n        }\r\n        return this.lastCenter;\r\n    }\r\n\r\n    /**\r\n     * Reset controller state\r\n     */\r\n    reset() {\r\n        this.recentTargets = [];\r\n        this.velocityHistory = [];\r\n        this.lastCenter = { x: this.width / 2, y: this.height / 2 };\r\n        this.saccadeCount = 0;\r\n\r\n        for (const cell of this.gridCells) {\r\n            cell.lastVisit = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update configuration\r\n     */\r\n    configure(config) {\r\n        this.config = { ...this.config, ...config };\r\n        this.inhibitionRadius = Math.min(this.width, this.height) * 0.1;\r\n    }\r\n}\r\n\r\nexport { SaccadicController };\r\n", "/**\r\n * Predictive Coding System\r\n * \r\n * Inspired by the brain's predictive processing theory:\r\n * - The brain constantly predicts incoming sensory data\r\n * - Only \"prediction errors\" (unexpected changes) are processed fully\r\n * - If prediction matches reality, minimal processing is needed\r\n * \r\n * For AR tracking:\r\n * - Predict next frame based on motion model\r\n * - Compare prediction to actual frame\r\n * - Skip or minimize processing if difference is below threshold\r\n * - In static scenes, ~90% of frames can be skipped\r\n */\r\n\r\nclass PredictiveCoding {\r\n    /**\r\n     * @param {number} width - Image width\r\n     * @param {number} height - Image height  \r\n     * @param {Object} config - Configuration\r\n     */\r\n    constructor(width, height, config) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.config = config;\r\n\r\n        // Frame history for prediction\r\n        this.frameHistory = [];\r\n        this.stateHistory = [];\r\n\r\n        // Motion model parameters\r\n        this.motionModel = {\r\n            vx: 0,           // Velocity X\r\n            vy: 0,           // Velocity Y\r\n            vtheta: 0,       // Angular velocity\r\n            vscale: 0,       // Scale velocity\r\n            confidence: 0,   // Model confidence\r\n        };\r\n\r\n        // Block-based change detection (8x8 blocks)\r\n        this.blockSize = 8;\r\n        this.blocksX = Math.ceil(width / this.blockSize);\r\n        this.blocksY = Math.ceil(height / this.blockSize);\r\n        this.blockMeans = new Float32Array(this.blocksX * this.blocksY);\r\n        this.prevBlockMeans = new Float32Array(this.blocksX * this.blocksY);\r\n\r\n        // Statistics\r\n        this.consecutiveSkips = 0;\r\n        this.maxConsecutiveSkips = 10; // Force processing every N frames\r\n    }\r\n\r\n    /**\r\n     * Predict whether current frame can be skipped\r\n     * \r\n     * @param {Uint8Array} inputData - Current frame grayscale data\r\n     * @param {Object} trackingState - Current tracking state\r\n     * @returns {Object} Prediction result\r\n     */\r\n    predict(inputData, trackingState) {\r\n        // Always process first few frames\r\n        if (this.frameHistory.length < 2) {\r\n            return { canSkip: false, confidence: 0, reason: 'insufficient_history' };\r\n        }\r\n\r\n        // Force processing periodically\r\n        if (this.consecutiveSkips >= this.maxConsecutiveSkips) {\r\n            return { canSkip: false, confidence: 0, reason: 'forced_refresh' };\r\n        }\r\n\r\n        // Compute change level\r\n        const changeLevel = this.getChangeLevel(inputData);\r\n\r\n        // If not tracking, be more conservative\r\n        const threshold = trackingState?.isTracking\r\n            ? this.config.CHANGE_THRESHOLD\r\n            : this.config.CHANGE_THRESHOLD * 0.5;\r\n\r\n        // Decision\r\n        const canSkip = changeLevel < threshold;\r\n        const confidence = canSkip\r\n            ? Math.min(1, (threshold - changeLevel) / threshold)\r\n            : 0;\r\n\r\n        // Predict state if skipping\r\n        let predictedState = null;\r\n        if (canSkip && trackingState) {\r\n            predictedState = this._predictState(trackingState);\r\n        }\r\n\r\n        if (canSkip) {\r\n            this.consecutiveSkips++;\r\n        }\r\n\r\n        return {\r\n            canSkip,\r\n            confidence,\r\n            changeLevel,\r\n            predictedState,\r\n            reason: canSkip ? 'low_change' : 'significant_change',\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Compute change level between current and previous frame\r\n     * Uses block-based comparison for efficiency\r\n     * \r\n     * @param {Uint8Array} inputData - Current frame\r\n     * @returns {number} Change level (0-1)\r\n     */\r\n    getChangeLevel(inputData) {\r\n        if (this.frameHistory.length === 0) {\r\n            return 1.0; // Assume maximum change for first frame\r\n        }\r\n\r\n        // Compute block means for current frame\r\n        this._computeBlockMeans(inputData, this.blockMeans);\r\n\r\n        // Compare with previous block means\r\n        let totalDiff = 0;\r\n        let maxDiff = 0;\r\n        const numBlocks = this.blocksX * this.blocksY;\r\n\r\n        for (let i = 0; i < numBlocks; i++) {\r\n            const diff = Math.abs(this.blockMeans[i] - this.prevBlockMeans[i]) / 255;\r\n            totalDiff += diff;\r\n            maxDiff = Math.max(maxDiff, diff);\r\n        }\r\n\r\n        // Combine average and max differences\r\n        const avgDiff = totalDiff / numBlocks;\r\n        const changeLevel = avgDiff * 0.7 + maxDiff * 0.3;\r\n\r\n        return Math.min(1, changeLevel);\r\n    }\r\n\r\n    /**\r\n     * Compute mean intensity for each block\r\n     * @private\r\n     */\r\n    _computeBlockMeans(data, output) {\r\n        const bs = this.blockSize;\r\n        const w = this.width;\r\n\r\n        for (let by = 0; by < this.blocksY; by++) {\r\n            const yStart = by * bs;\r\n            const yEnd = Math.min(yStart + bs, this.height);\r\n\r\n            for (let bx = 0; bx < this.blocksX; bx++) {\r\n                const xStart = bx * bs;\r\n                const xEnd = Math.min(xStart + bs, this.width);\r\n\r\n                let sum = 0;\r\n                let count = 0;\r\n\r\n                for (let y = yStart; y < yEnd; y++) {\r\n                    const rowOffset = y * w;\r\n                    for (let x = xStart; x < xEnd; x++) {\r\n                        sum += data[rowOffset + x];\r\n                        count++;\r\n                    }\r\n                }\r\n\r\n                output[by * this.blocksX + bx] = sum / count;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Predict next tracking state based on motion model\r\n     * @private\r\n     */\r\n    _predictState(currentState) {\r\n        if (!currentState.worldMatrix) return null;\r\n\r\n        // Extract current parameters\r\n        const matrix = currentState.worldMatrix;\r\n\r\n        // Apply motion model\r\n        const predictedMatrix = new Float32Array(16);\r\n        for (let i = 0; i < 16; i++) {\r\n            predictedMatrix[i] = matrix[i];\r\n        }\r\n\r\n        // Add predicted motion\r\n        predictedMatrix[12] += this.motionModel.vx;\r\n        predictedMatrix[13] += this.motionModel.vy;\r\n\r\n        // Apply scale change (to diagonal elements)\r\n        const scaleFactor = 1 + this.motionModel.vscale;\r\n        predictedMatrix[0] *= scaleFactor;\r\n        predictedMatrix[5] *= scaleFactor;\r\n        predictedMatrix[10] *= scaleFactor;\r\n\r\n        return {\r\n            worldMatrix: predictedMatrix,\r\n            isTracking: true,\r\n            isPredicted: true,\r\n            predictionConfidence: this.motionModel.confidence,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Store frame for future prediction\r\n     * \r\n     * @param {Uint8Array} inputData - Frame data\r\n     * @param {Object} trackingState - Tracking state\r\n     */\r\n    storeFrame(inputData, trackingState) {\r\n        // Copy current block means to previous before computing new\r\n        for (let i = 0; i < this.blockMeans.length; i++) {\r\n            this.prevBlockMeans[i] = this.blockMeans[i];\r\n        }\r\n        // Compute new block means\r\n        this._computeBlockMeans(inputData, this.blockMeans);\r\n\r\n        // Store state\r\n        if (trackingState?.worldMatrix) {\r\n            this.stateHistory.push({\r\n                timestamp: Date.now(),\r\n                matrix: new Float32Array(trackingState.worldMatrix),\r\n            });\r\n\r\n            // Update motion model\r\n            this._updateMotionModel();\r\n\r\n            // Keep history bounded\r\n            while (this.stateHistory.length > this.config.MOTION_HISTORY_FRAMES) {\r\n                this.stateHistory.shift();\r\n            }\r\n        }\r\n\r\n        // Reset skip counter\r\n        this.consecutiveSkips = 0;\r\n\r\n        // Keep frame count bounded\r\n        this.frameHistory.push(Date.now());\r\n        while (this.frameHistory.length > this.config.MOTION_HISTORY_FRAMES) {\r\n            this.frameHistory.shift();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update motion model from state history\r\n     * @private\r\n     */\r\n    _updateMotionModel() {\r\n        const history = this.stateHistory;\r\n        if (history.length < 2) {\r\n            this.motionModel.confidence = 0;\r\n            return;\r\n        }\r\n\r\n        // Compute velocity from recent frames\r\n        const n = history.length;\r\n        const latest = history[n - 1].matrix;\r\n        const prev = history[n - 2].matrix;\r\n        const dt = (history[n - 1].timestamp - history[n - 2].timestamp) / 1000;\r\n\r\n        if (dt > 0) {\r\n            // Position velocity\r\n            this.motionModel.vx = (latest[12] - prev[12]) / dt * 0.016; // Normalize to ~60fps\r\n            this.motionModel.vy = (latest[13] - prev[13]) / dt * 0.016;\r\n\r\n            // Scale velocity (from diagonal average)\r\n            const prevScale = (Math.abs(prev[0]) + Math.abs(prev[5])) / 2;\r\n            const currScale = (Math.abs(latest[0]) + Math.abs(latest[5])) / 2;\r\n            this.motionModel.vscale = (currScale - prevScale) / prevScale / dt * 0.016;\r\n\r\n            // Compute confidence based on consistency\r\n            if (history.length >= 3) {\r\n                const older = history[n - 3].matrix;\r\n                const expectedVx = (prev[12] - older[12]) / dt * 0.016;\r\n                const expectedVy = (prev[13] - older[13]) / dt * 0.016;\r\n\r\n                const errorX = Math.abs(this.motionModel.vx - expectedVx);\r\n                const errorY = Math.abs(this.motionModel.vy - expectedVy);\r\n                const error = Math.sqrt(errorX * errorX + errorY * errorY);\r\n\r\n                this.motionModel.confidence = Math.max(0, 1 - error / 10);\r\n            } else {\r\n                this.motionModel.confidence = 0.5;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if we're in a static scene (good candidate for aggressive skipping)\r\n     * @returns {boolean} True if scene appears static\r\n     */\r\n    isStaticScene() {\r\n        if (this.stateHistory.length < 3) return false;\r\n\r\n        const velocity = Math.sqrt(\r\n            this.motionModel.vx ** 2 +\r\n            this.motionModel.vy ** 2\r\n        );\r\n\r\n        return velocity < 0.5 && Math.abs(this.motionModel.vscale) < 0.01;\r\n    }\r\n\r\n    /**\r\n     * Reset prediction state\r\n     */\r\n    reset() {\r\n        this.frameHistory = [];\r\n        this.stateHistory = [];\r\n        this.consecutiveSkips = 0;\r\n        this.motionModel = {\r\n            vx: 0,\r\n            vy: 0,\r\n            vtheta: 0,\r\n            vscale: 0,\r\n            confidence: 0,\r\n        };\r\n        this.blockMeans.fill(0);\r\n        this.prevBlockMeans.fill(0);\r\n    }\r\n\r\n    /**\r\n     * Update configuration\r\n     */\r\n    configure(config) {\r\n        this.config = { ...this.config, ...config };\r\n    }\r\n}\r\n\r\nexport { PredictiveCoding };\r\n", "/**\r\n * Saliency Map Computation\r\n * \r\n * Computes visual saliency - regions that \"pop out\" and attract attention.\r\n * Used to guide saccadic attention to visually important areas.\r\n * \r\n * Implements a simplified Itti-Koch saliency model:\r\n * - Intensity contrast\r\n * - Edge density\r\n * - Local complexity\r\n * \r\n * For AR tracking, high-saliency regions often contain:\r\n * - Corners and edges (good for feature detection)\r\n * - High-contrast areas (robust to lighting changes)\r\n * - Texture-rich regions (distinctive for matching)\r\n */\r\n\r\nclass SaliencyMap {\r\n    /**\r\n     * @param {number} width - Image width\r\n     * @param {number} height - Image height\r\n     */\r\n    constructor(width, height) {\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        // Downsampled dimensions for efficiency\r\n        this.scale = 8; // Process at 1/8 resolution\r\n        this.scaledW = Math.ceil(width / this.scale);\r\n        this.scaledH = Math.ceil(height / this.scale);\r\n\r\n        // Pre-allocate buffers\r\n        this.intensityMap = new Float32Array(this.scaledW * this.scaledH);\r\n        this.contrastMap = new Float32Array(this.scaledW * this.scaledH);\r\n        this.edgeMap = new Float32Array(this.scaledW * this.scaledH);\r\n        this.saliencyBuffer = new Float32Array(this.scaledW * this.scaledH);\r\n\r\n        // Peak detection parameters\r\n        this.maxPeaks = 5;\r\n        this.suppressionRadius = Math.max(this.scaledW, this.scaledH) * 0.15;\r\n    }\r\n\r\n    /**\r\n     * Compute saliency map for input image\r\n     * \r\n     * @param {Uint8Array} inputData - Grayscale input image\r\n     * @returns {Object} Saliency result with peaks\r\n     */\r\n    compute(inputData) {\r\n        // Step 1: Downsample and compute intensity\r\n        this._downsample(inputData);\r\n\r\n        // Step 2: Compute features\r\n        this._computeContrast();\r\n        this._computeEdges();\r\n\r\n        // Step 3: Combine into saliency map\r\n        this._combineSaliency();\r\n\r\n        // Step 4: Find peaks\r\n        const peaks = this._findPeaks();\r\n\r\n        return {\r\n            map: this.saliencyBuffer,\r\n            width: this.scaledW,\r\n            height: this.scaledH,\r\n            peaks,\r\n            maxSaliency: peaks.length > 0 ? peaks[0].value : 0,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Downsample input to working resolution\r\n     * @private\r\n     */\r\n    _downsample(inputData) {\r\n        const s = this.scale;\r\n        const w = this.width;\r\n\r\n        for (let sy = 0; sy < this.scaledH; sy++) {\r\n            const yStart = sy * s;\r\n            const yEnd = Math.min(yStart + s, this.height);\r\n\r\n            for (let sx = 0; sx < this.scaledW; sx++) {\r\n                const xStart = sx * s;\r\n                const xEnd = Math.min(xStart + s, this.width);\r\n\r\n                let sum = 0;\r\n                let count = 0;\r\n\r\n                for (let y = yStart; y < yEnd; y++) {\r\n                    const rowOffset = y * w;\r\n                    for (let x = xStart; x < xEnd; x++) {\r\n                        sum += inputData[rowOffset + x];\r\n                        count++;\r\n                    }\r\n                }\r\n\r\n                this.intensityMap[sy * this.scaledW + sx] = sum / count / 255;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Compute local contrast map\r\n     * @private\r\n     */\r\n    _computeContrast() {\r\n        const w = this.scaledW;\r\n        const h = this.scaledH;\r\n        const intensity = this.intensityMap;\r\n        const contrast = this.contrastMap;\r\n\r\n        // 3x3 local contrast using center-surround\r\n        for (let y = 1; y < h - 1; y++) {\r\n            for (let x = 1; x < w - 1; x++) {\r\n                const idx = y * w + x;\r\n                const center = intensity[idx];\r\n\r\n                // Compute average of 8 neighbors\r\n                let surround = 0;\r\n                surround += intensity[(y - 1) * w + (x - 1)];\r\n                surround += intensity[(y - 1) * w + x];\r\n                surround += intensity[(y - 1) * w + (x + 1)];\r\n                surround += intensity[y * w + (x - 1)];\r\n                surround += intensity[y * w + (x + 1)];\r\n                surround += intensity[(y + 1) * w + (x - 1)];\r\n                surround += intensity[(y + 1) * w + x];\r\n                surround += intensity[(y + 1) * w + (x + 1)];\r\n                surround /= 8;\r\n\r\n                // Contrast is absolute difference\r\n                contrast[idx] = Math.abs(center - surround);\r\n            }\r\n        }\r\n\r\n        // Handle borders\r\n        for (let y = 0; y < h; y++) {\r\n            contrast[y * w] = 0;\r\n            contrast[y * w + w - 1] = 0;\r\n        }\r\n        for (let x = 0; x < w; x++) {\r\n            contrast[x] = 0;\r\n            contrast[(h - 1) * w + x] = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Compute edge density map using Sobel-like operator\r\n     * @private\r\n     */\r\n    _computeEdges() {\r\n        const w = this.scaledW;\r\n        const h = this.scaledH;\r\n        const intensity = this.intensityMap;\r\n        const edges = this.edgeMap;\r\n\r\n        for (let y = 1; y < h - 1; y++) {\r\n            for (let x = 1; x < w - 1; x++) {\r\n                // Simplified Sobel\r\n                const gx =\r\n                    -intensity[(y - 1) * w + (x - 1)] + intensity[(y - 1) * w + (x + 1)] +\r\n                    -2 * intensity[y * w + (x - 1)] + 2 * intensity[y * w + (x + 1)] +\r\n                    -intensity[(y + 1) * w + (x - 1)] + intensity[(y + 1) * w + (x + 1)];\r\n\r\n                const gy =\r\n                    -intensity[(y - 1) * w + (x - 1)] - 2 * intensity[(y - 1) * w + x] - intensity[(y - 1) * w + (x + 1)] +\r\n                    intensity[(y + 1) * w + (x - 1)] + 2 * intensity[(y + 1) * w + x] + intensity[(y + 1) * w + (x + 1)];\r\n\r\n                edges[y * w + x] = Math.sqrt(gx * gx + gy * gy) / 4; // Normalize\r\n            }\r\n        }\r\n\r\n        // Handle borders\r\n        for (let y = 0; y < h; y++) {\r\n            edges[y * w] = 0;\r\n            edges[y * w + w - 1] = 0;\r\n        }\r\n        for (let x = 0; x < w; x++) {\r\n            edges[x] = 0;\r\n            edges[(h - 1) * w + x] = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Combine features into final saliency map\r\n     * @private\r\n     */\r\n    _combineSaliency() {\r\n        const n = this.saliencyBuffer.length;\r\n        const contrast = this.contrastMap;\r\n        const edges = this.edgeMap;\r\n        const saliency = this.saliencyBuffer;\r\n\r\n        // Weight: 60% contrast, 40% edges\r\n        for (let i = 0; i < n; i++) {\r\n            saliency[i] = contrast[i] * 0.6 + edges[i] * 0.4;\r\n        }\r\n\r\n        // Normalize to [0, 1]\r\n        let max = 0;\r\n        for (let i = 0; i < n; i++) {\r\n            max = Math.max(max, saliency[i]);\r\n        }\r\n\r\n        if (max > 0) {\r\n            for (let i = 0; i < n; i++) {\r\n                saliency[i] /= max;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Find peaks in saliency map using non-maximum suppression\r\n     * @private\r\n     */\r\n    _findPeaks() {\r\n        const w = this.scaledW;\r\n        const h = this.scaledH;\r\n        const saliency = this.saliencyBuffer;\r\n        const peaks = [];\r\n        const r = this.suppressionRadius;\r\n        const r2 = r * r;\r\n\r\n        // Find all local maxima\r\n        const candidates = [];\r\n        for (let y = 1; y < h - 1; y++) {\r\n            for (let x = 1; x < w - 1; x++) {\r\n                const idx = y * w + x;\r\n                const val = saliency[idx];\r\n\r\n                // Check if local maximum (8-connected)\r\n                if (val > saliency[(y - 1) * w + (x - 1)] &&\r\n                    val > saliency[(y - 1) * w + x] &&\r\n                    val > saliency[(y - 1) * w + (x + 1)] &&\r\n                    val > saliency[y * w + (x - 1)] &&\r\n                    val > saliency[y * w + (x + 1)] &&\r\n                    val > saliency[(y + 1) * w + (x - 1)] &&\r\n                    val > saliency[(y + 1) * w + x] &&\r\n                    val > saliency[(y + 1) * w + (x + 1)]) {\r\n                    candidates.push({ x, y, value: val });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sort by value descending\r\n        candidates.sort((a, b) => b.value - a.value);\r\n\r\n        // Non-maximum suppression\r\n        for (const cand of candidates) {\r\n            if (peaks.length >= this.maxPeaks) break;\r\n\r\n            // Check if too close to existing peaks\r\n            let suppress = false;\r\n            for (const peak of peaks) {\r\n                const dx = cand.x - peak.x;\r\n                const dy = cand.y - peak.y;\r\n                if (dx * dx + dy * dy < r2) {\r\n                    suppress = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!suppress) {\r\n                // Convert to original image coordinates\r\n                peaks.push({\r\n                    x: (cand.x + 0.5) * this.scale,\r\n                    y: (cand.y + 0.5) * this.scale,\r\n                    value: cand.value,\r\n                });\r\n            }\r\n        }\r\n\r\n        return peaks;\r\n    }\r\n\r\n    /**\r\n     * Get saliency value at a specific location\r\n     * \r\n     * @param {number} x - X coordinate in original image\r\n     * @param {number} y - Y coordinate in original image\r\n     * @returns {number} Saliency value (0-1)\r\n     */\r\n    getSaliencyAt(x, y) {\r\n        const sx = Math.floor(x / this.scale);\r\n        const sy = Math.floor(y / this.scale);\r\n\r\n        if (sx < 0 || sx >= this.scaledW || sy < 0 || sy >= this.scaledH) {\r\n            return 0;\r\n        }\r\n\r\n        return this.saliencyBuffer[sy * this.scaledW + sx];\r\n    }\r\n}\r\n\r\nexport { SaliencyMap };\r\n", "/**\r\n * Scale Orchestrator\r\n * \r\n * Manages which octaves should be processed based on the current tracking state.\r\n * Implements temporal consistency and interleave strategies to optimize performance.\r\n */\r\nexport class ScaleOrchestrator {\r\n    constructor(numOctaves, options = {}) {\r\n        this.numOctaves = numOctaves;\r\n        this.options = {\r\n            interleaveInterval: 10,\r\n            hysteresis: 1, // Number of adjacent octaves to keep\r\n            ...options\r\n        };\r\n\r\n        this.frameCount = 0;\r\n        this.lastActiveOctave = -1;\r\n        this.interleaveOctave = 0;\r\n    }\r\n\r\n    /**\r\n     * Determine which octaves should be processed in the current frame\r\n     * \r\n     * @param {Object} trackingState - Current state of tracking\r\n     * @returns {number[]} Array of octave indices to process\r\n     */\r\n    getOctavesToProcess(trackingState = null) {\r\n        this.frameCount++;\r\n\r\n        // Case 1: No tracking or lost tracking -> Process all octaves\r\n        if (!trackingState || !trackingState.isTracking || trackingState.activeOctave === undefined) {\r\n            this.lastActiveOctave = -1;\r\n            return Array.from({ length: this.numOctaves }, (_, i) => i);\r\n        }\r\n\r\n        const activeScale = trackingState.activeOctave;\r\n        this.lastActiveOctave = activeScale;\r\n\r\n        // Case 2: Active tracking -> Focus on current scale and neighbors\r\n        const octaves = new Set();\r\n\r\n        // Add current and adjacent scales (Hysteresis)\r\n        for (let i = -this.options.hysteresis; i <= this.options.hysteresis; i++) {\r\n            const octave = activeScale + i;\r\n            if (octave >= 0 && octave < this.numOctaves) {\r\n                octaves.add(octave);\r\n            }\r\n        }\r\n\r\n        // Case 3: Interleave - Periodically check a distant octave to ensure we don't \"drift\"\r\n        if (this.frameCount % this.options.interleaveInterval === 0) {\r\n            this.interleaveOctave = (this.interleaveOctave + 1) % this.numOctaves;\r\n            // If the interleave octave is already being processed, pick the next one\r\n            if (octaves.has(this.interleaveOctave)) {\r\n                this.interleaveOctave = (this.interleaveOctave + 1) % this.numOctaves;\r\n            }\r\n            octaves.add(this.interleaveOctave);\r\n\r\n            if (this.options.debug) {\r\n                console.log(`[ScaleOrchestrator] Interleave check on octave ${this.interleaveOctave}`);\r\n            }\r\n        }\r\n\r\n        const result = Array.from(octaves).sort((a, b) => a - b);\r\n\r\n        if (this.options.debug) {\r\n            console.log(`[ScaleOrchestrator] Active: ${activeScale}, Processing: [${result.join(', ')}]`);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Reset orchestrator state\r\n     */\r\n    reset() {\r\n        this.frameCount = 0;\r\n        this.lastActiveOctave = -1;\r\n    }\r\n}\r\n", "/**\r\n * Bio-Inspired Perception Engine\r\n * \r\n * Inspired by human visual system:\r\n * - Foveal attention: High resolution in center, low in periphery\r\n * - Saccadic sampling: Strategic \"glances\" at areas of interest\r\n * - Predictive coding: Only process what's unexpected/changed\r\n * \r\n * Expected improvements:\r\n * - ~75% reduction in pixels processed per frame\r\n * - ~80% reduction in latency for static scenes\r\n * - ~70% reduction in energy consumption\r\n */\r\n\r\nimport { FovealAttention } from './foveal-attention.js';\r\nimport { SaccadicController } from './saccadic-controller.js';\r\nimport { PredictiveCoding } from './predictive-coding.js';\r\nimport { SaliencyMap } from './saliency-map.js';\r\nimport { ScaleOrchestrator } from './scale-orchestrator.js';\r\n\r\n/**\r\n * Configuration for Bio-Inspired Engine\r\n */\r\nconst BIO_CONFIG = {\r\n    // Foveal region (high resolution center)\r\n    FOVEA_RADIUS_RATIO: 0.15,        // 15% of image dimension\r\n    PARAFOVEA_RADIUS_RATIO: 0.30,    // 30% of image dimension\r\n\r\n    // Resolution multipliers\r\n    FOVEA_RESOLUTION: 1.0,           // Full resolution\r\n    PARAFOVEA_RESOLUTION: 0.5,       // Half resolution\r\n    PERIPHERY_RESOLUTION: 0.25,      // Quarter resolution\r\n\r\n    // Saccadic behavior\r\n    MAX_SACCADES_PER_FRAME: 3,       // Maximum \"glances\" per frame\r\n    SACCADE_COOLDOWN_MS: 50,         // Minimum time between saccades\r\n    SALIENCY_THRESHOLD: 0.3,         // Threshold for triggering saccade\r\n\r\n    // Predictive coding\r\n    CHANGE_THRESHOLD: 0.05,          // 5% pixel difference to trigger processing\r\n    PREDICTION_CONFIDENCE: 0.8,      // Confidence to skip processing\r\n    MOTION_HISTORY_FRAMES: 3,        // Frames to consider for motion prediction\r\n\r\n    // Performance\r\n    ENABLE_SKIP_FRAMES: true,        // Skip processing if nothing changed\r\n    MIN_PROCESSING_INTERVAL_MS: 8,   // Minimum 8ms (~120fps cap)\r\n    NUM_OCTAVES: 5,                  // Default number of octaves\r\n};\r\n\r\n/**\r\n * Main Bio-Inspired Perception Engine\r\n * Integrates all bio-inspired components for efficient AR processing\r\n */\r\nclass BioInspiredEngine {\r\n    /**\r\n     * @param {number} width - Input image width\r\n     * @param {number} height - Input image height\r\n     * @param {Object} options - Configuration options\r\n     */\r\n    constructor(width, height, options = {}) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.config = { ...BIO_CONFIG, ...options };\r\n\r\n        // Initialize sub-components\r\n        this.fovealAttention = new FovealAttention(width, height, this.config);\r\n        this.saccadicController = new SaccadicController(width, height, this.config);\r\n        this.predictiveCoding = new PredictiveCoding(width, height, this.config);\r\n        this.saliencyMap = new SaliencyMap(width, height);\r\n        this.scaleOrchestrator = new ScaleOrchestrator(this.config.NUM_OCTAVES, {\r\n            debug: options.debugMode\r\n        });\r\n\r\n        // State tracking\r\n        this.currentFoveaCenter = { x: width / 2, y: height / 2 };\r\n        this.frameCount = 0;\r\n        this.lastProcessTime = 0;\r\n        this.skipCount = 0;\r\n\r\n        // Performance metrics\r\n        this.metrics = {\r\n            totalFrames: 0,\r\n            skippedFrames: 0,\r\n            avgPixelsProcessed: 0,\r\n            avgLatency: 0,\r\n            saccadeCount: 0,\r\n        };\r\n\r\n        // Pre-allocate buffers\r\n        this._initBuffers();\r\n    }\r\n\r\n    /**\r\n     * Initialize pre-allocated buffers for efficient processing\r\n     * @private\r\n     */\r\n    _initBuffers() {\r\n        const fullSize = this.width * this.height;\r\n        const foveaSize = Math.ceil(fullSize * this.config.FOVEA_RADIUS_RATIO ** 2 * Math.PI);\r\n\r\n        // Multi-resolution output buffer\r\n        this.outputBuffer = {\r\n            fovea: new Uint8Array(foveaSize),\r\n            parafovea: new Uint8Array(Math.ceil(foveaSize * 4)),\r\n            periphery: new Uint8Array(Math.ceil(fullSize * 0.25)),\r\n        };\r\n\r\n        // Change detection buffer\r\n        this.changeBuffer = new Float32Array(Math.ceil(fullSize / 64)); // 8x8 blocks\r\n    }\r\n\r\n    /**\r\n     * Process an input frame using bio-inspired techniques\r\n     * \r\n     * @param {Uint8Array} inputData - Grayscale input image\r\n     * @param {Object} trackingState - Current tracking state (optional)\r\n     * @returns {Object} Processed result with attention regions\r\n     */\r\n    process(inputData, trackingState = null) {\r\n        const startTime = performance.now();\r\n        this.frameCount++;\r\n        this.metrics.totalFrames++;\r\n\r\n        // Step 1: Predictive Coding - Check if we can skip processing\r\n        const prediction = this.predictiveCoding.predict(inputData, trackingState);\r\n\r\n        if (prediction.canSkip && this.config.ENABLE_SKIP_FRAMES) {\r\n            this.metrics.skippedFrames++;\r\n            this.skipCount++;\r\n            return {\r\n                skipped: true,\r\n                prediction: prediction.predictedState,\r\n                confidence: prediction.confidence,\r\n                pixelsProcessed: 0,\r\n                latency: performance.now() - startTime,\r\n            };\r\n        }\r\n        this.skipCount = 0;\r\n\r\n        // Step 2: Compute Saliency Map for attention guidance\r\n        const saliency = this.saliencyMap.compute(inputData);\r\n\r\n        // Step 3: Saccadic Controller - Decide where to \"look\"\r\n        const saccadeTargets = this.saccadicController.computeTargets(\r\n            saliency,\r\n            this.currentFoveaCenter,\r\n            trackingState\r\n        );\r\n\r\n        // Step 4: Extract foveal regions at different resolutions\r\n        const attentionRegions = [];\r\n        let totalPixelsProcessed = 0;\r\n\r\n        for (const target of saccadeTargets) {\r\n            const region = this.fovealAttention.extract(\r\n                inputData,\r\n                target.x,\r\n                target.y,\r\n                target.priority\r\n            );\r\n            attentionRegions.push(region);\r\n            totalPixelsProcessed += region.pixelCount;\r\n            this.metrics.saccadeCount++;\r\n        }\r\n\r\n        // Step 5: Update fovea center based on highest priority target\r\n        if (saccadeTargets.length > 0) {\r\n            const primary = saccadeTargets[0];\r\n            this.currentFoveaCenter = { x: primary.x, y: primary.y };\r\n        }\r\n\r\n        // Step 6: Scale Orchestrator - Determine octaves to process\r\n        const octavesToProcess = this.scaleOrchestrator.getOctavesToProcess(trackingState);\r\n\r\n        // Step 7: Store frame for prediction\r\n        this.predictiveCoding.storeFrame(inputData, trackingState);\r\n\r\n        // Compute metrics\r\n        const latency = performance.now() - startTime;\r\n        this._updateMetrics(totalPixelsProcessed, latency);\r\n\r\n        return {\r\n            skipped: false,\r\n            attentionRegions,\r\n            foveaCenter: this.currentFoveaCenter,\r\n            saliencyPeaks: saliency.peaks,\r\n            octavesToProcess,\r\n            pixelsProcessed: totalPixelsProcessed,\r\n            pixelsSaved: this.width * this.height - totalPixelsProcessed,\r\n            savingsPercent: ((1 - totalPixelsProcessed / (this.width * this.height)) * 100).toFixed(1),\r\n            latency,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get the primary attention region (highest resolution)\r\n     * This is the region that should be used for feature detection\r\n     * \r\n     * @param {Object} processResult - Result from process()\r\n     * @returns {Object} Primary attention region with data\r\n     */\r\n    getPrimaryRegion(processResult) {\r\n        if (processResult.skipped || !processResult.attentionRegions?.length) {\r\n            return null;\r\n        }\r\n        return processResult.attentionRegions[0];\r\n    }\r\n\r\n    /**\r\n     * Suggest optimal processing based on change detection\r\n     * \r\n     * @param {Uint8Array} inputData - Current frame\r\n     * @returns {Object} Processing suggestion\r\n     */\r\n    suggestProcessing(inputData) {\r\n        const changeLevel = this.predictiveCoding.getChangeLevel(inputData);\r\n\r\n        return {\r\n            shouldProcessFull: changeLevel > 0.3,\r\n            shouldProcessPartial: changeLevel > 0.05,\r\n            canSkip: changeLevel < 0.02,\r\n            changeLevel,\r\n            recommendedSaccades: Math.ceil(changeLevel * this.config.MAX_SACCADES_PER_FRAME),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Update performance metrics\r\n     * @private\r\n     */\r\n    _updateMetrics(pixelsProcessed, latency) {\r\n        const alpha = 0.1; // Exponential moving average factor\r\n        this.metrics.avgPixelsProcessed =\r\n            this.metrics.avgPixelsProcessed * (1 - alpha) + pixelsProcessed * alpha;\r\n        this.metrics.avgLatency =\r\n            this.metrics.avgLatency * (1 - alpha) + latency * alpha;\r\n    }\r\n\r\n    /**\r\n     * Get current performance metrics\r\n     * @returns {Object} Performance metrics\r\n     */\r\n    getMetrics() {\r\n        return {\r\n            ...this.metrics,\r\n            skipRate: ((this.metrics.skippedFrames / this.metrics.totalFrames) * 100).toFixed(1) + '%',\r\n            avgSavings: ((1 - this.metrics.avgPixelsProcessed / (this.width * this.height)) * 100).toFixed(1) + '%',\r\n            currentFovea: this.currentFoveaCenter,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Reset engine state (e.g., when target changes)\r\n     */\r\n    reset() {\r\n        this.currentFoveaCenter = { x: this.width / 2, y: this.height / 2 };\r\n        this.frameCount = 0;\r\n        this.skipCount = 0;\r\n        this.predictiveCoding.reset();\r\n        this.saccadicController.reset();\r\n    }\r\n\r\n    /**\r\n     * Configure engine at runtime\r\n     * @param {Object} options - Configuration options to update\r\n     */\r\n    configure(options) {\r\n        this.config = { ...this.config, ...options };\r\n        this.fovealAttention.configure(this.config);\r\n        this.saccadicController.configure(this.config);\r\n        this.predictiveCoding.configure(this.config);\r\n    }\r\n}\r\n\r\nexport { BioInspiredEngine, BIO_CONFIG };\r\n", "/**\r\n * Bio-Inspired Controller Adapter\r\n * \r\n * Wraps the standard Controller with Bio-Inspired Perception capabilities.\r\n * Provides significant performance improvements while maintaining API compatibility.\r\n * \r\n * Key features:\r\n * - Foveal attention: Processes only regions of interest at full resolution\r\n * - Predictive coding: Skips processing when scene is static\r\n * - Saccadic sampling: Strategic \"glances\" at high-saliency regions\r\n * \r\n * Usage:\r\n * ```javascript\r\n * import { BioInspiredController } from './bio-inspired-controller.js';\r\n * \r\n * const controller = new BioInspiredController({\r\n *   inputWidth: 640,\r\n *   inputHeight: 480,\r\n *   onUpdate: (data) => console.log(data),\r\n *   bioInspired: {\r\n *     enabled: true,\r\n *     aggressiveSkipping: true,\r\n *   }\r\n * });\r\n * ```\r\n */\r\n\r\nimport { Controller, ControllerOptions } from './controller.js';\r\nimport { BioInspiredEngine, BIO_CONFIG } from '../core/perception/index.js';\r\nimport { AutoRotationFeature } from '../core/features/auto-rotation-feature.js';\r\n\r\n/**\r\n * Result from BioInspiredEngine.process()\r\n */\r\ninterface BioResult {\r\n    skipped: boolean;\r\n    prediction?: {\r\n        worldMatrix?: Float32Array;\r\n    };\r\n    attentionRegions?: any[];\r\n    foveaCenter?: { x: number; y: number };\r\n    pixelsSaved?: number;\r\n    octavesToProcess?: number[]; // Added for scale orchestration\r\n}\r\n\r\n/**\r\n * Extended options for Bio-Inspired Controller\r\n */\r\nexport interface BioInspiredControllerOptions extends ControllerOptions {\r\n    bioInspired?: {\r\n        enabled?: boolean;\r\n        aggressiveSkipping?: boolean;\r\n        foveaRadiusRatio?: number;\r\n        maxSaccades?: number;\r\n    };\r\n}\r\n\r\n/**\r\n * Bio-Inspired Controller\r\n * \r\n * Extends the standard Controller with bio-inspired perception capabilities.\r\n */\r\nclass BioInspiredController extends Controller {\r\n    private bioEngine: BioInspiredEngine | null = null;\r\n    private bioEnabled: boolean = true;\r\n    private bioMetricsInterval: number | null = null;\r\n    private lastBioResult: any = null;\r\n\r\n    constructor(options: BioInspiredControllerOptions) {\r\n        super(options);\r\n\r\n        const bioOptions = options.bioInspired || {};\r\n        this.bioEnabled = bioOptions.enabled !== false;\r\n\r\n        if (this.bioEnabled) {\r\n            // Initialize Bio-Inspired Engine\r\n            const bioConfig: any = {};\r\n\r\n            if (bioOptions.foveaRadiusRatio !== undefined) {\r\n                bioConfig.FOVEA_RADIUS_RATIO = bioOptions.foveaRadiusRatio;\r\n            }\r\n            if (bioOptions.maxSaccades !== undefined) {\r\n                bioConfig.MAX_SACCADES_PER_FRAME = bioOptions.maxSaccades;\r\n            }\r\n            if (bioOptions.aggressiveSkipping !== undefined) {\r\n                bioConfig.ENABLE_SKIP_FRAMES = bioOptions.aggressiveSkipping;\r\n                if (bioOptions.aggressiveSkipping) {\r\n                    bioConfig.CHANGE_THRESHOLD = 0.03; // More aggressive\r\n                }\r\n            }\r\n\r\n            this.bioEngine = new BioInspiredEngine(\r\n                options.inputWidth,\r\n                options.inputHeight,\r\n                bioConfig\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Override processVideo to add bio-inspired perception\r\n     */\r\n    processVideo(input: any) {\r\n        if (!this.bioEnabled || !this.bioEngine) {\r\n            return super.processVideo(input);\r\n        }\r\n\r\n        if (this.processingVideo) return;\r\n        this.processingVideo = true;\r\n\r\n        // Reset tracking states\r\n        this.trackingStates = [];\r\n        for (let i = 0; i < (this.markerDimensions?.length || 0); i++) {\r\n            this.trackingStates.push({\r\n                showing: false,\r\n                isTracking: false,\r\n                currentModelViewTransform: null,\r\n                trackCount: 0,\r\n                trackMiss: 0,\r\n            });\r\n        }\r\n\r\n        const startProcessing = async () => {\r\n            while (this.processingVideo) {\r\n                const inputData = this.inputLoader.loadInput(input);\r\n\r\n                // Get current tracking state for bio engine\r\n                const activeTracking = this.trackingStates.find(s => s.isTracking);\r\n                const trackingState = activeTracking ? {\r\n                    isTracking: true,\r\n                    activeOctave: activeTracking.lastOctaveIndex, // Tracked octave index\r\n                    worldMatrix: activeTracking.currentModelViewTransform\r\n                        ? this._flattenMatrix(activeTracking.currentModelViewTransform)\r\n                        : null\r\n                } : null;\r\n\r\n                // Process through bio-inspired engine\r\n                const bioResult = this.bioEngine!.process(inputData, (trackingState as any) || undefined) as BioResult;\r\n                this.lastBioResult = bioResult;\r\n\r\n                // If bio engine says we can skip, use prediction\r\n                if (bioResult.skipped && activeTracking?.isTracking) {\r\n                    // Use predicted state\r\n                    this._handleSkippedFrame(activeTracking, bioResult);\r\n                } else {\r\n                    // Normal processing with attention regions\r\n                    await this._processWithAttention(input, inputData, bioResult);\r\n                }\r\n\r\n                // Wait for next frame\r\n                if (typeof requestAnimationFrame !== 'undefined') {\r\n                    await new Promise(requestAnimationFrame);\r\n                } else {\r\n                    await new Promise(resolve => setTimeout(resolve, 16));\r\n                }\r\n            }\r\n        };\r\n\r\n        startProcessing();\r\n    }\r\n\r\n    /**\r\n     * Handle a skipped frame using prediction\r\n     * @private\r\n     */\r\n    private _handleSkippedFrame(trackingState: any, bioResult: any) {\r\n        // Use predicted matrix\r\n        if (bioResult.prediction && bioResult.prediction.worldMatrix) {\r\n            trackingState.currentModelViewTransform = this._unflattenMatrix(bioResult.prediction.worldMatrix);\r\n        }\r\n\r\n        // Notify with skipped status\r\n        const worldMatrix = trackingState.currentModelViewTransform\r\n            ? this._glModelViewMatrix(trackingState.currentModelViewTransform, 0)\r\n            : null;\r\n\r\n        this.onUpdate?.({\r\n            type: 'updateMatrix',\r\n            targetIndex: 0,\r\n            worldMatrix: worldMatrix ? this.featureManager.applyWorldMatrixFilters(0, worldMatrix, { stability: 0.9 }) : null,\r\n            skipped: true,\r\n            bioMetrics: this.bioEngine?.getMetrics(),\r\n        });\r\n\r\n        this.onUpdate?.({ type: 'processDone' });\r\n    }\r\n\r\n    /**\r\n     * Process frame using bio-inspired attention regions\r\n     * @private\r\n     */\r\n    private async _processWithAttention(input: any, inputData: Uint8Array, bioResult: BioResult) {\r\n        const nTracking = this.trackingStates.reduce((acc, s) => acc + (s.isTracking ? 1 : 0), 0);\r\n\r\n        // Detection phase - use primary attention region for efficiency\r\n        if (nTracking < this.maxTrack) {\r\n            const matchingIndexes = this.trackingStates\r\n                .map((s, i) => ({ state: s, index: i }))\r\n                .filter(({ state, index }) =>\r\n                    !state.isTracking &&\r\n                    (this.interestedTargetIndex === -1 || this.interestedTargetIndex === index)\r\n                )\r\n                .map(({ index }) => index);\r\n\r\n            if (matchingIndexes.length > 0) {\r\n                // Use full input for detection (bio engine already optimized upstream processing)\r\n                const { targetIndex: matchedTargetIndex, modelViewTransform, featurePoints } =\r\n                    await this._detectAndMatch(inputData, matchingIndexes, bioResult.octavesToProcess || null);\r\n\r\n                if (matchedTargetIndex !== -1) {\r\n                    this.trackingStates[matchedTargetIndex].isTracking = true;\r\n                    this.trackingStates[matchedTargetIndex].currentModelViewTransform = modelViewTransform;\r\n\r\n                    // Update bio engine fovea to focus on detected target\r\n                    if (bioResult.attentionRegions?.[0]) {\r\n                        this.bioEngine?.reset();\r\n                    }\r\n                }\r\n\r\n                this.onUpdate?.({ type: 'featurePoints', featurePoints });\r\n            }\r\n        }\r\n\r\n        // Tracking phase\r\n        for (let i = 0; i < this.trackingStates.length; i++) {\r\n            const trackingState = this.trackingStates[i];\r\n\r\n            if (trackingState.isTracking) {\r\n                const result = await this._trackAndUpdate(\r\n                    inputData,\r\n                    trackingState.currentModelViewTransform,\r\n                    i\r\n                );\r\n\r\n                if (!result || !result.modelViewTransform) {\r\n                    trackingState.isTracking = false;\r\n                    trackingState.screenCoords = result?.screenCoords || [];\r\n                    trackingState.reliabilities = result?.reliabilities || [];\r\n                    trackingState.stabilities = result?.stabilities || [];\r\n                } else {\r\n                    trackingState.currentModelViewTransform = result.modelViewTransform;\r\n                    trackingState.screenCoords = result.screenCoords;\r\n                    trackingState.reliabilities = result.reliabilities;\r\n                    trackingState.stabilities = result.stabilities;\r\n                    (trackingState as any).deformedMesh = result.deformedMesh;\r\n                }\r\n            }\r\n\r\n            const wasShowing = trackingState.showing;\r\n            trackingState.showing = this.featureManager.shouldShow(i, trackingState.isTracking);\r\n\r\n            if (wasShowing && !trackingState.showing) {\r\n                trackingState.trackingMatrix = null;\r\n                this.featureManager.notifyUpdate({ type: 'reset', targetIndex: i });\r\n            }\r\n\r\n            // Emit update\r\n            if (trackingState.showing || trackingState.screenCoords?.length > 0 || (wasShowing && !trackingState.showing)) {\r\n                const worldMatrix = trackingState.showing\r\n                    ? this._glModelViewMatrix(trackingState.currentModelViewTransform, i)\r\n                    : null;\r\n\r\n                let finalMatrix = null;\r\n                if (worldMatrix) {\r\n                    const stabilities = trackingState.stabilities || [];\r\n                    const avgStability = stabilities.length > 0\r\n                        ? stabilities.reduce((a: number, b: number) => a + b, 0) / stabilities.length\r\n                        : 0;\r\n\r\n                    finalMatrix = this.featureManager.applyWorldMatrixFilters(i, worldMatrix, { stability: avgStability });\r\n                    trackingState.trackingMatrix = finalMatrix;\r\n\r\n                    const isInputRotated = input.width === this.inputHeight && input.height === this.inputWidth;\r\n                    if (isInputRotated) {\r\n                        const rotationFeature = this.featureManager.getFeature<AutoRotationFeature>('auto-rotation');\r\n                        if (rotationFeature) {\r\n                            finalMatrix = rotationFeature.rotate(finalMatrix);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.onUpdate?.({\r\n                    type: 'updateMatrix',\r\n                    targetIndex: i,\r\n                    worldMatrix: finalMatrix,\r\n                    modelViewTransform: trackingState.currentModelViewTransform,\r\n                    screenCoords: trackingState.screenCoords,\r\n                    reliabilities: trackingState.reliabilities,\r\n                    stabilities: trackingState.stabilities,\r\n                    deformedMesh: (trackingState as any).deformedMesh,\r\n                    bioMetrics: this.bioEngine?.getMetrics(),\r\n                    foveaCenter: bioResult.foveaCenter,\r\n                    pixelsSaved: bioResult.pixelsSaved,\r\n                });\r\n            }\r\n        }\r\n\r\n        this.onUpdate?.({ type: 'processDone' });\r\n    }\r\n\r\n    /**\r\n     * Detect and match features, optionally limited to specific octaves\r\n     */\r\n    async _detectAndMatch(inputData: any, targetIndexes: number[], octavesToProcess: number[] | null = null) {\r\n        // \uD83D\uDE80 NANITE-STYLE: Estimate scale for filtered matching\r\n        let predictedScale: number | undefined = undefined;\r\n        for (const state of this.trackingStates) {\r\n            if (state.isTracking && state.currentModelViewTransform) {\r\n                const m = state.currentModelViewTransform;\r\n                predictedScale = Math.sqrt(m[0][0] ** 2 + m[1][0] ** 2 + m[2][0] ** 2);\r\n                break;\r\n            }\r\n        }\r\n\r\n        const { targetIndex, modelViewTransform, screenCoords, worldCoords, featurePoints } = await this._workerMatch(\r\n            null, // No feature points, worker will detect from inputData\r\n            targetIndexes,\r\n            inputData,\r\n            predictedScale,\r\n            octavesToProcess\r\n        );\r\n        return { targetIndex, modelViewTransform, screenCoords, worldCoords, featurePoints };\r\n    }\r\n\r\n    /**\r\n     * Communicate with worker for matching phase\r\n     */\r\n    _workerMatch(featurePoints: any, targetIndexes: number[], inputData: any = null, expectedScale?: number, octavesToProcess: number[] | null = null): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            if (!this.worker) {\r\n                // If no feature points but we have input data, detect first\r\n                let fpPromise;\r\n                if (!featurePoints && inputData) {\r\n                    fpPromise = Promise.resolve(this.fullDetector!.detect(inputData, { octavesToProcess }).featurePoints);\r\n                } else {\r\n                    fpPromise = Promise.resolve(featurePoints);\r\n                }\r\n\r\n                fpPromise.then(fp => {\r\n                    this._matchOnMainThread(fp, targetIndexes, expectedScale).then(resolve);\r\n                }).catch(() => resolve({ targetIndex: -1 }));\r\n                return;\r\n            }\r\n\r\n            const timeout = setTimeout(() => {\r\n                (this as any).workerMatchDone = null;\r\n                resolve({ targetIndex: -1 });\r\n            }, 1000);\r\n\r\n            (this as any).workerMatchDone = (data: any) => {\r\n                clearTimeout(timeout);\r\n                (this as any).workerMatchDone = null;\r\n                resolve(data);\r\n            };\r\n\r\n            if (inputData) {\r\n                this.worker.postMessage({ type: \"match\", inputData, targetIndexes, octavesToProcess, expectedScale });\r\n            } else {\r\n                this.worker.postMessage({ type: \"match\", featurePoints: featurePoints, targetIndexes, expectedScale });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Override _trackAndUpdate to capture active octave for the next frame's orchestration\r\n     */\r\n    async _trackAndUpdate(inputData: any, lastModelViewTransform: number[][], targetIndex: number) {\r\n        const result = await super._trackAndUpdate(inputData, lastModelViewTransform, targetIndex);\r\n        if (result && (result as any).octaveIndex !== undefined) {\r\n            this.trackingStates[targetIndex].lastOctaveIndex = (result as any).octaveIndex;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Flatten a 3x4 matrix to Float32Array\r\n     * @private\r\n     */\r\n    private _flattenMatrix(matrix: number[][]): Float32Array {\r\n        const result = new Float32Array(16);\r\n        for (let i = 0; i < 3; i++) {\r\n            for (let j = 0; j < 4; j++) {\r\n                result[i * 4 + j] = matrix[i][j];\r\n            }\r\n        }\r\n        result[12] = 0;\r\n        result[13] = 0;\r\n        result[14] = 0;\r\n        result[15] = 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Unflatten Float32Array to 3x4 matrix\r\n     * @private\r\n     */\r\n    private _unflattenMatrix(flat: Float32Array): number[][] {\r\n        return [\r\n            [flat[0], flat[1], flat[2], flat[3]],\r\n            [flat[4], flat[5], flat[6], flat[7]],\r\n            [flat[8], flat[9], flat[10], flat[11]],\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Get bio-inspired engine metrics\r\n     */\r\n    getBioMetrics() {\r\n        return this.bioEngine?.getMetrics() || null;\r\n    }\r\n\r\n    /**\r\n     * Get last bio processing result\r\n     */\r\n    getLastBioResult() {\r\n        return this.lastBioResult;\r\n    }\r\n\r\n    /**\r\n     * Enable/disable bio-inspired processing dynamically\r\n     */\r\n    setBioEnabled(enabled: boolean) {\r\n        this.bioEnabled = enabled;\r\n        if (enabled && !this.bioEngine) {\r\n            this.bioEngine = new BioInspiredEngine(this.inputWidth, this.inputHeight);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configure bio-inspired engine at runtime\r\n     */\r\n    configureBio(options: Partial<typeof BIO_CONFIG>) {\r\n        this.bioEngine?.configure(options);\r\n    }\r\n\r\n    /**\r\n     * Override dispose to clean up bio engine\r\n     */\r\n    dispose() {\r\n        super.dispose();\r\n        this.bioEngine = null;\r\n        if (this.bioMetricsInterval) {\r\n            clearInterval(this.bioMetricsInterval);\r\n        }\r\n    }\r\n}\r\n\r\nexport { BioInspiredController };\r\n", "\r\n\r\n// artoolkit version. slower. is it necessary?\r\nconst upsampleBilinear = ({ image, padOneWidth, padOneHeight }) => {\r\n  const { width, height, data } = image;\r\n\r\n  const dstWidth = image.width * 2 + (padOneWidth ? 1 : 0);\r\n  const dstHeight = image.height * 2 + (padOneHeight ? 1 : 0);\r\n\r\n  const temp = new Float32Array(dstWidth * dstHeight);\r\n  for (let i = 0; i < dstWidth; i++) {\r\n    const si = 0.5 * i - 0.25;\r\n    let si0 = Math.floor(si);\r\n    let si1 = Math.ceil(si);\r\n    if (si0 < 0) si0 = 0; // border\r\n    if (si1 >= width) si1 = width - 1; // border\r\n\r\n    for (let j = 0; j < dstHeight; j++) {\r\n      const sj = 0.5 * j - 0.25;\r\n      let sj0 = Math.floor(sj);\r\n      let sj1 = Math.ceil(sj);\r\n      if (sj0 < 0) sj0 = 0; // border\r\n      if (sj1 >= height) sj1 = height - 1; //border\r\n\r\n      const value =\r\n        (si1 - si) * (sj1 - sj) * data[sj0 * width + si0] +\r\n        (si1 - si) * (sj - sj0) * data[sj1 * width + si0] +\r\n        (si - si0) * (sj1 - sj) * data[sj0 * width + si1] +\r\n        (si - si0) * (sj - sj0) * data[sj1 * width + si1];\r\n\r\n      temp[j * dstWidth + i] = value;\r\n    }\r\n  }\r\n\r\n  return { data: temp, width: dstWidth, height: dstHeight };\r\n};\r\n\r\nconst downsampleBilinear = ({ image }) => {\r\n  const { data, width, height } = image;\r\n  const dstWidth = width >>> 1;\r\n  const dstHeight = height >>> 1;\r\n\r\n  const temp = new Uint8Array(dstWidth * dstHeight);\r\n\r\n  // Speed optimization: using Int32 views and manual indexing\r\n  // Also using bitwise operations for color averaging\r\n  for (let j = 0; j < dstHeight; j++) {\r\n    const row0 = (j * 2) * width;\r\n    const row1 = row0 + width;\r\n    const dstRow = j * dstWidth;\r\n\r\n    for (let i = 0; i < dstWidth; i++) {\r\n      const i2 = i * 2;\r\n      // Efficient Int32 math for blurring\r\n      const val = (data[row0 + i2] + data[row0 + i2 + 1] +\r\n        data[row1 + i2] + data[row1 + i2 + 1]) >> 2;\r\n      temp[dstRow + i] = val & 0xFF;\r\n    }\r\n  }\r\n\r\n  return { data: temp, width: dstWidth, height: dstHeight };\r\n};\r\n\r\nconst resize = ({ image, ratio }) => {\r\n  // Fast path for identity\r\n  if (ratio === 1) {\r\n    return {\r\n      data: new Uint8Array(image.data), // Copy to be safe/consistent\r\n      width: image.width,\r\n      height: image.height\r\n    };\r\n  }\r\n\r\n  // Recursive downsampling for better quality on large reductions\r\n  if (ratio <= 0.5) {\r\n    // 1024 -> 512 -> ...\r\n    return resize({\r\n      image: downsampleBilinear({ image }),\r\n      ratio: ratio * 2\r\n    });\r\n  }\r\n\r\n  const width = Math.round(image.width * ratio) | 0;\r\n  const height = Math.round(image.height * ratio) | 0;\r\n  const imageData = new Uint8Array(width * height);\r\n\r\n  const srcData = image.data;\r\n  const srcW = image.width | 0;\r\n  const srcH = image.height | 0;\r\n  // Pre-calculate limits to avoid Math.min inside loop\r\n  const srcW_1 = (srcW - 1) | 0;\r\n  const srcH_1 = (srcH - 1) | 0;\r\n\r\n  let dstIndex = 0;\r\n\r\n  for (let j = 0; j < height; j++) {\r\n    // Y coords\r\n    const srcY = j / ratio;\r\n    const y0 = srcY | 0; // Math.floor\r\n    const y1 = (y0 < srcH_1 ? y0 + 1 : srcH_1) | 0;\r\n    const fy = srcY - y0;\r\n    const ify = 1 - fy;\r\n\r\n    // Row offsets\r\n    const row0 = (y0 * srcW) | 0;\r\n    const row1 = (y1 * srcW) | 0;\r\n\r\n    for (let i = 0; i < width; i++) {\r\n      // X coords\r\n      const srcX = i / ratio;\r\n      const x0 = srcX | 0; // Math.floor\r\n      const x1 = (x0 < srcW_1 ? x0 + 1 : srcW_1) | 0;\r\n      const fx = srcX - x0;\r\n      const ifx = 1 - fx;\r\n\r\n      // Bilinear interpolation optimized\r\n      // v = (1-fx)(1-fy)v00 + fx(1-fy)v10 + (1-fx)fy*v01 + fx*fy*v11\r\n      // Factored: (1-fy) * ((1-fx)v00 + fx*v10) + fy * ((1-fx)v01 + fx*v11)\r\n\r\n      const val0 = srcData[row0 + x0] * ifx + srcData[row0 + x1] * fx;\r\n      const val1 = srcData[row1 + x0] * ifx + srcData[row1 + x1] * fx;\r\n\r\n      const value = val0 * ify + val1 * fy;\r\n\r\n      imageData[dstIndex++] = value | 0;\r\n    }\r\n  }\r\n\r\n  return { data: imageData, width: width, height: height };\r\n};\r\n\r\nexport { downsampleBilinear, upsampleBilinear, resize };\r\n", "import { resize } from \"./utils/images.js\";\r\nimport { AR_CONFIG } from \"./constants.js\";\r\n\r\n/**\r\n * Tama\u00F1o m\u00EDnimo de p\u00EDxeles para el procesamiento de im\u00E1genes\r\n * Un valor m\u00E1s bajo permite detectar im\u00E1genes m\u00E1s peque\u00F1as pero aumenta el tiempo de procesamiento\r\n * @constant {number}\r\n */\r\nconst MIN_IMAGE_PIXEL_SIZE = AR_CONFIG.MIN_IMAGE_PIXEL_SIZE;\r\n\r\n\r\n\r\n/**\r\n * Construye una lista de im\u00E1genes con diferentes escalas para detecci\u00F3n de caracter\u00EDsticas\r\n * @param {{width: number, height: number, data: any}} inputImage - Imagen de entrada con propiedades width, height y data\r\n * @returns {Array<{data: Uint8Array, width: number, height: number, scale: number}>} Lista de im\u00E1genes escaladas con propiedades data, width, height y scale\r\n */\r\nconst buildImageList = (inputImage) => {\r\n  const minScale = MIN_IMAGE_PIXEL_SIZE / Math.min(inputImage.width, inputImage.height);\r\n\r\n  const scaleList = [];\r\n  let c = minScale;\r\n  while (true) {\r\n    scaleList.push(c);\r\n    // Optimization: Paso balanceado (aprox 1.5)\r\n    // Mejor cobertura que 2.0, pero mucho m\u00E1s ligero que 1.41 o 1.26\r\n    c *= Math.pow(2.0, AR_CONFIG.SCALE_STEP_EXPONENT);\r\n    if (c >= 0.95) {\r\n      c = 1;\r\n      break;\r\n    }\r\n  }\r\n  scaleList.push(c);\r\n  scaleList.reverse();\r\n\r\n  const imageList = [];\r\n  for (let i = 0; i < scaleList.length; i++) {\r\n    imageList.push(\r\n      Object.assign(resize({ image: inputImage, ratio: scaleList[i] }), { scale: scaleList[i] }),\r\n    );\r\n  }\r\n  return imageList;\r\n};\r\n\r\n/**\r\n * Construye una lista optimizada de im\u00E1genes para tracking\r\n * Genera dos versiones escaladas (256px y 128px) para tracking eficiente\r\n * @param {{width: number, height: number, data: any}} inputImage - Imagen de entrada con propiedades width, height y data\r\n * @returns {Array<{data: Uint8Array, width: number, height: number, scale: number}>} Lista de im\u00E1genes escaladas para tracking\r\n */\r\nconst buildTrackingImageList = (inputImage) => {\r\n  const minDimension = Math.min(inputImage.width, inputImage.height);\r\n  const scaleList = [];\r\n  const imageList = [];\r\n  // Generamos versiones de 256px y 128px para tracking robusto a diferentes distancias\r\n  scaleList.push(AR_CONFIG.TRACKING_DOWNSCALE_LEVEL_1 / minDimension);\r\n  scaleList.push(AR_CONFIG.TRACKING_DOWNSCALE_LEVEL_2 / minDimension);\r\n  for (let i = 0; i < scaleList.length; i++) {\r\n    imageList.push(\r\n      Object.assign(resize({ image: inputImage, ratio: scaleList[i] }), { scale: scaleList[i] }),\r\n    );\r\n  }\r\n  return imageList;\r\n};\r\n\r\n\r\nexport { buildImageList, buildTrackingImageList };\r\n", "// fast 2D submatrix sum using cumulative sum algorithm\r\nclass Cumsum {\r\n  constructor(data, width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.cumsum = new Int32Array(width * height);\r\n\r\n    this.cumsum[0] = data[0];\r\n    for (let i = 1; i < width; i++) {\r\n      this.cumsum[i] = this.cumsum[i - 1] + data[i];\r\n    }\r\n    for (let j = 1; j < height; j++) {\r\n      this.cumsum[j * width] = this.cumsum[(j - 1) * width] + data[j * width];\r\n    }\r\n\r\n    for (let j = 1; j < height; j++) {\r\n      for (let i = 1; i < width; i++) {\r\n        const pos = j * width + i;\r\n        this.cumsum[pos] =\r\n          data[pos] +\r\n          this.cumsum[(j - 1) * width + i] +\r\n          this.cumsum[j * width + i - 1] -\r\n          this.cumsum[(j - 1) * width + i - 1];\r\n      }\r\n    }\r\n  }\r\n\r\n  query(x1, y1, x2, y2) {\r\n    const { width } = this;\r\n    let ret = this.cumsum[y2 * width + x2];\r\n    if (y1 > 0) ret -= this.cumsum[(y1 - 1) * width + x2];\r\n    if (x1 > 0) ret -= this.cumsum[y2 * width + x1 - 1];\r\n    if (x1 > 0 && y1 > 0) ret += this.cumsum[(y1 - 1) * width + x1 - 1];\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport { Cumsum };\r\n", "import { Cumsum } from \"../utils/cumsum.js\";\r\nimport { gpuCompute } from \"../utils/gpu-compute.js\";\r\n\r\nconst SEARCH_SIZE1 = 10;\r\nconst SEARCH_SIZE2 = 2;\r\n\r\n// Template parameters - ajustados para m\u00E1s puntos\r\nconst TEMPLATE_SIZE = 6;\r\nconst TEMPLATE_SD_THRESH = 4.0;  // Reducido de 5.0 para aceptar m\u00E1s candidatos\r\nconst MAX_SIM_THRESH = 0.95;\r\n\r\nconst MAX_THRESH = 0.9;\r\nconst MIN_THRESH = 0.2;\r\nconst SD_THRESH = 8.0;\r\nconst OCCUPANCY_SIZE = 8;  // Reduced from 10 to allow more density\r\n\r\n// GPU mode flag - set to false to use original JS implementation\r\nlet useGPU = true;\r\n\r\n/**\r\n * Set GPU mode for extraction\r\n * @param {boolean} enabled - Whether to use GPU acceleration\r\n */\r\nexport const setGPUMode = (enabled) => {\r\n  useGPU = enabled;\r\n};\r\n\r\n/*\r\n * Input image is in grey format. the imageData array size is width * height. value range from 0-255\r\n * pixel value at row r and c = imageData[r * width + c]\r\n *\r\n * @param {Uint8Array} options.imageData\r\n * @param {int} options.width image width\r\n * @param {int} options.height image height\r\n */\r\nconst extract = (image) => {\r\n  const { data: imageData, width, height } = image;\r\n\r\n  let dValue, isCandidate;\r\n\r\n  if (useGPU) {\r\n    // GPU-accelerated edge detection\r\n    const result = gpuCompute.edgeDetection(imageData, width, height);\r\n    dValue = result.dValue;\r\n    isCandidate = result.isCandidate;\r\n  } else {\r\n    // Original JS implementation\r\n    dValue = new Float32Array(imageData.length);\r\n    isCandidate = new Uint8Array(imageData.length);\r\n\r\n    for (let j = 1; j < height - 1; j++) {\r\n      const rowOffset = j * width;\r\n      const prevRowOffset = (j - 1) * width;\r\n      const nextRowOffset = (j + 1) * width;\r\n\r\n      for (let i = 1; i < width - 1; i++) {\r\n        const pos = rowOffset + i;\r\n\r\n        // dx/dy with tight loops\r\n        let dx = (imageData[prevRowOffset + i + 1] - imageData[prevRowOffset + i - 1] +\r\n          imageData[rowOffset + i + 1] - imageData[rowOffset + i - 1] +\r\n          imageData[nextRowOffset + i + 1] - imageData[nextRowOffset + i - 1]) / 768;\r\n\r\n        let dy = (imageData[nextRowOffset + i - 1] - imageData[prevRowOffset + i - 1] +\r\n          imageData[nextRowOffset + i] - imageData[prevRowOffset + i] +\r\n          imageData[nextRowOffset + i + 1] - imageData[prevRowOffset + i + 1]) / 768;\r\n\r\n        dValue[pos] = Math.sqrt((dx * dx + dy * dy) / 2);\r\n      }\r\n    }\r\n\r\n    // Step 1.2 - Local Maxima (for JS path)\r\n    for (let j = 1; j < height - 1; j++) {\r\n      const rowOffset = j * width;\r\n      for (let i = 1; i < width - 1; i++) {\r\n        const pos = rowOffset + i;\r\n        const val = dValue[pos];\r\n        if (val > 0 &&\r\n          val >= dValue[pos - 1] && val >= dValue[pos + 1] &&\r\n          val >= dValue[pos - width] && val >= dValue[pos + width]) {\r\n          isCandidate[pos] = 1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Step 1.2 - Build Histogram from detected candidates\r\n  const dValueHist = new Uint32Array(1000);\r\n  let allCount = 0;\r\n  for (let j = 1; j < height - 1; j++) {\r\n    const rowOffset = j * width;\r\n    for (let i = 1; i < width - 1; i++) {\r\n      const pos = rowOffset + i;\r\n      if (isCandidate[pos]) {\r\n        const val = dValue[pos];\r\n        let k = Math.floor(val * 1000);\r\n        if (k > 999) k = 999;\r\n        dValueHist[k]++;\r\n        allCount++;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Determine dValue threshold for top 5% (aumentado de 2% para m\u00E1s candidatos)\r\n  const maxPoints = 0.10 * width * height; // Increased to 10% for more candidates\r\n  let kThresh = 999;\r\n  let filteredCount = 0;\r\n  while (kThresh >= 0) {\r\n    filteredCount += dValueHist[kThresh];\r\n    if (filteredCount > maxPoints) break;\r\n    kThresh--;\r\n  }\r\n  const minDValue = kThresh / 1000;\r\n\r\n  // Step 2\r\n  const imageDataSqr = new Float32Array(imageData.length);\r\n  for (let i = 0; i < imageData.length; i++) {\r\n    imageDataSqr[i] = imageData[i] * imageData[i];\r\n  }\r\n  const imageDataCumsum = new Cumsum(imageData, width, height);\r\n  const imageDataSqrCumsum = new Cumsum(imageDataSqr, width, height);\r\n\r\n  // Collect candidates above threshold\r\n  const candidates = [];\r\n  for (let i = 0; i < imageData.length; i++) {\r\n    if (isCandidate[i] && dValue[i] >= minDValue) {\r\n      candidates.push({\r\n        pos: i,\r\n        dval: dValue[i],\r\n        x: i % width,\r\n        y: Math.floor(i / width)\r\n      });\r\n    }\r\n  }\r\n  // Sort by dValue DESCENDING\r\n  candidates.sort((a, b) => b.dval - a.dval);\r\n\r\n  // Step 3 - On-Demand Feature Selection (The 10x Win)\r\n  const divSize = (TEMPLATE_SIZE * 2 + 1) * 3;\r\n  const maxFeatureNum = Math.floor(width / OCCUPANCY_SIZE) * Math.floor(height / OCCUPANCY_SIZE) +\r\n    Math.floor(width / divSize) * Math.floor(height / divSize);\r\n\r\n  const coords = [];\r\n  const invalidated = new Uint8Array(width * height);\r\n  const templateWidth = 2 * TEMPLATE_SIZE + 1;\r\n  const nPixels = templateWidth * templateWidth;\r\n\r\n  const actualOccSize = Math.floor(Math.min(width, height) / 12);  // Reducido de 10 para m\u00E1s densidad\r\n\r\n  for (let i = 0; i < candidates.length; i++) {\r\n    const { x, y, pos } = candidates[i];\r\n    if (invalidated[pos]) continue;\r\n\r\n    // Boundary safety for template\r\n    if (x < TEMPLATE_SIZE + SEARCH_SIZE1 || x >= width - TEMPLATE_SIZE - SEARCH_SIZE1 ||\r\n      y < TEMPLATE_SIZE + SEARCH_SIZE1 || y >= height - TEMPLATE_SIZE - SEARCH_SIZE1) {\r\n      continue;\r\n    }\r\n\r\n    const vlen = _templateVar({\r\n      image,\r\n      cx: x,\r\n      cy: y,\r\n      sdThresh: TEMPLATE_SD_THRESH,\r\n      imageDataCumsum,\r\n      imageDataSqrCumsum,\r\n    });\r\n    if (vlen === null) continue;\r\n\r\n    const templateAvg = imageDataCumsum.query(\r\n      x - TEMPLATE_SIZE,\r\n      y - TEMPLATE_SIZE,\r\n      x + TEMPLATE_SIZE,\r\n      y + TEMPLATE_SIZE,\r\n    ) / nPixels;\r\n\r\n    // Optimization: Cache template once per candidate\r\n    const templateData = new Uint8Array(templateWidth * templateWidth);\r\n    let tidx = 0;\r\n    const tStart = (y - TEMPLATE_SIZE) * width + (x - TEMPLATE_SIZE);\r\n    for (let tj = 0; tj < templateWidth; tj++) {\r\n      const rowOffset = tStart + tj * width;\r\n      for (let ti = 0; ti < templateWidth; ti++) {\r\n        templateData[tidx++] = imageData[rowOffset + ti];\r\n      }\r\n    }\r\n\r\n    // Step 2.1: Find max similarity in search area (On demand!)\r\n    let max = -1.0;\r\n    for (let jj = -SEARCH_SIZE1; jj <= SEARCH_SIZE1; jj++) {\r\n      for (let ii = -SEARCH_SIZE1; ii <= SEARCH_SIZE1; ii++) {\r\n        if (ii * ii + jj * jj <= SEARCH_SIZE2 * SEARCH_SIZE2) continue;\r\n\r\n        const sim = _getSimilarityOptimized({\r\n          image,\r\n          cx: x + ii,\r\n          cy: y + jj,\r\n          vlen: vlen,\r\n          templateData,\r\n          templateAvg,\r\n          templateWidth,\r\n          imageDataCumsum,\r\n          imageDataSqrCumsum,\r\n          width,\r\n          height\r\n        });\r\n\r\n        if (sim !== null && sim > max) {\r\n          max = sim;\r\n          if (max > MAX_THRESH) break;\r\n        }\r\n      }\r\n      if (max > MAX_THRESH) break;\r\n    }\r\n\r\n    // Now decide if we select it\r\n    if (max < MAX_THRESH) {\r\n      // Uniqueness check (Step 2.2 sub-loop)\r\n      let minUnique = 1.0;\r\n      let maxUnique = -1.0;\r\n      let failedUnique = false;\r\n\r\n      for (let jj = -SEARCH_SIZE2; jj <= SEARCH_SIZE2; jj++) {\r\n        for (let ii = -SEARCH_SIZE2; ii <= SEARCH_SIZE2; ii++) {\r\n          if (ii * ii + jj * jj > SEARCH_SIZE2 * SEARCH_SIZE2) continue;\r\n          if (ii === 0 && jj === 0) continue;\r\n\r\n          const sim = _getSimilarityOptimized({\r\n            image,\r\n            vlen,\r\n            cx: x + ii,\r\n            cy: y + jj,\r\n            templateData,\r\n            templateAvg,\r\n            templateWidth,\r\n            imageDataCumsum,\r\n            imageDataSqrCumsum,\r\n            width,\r\n            height\r\n          });\r\n\r\n          if (sim === null) continue;\r\n          if (sim < minUnique) minUnique = sim;\r\n          if (sim > maxUnique) maxUnique = sim;\r\n          if (minUnique < MIN_THRESH || maxUnique > 0.99) {\r\n            failedUnique = true;\r\n            break;\r\n          }\r\n        }\r\n        if (failedUnique) break;\r\n      }\r\n\r\n      if (!failedUnique) {\r\n        coords.push({ x, y });\r\n        // Invalidate neighbors\r\n        for (let jj = -actualOccSize; jj <= actualOccSize; jj++) {\r\n          const yy = y + jj;\r\n          if (yy < 0 || yy >= height) continue;\r\n          const rowStart = yy * width;\r\n          for (let ii = -actualOccSize; ii <= actualOccSize; ii++) {\r\n            const xx = x + ii;\r\n            if (xx < 0 || xx >= width) continue;\r\n            invalidated[rowStart + xx] = 1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (coords.length >= maxFeatureNum) break;\r\n  }\r\n\r\n  return coords;\r\n};\r\n\r\n// compute variances of the pixels, centered at (cx, cy)\r\nconst _templateVar = ({ image, cx, cy, sdThresh, imageDataCumsum, imageDataSqrCumsum }) => {\r\n  if (cx - TEMPLATE_SIZE < 0 || cx + TEMPLATE_SIZE >= image.width) return null;\r\n  if (cy - TEMPLATE_SIZE < 0 || cy + TEMPLATE_SIZE >= image.height) return null;\r\n\r\n  const templateWidth = 2 * TEMPLATE_SIZE + 1;\r\n  const nPixels = templateWidth * templateWidth;\r\n\r\n  let average = imageDataCumsum.query(\r\n    cx - TEMPLATE_SIZE,\r\n    cy - TEMPLATE_SIZE,\r\n    cx + TEMPLATE_SIZE,\r\n    cy + TEMPLATE_SIZE,\r\n  );\r\n  average /= nPixels;\r\n\r\n  //v = sum((pixel_i - avg)^2) for all pixel i within the template\r\n  //  = sum(pixel_i^2) - sum(2 * avg * pixel_i) + sum(avg^avg)\r\n\r\n  let vlen = imageDataSqrCumsum.query(\r\n    cx - TEMPLATE_SIZE,\r\n    cy - TEMPLATE_SIZE,\r\n    cx + TEMPLATE_SIZE,\r\n    cy + TEMPLATE_SIZE,\r\n  );\r\n  vlen -=\r\n    2 *\r\n    average *\r\n    imageDataCumsum.query(\r\n      cx - TEMPLATE_SIZE,\r\n      cy - TEMPLATE_SIZE,\r\n      cx + TEMPLATE_SIZE,\r\n      cy + TEMPLATE_SIZE,\r\n    );\r\n  vlen += nPixels * average * average;\r\n\r\n  if (vlen / nPixels < sdThresh * sdThresh) return null;\r\n  vlen = Math.sqrt(vlen);\r\n  return vlen;\r\n};\r\n\r\nconst _getSimilarityOptimized = (options) => {\r\n  const { cx, cy, vlen, templateData, templateAvg, templateWidth, imageDataCumsum, imageDataSqrCumsum, width, height } = options;\r\n  const imageData = options.image.data;\r\n  const templateSize = (templateWidth - 1) / 2;\r\n\r\n  if (cx - templateSize < 0 || cx + templateSize >= width) return null;\r\n  if (cy - templateSize < 0 || cy + templateSize >= height) return null;\r\n\r\n  const nP = templateWidth * templateWidth;\r\n  const sx = imageDataCumsum.query(\r\n    cx - templateSize,\r\n    cy - templateSize,\r\n    cx + templateSize,\r\n    cy + templateSize,\r\n  );\r\n  const sxx = imageDataSqrCumsum.query(\r\n    cx - templateSize,\r\n    cy - templateSize,\r\n    cx + templateSize,\r\n    cy + templateSize,\r\n  );\r\n\r\n  // \uD83D\uDE80 MOONSHOT Early Exit: Check variance (vlen2) before expensive sxy loop\r\n  let vlen2 = sxx - (sx * sx) / nP;\r\n  if (vlen2 <= 0) return null;\r\n  vlen2 = Math.sqrt(vlen2);\r\n\r\n  // Full calculation - Optimized with 2x2 sub-sampling for SPEED\r\n  let sxy = 0;\r\n  const p1_start = (cy - templateSize) * width + (cx - templateSize);\r\n\r\n  for (let j = 0; j < templateWidth; j++) {\r\n    const rowOffset1 = p1_start + j * width;\r\n    const rowOffset2 = j * templateWidth;\r\n    for (let i = 0; i < templateWidth; i++) {\r\n      sxy += imageData[rowOffset1 + i] * templateData[rowOffset2 + i];\r\n    }\r\n  }\r\n\r\n  const sampledCount = templateWidth * templateWidth;\r\n  const totalCount = templateWidth * templateWidth;\r\n  sxy *= (totalCount / sampledCount);\r\n\r\n  // Covariance check\r\n  const sxy_final = sxy - templateAvg * sx;\r\n  return (1.0 * sxy_final) / (vlen * vlen2);\r\n};\r\n\r\nexport { extract };\r\n", "import { extract } from \"./extract.js\";\r\n\r\n/**\r\n * Extrae caracter\u00EDsticas de tracking de una lista de im\u00E1genes\r\n * Procesa cada imagen para obtener puntos caracter\u00EDsticos y datos de escala\r\n * @param {Array<Object>} imageList - Lista de im\u00E1genes a procesar\r\n * @param {Function} doneCallback - Funci\u00F3n de callback para reportar progreso\r\n * @returns {Array<Object>} Conjunto de caracter\u00EDsticas extra\u00EDdas\r\n */\r\nexport const extractTrackingFeatures = (imageList, doneCallback) => {\r\n  const featureSets = [];\r\n\r\n  // Procesar cada imagen en la lista\r\n  for (let i = 0; i < imageList.length; i++) {\r\n    const image = imageList[i];\r\n\r\n    // Extraer puntos caracter\u00EDsticos\r\n    const points = extract(image);\r\n\r\n    // Construir conjunto de caracter\u00EDsticas\r\n    const featureSet = {\r\n      data: image.data,\r\n      scale: image.scale,\r\n      width: image.width,\r\n      height: image.height,\r\n      points,\r\n    };\r\n    featureSets.push(featureSet);\r\n\r\n    // Reportar progreso\r\n    doneCallback(i);\r\n  }\r\n  return featureSets;\r\n};\r\n", "/**\r\n * @fileoverview Compilador Offline Optimizado - Sin TensorFlow para m\u00E1xima velocidad\r\n * \r\n * Este m\u00F3dulo implementa un compilador de im\u00E1genes AR ultrarr\u00E1pido\r\n * que NO depende de TensorFlow, eliminando todos los problemas de\r\n * inicializaci\u00F3n, bloqueos y compatibilidad.\r\n */\r\n\r\nimport { buildTrackingImageList, buildImageList } from \"../core/image-list.js\";\r\nimport { extractTrackingFeatures } from \"../core/tracker/extract-utils.js\";\r\nimport { DetectorLite } from \"../core/detector/detector-lite.js\";\r\nimport { build as hierarchicalClusteringBuild } from \"../core/matching/hierarchical-clustering.js\";\r\nimport * as protocol from \"../core/protocol.js\";\r\nimport { triangulate, getEdges } from \"../core/utils/delaunay.js\";\r\nimport { AR_CONFIG } from \"../core/constants.js\";\r\n\r\n\r\n// Detect environment\r\nconst isNode = typeof process !== \"undefined\" &&\r\n    process.versions != null &&\r\n    process.versions.node != null;\r\n\r\nexport class OfflineCompiler {\r\n    data: any = null;\r\n\r\n    constructor() {\r\n        console.log(\"\u26A1 OfflineCompiler: Main thread mode (no workers)\");\r\n    }\r\n\r\n    async compileImageTargets(images: any[], progressCallback: (p: number) => void) {\r\n        console.time(\"\u23F1\uFE0F Compilaci\u00F3n total\");\r\n\r\n        const targetImages: any[] = [];\r\n\r\n        // Preparar im\u00E1genes\r\n        for (let i = 0; i < images.length; i++) {\r\n            const img = images[i];\r\n\r\n            if (!img || !img.width || !img.height || !img.data) {\r\n                throw new Error(\r\n                    `Imagen inv\u00E1lida en posici\u00F3n ${i}. Debe tener propiedades width, height y data.`\r\n                );\r\n            }\r\n\r\n            const greyImageData = new Uint8Array(img.width * img.height);\r\n\r\n            if (img.data.length === img.width * img.height) {\r\n                greyImageData.set(img.data);\r\n            } else if (img.data.length === img.width * img.height * 4) {\r\n                for (let j = 0; j < greyImageData.length; j++) {\r\n                    const offset = j * 4;\r\n                    greyImageData[j] = Math.floor(\r\n                        (img.data[offset] + img.data[offset + 1] + img.data[offset + 2]) / 3\r\n                    );\r\n                }\r\n            } else {\r\n                throw new Error(`Formato de datos de imagen no soportado en posici\u00F3n ${i}`);\r\n            }\r\n\r\n            targetImages.push({\r\n                data: greyImageData,\r\n                width: img.width,\r\n                height: img.height,\r\n            });\r\n        }\r\n\r\n        const results: any[] = await this._compileTarget(targetImages, progressCallback);\r\n\r\n        this.data = targetImages.map((img, i) => ({\r\n            targetImage: img,\r\n            matchingData: results[i].matchingData,\r\n            trackingData: results[i].trackingData,\r\n        }));\r\n\r\n        console.timeEnd(\"\u23F1\uFE0F Compilaci\u00F3n total\");\r\n        return this.data;\r\n    }\r\n\r\n    async _compileTarget(targetImages: any[], progressCallback: (p: number) => void) {\r\n        // Run match and track sequentially to match browser behavior exactly\r\n        const matchingResults = await this._compileMatch(targetImages, (p) => progressCallback(p * 0.5));\r\n        const trackingResults = await this._compileTrack(targetImages, (p) => progressCallback(50 + p * 0.5));\r\n\r\n        return targetImages.map((_, i) => ({\r\n            matchingData: matchingResults[i],\r\n            trackingData: trackingResults[i]\r\n        }));\r\n    }\r\n\r\n    async _compileMatch(targetImages: any[], progressCallback: (p: number) => void) {\r\n        const percentPerImage = 100 / targetImages.length;\r\n        let currentPercent = 0;\r\n\r\n        const results = [];\r\n        for (let i = 0; i < targetImages.length; i++) {\r\n            const targetImage = targetImages[i];\r\n\r\n            // \uD83D\uDE80 NANITE-STYLE: Only process the target at scale 1.0\r\n            // The DetectorLite already builds its own pyramid and finds features at all octaves (virtualized LOD)\r\n            const detector = new DetectorLite(targetImage.width, targetImage.height, {\r\n                useLSH: AR_CONFIG.USE_LSH,\r\n                maxFeaturesPerBucket: AR_CONFIG.MAX_FEATURES_PER_BUCKET\r\n            });\r\n            const { featurePoints: rawPs } = detector.detect(targetImage.data);\r\n\r\n            // \uD83C\uDFAF Stratified Sampling: Ensure we have features from ALL scales\r\n            // We take the top N features per octave to guarantee scale coverage (Nanite-style)\r\n            const octaves = [0, 1, 2, 3, 4, 5];\r\n            const ps: any[] = [];\r\n            const featuresPerOctave = 300;\r\n\r\n            for (const oct of octaves) {\r\n                const octScale = Math.pow(2, oct);\r\n                const octFeatures = rawPs\r\n                    .filter(p => Math.abs(p.scale - octScale) < 0.1)\r\n                    .sort((a, b) => (b.score || 0) - (a.score || 0))\r\n                    .slice(0, featuresPerOctave);\r\n                ps.push(...octFeatures);\r\n            }\r\n\r\n            const maximaPoints = ps.filter((p: any) => p.maxima);\r\n            const minimaPoints = ps.filter((p: any) => !p.maxima);\r\n            const maximaPointsCluster = hierarchicalClusteringBuild({ points: maximaPoints });\r\n            const minimaPointsCluster = hierarchicalClusteringBuild({ points: minimaPoints });\r\n\r\n            const keyframe = {\r\n                maximaPoints,\r\n                minimaPoints,\r\n                maximaPointsCluster,\r\n                minimaPointsCluster,\r\n                width: targetImage.width,\r\n                height: targetImage.height,\r\n                scale: 1.0,\r\n            };\r\n\r\n            // Wrapped in array because the protocol expects matchingData to be an array of keyframes\r\n            // We provide only one keyframe containing features from all octaves\r\n            results.push([keyframe]);\r\n\r\n            currentPercent += percentPerImage;\r\n            progressCallback(currentPercent);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    async _compileTrack(targetImages: any[], progressCallback: (p: number) => void) {\r\n        const percentPerImage = 100 / targetImages.length;\r\n        let currentPercent = 0;\r\n\r\n        const results = [];\r\n        for (let i = 0; i < targetImages.length; i++) {\r\n            const targetImage = targetImages[i];\r\n            const imageList = buildTrackingImageList(targetImage);\r\n            const percentPerScale = percentPerImage / imageList.length;\r\n\r\n            const trackingData = extractTrackingFeatures(imageList, () => {\r\n                currentPercent += percentPerScale;\r\n                progressCallback(currentPercent);\r\n            });\r\n\r\n            results.push(trackingData);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    async compileTrack({ progressCallback, targetImages, basePercent = 0 }: { progressCallback: (p: number) => void, targetImages: any[], basePercent?: number }) {\r\n        return this._compileTrack(targetImages, (percent) => {\r\n            progressCallback(basePercent + percent * (100 - basePercent) / 100);\r\n        });\r\n    }\r\n\r\n    async compileMatch({ progressCallback, targetImages, basePercent = 0 }: { progressCallback: (p: number) => void, targetImages: any[], basePercent?: number }) {\r\n        return this._compileMatch(targetImages, (percent) => {\r\n            progressCallback(basePercent + percent * (50 - basePercent) / 100);\r\n        });\r\n    }\r\n\r\n    exportData() {\r\n        if (!this.data) {\r\n            throw new Error(\"No hay datos compilados para exportar\");\r\n        }\r\n\r\n        const dataList = this.data.map((item: any) => {\r\n            return {\r\n                targetImage: {\r\n                    width: item.targetImage.width,\r\n                    height: item.targetImage.height,\r\n                },\r\n                trackingData: item.trackingData.map((td: any) => {\r\n                    const count = td.points.length;\r\n                    const px = new Float32Array(count);\r\n                    const py = new Float32Array(count);\r\n                    for (let i = 0; i < count; i++) {\r\n                        px[i] = td.points[i].x;\r\n                        py[i] = td.points[i].y;\r\n                    }\r\n                    const triangles = triangulate(td.points);\r\n                    const edges = getEdges(triangles);\r\n                    const restLengths = new Float32Array(edges.length);\r\n                    for (let j = 0; j < edges.length; j++) {\r\n                        const p1 = td.points[edges[j][0]];\r\n                        const p2 = td.points[edges[j][1]];\r\n                        restLengths[j] = Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);\r\n                    }\r\n\r\n                    return {\r\n                        w: td.width,\r\n                        h: td.height,\r\n                        s: td.scale,\r\n                        px,\r\n                        py,\r\n                        d: td.data,\r\n                        mesh: {\r\n                            t: new Uint16Array(triangles.flat()),\r\n                            e: new Uint16Array(edges.flat()),\r\n                            rl: restLengths\r\n                        }\r\n                    };\r\n                }),\r\n                matchingData: item.matchingData.map((kf: any) => {\r\n                    const useCompact = AR_CONFIG.USE_COMPACT_DESCRIPTORS;\r\n                    const columnarizeFn = useCompact ? protocol.columnarizeCompact : protocol.columnarize;\r\n                    return {\r\n                        w: kf.width,\r\n                        h: kf.height,\r\n                        s: kf.scale,\r\n                        hdc: false,\r\n                        max: columnarizeFn(kf.maximaPoints, kf.maximaPointsCluster, kf.width, kf.height),\r\n                        min: columnarizeFn(kf.minimaPoints, kf.minimaPointsCluster, kf.width, kf.height),\r\n                    };\r\n                }),\r\n\r\n            };\r\n        });\r\n\r\n        return protocol.encodeTaar(dataList);\r\n    }\r\n\r\n    importData(buffer: ArrayBuffer | Uint8Array) {\r\n        const result = protocol.decodeTaar(buffer);\r\n        this.data = result.dataList;\r\n        return result;\r\n    }\r\n\r\n    async destroy() {\r\n        // No workers to destroy\r\n    }\r\n}\r\n", "/**\r\n * \uD83D\uDE80 Moonshot: Simple incremental Delaunay Triangulation (Bowyer-Watson)\r\n * \r\n * Used to create a topological mesh covering the image target features.\r\n */\r\n\r\nexport function triangulate(points) {\r\n    if (points.length < 3) return [];\r\n\r\n    // 1. Create a super-triangle that contains all points\r\n    // Find min/max bounds\r\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n    for (const p of points) {\r\n        if (p.x < minX) minX = p.x;\r\n        if (p.x > maxX) maxX = p.x;\r\n        if (p.y < minY) minY = p.y;\r\n        if (p.y > maxY) maxY = p.y;\r\n    }\r\n\r\n    const dx = maxX - minX;\r\n    const dy = maxY - minY;\r\n    const deltaMax = Math.max(dx, dy);\r\n    const midX = (minX + maxX) / 2;\r\n    const midY = (minY + maxY) / 2;\r\n\r\n    // A triangle large enough to cover all points\r\n    const p1 = { x: midX - 20 * deltaMax, y: midY - deltaMax };\r\n    const p2 = { x: midX, y: midY + 20 * deltaMax };\r\n    const p3 = { x: midX + 20 * deltaMax, y: midY - deltaMax };\r\n\r\n    let triangles = [\r\n        { p1, p2, p3, indices: [-1, -2, -3] }\r\n    ];\r\n\r\n    // 2. Add points one by one\r\n    for (let i = 0; i < points.length; i++) {\r\n        const p = points[i];\r\n        const badTriangles = [];\r\n\r\n        for (const t of triangles) {\r\n            if (isInCircumcircle(p, t)) {\r\n                badTriangles.push(t);\r\n            }\r\n        }\r\n\r\n        const polygon = [];\r\n        for (const t of badTriangles) {\r\n            const edges = [\r\n                { a: t.p1, b: t.p2, i1: t.indices[0], i2: t.indices[1] },\r\n                { a: t.p2, b: t.p3, i1: t.indices[1], i2: t.indices[2] },\r\n                { a: t.p3, b: t.p1, i1: t.indices[2], i2: t.indices[0] }\r\n            ];\r\n\r\n            for (const edge of edges) {\r\n                let isShared = false;\r\n                for (const t2 of badTriangles) {\r\n                    if (t === t2) continue;\r\n                    if (isSameEdge(edge, t2)) {\r\n                        isShared = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!isShared) {\r\n                    polygon.push(edge);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Remove bad triangles\r\n        triangles = triangles.filter(t => !badTriangles.includes(t));\r\n\r\n        // Add new triangles from polygon edges to point p\r\n        for (const edge of polygon) {\r\n            triangles.push({\r\n                p1: edge.a,\r\n                p2: edge.b,\r\n                p3: p,\r\n                indices: [edge.i1, edge.i2, i]\r\n            });\r\n        }\r\n    }\r\n\r\n    // 3. Remove triangles that share vertices with the super-triangle\r\n    return triangles.filter(t => {\r\n        return t.indices[0] >= 0 && t.indices[1] >= 0 && t.indices[2] >= 0;\r\n    }).map(t => t.indices);\r\n}\r\n\r\nfunction isInCircumcircle(p, t) {\r\n    const x1 = t.p1.x, y1 = t.p1.y;\r\n    const x2 = t.p2.x, y2 = t.p2.y;\r\n    const x3 = t.p3.x, y3 = t.p3.y;\r\n\r\n    const D = 2 * (x1 * (y2 - y3) + x2 * (y3 - y1) + x3 * (y1 - y2));\r\n    const centerX = ((x1 * x1 + y1 * y1) * (y2 - y3) + (x2 * x2 + y2 * y2) * (y3 - y1) + (x3 * x3 + y3 * y3) * (y1 - y2)) / D;\r\n    const centerY = ((x1 * x1 + y1 * y1) * (x3 - x2) + (x2 * x2 + y2 * y2) * (x1 - x3) + (x3 * x3 + y3 * y3) * (x2 - x1)) / D;\r\n\r\n    const radiusSq = (x1 - centerX) * (x1 - centerX) + (y1 - centerY) * (y1 - centerY);\r\n    const distSq = (p.x - centerX) * (p.x - centerX) + (p.y - centerY) * (p.y - centerY);\r\n\r\n    return distSq <= radiusSq;\r\n}\r\n\r\nfunction isSameEdge(edge, triangle) {\r\n    const tEdges = [\r\n        [triangle.indices[0], triangle.indices[1]],\r\n        [triangle.indices[1], triangle.indices[2]],\r\n        [triangle.indices[2], triangle.indices[0]]\r\n    ];\r\n\r\n    for (const te of tEdges) {\r\n        if ((edge.i1 === te[0] && edge.i2 === te[1]) || (edge.i1 === te[1] && edge.i2 === te[0])) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Extract edges from triangles for Mass-Spring logic\r\n */\r\nexport function getEdges(triangles) {\r\n    const edgeSet = new Set();\r\n    const edges = [];\r\n\r\n    for (const t of triangles) {\r\n        const pairs = [[t[0], t[1]], [t[1], t[2]], [t[2], t[0]]];\r\n        for (const pair of pairs) {\r\n            const low = Math.min(pair[0], pair[1]);\r\n            const high = Math.max(pair[0], pair[1]);\r\n            const key = `${low}-${high}`;\r\n            if (!edgeSet.has(key)) {\r\n                edgeSet.add(key);\r\n                edges.push([low, high]);\r\n            }\r\n        }\r\n    }\r\n    return edges;\r\n}\r\n", "/**\r\n * \uD83D\uDCD0 AR Projection Utilities\r\n * Common logic for projecting 3D marker-space points to 2D screen CSS pixels.\r\n */\r\n\r\n/**\r\n * Projects a 3D marker-space point (x, y, z) into 2D screen coordinates.\r\n * \r\n * @param {number} x - Marker X coordinate\r\n * @param {number} y - Marker Y coordinate\r\n * @param {number} z - Marker Z coordinate (height from surface)\r\n * @param {number[][]} mVT - ModelViewTransform matrix (3x4)\r\n * @param {number[][]} proj - Projection matrix (3x3)\r\n * @param {number} videoW - Internal video width\r\n * @param {number} videoH - Internal video height\r\n * @param {Object} containerRect - {width, height} of the display container\r\n * @param {boolean} needsRotation - Whether the feed needs 90deg rotation (e.g. portrait mobile)\r\n * @returns {{sx: number, sy: number}} Screen coordinates [X, Y]\r\n */\r\nexport function projectToScreen(x, y, z, mVT, proj, videoW, videoH, containerRect, needsRotation = false) {\r\n    // 1. Marker Space -> Camera Space (3D)\r\n    const tx = mVT[0][0] * x + mVT[0][1] * y + mVT[0][2] * z + mVT[0][3];\r\n    const ty = mVT[1][0] * x + mVT[1][1] * y + mVT[1][2] * z + mVT[1][3];\r\n    const tz = mVT[2][0] * x + mVT[2][1] * y + mVT[2][2] * z + mVT[2][3];\r\n\r\n    // 2. Camera Space -> Buffer Pixels (2D)\r\n    // Using intrinsic projection from controller\r\n    const bx = (proj[0][0] * tx / tz) + proj[0][2];\r\n    const by = (proj[1][1] * ty / tz) + proj[1][2];\r\n\r\n    // 3. Buffer Pixels -> Screen CSS Pixels\r\n    const vW = needsRotation ? videoH : videoW;\r\n    const vH = needsRotation ? videoW : videoH;\r\n\r\n    // Calculate how the video is scaled to cover (object-fit: cover) the container\r\n    const perspectiveScale = Math.max(containerRect.width / vW, containerRect.height / vH);\r\n\r\n    const displayW = vW * perspectiveScale;\r\n    const displayH = vH * perspectiveScale;\r\n\r\n    // Centering offsets\r\n    const offsetX = (containerRect.width - displayW) / 2;\r\n    const offsetY = (containerRect.height - displayH) / 2;\r\n\r\n    let sx, sy;\r\n    if (needsRotation) {\r\n        // Rotation Mapping: \r\n        // Camera +X (Right) -> Screen +Y (Down)\r\n        // Camera +Y (Down)  -> Screen -X (Left)\r\n        sx = offsetX + (displayW / 2) - (by - proj[1][2]) * perspectiveScale;\r\n        sy = offsetY + (displayH / 2) + (bx - proj[0][2]) * perspectiveScale;\r\n    } else {\r\n        sx = offsetX + (displayW / 2) + (bx - proj[0][2]) * perspectiveScale;\r\n        sy = offsetY + (displayH / 2) + (by - proj[1][2]) * perspectiveScale;\r\n    }\r\n\r\n    return { sx, sy };\r\n}\r\n", "import { BioInspiredController } from '../src/runtime/bio-inspired-controller.js';\r\nimport { OfflineCompiler } from '../src/compiler/offline-compiler.js';\r\nimport { projectToScreen } from '../src/core/utils/projection.js';\r\nimport { AR_CONFIG } from '../src/core/constants.js';\r\n\r\nconst WIDTH = AR_CONFIG.VIEWPORT_WIDTH;\r\nconst HEIGHT = AR_CONFIG.VIEWPORT_HEIGHT;\r\n\r\nconst video = document.getElementById('video') as HTMLVideoElement;\r\nconst arCanvas = document.getElementById('arCanvas') as HTMLCanvasElement;\r\nconst debugCanvas = document.getElementById('debugCanvas') as HTMLCanvasElement;\r\nconst arCtx = arCanvas.getContext('2d')!;\r\nconst debugCtx = debugCanvas.getContext('2d')!;\r\nconst btnCapture = document.getElementById('btn-capture') as HTMLButtonElement;\r\nconst btnReset = document.getElementById('btn-reset') as HTMLButtonElement;\r\nconst scanLine = document.getElementById('scan-line')!;\r\nconst overlayImg = document.getElementById('overlay-img') as HTMLImageElement;\r\nconst capturePreview = document.getElementById('capture-preview') as HTMLImageElement;\r\nconst arContainer = document.getElementById('ar-container')!;\r\n\r\n// Initialize canvas sizes\r\narCanvas.width = WIDTH;\r\narCanvas.height = HEIGHT;\r\n\r\nlet controller: BioInspiredController | null = null;\r\nlet captureCanvas: HTMLCanvasElement | null = null;\r\nlet isTesting = false;\r\n\r\nfunction log(msg: string) {\r\n    // Silenced for a cleaner UI\r\n    console.log(`[AR LOG] ${msg}`);\r\n}\r\n\r\nconst instructionText = document.getElementById('instruction-text')!;\r\n\r\nvideo.onloadedmetadata = () => {\r\n    log(`C\u00E1mara: ${video.videoWidth}x${video.videoHeight}`);\r\n\r\n    // Adjust debug canvas to match container's physical size for high-res drawing\r\n    const dpr = window.devicePixelRatio || 1;\r\n    const rect = arContainer.getBoundingClientRect();\r\n    debugCanvas.width = rect.width * dpr;\r\n    debugCanvas.height = rect.height * dpr;\r\n\r\n    // Direct transition to capture-ready state\r\n    btnCapture.style.display = 'block'; // Ensure capture button is visible\r\n    btnCapture.classList.add('btn-pulse'); // Add pulse animation\r\n    scanLine.style.display = 'block'; // Show scan line\r\n    instructionText.textContent = 'Paso 1: Enmarca el objeto y haz clic en \"Capturar\"';\r\n};\r\n\r\nasync function startCamera() {\r\n    try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n            video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }\r\n        });\r\n        video.srcObject = stream;\r\n        log('C\u00E1mara iniciada correctamente.');\r\n    } catch (err) {\r\n        log('Error al acceder a la c\u00E1mara: ' + err);\r\n    }\r\n}\r\n\r\nfunction drawVideoToCanvas(ctx: CanvasRenderingContext2D, videoElement: HTMLVideoElement, targetWidth: number, targetHeight: number) {\r\n    const videoWidth = videoElement.videoWidth;\r\n    const videoHeight = videoElement.videoHeight;\r\n    const videoRatio = videoWidth / videoHeight;\r\n    const targetRatio = targetWidth / targetHeight;\r\n\r\n    let sx, sy, sw, sh;\r\n\r\n    if (videoRatio > targetRatio) {\r\n        // Video is wider than canvas (landscape vs portrait-ish)\r\n        sh = videoHeight;\r\n        sw = sh * targetRatio;\r\n        sx = (videoWidth - sw) / 2;\r\n        sy = 0;\r\n    } else {\r\n        // Video is taller than canvas (portrait vs landscape-ish)\r\n        sw = videoWidth;\r\n        sh = sw / targetRatio;\r\n        sx = 0;\r\n        sy = (videoHeight - sh) / 2;\r\n    }\r\n\r\n    ctx.drawImage(videoElement, sx, sy, sw, sh, 0, 0, targetWidth, targetHeight);\r\n}\r\n\r\nbtnCapture.onclick = async () => {\r\n    btnCapture.disabled = true;\r\n    btnCapture.classList.remove('btn-pulse');\r\n    instructionText.textContent = 'Procesando imagen... un momento';\r\n    log('Capturando frame...');\r\n\r\n    // Capture current frame with aspect ratio fix\r\n    captureCanvas = document.createElement('canvas');\r\n    captureCanvas.width = WIDTH;\r\n    captureCanvas.height = HEIGHT;\r\n    const ctx = captureCanvas.getContext('2d')!;\r\n\r\n    drawVideoToCanvas(ctx, video, WIDTH, HEIGHT);\r\n\r\n    // Show preview\r\n    capturePreview.src = captureCanvas.toDataURL();\r\n    capturePreview.style.display = 'block';\r\n\r\n    log('Compilando target al vuelo...');\r\n    const compiler = new OfflineCompiler();\r\n\r\n    try {\r\n        const compiledData = await compiler.compileImageTargets([\r\n            {\r\n                width: WIDTH,\r\n                height: HEIGHT,\r\n                data: ctx.getImageData(0, 0, WIDTH, HEIGHT).data\r\n            }\r\n        ], (p) => {\r\n            if (Math.round(p) % 20 === 0) log(`Progreso: ${Math.round(p)}%`);\r\n        });\r\n\r\n        const buffer = compiler.exportData();\r\n        const cleanBuffer = buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength);\r\n\r\n        controller = new BioInspiredController({\r\n            inputWidth: WIDTH,\r\n            inputHeight: HEIGHT,\r\n            debugMode: true,\r\n            bioInspired: { enabled: true, aggressiveSkipping: false },\r\n            onUpdate: (data) => handleARUpdate(data, WIDTH, HEIGHT)\r\n        });\r\n\r\n        await controller.addImageTargetsFromBuffer(cleanBuffer);\r\n\r\n        log('Target registrado con \u00E9xito. Iniciando tracking autom\u00E1ticamente.');\r\n        btnCapture.style.display = 'none';\r\n        btnReset.style.display = 'block';\r\n        scanLine.style.display = 'none';\r\n        instructionText.style.opacity = '0';\r\n\r\n        isTesting = true;\r\n        overlayImg.style.display = 'block';\r\n        startProcessingLoop();\r\n\r\n    } catch (e) {\r\n        log('Error en compilaci\u00F3n: ' + e);\r\n        btnCapture.disabled = false;\r\n        instructionText.textContent = 'Error. Intenta capturar de nuevo.';\r\n    }\r\n};\r\n\r\nfunction startProcessingLoop() {\r\n    if (!controller || !isTesting) return;\r\n\r\n    function processFrame() {\r\n        if (!isTesting) return;\r\n\r\n        // Feed corrected frame to arCanvas so controller can see it\r\n        drawVideoToCanvas(arCtx, video, WIDTH, HEIGHT);\r\n\r\n        // The controller normally calls processVideo which does internal polling on a canvas.\r\n        // But since we are manually drawing to arCanvas to fix aspect ratio,\r\n        // we can just call processVideo(arCanvas) once and it will keep looking at it.\r\n        // Actually, BioInspiredController.processVideo(canvas) starts an internal loop.\r\n        // So we just need to keep updating that canvas.\r\n\r\n        requestAnimationFrame(processFrame);\r\n    }\r\n\r\n    controller.processVideo(arCanvas);\r\n    processFrame();\r\n}\r\n\r\nbtnReset.onclick = () => {\r\n    location.reload();\r\n};\r\n\r\nfunction handleARUpdate(data: any, markerW: number, markerH: number) {\r\n    if (data.type === 'processDone') return;\r\n\r\n    const dpr = window.devicePixelRatio || 1;\r\n    const scaleX = debugCanvas.width / WIDTH;\r\n    const scaleY = debugCanvas.height / HEIGHT;\r\n\r\n    // Clear debug canvas\r\n    if (data.type === 'featurePoints' || data.type === 'updateMatrix') {\r\n        debugCtx.clearRect(0, 0, debugCanvas.width, debugCanvas.height);\r\n    }\r\n\r\n    if (data.type === 'featurePoints') {\r\n        const { featurePoints } = data;\r\n        if (featurePoints && !isTesting) {\r\n            drawFeaturePoints(featurePoints, scaleX, scaleY);\r\n        }\r\n    }\r\n\r\n    if (data.type === 'updateMatrix') {\r\n        const { worldMatrix, modelViewTransform, screenCoords } = data;\r\n\r\n        if (screenCoords && screenCoords.length > 0) {\r\n            drawTrackingPoints(screenCoords, scaleX, scaleY);\r\n        }\r\n\r\n        if (worldMatrix && isTesting) {\r\n            positionOverlay(modelViewTransform, markerW, markerH);\r\n        } else {\r\n            if (isTesting) {\r\n                overlayImg.style.display = 'none';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawFeaturePoints(points: any[], sx: number, sy: number) {\r\n    debugCtx.fillStyle = 'rgba(255, 255, 0, 0.6)';\r\n    const limit = Math.min(points.length, 150);\r\n    for (let i = 0; i < limit; i++) {\r\n        const p = points[i];\r\n        debugCtx.fillRect(p.x * sx - 1, p.y * sy - 1, 2, 2);\r\n    }\r\n}\r\n\r\nfunction drawTrackingPoints(coords: any[], sx: number, sy: number) {\r\n    debugCtx.fillStyle = 'rgba(0, 255, 0, 0.8)';\r\n    const limit = Math.min(coords.length, 100);\r\n    for (let i = 0; i < limit; i++) {\r\n        const p = coords[i];\r\n        debugCtx.fillRect(p.x * sx - 1.5, p.y * sy - 1.5, 3, 3);\r\n    }\r\n}\r\n\r\nfunction positionOverlay(mVT: number[][], markerW: number, markerH: number) {\r\n    if (!controller) return;\r\n\r\n    const proj = (controller as any).projectionTransform;\r\n    const containerRect = arContainer.getBoundingClientRect();\r\n\r\n    const pUL = projectToScreen(0, 0, 0, mVT, proj, WIDTH, HEIGHT, containerRect, false);\r\n    const pUR = projectToScreen(markerW, 0, 0, mVT, proj, WIDTH, HEIGHT, containerRect, false);\r\n    const pLL = projectToScreen(0, markerH, 0, mVT, proj, WIDTH, HEIGHT, containerRect, false);\r\n    const pLR = projectToScreen(markerW, markerH, 0, mVT, proj, WIDTH, HEIGHT, containerRect, false);\r\n\r\n    const matrix = solveHomography(markerW, markerH, pUL, pUR, pLL, pLR);\r\n\r\n    overlayImg.style.width = `${markerW}px`;\r\n    overlayImg.style.height = `${markerH}px`;\r\n    overlayImg.style.transformOrigin = '0 0';\r\n    overlayImg.style.transform = `matrix3d(${matrix.join(',')})`;\r\n    overlayImg.style.display = 'block';\r\n}\r\n\r\nfunction solveHomography(w: number, h: number, p1: any, p2: any, p3: any, p4: any) {\r\n    const x1 = p1.sx, y1 = p1.sy;\r\n    const x2 = p2.sx, y2 = p2.sy;\r\n    const x3 = p3.sx, y3 = p3.sy;\r\n    const x4 = p4.sx, y4 = p4.sy;\r\n\r\n    const dx1 = x2 - x4, dx2 = x3 - x4, dx3 = x1 - x2 + x4 - x3;\r\n    const dy1 = y2 - y4, dy2 = y3 - y4, dy3 = y1 - y2 + y4 - y3;\r\n\r\n    let a, b, c, d, e, f, g, h_coeff;\r\n    const det = dx1 * dy2 - dx2 * dy1;\r\n    g = (dx3 * dy2 - dx2 * dy3) / det;\r\n    h_coeff = (dx1 * dy3 - dx3 * dy1) / det;\r\n    a = x2 - x1 + g * x2;\r\n    b = x3 - x1 + h_coeff * x3;\r\n    c = x1;\r\n    d = y2 - y1 + g * y2;\r\n    e = y3 - y1 + h_coeff * y3;\r\n    f = y1;\r\n\r\n    return [\r\n        a / w, d / w, 0, g / w,\r\n        b / h, e / h, 0, h_coeff / h,\r\n        0, 0, 1, 0,\r\n        c, f, 0, 1\r\n    ];\r\n}\r\n\r\nstartCamera();\r\n"],
  "mappings": "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",
  "names": ["buildModelViewProjectionTransform", "applyModelViewProjectionTransform", "computeScreenCoordiate", "init_utils", "__esmMin", "projectionTransform", "modelViewTransform", "modelViewProjectionTransform", "x", "y", "_z", "ux", "uy", "uz", "z", "refineNonRigid", "mesh", "trackedPoints", "currentVertices", "iterations", "edges", "restLengths", "numVertices", "vertices", "stiffness", "dataFidelity", "iter", "i", "idx1", "idx2", "restL", "vx1", "vy1", "vx2", "vy2", "dx", "dy", "currentL", "diff", "moveX", "moveY", "tp", "idx", "targetX", "targetY", "init_non_rigid_refine", "__esmMin", "AR_CONFIG", "init_constants", "__esmMin", "AR2_DEFAULT_TS", "AR2_SEARCH_SIZE", "AR2_SEARCH_GAP", "AR2_SIM_THRESH", "Tracker", "init_tracker", "__esmMin", "init_utils", "init_non_rigid_refine", "init_constants", "AR_CONFIG", "markerDimensions", "trackingDataList", "projectionTransform", "inputWidth", "inputHeight", "debugMode", "i", "targetOctaves", "keyframe", "templateSize", "inputData", "transform", "targetIndex", "lastModelViewTransform", "debugExtra", "modelViewProjectionTransform", "buildModelViewProjectionTransform", "mW", "mH", "p0", "computeScreenCoordiate", "p1", "screenW", "octaveIndex", "minDiff", "switchThreshold", "diff", "prebuilt", "projectedImage", "matchingPoints", "sim", "trackingFrame", "worldCoords", "screenCoords", "goodTrack", "px", "py", "scale", "reliabilities", "reliability", "point", "deformedMesh", "currentOctaveVertices", "trackedTargets", "j", "idx", "refinedOctaveVertices", "refineNonRigid", "screenMeshVertices", "p", "minX", "minY", "maxX", "maxY", "markerPixels", "markerWidth", "markerHeight", "featureCount", "templateOneSize", "oneOverNPixels", "searchOneSize", "searchGap", "sims", "templateData", "f", "sCenterX", "sCenterY", "bestSim", "bestX", "bestY", "sumT", "sumT2", "tidx", "ty", "fyOffset", "tx", "val", "varT", "coarseGap", "sy", "cy", "sx", "cx", "sumI", "sumI2", "sumIT", "rowOffset", "tRowOffset", "valI", "valT", "varI", "fineCenterX", "fineCenterY", "fineSearch", "M", "markerScale", "invScale", "inputW", "inputH", "m00", "m01", "m03", "m10", "m11", "m13", "m20", "m21", "m23", "y", "jOffset", "x", "invZ", "ux", "uy", "x0", "y0", "x1", "y1", "dx", "dy", "omDx", "omDy", "y0Offset", "y1Offset", "v00", "v10", "v01", "v11", "FREAK_RINGS", "FREAKPOINTS", "init_freak", "__esmMin", "r", "sigma", "i", "point", "tryInitGPU", "computeGradientsJS", "findLocalMaximaJS", "gaussianBlurJS", "downsampleJS", "GPUCompute", "gpuCompute", "init_gpu_compute", "__esmMin", "imageData", "width", "height", "dValue", "j", "rowOffset", "prevRowOffset", "nextRowOffset", "i", "pos", "dx", "dy", "gradients", "isCandidate", "val", "data", "output", "temp", "k0", "k1", "k2", "w1", "h1", "y", "x", "x0", "x1", "x3", "x4", "y0", "y1", "y2", "y3", "y4", "newWidth", "newHeight", "sy", "sx", "numLevels", "pyramid", "currentData", "currentWidth", "currentHeight", "level", "blurred", "downsampled", "computeLSH64", "samples", "result", "i", "p1", "LSH_PAIRS", "p2", "uintIdx", "uintBitIdx", "computeFullFREAK", "descriptor", "bitCount", "byteIdx", "FREAKPOINTS", "j", "packLSHIntoDescriptor", "lsh", "desc", "view", "SAMPLING_INDICES", "currentBit", "samplingIdx", "init_lsh_direct", "__esmMin", "init_freak", "utf8Count", "str", "strLength", "byteLength", "pos", "value", "extra", "utf8EncodeJs", "output", "outputOffset", "offset", "utf8EncodeTE", "sharedTextEncoder", "utf8Encode", "TEXT_ENCODER_THRESHOLD", "utf8DecodeJs", "bytes", "inputOffset", "end", "units", "result", "byte1", "byte2", "byte3", "byte4", "unit", "CHUNK_SIZE", "utf8DecodeTD", "stringBytes", "sharedTextDecoder", "utf8Decode", "TEXT_DECODER_THRESHOLD", "init_utf8", "__esmMin", "ExtData", "init_ExtData", "__esmMin", "type", "data", "DecodeError", "init_DecodeError", "__esmMin", "_DecodeError", "message", "proto", "setUint64", "view", "offset", "value", "high", "low", "setInt64", "getInt64", "getUint64", "init_int", "__esmMin", "encodeTimeSpecToTimestamp", "sec", "nsec", "TIMESTAMP64_MAX_SEC", "TIMESTAMP32_MAX_SEC", "rv", "secHigh", "secLow", "view", "setInt64", "encodeDateToTimeSpec", "date", "msec", "nsecInSec", "encodeTimestampExtension", "object", "timeSpec", "decodeTimestampToTimeSpec", "data", "nsec30AndSecHigh2", "secLow32", "getInt64", "DecodeError", "decodeTimestampExtension", "EXT_TIMESTAMP", "timestampExtension", "init_timestamp", "__esmMin", "init_DecodeError", "init_int", "ExtensionCodec", "init_ExtensionCodec", "__esmMin", "init_ExtData", "init_timestamp", "_ExtensionCodec", "timestampExtension", "type", "encode", "decode", "index", "object", "context", "i", "encodeExt", "data", "ExtData", "decodeExt", "isArrayBufferLike", "buffer", "ensureUint8Array", "init_typedArrays", "__esmMin", "DEFAULT_MAX_DEPTH", "DEFAULT_INITIAL_BUFFER_SIZE", "Encoder", "init_Encoder", "__esmMin", "init_utf8", "init_ExtensionCodec", "init_int", "init_typedArrays", "_Encoder", "options", "ExtensionCodec", "object", "depth", "sizeToWrite", "requiredSize", "newSize", "newBuffer", "newBytes", "newView", "byteLength", "utf8Count", "utf8Encode", "ext", "size", "bytes", "ensureUint8Array", "item", "keys", "count", "key", "value", "data", "values", "setUint64", "setInt64", "encode", "value", "options", "Encoder", "init_encode", "__esmMin", "init_Encoder", "prettyByte", "byte", "init_prettyByte", "__esmMin", "DEFAULT_MAX_KEY_LENGTH", "DEFAULT_MAX_LENGTH_PER_KEY", "CachedKeyDecoder", "init_CachedKeyDecoder", "__esmMin", "init_utf8", "maxKeyLength", "maxLengthPerKey", "i", "byteLength", "bytes", "inputOffset", "records", "FIND_CHUNK", "record", "recordBytes", "j", "value", "cachedValue", "str", "utf8DecodeJs", "slicedCopyOfBytes", "STATE_ARRAY", "STATE_MAP_KEY", "STATE_MAP_VALUE", "mapKeyConverter", "StackPool", "HEAD_BYTE_REQUIRED", "EMPTY_VIEW", "EMPTY_BYTES", "MORE_DATA", "sharedCachedKeyDecoder", "Decoder", "init_Decoder", "__esmMin", "init_prettyByte", "init_ExtensionCodec", "init_int", "init_utf8", "init_typedArrays", "init_CachedKeyDecoder", "init_DecodeError", "key", "DecodeError", "size", "state", "partialState", "e", "CachedKeyDecoder", "_Decoder", "options", "ExtensionCodec", "buffer", "bytes", "ensureUint8Array", "remainingData", "newData", "newBuffer", "posToShow", "view", "pos", "object", "stream", "decoded", "headByte", "totalPos", "prettyByte", "isArray", "isArrayHeaderRequired", "arrayItemsLeft", "DECODE", "byteLength", "stack", "headerOffset", "offset", "utf8Decode", "headOffset", "extType", "data", "value", "getUint64", "getInt64", "decode", "buffer", "options", "Decoder", "init_decode", "__esmMin", "init_Decoder", "init_dist", "__esmMin", "init_encode", "init_decode", "unpack4Bit", "packed", "width", "height", "length", "data", "byte", "p1", "p2", "columnarize", "points", "tree", "useHDC", "count", "x", "y", "angle", "scale", "descriptors", "i", "compactTree", "columnarizeCompact", "node", "c", "decodeTaar", "buffer", "content", "decode", "version", "CURRENT_VERSION", "dataList", "item", "td", "normalizeBuffer", "arr", "Type", "rawData", "w", "h", "unpacked", "kf", "col", "xRaw", "yRaw", "k", "aRaw", "a", "sRaw", "s", "encodeTaar", "encode", "init_protocol", "__esmMin", "init_dist", "PYRAMID_MIN_SIZE", "NUM_BUCKETS_PER_DIMENSION", "DEFAULT_MAX_FEATURES_PER_BUCKET", "ORIENTATION_NUM_BINS", "FREAK_EXPANSION_FACTOR", "globalUseGPU", "DetectorLite", "init_detector_lite", "__esmMin", "init_freak", "init_gpu_compute", "init_lsh_direct", "init_protocol", "width", "height", "options", "numOctaves", "w", "h", "imageData", "octavesToProcess", "_", "i", "data", "pyramidImages", "dogPyramid", "extremas", "prunedExtremas", "ext", "scale", "gpuPyramid", "gpuCompute", "pyramid", "level", "img2", "e", "currentData", "currentWidth", "currentHeight", "shouldProcess", "img1", "o", "sourceData", "downsampled", "output", "temp", "k0", "k1", "k2", "w1", "y", "rowOffset", "sumL0", "x", "pos", "r2", "r1", "p", "b2", "b1", "newWidth", "newHeight", "r0", "dr", "i2", "dog", "j", "octave", "curr", "prev", "next", "val", "isMaxima", "isMinima", "dy", "dx", "neighbor", "px", "py", "prevWidth", "xx", "yy", "nx", "ny", "nextWidth", "nBuckets", "nFeatures", "buckets", "bucketX", "bucketIdx", "result", "bucket", "b", "img", "histogram", "radius", "gradY", "gradX", "mag", "angle", "bin", "weight", "maxBin", "cos", "sin", "samples", "FREAKPOINTS", "fx", "fy", "xp", "yp", "x0", "y0", "x1", "y1", "fracX", "fracY", "computeLSH64", "packLSHIntoDescriptor", "computeFullFREAK", "defaultCompare", "a", "b", "TinyQueue", "init_tinyqueue", "__esmMin", "data", "compare", "i", "item", "top", "bottom", "pos", "parent", "current", "halfLength", "left", "best", "right", "popcount32", "n", "BIT_COUNT_8", "compute64", "compute", "init_hamming_distance", "__esmMin", "i", "c", "v1", "v1Idx", "v2", "v2Idx", "x1", "x2", "count1", "count2", "options", "v1Offset", "v2Offset", "v2Len", "d", "computeHoughMatches", "_mapCorrespondence", "init_hough", "__esmMin", "options", "keywidth", "keyheight", "querywidth", "queryheight", "matches", "maxX", "minX", "maxY", "minY", "numAngleBins", "numScaleBins", "minScale", "maxScale", "scaleOneOverLogK", "maxDim", "keycenterX", "keycenterY", "projectedDims", "i", "queryscale", "keyscale", "scale", "a1", "a2", "medianProjectedDim", "binSize", "numXBins", "numYBins", "numXYBins", "numXYAngleBins", "querypointValids", "querypointBinLocations", "votes", "querypoint", "keypoint", "x", "y", "angle", "fbinX", "fbinY", "fbinAngle", "fbinScale", "binX", "binY", "binScale", "binAngle", "dx", "binX2", "dy", "binY2", "dangle", "binAngle2", "dscale", "binScale2", "binIndex", "maxVotes", "maxVoteIndex", "index", "houghMatches", "relaxedDelta", "queryBins", "temp", "cos", "sin", "S", "tp", "tx", "ty", "createRandomizer", "init_randomizer", "__esmMin", "options", "arr", "sampleSize", "i", "k", "tmp", "maxValue", "linePointSide", "checkFourPointsConsistent", "checkThreePointsConsistent", "determinant", "matrixInverse33", "multiplyPointHomographyInhomogenous", "smallestTriangleArea", "quadrilateralConvex", "_vector", "_areaOfTriangle", "init_geometry", "__esmMin", "A", "B", "C", "x1", "x2", "x3", "x4", "x1p", "x2p", "x3p", "x4p", "C1", "C2", "C3", "threshold", "det", "oneOver", "x", "H", "w", "xp", "v12", "v13", "v14", "v32", "v34", "a1", "a2", "a3", "a4", "first", "a", "b", "u", "v", "toString", "isAnyArray", "value", "tag", "exports", "require_lib", "__commonJSMin", "exports", "module", "isAnyArray", "max", "input", "options", "fromIndex", "toIndex", "maxValue", "require_lib", "__commonJSMin", "exports", "module", "isAnyArray", "min", "input", "options", "fromIndex", "toIndex", "minValue", "require_lib", "__commonJSMin", "exports", "module", "isAnyArray", "max", "min", "_interopDefaultLegacy", "e", "max__default", "min__default", "rescale", "input", "options", "output", "currentMin", "currentMax", "minValue", "maxValue", "factor", "i", "require_matrix", "__commonJSMin", "exports", "isAnyArray", "rescale", "indent", "indentData", "inspectMatrix", "inspectMatrixWithOptions", "matrix", "options", "maxRows", "maxColumns", "maxNumSize", "padMinus", "inspectData", "rows", "columns", "maxI", "maxJ", "result", "loop", "i", "j", "line", "formatNumber", "num", "formatNumber2", "len", "str", "fix", "exp", "installMathOperations", "AbstractMatrix", "Matrix", "value", "arg0", "checkRowIndex", "index", "outer", "max", "checkColumnIndex", "checkRowVector", "vector", "checkColumnVector", "checkRowIndices", "rowIndices", "checkColumnIndices", "columnIndices", "checkRange", "startRow", "endRow", "startColumn", "endColumn", "checkNumber", "newArray", "length", "array", "name", "checkNonEmpty", "sumByRow", "sum", "sumByColumn", "sumAll", "v", "productByRow", "productByColumn", "productAll", "varianceByRow", "unbiased", "mean", "cols", "variance", "sum1", "sum2", "x", "varianceByColumn", "varianceAll", "size", "centerByRow", "centerByColumn", "centerAll", "getScaleByRow", "scale", "scaleByRow", "getScaleByColumn", "scaleByColumn", "getScaleAll", "divider", "scaleAll", "_AbstractMatrix", "newRows", "newColumns", "newData", "newMatrix", "row", "column", "random", "min", "interval", "data", "l", "matrix1", "matrix2", "callback", "copy", "previousColumn", "isEchelonForm", "checked", "isReducedEchelonForm", "k", "h", "iMax", "tmp", "factor", "m", "n", "p", "pivot", "row1", "row2", "temp", "column1", "column2", "by", "idx", "diag", "type", "vector2", "vector1", "dot", "other", "Bcolj", "s", "scalar", "bb", "e", "a11", "b11", "a12", "b12", "a21", "b21", "a22", "b22", "m1", "m2", "m3", "m4", "m5", "m6", "m7", "c00", "c01", "c10", "c11", "a00", "a01", "a02", "a10", "a20", "b00", "b01", "b02", "b10", "b20", "m8", "m9", "m10", "m11", "m12", "m13", "m14", "m15", "m16", "m17", "m18", "m19", "m20", "m21", "m22", "m23", "c02", "c12", "c20", "c21", "c22", "y", "r1", "c1", "r2", "c2", "embed", "mat", "r", "c", "resultat", "blockMult", "a", "b", "halfRows", "halfCols", "middle", "first", "last", "q", "AxI", "IxB", "compareFunction", "compareNumbers", "indices", "rowIndex", "columnIndex", "trace", "from", "to", "center", "col", "isArrayOfNumbers", "element", "_Matrix", "#initData", "nRows", "nColumns", "arrayData", "newRow", "SymmetricMatrix", "_SymmetricMatrix", "#matrix", "diagonalSize", "mask", "sidesToRemove", "passthroughs", "sideIndex", "compact", "compactSize", "DistanceMatrix", "_DistanceMatrix", "sideSize", "compactLength", "BaseView", "MatrixColumnView", "MatrixColumnSelectionView", "MatrixFlipColumnView", "MatrixFlipRowView", "MatrixRowView", "MatrixRowSelectionView", "MatrixSelectionView", "MatrixSubView", "MatrixTransposeView", "WrapperMatrix1D", "WrapperMatrix2D", "wrap", "LuDecomposition", "lu", "pivotVector", "pivotSign", "t", "LUcolj", "kmax", "count", "X", "determinant", "hypotenuse", "QrDecomposition", "qr", "rdiag", "nrm", "SingularValueDecomposition", "computeLeftSingularVectors", "computeRightSingularVectors", "autoTranspose", "wantu", "wantv", "swapped", "aux", "nu", "ni", "U", "V", "work", "si", "nct", "nrt", "mrc", "pp", "eps", "kase", "alpha", "ks", "f", "cs", "sn", "sp", "spm1", "epm1", "sk", "ek", "shift", "g", "Y", "scols", "Ls", "VL", "vrows", "urows", "VLU", "vcols", "ucols", "tol", "ii", "inverse", "useSVD", "solve", "leftHandSide", "rightHandSide", "d", "subMatrix0", "subMatrix1", "subMatrix2", "xrange", "exception", "range", "dependenciesOneRow", "error", "thresholdValue", "thresholdError", "returnArray", "linearDependencies", "results", "Abis", "pseudoInverse", "threshold", "svdSolution", "covariance", "xMatrix", "yMatrix", "yIsSame", "cov", "correlation", "sdx", "sdy", "corr", "EigenvalueDecomposition", "assumeSymmetric", "isSymmetric", "tred2", "tql2", "H", "ort", "orthes", "hqr2", "hh", "dl1", "c3", "el1", "s2", "tst1", "low", "high", "nn", "exshift", "norm", "z", "iter", "w", "ra", "sa", "vr", "vi", "notlast", "cdivres", "cdiv", "xr", "xi", "yr", "yi", "CholeskyDecomposition", "dimension", "positiveDefinite", "B", "nipals", "scaleScores", "maxIterations", "terminationCriteria", "u", "diff", "tOld", "counter", "xResidual", "residual", "yResidual", "matrix", "Matrix", "SingularValueDecomposition", "matrix_default", "inverse", "init_matrix", "__esmMin", "solveHomography", "_normalizePoints", "_denormalizeHomography", "init_homography", "__esmMin", "init_matrix", "srcPoints", "dstPoints", "normSrcPoints", "srcParam", "normDstPoints", "dstParam", "num", "AData", "BData", "j", "row1", "row2", "A", "Matrix", "B", "AT", "ATA", "ATB", "C", "inverse", "coords", "sumX", "sumY", "i", "meanX", "meanY", "sumDiff", "diffX", "diffY", "s", "normPoints", "nH", "sMeanX", "sMeanY", "H", "CAUCHY_SCALE", "CHUNK_SIZE", "NUM_HYPOTHESES", "NUM_HYPOTHESES_QUICK", "computeHomography", "_checkHeuristics", "_normalizeHomography", "_cauchyProjectiveReprojectionCost", "_checkHomographyPointsGeometricallyConsistent", "init_ransacHomography", "__esmMin", "init_randomizer", "init_geometry", "init_homography", "options", "srcPoints", "dstPoints", "keyframe", "quickMode", "testPoints", "sampleSize", "scale", "oneOverScale2", "chuckSize", "randomizer", "createRandomizer", "perm", "i", "numHypothesis", "maxTrials", "trial", "Hs", "checkFourPointsConsistent", "H", "solveHomography", "hypotheses", "curChuckSize", "chuckEnd", "j", "k", "cost", "h1", "h2", "finalH", "mp", "multiplyPointHomographyInhomogenous", "smallestTriangleArea", "quadrilateralConvex", "inH", "oneOver", "srcPoint", "dstPoint", "x", "f", "mappedPoints", "i1", "i2", "i3", "checkThreePointsConsistent", "refineWithMorphology", "imageData", "width", "height", "targetData", "initialH", "iterations", "currentH", "boundaryPoints", "step", "i", "iter", "correspondences", "pt", "w", "sx", "sy", "searchDist", "bestX", "bestY", "maxGrad", "dy", "dx", "nx", "ny", "idx", "gx", "gy", "grad", "nextH", "solveDLTWeight", "pairs", "n", "A", "Matrix", "src", "dst", "x", "y", "xp", "yp", "h", "SingularValueDecomposition", "scale", "v", "init_morph_refinement", "__esmMin", "init_matrix", "popcount32", "n", "MIN_FEATURE_PER_NODE", "NUM_ASSIGNMENT_HYPOTHESES", "NUM_CENTERS", "_computeKMedoids", "build", "_build", "init_hierarchical_clustering", "__esmMin", "init_hamming_distance", "init_randomizer", "options", "descriptors", "pointIndexes", "randomizer", "useHDC", "numPointIndexes", "randomPointIndexes", "i", "bestSumD", "bestAssignment", "centerPointIndices", "k", "sumD", "currentAssignment", "j", "pIdx", "bestD", "bestCenterIdx", "cIdx", "d", "compute64", "points", "numPoints", "createRandomizer", "centerPointIndex", "isLeaf", "clusters", "assignment", "centerIdx", "cluster", "node", "clusterPoints", "INLIER_THRESHOLD", "MIN_NUM_INLIERS", "CLUSTER_MAX_POP", "HAMMING_THRESHOLD", "HDC_RATIO_THRESHOLD", "MAX_MATCH_QUERY_POINTS", "match", "_query", "_findInlierMatches", "init_matching", "__esmMin", "init_tinyqueue", "init_hamming_distance", "init_hough", "init_ransacHomography", "init_geometry", "init_morph_refinement", "init_hierarchical_clustering", "init_constants", "AR_CONFIG", "keyframe", "rawQuerypoints", "querywidth", "queryheight", "debugMode", "expectedScale", "debugExtra", "querypoints", "a", "b", "matches", "qlen", "kmax", "kmin", "isHDC", "isCompact", "descSize", "currentRatioThreshold", "j", "querypoint", "col", "rootNode", "keypointIndexes", "queue", "TinyQueue", "a1", "a2", "bestIndex", "bestD1", "bestD2", "qDesc", "cDesc", "qDescCompact", "k", "idx", "featureScale", "idealKeyScale", "d", "popcount32", "compute", "constellationMatches", "houghMatches", "computeHoughMatches", "H", "computeHomography", "m", "inlierMatches", "HInv", "matrixInverse33", "dThreshold2", "matches2", "hi00", "hi01", "hi02", "hi10", "hi11", "hi12", "hi20", "hi21", "hi22", "qx", "qy", "invZ", "mapX", "mapY", "cx", "cy", "cd", "clen", "dx", "dy", "houghMatches2", "H2", "inlierMatches2", "refineWithMorphology", "node", "descriptors", "numPop", "isLeaf", "childrenOrIndices", "i", "minD", "distances", "cIdx", "dist", "options", "threshold", "threshold2", "h00", "h01", "h02", "h10", "h11", "h12", "h20", "h21", "h22", "goodMatches", "qp", "kp", "mx", "my", "matcher_exports", "__export", "Matcher", "init_matcher", "__esmMin", "init_matching", "queryWidth", "queryHeight", "debugMode", "keyframes", "featurePoints", "expectedScale", "debugExtra", "bestResult", "j", "H", "matches", "frameDebugExtra", "match", "screenCoords", "worldCoords", "keyframe", "kfScale", "i", "querypoint", "keypoint", "pointScale", "solvePosePnP", "screenCoords", "worldCoords", "projectionTransform", "K", "Matrix", "KI", "Inverse3x3", "A", "i", "sci", "wci", "nx", "ny", "nz", "unx", "uny", "X", "Y", "sol", "SingularValueDecomposition", "r1_raw", "r2_raw", "t_raw", "scale1", "scale2", "scale", "R_approx", "svdRot", "U", "Vrot", "R", "m", "U_mat", "k00", "k01", "k02", "k10", "k11", "k12", "k20", "k21", "k22", "invDet", "init_pnp_solver", "__esmMin", "init_matrix", "estimate", "init_estimate", "__esmMin", "init_pnp_solver", "screenCoords", "worldCoords", "projectionTransform", "solvePosePnP", "TRACKING_THRESH", "K2_FACTOR", "ICP_MAX_LOOP", "ICP_BREAK_LOOP_ERROR_THRESH", "ICP_BREAK_LOOP_ERROR_RATIO_THRESH", "mat", "J_U_Xc", "J_Xc_S", "refineEstimate", "_doICP", "_updateModelViewTransform", "_getDeltaS", "_getJ_U_S", "init_refine_estimate", "__esmMin", "init_matrix", "init_utils", "initialModelViewTransform", "projectionTransform", "worldCoords", "screenCoords", "stabilities", "dx", "dy", "i", "normalizedWorldCoords", "diffModelViewTransform", "j", "inlierProbs", "updatedModelViewTransform", "finalModelViewTransform", "ret", "inlierProb", "isRobustMode", "modelViewTransform", "err0", "err1", "E", "E2", "dxs", "dys", "l", "modelViewProjectionTransform", "buildModelViewProjectionTransform", "n", "u", "computeScreenCoordiate", "K2", "inlierNum", "a", "b", "dU", "allJ_U_S", "J_U_S", "robustW", "s", "stabilityW", "W", "dS", "ra", "q0", "q1", "q2", "cra", "sra", "one_cra", "mat2", "J", "Matrix", "U", "JT", "JTJ", "JTU", "JTJInv", "inverse", "worldCoord", "T", "x", "y", "z", "applyModelViewProjectionTransform", "z2", "k", "estimator_exports", "__export", "Estimator", "init_estimator", "__esmMin", "init_estimate", "init_refine_estimate", "projectionTransform", "screenCoords", "worldCoords", "estimate", "initialModelViewTransform", "refineEstimate", "controller_worker_exports", "matchingDataList", "debugMode", "matcher", "estimator", "tracker", "detector", "init_controller_worker", "__esmMin", "init_matcher", "init_estimator", "init_tracker", "init_detector_lite", "msg", "data", "Matcher", "Estimator", "Tracker", "DetectorLite", "interestedTargetIndexes", "matchedTargetIndex", "matchedModelViewTransform", "matchedScreenCoords", "matchedWorldCoords", "matchedDebugExtra", "featurePoints", "i", "matchingIndex", "keyframeIndex", "screenCoords", "worldCoords", "debugExtra", "modelViewTransform", "trackInput", "lastModelViewTransform", "targetIndex", "trackResult", "stabilities", "finalModelViewTransform", "init_tracker", "InputLoader", "width", "height", "canvas", "input", "isInputRotated", "inputW", "inputH", "inputAspect", "canvasAspect", "sx", "sy", "sw", "sh", "imageData", "rgbaData", "grayscale", "len", "i", "offset", "FeatureManager", "feature", "id", "f", "context", "inputData", "targetIndex", "worldMatrix", "result", "isTracking", "show", "data", "LowPassFilter", "alpha", "initval", "value", "OneEuroFilter", "minCutOff", "beta", "dCutOff", "cutoff", "te", "time", "v", "filteredValue", "edvalue", "alpha_d", "edvalue_filtered", "OneEuroFilterFeature", "minCutOff", "beta", "context", "targetIndex", "OneEuroFilter", "worldMatrix", "filter", "stability", "dynamicMinCutOff", "data", "TemporalFilterFeature", "warmup", "miss", "onToggleShowing", "targetIndex", "isTracking", "state", "AutoRotationFeature", "context", "targetIndex", "worldMatrix", "m", "init_detector_lite", "init_protocol", "init_constants", "ControllerWorker", "getControllerWorker", "DEFAULT_FILTER_CUTOFF", "AR_CONFIG", "DEFAULT_FILTER_BETA", "DEFAULT_WARMUP_TOLERANCE", "DEFAULT_MISS_TOLERANCE", "WORKER_TIMEOUT_MS", "loopIdCounter", "Controller", "inputWidth", "inputHeight", "onUpdate", "debugMode", "maxTrack", "warmupTolerance", "missTolerance", "filterMinCF", "filterBeta", "worker", "FeatureManager", "OneEuroFilterFeature", "TemporalFilterFeature", "AutoRotationFeature", "InputLoader", "DetectorLite", "near", "far", "fovy", "f", "e", "fileURLs", "urls", "buffers", "url", "allTrackingData", "allMatchingData", "allDimensions", "buffer", "dataList", "decodeTaar", "item", "Tracker", "input", "inputData", "m", "modelViewTransform", "targetIndex", "targetIndexes", "predictedScale", "state", "screenCoords", "worldCoords", "featurePoints", "lastModelViewTransform", "reliabilities", "indices", "octaveIndex", "deformedMesh", "numPoints", "stabilities", "lastCoords", "i", "idxInResult", "finalScreenCoords", "finalReliabilities", "finalStabilities", "finalWorldCoords", "isCurrentlyTracked", "isWarmup", "_", "globalIdx", "currentLoopId", "acc", "s", "matchingIndexes", "matchedTargetIndex", "trackingState", "result", "wasShowing", "worldMatrix", "finalMatrix", "avgStability", "a", "b", "filteredMatrix", "rotationFeature", "resolve", "debugExtra", "trackFeatures", "expectedScale", "fpPromise", "fp", "timeout", "data", "Matcher", "Estimator", "matchedModelViewTransform", "matchedScreenCoords", "matchedWorldCoords", "matchedDebugExtra", "matchingIndex", "keyframeIndex", "trackingFeatures", "projectionTransform", "width", "height", "proj", "projMatrix", "j", "FovealAttention", "width", "height", "config", "foveaDiam", "parafoveaDiam", "parafoveaScaled", "periphW", "periphH", "r", "size", "y", "x", "dx", "dy", "dist", "inputData", "centerX", "centerY", "priority", "cx", "cy", "diam", "buffer", "idx", "validPixels", "rowStart", "maskIdx", "localX", "localY", "origX", "origY", "res", "scaledDiam", "step", "sy", "sx", "outW", "outH", "foveaPixels", "parafoveaPixels", "peripheryPixels", "SaccadicController", "width", "height", "config", "rows", "cols", "cells", "cellW", "cellH", "c", "saliency", "currentFovea", "trackingState", "targets", "maxTargets", "predicted", "peak", "gridTarget", "matrix", "cx", "cy", "vx", "vy", "axis", "sum", "i", "x", "y", "currentTargets", "r2", "t", "dx", "dy", "oldest", "oldestTime", "cell", "maxHistory", "PredictiveCoding", "width", "height", "config", "inputData", "trackingState", "changeLevel", "threshold", "canSkip", "confidence", "predictedState", "totalDiff", "maxDiff", "numBlocks", "i", "diff", "data", "output", "bs", "w", "by", "yStart", "yEnd", "bx", "xStart", "xEnd", "sum", "count", "y", "rowOffset", "x", "currentState", "matrix", "predictedMatrix", "scaleFactor", "history", "n", "latest", "prev", "dt", "prevScale", "currScale", "older", "expectedVx", "expectedVy", "errorX", "errorY", "error", "SaliencyMap", "width", "height", "inputData", "peaks", "w", "sy", "yStart", "yEnd", "sx", "xStart", "xEnd", "sum", "count", "y", "rowOffset", "x", "h", "intensity", "contrast", "idx", "center", "surround", "edges", "gx", "gy", "n", "saliency", "i", "max", "r", "r2", "candidates", "val", "a", "b", "cand", "suppress", "peak", "dx", "dy", "ScaleOrchestrator", "numOctaves", "options", "trackingState", "_", "i", "activeScale", "octaves", "octave", "result", "a", "b", "BIO_CONFIG", "BioInspiredEngine", "width", "height", "options", "FovealAttention", "SaccadicController", "PredictiveCoding", "SaliencyMap", "ScaleOrchestrator", "fullSize", "foveaSize", "inputData", "trackingState", "startTime", "prediction", "saliency", "saccadeTargets", "attentionRegions", "totalPixelsProcessed", "target", "region", "primary", "octavesToProcess", "latency", "processResult", "changeLevel", "pixelsProcessed", "BioInspiredController", "Controller", "options", "bioOptions", "bioConfig", "BioInspiredEngine", "input", "i", "inputData", "activeTracking", "s", "trackingState", "bioResult", "resolve", "worldMatrix", "acc", "matchingIndexes", "state", "index", "matchedTargetIndex", "modelViewTransform", "featurePoints", "result", "wasShowing", "finalMatrix", "stabilities", "avgStability", "a", "b", "rotationFeature", "targetIndexes", "octavesToProcess", "predictedScale", "m", "targetIndex", "screenCoords", "worldCoords", "expectedScale", "fpPromise", "fp", "timeout", "data", "lastModelViewTransform", "matrix", "j", "flat", "enabled", "downsampleBilinear", "image", "data", "width", "height", "dstWidth", "dstHeight", "temp", "j", "row0", "row1", "dstRow", "i", "i2", "val", "resize", "ratio", "imageData", "srcData", "srcW", "srcH", "srcW_1", "srcH_1", "dstIndex", "srcY", "y0", "y1", "fy", "ify", "srcX", "x0", "x1", "fx", "ifx", "val0", "val1", "value", "init_constants", "MIN_IMAGE_PIXEL_SIZE", "AR_CONFIG", "buildTrackingImageList", "inputImage", "minDimension", "scaleList", "imageList", "AR_CONFIG", "i", "resize", "Cumsum", "data", "width", "height", "i", "j", "pos", "x1", "y1", "x2", "y2", "ret", "init_gpu_compute", "SEARCH_SIZE1", "SEARCH_SIZE2", "TEMPLATE_SIZE", "TEMPLATE_SD_THRESH", "MAX_THRESH", "MIN_THRESH", "OCCUPANCY_SIZE", "useGPU", "extract", "image", "imageData", "width", "height", "dValue", "isCandidate", "useGPU", "result", "gpuCompute", "j", "rowOffset", "prevRowOffset", "nextRowOffset", "i", "pos", "dx", "dy", "val", "dValueHist", "allCount", "k", "maxPoints", "kThresh", "filteredCount", "minDValue", "imageDataSqr", "imageDataCumsum", "Cumsum", "imageDataSqrCumsum", "candidates", "a", "b", "divSize", "TEMPLATE_SIZE", "maxFeatureNum", "OCCUPANCY_SIZE", "coords", "invalidated", "templateWidth", "nPixels", "actualOccSize", "x", "y", "SEARCH_SIZE1", "vlen", "_templateVar", "TEMPLATE_SD_THRESH", "templateAvg", "templateData", "tidx", "tStart", "tj", "ti", "max", "jj", "ii", "SEARCH_SIZE2", "sim", "_getSimilarityOptimized", "MAX_THRESH", "minUnique", "maxUnique", "failedUnique", "MIN_THRESH", "yy", "rowStart", "xx", "cx", "cy", "sdThresh", "average", "options", "templateSize", "nP", "sx", "vlen2", "sxy", "p1_start", "rowOffset1", "rowOffset2", "sampledCount", "totalCount", "extractTrackingFeatures", "imageList", "doneCallback", "featureSets", "i", "image", "points", "extract", "featureSet", "init_detector_lite", "init_hierarchical_clustering", "init_protocol", "triangulate", "points", "minX", "minY", "maxX", "maxY", "p", "dx", "dy", "deltaMax", "midX", "midY", "p1", "p2", "p3", "triangles", "i", "badTriangles", "t", "isInCircumcircle", "polygon", "edges", "edge", "isShared", "t2", "isSameEdge", "x1", "y1", "x2", "y2", "x3", "y3", "D", "centerX", "centerY", "radiusSq", "triangle", "tEdges", "te", "getEdges", "edgeSet", "pairs", "pair", "low", "high", "key", "init_constants", "isNode", "OfflineCompiler", "images", "progressCallback", "targetImages", "img", "greyImageData", "j", "offset", "results", "i", "matchingResults", "p", "trackingResults", "_", "percentPerImage", "currentPercent", "targetImage", "detector", "DetectorLite", "AR_CONFIG", "rawPs", "octaves", "ps", "featuresPerOctave", "oct", "octScale", "octFeatures", "a", "b", "maximaPoints", "minimaPoints", "maximaPointsCluster", "build", "minimaPointsCluster", "keyframe", "imageList", "buildTrackingImageList", "percentPerScale", "trackingData", "extractTrackingFeatures", "basePercent", "percent", "dataList", "item", "td", "count", "px", "py", "triangles", "triangulate", "edges", "getEdges", "restLengths", "p1", "p2", "kf", "columnarizeFn", "columnarizeCompact", "columnarize", "encodeTaar", "buffer", "result", "decodeTaar", "projectToScreen", "x", "y", "z", "mVT", "proj", "videoW", "videoH", "containerRect", "needsRotation", "tx", "ty", "tz", "bx", "by", "vW", "vH", "perspectiveScale", "displayW", "displayH", "offsetX", "offsetY", "sx", "sy", "init_constants", "WIDTH", "AR_CONFIG", "HEIGHT", "video", "arCanvas", "debugCanvas", "arCtx", "debugCtx", "btnCapture", "btnReset", "scanLine", "overlayImg", "capturePreview", "arContainer", "controller", "captureCanvas", "isTesting", "log", "msg", "instructionText", "dpr", "rect", "startCamera", "stream", "err", "drawVideoToCanvas", "ctx", "videoElement", "targetWidth", "targetHeight", "videoWidth", "videoHeight", "videoRatio", "targetRatio", "sx", "sy", "sw", "sh", "compiler", "OfflineCompiler", "compiledData", "p", "buffer", "cleanBuffer", "BioInspiredController", "data", "handleARUpdate", "startProcessingLoop", "e", "processFrame", "markerW", "markerH", "scaleX", "scaleY", "featurePoints", "drawFeaturePoints", "worldMatrix", "modelViewTransform", "screenCoords", "drawTrackingPoints", "positionOverlay", "points", "limit", "i", "coords", "mVT", "proj", "containerRect", "pUL", "projectToScreen", "pUR", "pLL", "pLR", "matrix", "solveHomography", "w", "h", "p1", "p2", "p3", "p4", "x1", "y1", "x2", "y2", "x3", "y3", "x4", "y4", "dx1", "dx2", "dx3", "dy1", "dy2", "dy3", "a", "b", "c", "d", "f", "g", "h_coeff", "det"]
}
