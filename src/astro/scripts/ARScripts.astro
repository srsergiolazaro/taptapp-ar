<script is:inline>
  // Lógica mejorada para reproducción de video
  let started = false;
  let playing = false;

  window.addEventListener("click", async function () {
    try {
      let video = document.querySelector("#ar-video");
      let avideo = document.querySelector("a-video");

      if (!video || !avideo) {
        console.error("Elementos de video no encontrados");
        return;
      }

      if (!started) {
        await video.play();
        avideo.setAttribute("opacity", 1);
        started = true;
        playing = true;
      } else {
        if (playing) {
          video.pause();
          playing = false;
        } else {
          await video.play();
          playing = true;
        }
      }
    } catch (error) {
      console.error("Error en la reproducción del video:", error);
    }
  });
</script>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    const scene = document.querySelector("a-scene");
    const errorOverlay = document.getElementById("error-overlay");
    const scanningOverlay = document.getElementById("scanning-overlay");
    const videoEl = document.querySelector("#ar-video");
    const mainVideo = document.querySelector("#main-video");
    const targetImage = document.querySelector("#target-image");

    if (!scene || !errorOverlay || !scanningOverlay || !videoEl || !mainVideo || !targetImage) {
      console.error("Elementos críticos no encontrados");
      if (errorOverlay) errorOverlay.classList.remove("hidden");
      return;
    }

    // Verificación de recursos
    targetImage.addEventListener("error", () => {
      console.error("Error al cargar la imagen objetivo");
      errorOverlay.classList.remove("hidden");
    });

    videoEl.addEventListener("error", () => {
      console.error("Error al cargar el video");
      errorOverlay.classList.remove("hidden");
    });

    // Gestión mejorada de errores AR
    scene.addEventListener("arError", (event) => {
      console.error("Error AR:", event);
      errorOverlay.classList.remove("hidden");
    });

    // Verificar si MindAR está disponible
    if (!window.MINDAR || !window.MINDAR.IMAGE) {
      console.error("MindAR no está disponible");
      errorOverlay.classList.remove("hidden");
      return;
    }

    // Manejo de eventos de target
    const targetEntity = document.querySelector("a-entity[mindar-image-target]");

    targetEntity.addEventListener("targetFound", () => {
      console.log("¡Objetivo encontrado!");
      scanningOverlay.classList.add("hidden");

      // Hacer visible el video
      mainVideo.setAttribute("opacity", "1");

      // Intentar reproducir
      videoEl.play().catch((err) => {
        console.error("Error reproduciendo video:", err);
      });
    });

    targetEntity.addEventListener("targetLost", () => {
      console.log("Objetivo perdido");
      scanningOverlay.classList.remove("hidden");
      mainVideo.setAttribute("opacity", "0");
    });

    // Función para aplicar estilos adaptativos
    function applyVideoStyles() {
      // Estilos del elemento video HTML
      if (videoEl) {
        videoEl.style.width = "100%";
        videoEl.style.height = "100%";
        videoEl.style.objectFit = "contain";
      }
    }

    // Aplicar estilos al inicio y cuando cambie la orientación
    applyVideoStyles();
    window.addEventListener("resize", applyVideoStyles);

    // Manejar toques para dispositivos móviles
    document.addEventListener("touchstart", () => {
      if (videoEl.paused && mainVideo.getAttribute("opacity") === "1") {
        videoEl.play().catch((e) => console.log("Error en touchstart:", e));
      }
    });
  });
</script>
